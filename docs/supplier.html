<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>supplier API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Supplier">Supplier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Supplier.__init__">Supplier</a>
                        </li>
                        <li>
                                <a class="class" href="#Supplier.ReceiveBuyRequest">Supplier.ReceiveBuyRequest</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.ReceiveBuyRequest.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#Supplier.AcceptBuyRequest">Supplier.AcceptBuyRequest</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.AcceptBuyRequest.__init__">AcceptBuyRequest</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.AcceptBuyRequest.request_id">request_id</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.AcceptBuyRequest.quant">quant</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.AcceptBuyRequest.product">product</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.AcceptBuyRequest.sender">sender</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.AcceptBuyRequest.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#Supplier.ReceiveConfirmationOrDenial">Supplier.ReceiveConfirmationOrDenial</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.ReceiveConfirmationOrDenial.__init__">ReceiveConfirmationOrDenial</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.ReceiveConfirmationOrDenial.accepted_id">accepted_id</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.ReceiveConfirmationOrDenial.accepted_quantity">accepted_quantity</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.ReceiveConfirmationOrDenial.accepted_product">accepted_product</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.ReceiveConfirmationOrDenial.sender_jid">sender_jid</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.ReceiveConfirmationOrDenial.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#Supplier.ReceiveVehicleArrival">Supplier.ReceiveVehicleArrival</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.ReceiveVehicleArrival.add_metadata">add_metadata</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.ReceiveVehicleArrival.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#Supplier.AssignVehicle">Supplier.AssignVehicle</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.AssignVehicle.__init__">AssignVehicle</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.AssignVehicle.request_id">request_id</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.AssignVehicle.populate_vehicles_from_contacts">populate_vehicles_from_contacts</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.AssignVehicle.create_presence_info_message">create_presence_info_message</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.AssignVehicle.create_call_for_proposal_message">create_call_for_proposal_message</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.AssignVehicle.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#Supplier.ReceivePresenceInfo">Supplier.ReceivePresenceInfo</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.ReceivePresenceInfo.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#Supplier.ReceiveVehicleProposals">Supplier.ReceiveVehicleProposals</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.ReceiveVehicleProposals.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#Supplier.ChooseBestVehicle">Supplier.ChooseBestVehicle</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.ChooseBestVehicle.__init__">ChooseBestVehicle</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#Supplier.ChooseBestVehicle.request_id">request_id</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.ChooseBestVehicle.get_best_vehicle">get_best_vehicle</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#Supplier.ChooseBestVehicle.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#Supplier.ReceiveTimeDelta">Supplier.ReceiveTimeDelta</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#Supplier.ReceiveTimeDelta.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#Supplier.print_stats">print_stats</a>
                        </li>
                        <li>
                                <a class="function" href="#Supplier.update_graph">update_graph</a>
                        </li>
                        <li>
                                <a class="function" href="#Supplier.message_to_order">message_to_order</a>
                        </li>
                        <li>
                                <a class="function" href="#Supplier.dict_to_order">dict_to_order</a>
                        </li>
                        <li>
                                <a class="variable" href="#Supplier.node_id">node_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#Supplier.map">map</a>
                        </li>
                        <li>
                                <a class="variable" href="#Supplier.pos_x">pos_x</a>
                        </li>
                        <li>
                                <a class="variable" href="#Supplier.pos_y">pos_y</a>
                        </li>
                        <li>
                                <a class="variable" href="#Supplier.contact_list">contact_list</a>
                        </li>
                        <li>
                                <a class="variable" href="#Supplier.verbose">verbose</a>
                        </li>
                        <li>
                                <a class="variable" href="#Supplier.id_base">id_base</a>
                        </li>
                        <li>
                                <a class="function" href="#Supplier.setup">setup</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
supplier    </h1>

                        <div class="docstring"><p>Supplier Agent Module for Supply Chain Optimization System.</p>

<p>This module implements the Supplier agent, which provides infinite inventory to warehouses
in the supply chain. The Supplier serves as the ultimate source of materials, responding
to warehouse purchase requests and coordinating vehicle delivery logistics.</p>

<p>The module implements the FIPA Contract Net Protocol as a <strong>Participant</strong> role:</p>

<ul>
<li><strong>Responds</strong> to warehouse purchase requests (warehouse-buy CFP)</li>
<li><strong>Proposes</strong> materials (supplier-accept)</li>
<li><strong>Receives awards</strong> (warehouse-confirm) or rejections (warehouse-deny)</li>
<li><strong>Coordinates vehicles</strong> for delivery to warehouses</li>
</ul>

<h6 id="key-features">Key Features:</h6>

<blockquote>
  <ul>
  <li>Infinite stock of all products (never runs out)</li>
  <li>Concurrent request handling from multiple warehouses</li>
  <li>Vehicle coordination for material delivery</li>
  <li>Order tracking through pending_deliveries system</li>
  </ul>
</blockquote>

<h6 id="typical-usage-example">Typical usage example:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">world.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">Graph</span>

<span class="c1"># Initialize graph and supplier agent</span>
<span class="n">map_graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">supplier</span> <span class="o">=</span> <span class="n">Supplier</span><span class="p">(</span>
    <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;supplier1@localhost&quot;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;supplier_password&quot;</span><span class="p">,</span>
    <span class="nb">map</span><span class="o">=</span><span class="n">map_graph</span><span class="p">,</span>
    <span class="n">node_id</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">contact_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;warehouse1@localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle1@localhost&quot;</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">supplier</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre>
  </div>
</blockquote>
</div>

                        <input id="mod-supplier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-supplier-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">Supplier Agent Module for Supply Chain Optimization System.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">This module implements the Supplier agent, which provides infinite inventory to warehouses</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">in the supply chain. The Supplier serves as the ultimate source of materials, responding</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">to warehouse purchase requests and coordinating vehicle delivery logistics.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">The module implements the FIPA Contract Net Protocol as a **Participant** role:</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">- **Responds** to warehouse purchase requests (warehouse-buy CFP)</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">- **Proposes** materials (supplier-accept)</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">- **Receives awards** (warehouse-confirm) or rejections (warehouse-deny)</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">- **Coordinates vehicles** for delivery to warehouses</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">Key Features:</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">    - Infinite stock of all products (never runs out)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">    - Concurrent request handling from multiple warehouses</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">    - Vehicle coordination for material delivery</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">    - Order tracking through pending_deliveries system</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">Typical usage example:</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">    ```python</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">    from world.graph import Graph</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">    </span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">    # Initialize graph and supplier agent</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">    map_graph = Graph()</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">    supplier = Supplier(</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">        jid=&quot;supplier1@localhost&quot;,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">        password=&quot;supplier_password&quot;,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">        map=map_graph,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">        node_id=20,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">        contact_list=[&quot;warehouse1@localhost&quot;, &quot;vehicle1@localhost&quot;],</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">        verbose=True</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    )</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">    await supplier.start()</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    ```</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">queue</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">spade</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.behaviour</span><span class="w"> </span><span class="kn">import</span> <span class="n">OneShotBehaviour</span><span class="p">,</span> <span class="n">CyclicBehaviour</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.template</span><span class="w"> </span><span class="kn">import</span> <span class="n">Template</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.presence</span><span class="w"> </span><span class="kn">import</span> <span class="n">PresenceShow</span><span class="p">,</span> <span class="n">Contact</span><span class="p">,</span> <span class="n">PresenceInfo</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">world.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Edge</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">veiculos.veiculos</span><span class="w"> </span><span class="kn">import</span> <span class="n">Order</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="c1"># Configuration for pdoc sidebar visibility</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="n">__pdoc__</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    <span class="c1"># Hide auxiliary functions</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="s1">&#39;decode_ID&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="s1">&#39;str_to_dict&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="s1">&#39;decode_vehicle_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="s1">&#39;dict_to_json&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="c1"># Hide internal class variables</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>    <span class="s1">&#39;Supplier.id_base&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>    <span class="s1">&#39;Supplier.total_supplied&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>    <span class="s1">&#39;Supplier.pending_deliveries&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>    <span class="s1">&#39;Supplier.vehicle_proposals&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>    <span class="s1">&#39;Supplier.vehicles&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>    <span class="s1">&#39;Supplier.presence_infos&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>    <span class="s1">&#39;Supplier.current_tick&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>    <span class="s1">&#39;Supplier.node_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>    <span class="s1">&#39;Supplier.map&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>    <span class="s1">&#39;Supplier.contact_list&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>    <span class="s1">&#39;Supplier.verbose&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>    <span class="s1">&#39;Supplier.available_contacts&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>    <span class="s1">&#39;Supplier.wait_contact_list&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>    
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>    <span class="c1"># Hide behaviour __init__ methods</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="s1">&#39;Supplier.ReceiveBuyRequest.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="s1">&#39;Supplier.AcceptBuyRequest.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>    <span class="s1">&#39;Supplier.ReceiveConfirmationOrDenial.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>    <span class="s1">&#39;Supplier.AssignVehicle.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>    <span class="s1">&#39;Supplier.ReceivePresenceInfo.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="s1">&#39;Supplier.ReceiveVehicleProposals.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>    <span class="s1">&#39;Supplier.ChooseBestVehicle.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>    <span class="s1">&#39;Supplier.ReceiveVehicleArrival.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    <span class="s1">&#39;Supplier.ReceiveTimeDelta.__init__&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>    <span class="c1"># Hide behaviour instance variables</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="s1">&#39;Supplier.ReceiveBuyRequest.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="s1">&#39;Supplier.AcceptBuyRequest.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="s1">&#39;Supplier.AcceptBuyRequest.order_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="s1">&#39;Supplier.AcceptBuyRequest.warehouse_jid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="s1">&#39;Supplier.AcceptBuyRequest.product&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>    <span class="s1">&#39;Supplier.AcceptBuyRequest.quantity&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>    <span class="s1">&#39;Supplier.ReceiveConfirmationOrDenial.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="s1">&#39;Supplier.AssignVehicle.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>    <span class="s1">&#39;Supplier.AssignVehicle.order&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>    <span class="s1">&#39;Supplier.AssignVehicle.warehouse_jid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>    <span class="s1">&#39;Supplier.ReceivePresenceInfo.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>    <span class="s1">&#39;Supplier.ReceivePresenceInfo.order_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>    <span class="s1">&#39;Supplier.ReceiveVehicleProposals.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>    <span class="s1">&#39;Supplier.ReceiveVehicleProposals.order_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="s1">&#39;Supplier.ReceiveVehicleProposals.warehouse_jid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="s1">&#39;Supplier.ChooseBestVehicle.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    <span class="s1">&#39;Supplier.ChooseBestVehicle.order_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="s1">&#39;Supplier.ChooseBestVehicle.warehouse_jid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>    <span class="s1">&#39;Supplier.ReceiveVehicleArrival.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>    <span class="s1">&#39;Supplier.ReceiveTimeDelta.agent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="p">}</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Supplier</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">    Supplier Agent for Supply Chain Management System.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">    </span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">    The Supplier agent acts as the ultimate source of materials in the supply chain,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">    providing infinite inventory to warehouses. It implements the FIPA Contract Net</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">    Protocol as a **Participant**, responding to warehouse requests and coordinating</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">    vehicle deliveries.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">    </span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">    FIPA Contract Net Protocol - Participant Role Implementation:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">    </span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">    **As Participant (with Warehouses)**:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">        - **Proposal Phase**: Receives warehouse-buy CFP from warehouses</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">        - **Proposal Submission**: Always sends supplier-accept (has infinite stock)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">        - **Result Reception**: Receives warehouse-confirm (accept-proposal) or warehouse-deny (reject-proposal)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        - **Execution**: Coordinates vehicle delivery for confirmed orders</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">    </span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">    Infinite Stock Model:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        Unlike Store and Warehouse agents, the Supplier has unlimited inventory:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        - Never rejects requests due to insufficient stock</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        - Always responds with supplier-accept (FIPA propose)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">        - Tracks total supplied quantities for statistics only</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">        - No stock locking or capacity constraints</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">    </span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">    Order Lifecycle:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        1. **Request Reception**: Warehouse sends warehouse-buy (FIPA CFP)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        2. **Automatic Acceptance**: Supplier sends supplier-accept (FIPA propose)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">        3. **Awaiting Award**: Wait for warehouse decision (10 second timeout)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">        4. **Confirmation**: Warehouse sends warehouse-confirm (FIPA accept-proposal)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        5. **Vehicle Assignment**: Launch AssignVehicle to coordinate delivery</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">        6. **Delivery Tracking**: Order added to pending_deliveries</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">        7. **Pickup**: Vehicle picks up materials from supplier</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">        8. **Completion**: Order removed from pending_deliveries</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">    </span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">    ID Encoding System:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        Uses hierarchical encoding for generating unique request identifiers:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">        - Formula: `agent_type * 100_000_000 + instance_id * 1_000_000 + request_counter`</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        - Agent type code for Supplier: 3</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        - Example: supplier1&#39;s base ID = 3_001_000_000</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">    </span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">    Attributes:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        jid (str): Jabber ID of the supplier agent (e.g., &quot;supplier1@localhost&quot;).</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        node_id (int): Graph node ID representing the supplier&#39;s physical location.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        map (Graph): Reference to the world graph for pathfinding calculations.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">        contact_list (list[str]): JIDs for warehouses and vehicles.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        verbose (bool): Flag to control debug output verbosity.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        id_base (int): Base value for generating unique request IDs.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        total_supplied (dict[str, int]): Cumulative quantities supplied per product.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">            Format: {product: total_quantity_supplied}</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        pending_deliveries (dict[int, Order]): Confirmed orders awaiting vehicle pickup.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">            Format: {order_id: Order object}</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">        vehicle_proposals (dict[int, dict[str, tuple[bool, int]]]): Vehicle delivery proposals.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">            Format: {order_id: {vehicle_jid: (can_fit, delivery_time)}}</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">        vehicles (list[str]): List of vehicle JIDs discovered from contacts.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        presence_infos (dict[str, str]): Vehicle presence status cache.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        current_tick (int): Current simulation time, synchronized by world agent.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">    </span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">    Behaviours:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">        Warehouse Interaction (FIPA Participant):</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">            - ReceiveBuyRequest: Processes warehouse purchase requests (FIPA CFP)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">            - AcceptBuyRequest: Sends proposal to warehouse (FIPA propose)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">            - ReceiveConfirmationOrDenial: Handles warehouse award/rejection</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">        </span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">        Vehicle Coordination:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">            - AssignVehicle: Initiates vehicle assignment for deliveries</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">            - ReceivePresenceInfo: Checks vehicle availability</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">            - ReceiveVehicleProposals: Collects vehicle delivery proposals</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">            - ChooseBestVehicle: Selects optimal vehicle using scoring algorithm</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">            - ReceiveVehicleArrival: Handles vehicle pickup notifications</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        </span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">        Time Management:</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">            - ReceiveTimeDelta: Synchronizes simulation time and traffic updates</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">    </span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">    Message Protocols:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">        Incoming from Warehouses:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">            - warehouse-buy: Purchase request (FIPA CFP)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">            - warehouse-confirm: Order confirmation (FIPA accept-proposal)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="sd">            - warehouse-deny: Order rejection (FIPA reject-proposal)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">        </span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">        Outgoing to Warehouses:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">            - supplier-accept: Material proposal (FIPA propose)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        </span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">        Vehicle Communication:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">            - order-proposal: Request vehicle delivery quote</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">            - vehicle-proposal: Vehicle delivery proposal</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">            - order-confirmation: Confirm vehicle assignment</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">            - vehicle-pickup: Vehicle picks up order from supplier</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">            - presence-info: Request vehicle availability</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">            - presence-response: Vehicle availability status</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">    </span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">    Usage Instructions:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">        **For Vehicle Integration**:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">            - All vehicles must subscribe to all suppliers (mutual presence subscription)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">            - Vehicles access pending orders via `supplier_agent.pending_deliveries.values()`</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">            - Vehicle pickup removes order from pending_deliveries</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        </span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">        **For Warehouse Integration**:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">            - Warehouses send warehouse-buy requests to supplier</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">            - Supplier always accepts (infinite stock)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">            - Warehouse selects winning supplier based on delivery time</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">    </span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">    Example:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        ```python</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">        supplier = Supplier(</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">            jid=&quot;supplier1@localhost&quot;,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">            password=&quot;password&quot;,</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">            map=world_graph,</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">            node_id=20,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">            contact_list=[&quot;warehouse1@localhost&quot;, &quot;vehicle1@localhost&quot;],</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">            verbose=True</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        )</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">        await supplier.start()</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        </span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        # Access statistics</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        print(supplier.total_supplied)  # {&#39;electronics&#39;: 500, &#39;textiles&#39;: 300}</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        </span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">        # Access pending orders (for vehicles)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">        for order in supplier.pending_deliveries.values():</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">            print(f&quot;Order {order.orderid}: {order.quantity}x{order.product}&quot;)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        ```</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">    </span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">    Note:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">        The infinite stock model simplifies the supply chain by eliminating upstream</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">        constraints, allowing focus on warehouse inventory management and vehicle logistics.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>    
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>    <span class="c1">#          SUPPLIER &lt;-&gt; WAREHOUSE</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>    
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveBuyRequest</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        Cyclic behaviour that processes incoming purchase requests from warehouses.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">        </span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        This behaviour implements the proposal phase of the FIPA Contract Net Protocol</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        where the supplier acts as a **Participant**. It receives CFP messages from</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        warehouses and automatically accepts all requests since the supplier has</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        infinite stock.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        </span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        FIPA Protocol Phase: **Proposal Phase - Participant Role**</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">            - Role: Participant (Supplier responding to Warehouse&#39;s CFP)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">            - Receives: warehouse-buy messages (FIPA CFP)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">            - Evaluates: Always accepts (infinite stock model)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">            - Responds: supplier-accept (FIPA propose) for every request</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        </span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">        Infinite Stock Advantage:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">            Unlike warehouses that must check inventory:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">            - No stock validation needed</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">            - No rejection logic (always accepts)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">            - No stock locking mechanism required</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">            - Simplifies participant role implementation</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        </span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        Message Format (warehouse-buy):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">            Metadata:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">                - performative: &quot;warehouse-buy&quot;</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">                - request_id: Unique request identifier</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">            Body:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">                - Format: &quot;{quantity} {product}&quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">                - Example: &quot;100 raw_materials&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        </span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        Workflow:</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">            1. **Receive**: Wait up to 20 seconds for warehouse-buy message</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">            2. **Parse**: Extract request_id, quantity, product from message</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">            3. **Accept**: Launch AcceptBuyRequest behaviour (always accept)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">            4. **Track**: Update total_supplied statistics</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">            5. **Continue**: Return to listening (cyclic behaviour)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">        </span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        Statistics Tracking:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">            Maintains cumulative supply counts per product:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">            - Increment total_supplied[product] by quantity</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">            - Create entry if product not yet supplied</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">            - Used for monitoring and reporting only</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">        </span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        Concurrency Handling:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">            - Processes multiple warehouse requests concurrently</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">            - Each request launches independent AcceptBuyRequest behaviour</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">            - No race conditions (infinite stock eliminates conflicts)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">        </span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">        Example Execution:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">            ```</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">            Request Received: &quot;100 electronics&quot; (request_id=201000000)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">            From: warehouse1@localhost</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">            Decision: ACCEPT (always)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">            Actions:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">                - total_supplied[electronics]: 500 -&gt; 600</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">                - Launch AcceptBuyRequest</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">                - Print: &quot;Request 201000000: 100 xelectronics from warehouse1 received.&quot;</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">            ```</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">        </span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">        Timeout Behavior:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">            If no message received in 20 seconds:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">            - Log timeout (if verbose enabled)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">            - Continue listening (cyclic behaviour doesn&#39;t terminate)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">        </span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">        Note:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">            This behaviour never terminates (cyclic), continuously listening for</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">            warehouse requests throughout the supplier&#39;s lifecycle.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Awaiting buy request from warehouses...&quot;</span><span class="p">)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">                Messages with metadata (&quot;performative&quot;, &quot;warehouse-buy&quot;) have body</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">                with the following format:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">                </span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">                &quot;product_quantity product_type&quot;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">                </span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">                request_id is in metadata[&quot;request_id&quot;]</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>                <span class="n">request_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>                <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>                <span class="n">quant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>                <span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>                <span class="c1"># Essential print - request received</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Request </span><span class="si">{</span><span class="n">request_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quant</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> received.&quot;</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>                
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>                <span class="c1"># Supplier has infinite stock - always accept</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>                <span class="n">accept_behav</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">AcceptBuyRequest</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>                
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>                <span class="c1"># Track total supplied (no need to lock since infinite)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>                <span class="k">if</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quant</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> supplied: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">accept_behav</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Did not get any buy requests in 20 seconds.&quot;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">AcceptBuyRequest</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        Behaviour that sends proposal acceptance to warehouse (FIPA propose).</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        </span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        This behaviour implements the proposal submission in the FIPA Contract Net</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        Protocol where the supplier, acting as a participant, sends its proposal</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        to fulfill the warehouse&#39;s request. Since the supplier has infinite stock,</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">        this is always an acceptance. It then sets up to receive the warehouse&#39;s</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        decision (accept-proposal or reject-proposal).</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">        </span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">        FIPA Protocol Phase: **Proposal Submission - Participant Role**</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">            - Role: Participant (Supplier proposing to Warehouse)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">            - Sends: supplier-accept (FIPA propose)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">            - Purpose: &quot;I can fulfill your request&quot; (always true for supplier)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">            - Next Phase: Await warehouse&#39;s award or rejection decision</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">        </span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">        Attributes:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">            request_id (int): Unique identifier for this request.</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">            quant (int): Quantity of product being proposed.</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">            product (str): Name of product being proposed.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">            sender (str): Warehouse JID that initiated the request.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">        </span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">        Message Format (supplier-accept):</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">            Metadata:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">                - performative: &quot;supplier-accept&quot; (FIPA propose)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">                - supplier_id: This supplier&#39;s JID</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">                - warehouse_id: Requesting warehouse&#39;s JID</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">                - node_id: Supplier&#39;s graph location</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">                - request_id: Original request identifier</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">            Body:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">                - Format: &quot;{quantity} {product}&quot;</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">                - Example: &quot;100 electronics&quot;</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">        </span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">        Workflow:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">            1. **Log Acceptance** (verbose): Print proposal details</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">            2. **Construct Message**: Create supplier-accept with all metadata</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">            3. **Send Proposal**: Transmit to requesting warehouse</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">            4. **Create Listener**: Initialize ReceiveConfirmationOrDenial behaviour</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">            5. **Setup Template**: Configure filter for this specific negotiation</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">            6. **Register Listener**: Add behaviour with template to agent</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">            7. **Return**: Don&#39;t block (listener runs independently)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        </span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">        Template Configuration:</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">            Filters messages to match:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">            - supplier_id: This supplier</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">            - warehouse_id: Specific warehouse that made request</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">            - request_id: This specific request</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">            </span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">            Accepts both performatives:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">            - warehouse-confirm (FIPA accept-proposal)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">            - warehouse-deny (FIPA reject-proposal)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">        </span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">        Non-Blocking Design:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">            The commented-out `await confirm_deny_behav.join()` demonstrates</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">            that we intentionally DON&#39;T wait for confirmation here. This allows</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">            the supplier to accept multiple warehouse requests concurrently.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">        </span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">        Example:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">            ```</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">            Input: Warehouse request for &quot;100 electronics&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">            Proposal Sent: supplier-accept with body &quot;100 electronics&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">            Listener Setup: ReceiveConfirmationOrDenial waiting for:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">                - warehouse-confirm (award) OR</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">                - warehouse-deny (rejection)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">            Result: Supplier ready to process next request</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">            ```</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        </span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">        Side Effects:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">            - Sends SPADE message to warehouse</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">            - Adds ReceiveConfirmationOrDenial behaviour to agent</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">            - Prints debug information if verbose enabled</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        </span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">        Note:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">            Unlike warehouse AcceptBuyRequest, this never needs to lock stock</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">            since the supplier has infinite inventory.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">):</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">            Initialize the AcceptBuyRequest behaviour.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">            </span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">            Args:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">                msg (Message): The warehouse-buy request message to accept.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">quant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">sender</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>            
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Accepted a request from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>                    <span class="sa">f</span><span class="s2">&quot;id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>                    <span class="sa">f</span><span class="s2">&quot;quant=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quant</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>                    <span class="sa">f</span><span class="s2">&quot;product=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>                <span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>            
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;supplier-accept&quot;</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">))</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quant</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Sending supplier-accept message to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Message metadata: warehouse_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">, request_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>            
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Message sent successfully!&quot;</span><span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>            <span class="c1"># Wait for either confirmation or denial</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>            <span class="n">confirm_deny_behav</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">ReceiveConfirmationOrDenial</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>            
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="c1"># Template that matches BOTH warehouse-confirm AND warehouse-deny</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">))</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">confirm_deny_behav</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; AcceptBuyRequest finished, now waiting for confirmation or denial...&quot;</span><span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="c1"># Aguardar a confirmao ser recebida antes de terminar</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="c1"># await confirm_deny_behav.join()</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>    
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveConfirmationOrDenial</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">        Behaviour that processes warehouse&#39;s award or rejection decision (FIPA result notification).</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">        </span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        This behaviour implements the result notification reception in the FIPA Contract Net</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        Protocol where the supplier, acting as a participant, receives the warehouse&#39;s final</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">        decision about whether its proposal was accepted or rejected.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">        </span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        FIPA Protocol Phase: **Result Notification Reception - Participant Role**</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">            - Role: Participant (Supplier receiving Warehouse&#39;s decision)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">            - Receives: warehouse-confirm (FIPA accept-proposal) or warehouse-deny (FIPA reject-proposal)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">            - Actions:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">                - If confirm: Add order to pending_deliveries, assign vehicle</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">                - If deny: Log rejection (no rollback needed - infinite stock)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">                - If timeout: Log timeout (warehouse chose another supplier)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">        </span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a><span class="sd">        Order State Transitions:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">        </span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="sd">            **On warehouse-confirm (Award)**:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">                1. Convert message to Order object</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">                2. pending_deliveries[order_id] = order</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">                3. Launch AssignVehicle behaviour</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">                4. Print confirmation message</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">            </span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">            **On warehouse-deny or timeout (Rejection/Timeout)**:</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">                1. Log rejection/timeout (if verbose)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">                2. No state changes needed (infinite stock)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">                3. No further action required</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">        </span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">        Attributes:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">            accepted_id (int): Request ID for which we sent proposal.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a><span class="sd">            accepted_quantity (int): Quantity that was proposed.</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">            accepted_product (str): Product that was proposed.</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="sd">            sender_jid (str): Warehouse JID that will send decision.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="sd">        </span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">        Timeout Mechanism:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">            - Wait time: 10 seconds</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">            - Interpretation: Warehouse chose another supplier (implicit rejection)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">            - Action: Log only (no stock to unlock)</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">        </span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">        Example Execution:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">        </span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">            **Scenario 1: Warehouse Confirms**</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">            ```</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">            Message Received: warehouse-confirm &quot;100 electronics&quot;</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">            Actions:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">                - Create Order object</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">                - pending_deliveries[301000000] = Order(...)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">                - Launch AssignVehicle(301000000)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">                - Print: &quot;Order 301000000 confirmed: 100 xelectronics for warehouse1&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">            ```</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">            </span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">            **Scenario 2: Warehouse Denies**</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">            ```</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">            Message Received: warehouse-deny &quot;100 electronics&quot;</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">            Actions:</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">                - Print: &quot;Denial received! Warehouse chose another supplier.&quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">                - No state changes (infinite stock)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">            ```</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">            </span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">            **Scenario 3: Timeout**</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">            ```</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">            Message Received: None (10 second timeout)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">            Actions:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">                - Print: &quot;Timeout: No confirmation or denial received&quot;</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">                - Print: &quot;Order not confirmed for electronics x100&quot;</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">                - No state changes (infinite stock)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">            ```</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">        </span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        Difference from Warehouse Behaviour:</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">            Unlike warehouse ReceiveConfirmationOrDenial:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">            - No stock unlocking needed (infinite inventory)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">            - No capacity adjustments required</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">            - Simpler state management</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">            - Only tracks confirmed orders in pending_deliveries</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">        </span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        Note:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">            This behaviour is automatically filtered by template to only receive</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">            messages for the specific supplier, warehouse, and request_id combination.</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accept_msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">sender_jid</span><span class="p">):</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">            Initialize the ReceiveConfirmationOrDenial behaviour.</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">            </span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">            Args:</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">                accept_msg (Message): The supplier-accept message we sent.</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">                    Used to extract proposal details for logging if needed.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">                sender_jid (str): JID of the warehouse that will send the decision.</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">accept_msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="n">bod</span> <span class="o">=</span> <span class="n">accept_msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bod</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_product</span> <span class="o">=</span> <span class="n">bod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sender_jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sender_jid</span><span class="p">)</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Waiting for warehouse confirmation or denial...&quot;</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>            
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                <span class="n">performative</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>                
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>                <span class="c1"># Message with body format &quot;quantity product&quot;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                <span class="n">quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                <span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                <span class="k">if</span> <span class="n">performative</span> <span class="o">==</span> <span class="s2">&quot;warehouse-confirm&quot;</span><span class="p">:</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                    <span class="c1"># Warehouse confirmed - add to pending deliveries</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                    <span class="c1"># Create Order object from message and add to pending_deliveries</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                    <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">message_to_order</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                            
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                    <span class="c1"># Essential print - order confirmed</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> confirmed: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>                    <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">AssignVehicle</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">)</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                    
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                    
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                <span class="k">elif</span> <span class="n">performative</span> <span class="o">==</span> <span class="s2">&quot;warehouse-deny&quot;</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                    <span class="c1"># Warehouse denied (chose another supplier) - just log it</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Denial received! Warehouse chose another supplier.&quot;</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order not confirmed for </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>                    
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Timeout: No confirmation or denial received in 10 seconds.&quot;</span><span class="p">)</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                    <span class="c1"># Since supplier has infinite stock, no need to rollback</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                    <span class="c1"># Just log that order wasn&#39;t confirmed</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order not confirmed for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_product</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>    
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveVehicleArrival</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">        Cyclic behaviour that processes vehicle pickup notifications.</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">        </span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">        Handles vehicle-pickup messages when vehicles arrive to collect confirmed</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">        orders from the supplier, removes order from pending_deliveries, and sends</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">        pickup confirmation back to vehicle.</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>            
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">r_msg</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;pickup-confirm&quot;</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">))</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>            
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span>  <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                <span class="c1"># Parse message body</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                    <span class="n">order</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">dict_to_order</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; ERROR: Failed to parse vehicle message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                    <span class="k">return</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>                <span class="c1"># Vehicle is picking up an order to deliver to warehouse</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>                    <span class="k">del</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">]</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> picked up order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                    
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>                    
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; ERROR: Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> not found in pending orders!&quot;</span><span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>                
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>    
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">AssignVehicle</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">        Behaviour that coordinates vehicle assignment for delivery to warehouse.</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        </span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">        This behaviour implements a vehicle coordination protocol where the supplier</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">        requests delivery quotes from available vehicles to transport materials to</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        a warehouse. This is similar to a mini FIPA Contract Net but simplified.</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">        </span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        Vehicle Selection Process:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">        </span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">            **Phase 1: Vehicle Discovery**</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">                - Populate vehicles list from presence contacts</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">                - Only vehicles subscribed to supplier are eligible</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">            </span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">            **Phase 2: Presence Check**</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">                - Send presence-info request to each vehicle</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">                - Receive presence-response with availability status</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">                - Categorize: CHAT (available) vs AWAY (busy)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">            </span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">            **Phase 3: Proposal Requests**</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">                - Send order-proposal to available vehicles first</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">                - If no available vehicles, send to AWAY vehicles</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">                - Broadcast pickup/delivery details</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">            </span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">            **Phase 4: Collect Proposals**</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">                - Launch ReceiveVehicleProposals to gather responses</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">                - Wait for vehicle-proposal messages with can_fit and delivery_time</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">            </span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">            **Phase 5: Vehicle Selection**</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">                - Launch ChooseBestVehicle to evaluate proposals</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">                - Selection criteria: can_fit capacity, then delivery_time</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">                - Send order-confirmation to winner</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">        </span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">        Attributes:</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">            request_id (int): Unique identifier for the order requiring delivery.</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">        </span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">        Order Information Required:</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">            - pickup_node: Supplier&#39;s current graph node</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">            - delivery_node: Warehouse&#39;s graph node location</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">            - product: Product type to deliver</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">            - quantity: Amount to deliver</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">            - sender: Warehouse JID expecting delivery</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">        </span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        Message Format (order-proposal):</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">            Metadata:</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">                - performative: &quot;order-proposal&quot;</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">            Body (JSON):</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">                - orderid: Order identifier</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">                - product: Product type</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">                - quantity: Amount to deliver</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">                - sender: Warehouse JID (delivery destination)</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">                - receiver: Supplier JID (pickup location)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">                - sender_location: Warehouse node</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">                - receiver_location: Supplier node</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        </span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        Presence Status Handling:</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">            - **PresenceShow.CHAT**: Vehicle available, prioritize for proposals</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">            - **PresenceShow.AWAY**: Vehicle busy, use only if no available vehicles</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">            - Strategy: Try available first, fallback to busy if necessary</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">        </span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        Example Execution:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        </span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">            **Scenario: Normal Vehicle Assignment**</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">            ```</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">            Order ID: 301000000</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">            Pickup: Node 20 (Supplier location)</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">            Delivery: Node 10 (Warehouse location)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">            Product: electronics</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">            Quantity: 100</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">            </span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">            Step 1: Discover vehicles</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">                Found: [vehicle-1, vehicle-2, vehicle-3]</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">            </span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">            Step 2: Check presence</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">                vehicle-1: CHAT (available)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">                vehicle-2: AWAY (busy)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">                vehicle-3: CHAT (available)</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">            </span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">            Step 3: Send proposals</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">                Sent to: vehicle-1, vehicle-3 (2 available)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">            </span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">            Step 4: Collect proposals</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">                vehicle-1: can_fit=True, time=120s</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">                vehicle-3: can_fit=True, time=85s</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">            </span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">            Step 5: Choose best</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">                Winner: vehicle-3 (lower delivery time)</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">                Send order-confirmation to vehicle-3</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">            ```</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">            </span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">            **Scenario: No Available Vehicles**</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">            ```</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">            All vehicles: AWAY (busy)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">            Action: Send proposals to all AWAY vehicles anyway</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">            Result: Best vehicle will accept when capacity available</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">            ```</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">        </span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">        Error Handling:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">            - If no vehicles found in contacts:</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">                - Print error message</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">                - Return without sending proposals</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">                - Order stays in pending_deliveries for retry</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a><span class="sd">        </span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">        Note:</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">            This behaviour launches two child behaviours (ReceiveVehicleProposals</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">            and ChooseBestVehicle) that implement the proposal collection and</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">            selection logic.</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">):</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">            Initialize the AssignVehicle behaviour.</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a><span class="sd">            </span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a><span class="sd">            Args:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="sd">                request_id (int): Unique identifier for the order requiring vehicle assignment.</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">populate_vehicles_from_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Populate vehicles list from presence contacts if empty&quot;&quot;&quot;</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>            
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="c1"># Get all vehicles from presence contacts</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="n">vehicles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;vehicle&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)]</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>            
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="k">if</span> <span class="n">vehicles</span><span class="p">:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span> <span class="o">=</span> <span class="n">vehicles</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Discovered </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> vehicle(s) from presence: </span><span class="si">{</span><span class="n">vehicles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No vehicles found in presence contacts yet!&quot;</span><span class="p">)</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>            
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">vehicles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_presence_info_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;presence-info&quot;</span><span class="p">)</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>            
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_call_for_proposal_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>            
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-proposal&quot;</span><span class="p">)</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>            
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">]</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>            <span class="n">new_body</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">,</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                <span class="s2">&quot;product&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="p">,</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                <span class="s2">&quot;quantity&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                <span class="s2">&quot;sender&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">receiver</span><span class="p">,</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                <span class="s2">&quot;receiver&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                <span class="s2">&quot;sender_location&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span><span class="p">,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                <span class="s2">&quot;receiver_location&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="p">}</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_body</span><span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>            
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="c1"># Populate vehicles from contacts</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="n">has_vehicles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_vehicles_from_contacts</span><span class="p">()</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>            
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_vehicles</span><span class="p">:</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  ERROR: No vehicles found in contacts!&quot;</span><span class="p">)</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Make sure vehicles are started and have subscribed to this supplier.&quot;</span><span class="p">)</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>                <span class="k">return</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>            
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Requesting vehicle proposals...&quot;</span><span class="p">)</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicles to contact: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>            
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>            <span class="c1"># Enviar mensagens de proposal a todos os veculos</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>            <span class="c1"># No verificamos presena - deixamos cada veculo decidir se pode aceitar</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="n">n_available_vehicles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>            <span class="n">away_vehicles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span><span class="p">:</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>                
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_presence_info_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">ReceivePresenceInfo</span><span class="p">()</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                <span class="n">temp</span> <span class="p">:</span> <span class="n">Template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                <span class="n">temp</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;presence-response&quot;</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>                <span class="n">temp</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;vehicle_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">))</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>                
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>                <span class="k">await</span> <span class="n">behav</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Presence info from </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>                
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">vehicle_jid</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PresenceShow.CHAT&quot;</span><span class="p">:</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_call_for_proposal_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                    <span class="n">n_available_vehicles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent order proposal to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>                
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>                <span class="k">elif</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">vehicle_jid</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PresenceShow.AWAY&quot;</span> <span class="ow">and</span> <span class="n">n_available_vehicles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>                    <span class="n">away_vehicles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Vehicle </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2"> is away.&quot;</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>                    
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            <span class="k">if</span> <span class="n">n_available_vehicles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No AVAILABLE vehicles found. All vehicles are AWAY.&quot;</span><span class="p">)</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>                <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">away_vehicles</span><span class="p">:</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_call_for_proposal_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent order proposal to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent proposals to </span><span class="si">{</span><span class="n">n_available_vehicles</span><span class="si">}</span><span class="s2"> vehicle(s)&quot;</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>                    
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">ChooseBestVehicle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>            <span class="c1"># Waits for all vehicle proposals to be received</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="k">await</span> <span class="n">behav</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>    
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceivePresenceInfo</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">        Behaviour to receive presence information from vehicle agents.</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">        </span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">        This behaviour requests and collects availability status from vehicle agents,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">        which is used to determine which vehicles are available for delivery tasks</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">        from the supplier to warehouses.</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">        </span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">        The presence information indicates whether a vehicle is busy, available, or</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">        in another state. This helps the supplier make intelligent vehicle assignment</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">        decisions based on current vehicle availability.</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">        </span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">        Workflow:</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">            1. **Receive Message**: Wait up to 10 seconds for presence response</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">            2. **Parse JSON**: Extract presence_show status from message body</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">            3. **Store Information**: Save presence info indexed by vehicle_id</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">            4. **Handle Timeout**: Print warning if no response received</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">        </span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">        Side Effects:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">            - Updates agent.presence_infos dictionary with vehicle status</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">            - Prints presence information if verbose mode enabled</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        </span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        Returns:</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">            None. Completes after receiving one presence message or timing out.</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">        </span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">        Example:</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">            ```</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">            Message Received:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">                Metadata: vehicle_id = &quot;vehicle2@localhost&quot;</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">                Body: {&quot;presence_show&quot;: &quot;available&quot;}</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">            Processing:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">                - presence_infos[&quot;vehicle2@localhost&quot;] = &quot;available&quot;</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">            Output:</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">                - Print: &quot;Received presence info response from vehicle2: available&quot;</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">            ```</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">        </span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">        Note:</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">            The 10-second timeout prevents indefinite blocking if a vehicle agent</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">            is offline or unresponsive.</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>            
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>                <span class="n">presence_info</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;presence_show&quot;</span><span class="p">]</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Received presence info response from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">presence_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;vehicle_id&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">presence_info</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; No presence info response received from vehicle.&quot;</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>    
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveVehicleProposals</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">        Cyclic behaviour that collects vehicle delivery proposals for supplier orders.</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">        </span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">        This behaviour implements the proposal collection phase of vehicle selection</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">        for deliveries from supplier to warehouses. After the supplier sends delivery</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">        requests to vehicles, this behaviour continuously receives and stores vehicle</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">        proposals containing delivery capacity and estimated delivery time information.</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">        </span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">        The behaviour runs in an infinite loop within each execution, collecting all</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">        available proposals until a timeout occurs (no more proposals arriving). Each</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">        proposal is indexed by order_id and vehicle_jid for later evaluation by</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">        ChooseBestVehicle behaviour.</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">        </span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">        Proposal Data Structure:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">            ```python</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">            vehicle_proposals = {</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">                order_id: {</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">                    &quot;vehicle1@localhost&quot;: (can_fit: bool, delivery_time: int),</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">                    &quot;vehicle2@localhost&quot;: (can_fit: bool, delivery_time: int),</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">                    ...</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">                }</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">            }</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">            ```</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">        </span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">        Message Format:</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">            Body (JSON):</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">                ```json</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">                {</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">                    &quot;can_fit&quot;: true,</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">                    &quot;delivery_time&quot;: 180</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">                }</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">                ```</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">        </span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">        Workflow:</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">            1. **Receive Message**: Wait up to 5 seconds for vehicle proposal</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">            2. **Parse Proposal**: Extract orderid, can_fit, delivery_time</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="sd">            3. **Initialize Storage**: Create order_id entry if doesn&#39;t exist</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">            4. **Store Proposal**: Add vehicle proposal to vehicle_proposals dict</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">            5. **Continue Loop**: Repeat until timeout (no more proposals)</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">            6. **Exit**: Break loop when timeout indicates all proposals received</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">        </span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">        Side Effects:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">            - Updates agent.vehicle_proposals dictionary with new proposals</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">            - Prints proposal details if verbose mode enabled</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">            - Breaks loop after 5-second timeout</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">        </span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">        Returns:</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">            None. Exits after collecting all available proposals.</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">        </span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        Example Execution:</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">            ```</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">            Loop Iteration 1:</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">                - Receive from vehicle1: can_fit=True, time=150</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">                - Store: vehicle_proposals[3001000000][&quot;vehicle1&quot;] = (True, 150)</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">            Loop Iteration 2:</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">                - Receive from vehicle2: can_fit=True, time=130</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">                - Store: vehicle_proposals[3001000000][&quot;vehicle2&quot;] = (True, 130)</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">            Loop Iteration 3:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">                - Timeout after 5 seconds</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="sd">                - Break loop, all proposals collected</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">            ```</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">        </span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a><span class="sd">        Note:</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">            The 5-second timeout is optimized to collect multiple proposals quickly</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">            while not waiting too long for vehicles that won&#39;t respond.</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Received vehicle proposal from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                    
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                    <span class="c1"># A proposta do veculo no  uma Order, so apenas dados da proposta</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                    <span class="n">order_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orderid&quot;</span><span class="p">]</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                    <span class="n">sender_jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                    <span class="n">can_fit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;can_fit&quot;</span><span class="p">]</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                    
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                    <span class="c1"># Verificar se a entrada para este order_id existe, se no criar</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">:</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                        <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                    
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)][</span><span class="n">sender_jid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">can_fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle </span><span class="si">{</span><span class="n">sender_jid</span><span class="si">}</span><span class="s2"> proposal: can_fit=</span><span class="si">{</span><span class="n">can_fit</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>  
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                <span class="k">else</span><span class="p">:</span> 
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Timeout - no more proposals received&quot;</span><span class="p">)</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>                    <span class="k">break</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                 
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ChooseBestVehicle</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">        Behaviour that evaluates vehicle proposals and selects optimal vehicle for supplier delivery.</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">        </span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">        This behaviour implements the proposal evaluation and winner selection phase of</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">        vehicle assignment for supplier-to-warehouse deliveries. After collecting all</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">        vehicle proposals via ReceiveVehicleProposals, this behaviour compares them based</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="sd">        on capacity and delivery time, then notifies the selected vehicle and rejects all others.</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="sd">        </span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">        Selection Algorithm:</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">            1. **Priority 1**: Filter vehicles that can fit the order (can_fit=True)</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">            2. **Priority 2**: Among fitting vehicles, select one with minimum delivery_time</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">            3. **Fallback**: If no vehicles can fit, select vehicle with minimum delivery_time anyway</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">        </span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">        Attributes:</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">            request_id (int): Unique order identifier to find proposals.</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">        </span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">        Workflow:</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">            1. **Retrieve Proposals**: Get all proposals for this request_id</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">            2. **Evaluate Proposals**: Call get_best_vehicle() to select winner</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">            3. **Send Confirmation**: Notify selected vehicle with order-confirmation</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">            4. **Send Rejections**: Notify all other vehicles they were not selected</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a><span class="sd">        </span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">        Message Format (Confirmation):</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">            Metadata:</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">                - performative: &quot;order-confirmation&quot;</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">            Body (JSON):</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">                ```json</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">                {</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">                    &quot;confirmed&quot;: true</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">                }</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">                ```</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">        </span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">        Message Format (Rejection):</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">            Metadata:</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">                - performative: &quot;order-confirmation&quot;</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">            Body (JSON):</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">                ```json</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">                {</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">                    &quot;confirmed&quot;: false</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="sd">                }</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">                ```</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="sd">        </span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">        Side Effects:</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">            - Reads from agent.vehicle_proposals dictionary</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="sd">            - Reads from agent.pending_deliveries for Order object</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">            - Sends confirmation message to selected vehicle</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">            - Sends rejection messages to non-selected vehicles</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">            - Prints selection decision if verbose mode enabled</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        </span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">        Returns:</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">            None. Completes after sending all confirmation/rejection messages.</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">        </span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">        Example Execution:</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">            ```</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">            Proposals Received:</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">                - vehicle1: (can_fit=True, time=150)</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">                - vehicle2: (can_fit=True, time=130)</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">                - vehicle3: (can_fit=False, time=120)</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">            </span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">            Evaluation:</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">                - Filter: vehicle1, vehicle2 (can fit)</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">                - Compare times: 130 &lt; 150</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">                - Winner: vehicle2</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">            </span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">            Actions:</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">                - Send confirmation to vehicle2 (confirmed=true)</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">                - Send rejection to vehicle1 (confirmed=false)</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">                - Send rejection to vehicle3 (confirmed=false)</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">            </span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">            Output:</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">                - Print: &quot;Best vehicle selected: vehicle2@localhost&quot;</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">            ```</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">        </span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        Note:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">            Unlike warehouse&#39;s version, this behaviour doesn&#39;t wait for proposals</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">            as they are already collected by ReceiveVehicleProposals before this</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">            behaviour is invoked.</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">):</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_best_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposals</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>            <span class="c1"># First filter vehicles that can fit the order</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>            <span class="n">can_fit_vehicles</span> <span class="o">=</span> <span class="p">{</span><span class="n">jid</span><span class="p">:</span> <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="ow">in</span> <span class="n">proposals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">fit</span><span class="p">}</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>            <span class="k">if</span> <span class="n">can_fit_vehicles</span><span class="p">:</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>                <span class="c1"># If there are vehicles that can fit, choose the one with lowest delivery time</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>                <span class="n">best_vehicle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">can_fit_vehicles</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>                <span class="k">return</span> <span class="n">best_vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>                <span class="c1"># If no vehicles can fit, choose the one with lowest delivery time anyway</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>                <span class="k">if</span> <span class="n">proposals</span><span class="p">:</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>                    <span class="n">best_vehicle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">proposals</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>                    <span class="k">return</span> <span class="n">best_vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Comparing vehicle proposals...&quot;</span><span class="p">)</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>            
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>            <span class="c1"># Verificar se a entrada para este order_id existe, se no criar</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">:</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>            
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>            <span class="n">order_proposals</span> <span class="o">=</span>  <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>            <span class="n">proposals</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span> <span class="c1"># vehicle_jid : (can_fit, time)</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>            
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Total proposals received: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">proposals</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="n">best_vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_vehicle</span><span class="p">(</span><span class="n">proposals</span><span class="p">)</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>            
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="k">if</span> <span class="n">best_vehicle</span><span class="p">:</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>                <span class="c1"># Essential print - vehicle assigned</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle assigned: </span><span class="si">{</span><span class="n">best_vehicle</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>                
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>                <span class="c1"># Send confirmation to the selected vehicle</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">best_vehicle</span><span class="p">)</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-confirmation&quot;</span><span class="p">)</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>                
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>                <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">]</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>                <span class="n">order_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>                    <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">,</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>                    <span class="s2">&quot;confirmed&quot;</span> <span class="p">:</span> <span class="kc">True</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>                <span class="p">}</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order_data</span><span class="p">)</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>                
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Confirmation sent to </span><span class="si">{</span><span class="n">best_vehicle</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>                
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>                <span class="c1"># Send rejection to all other vehicles</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>                <span class="n">rejected_vehicles</span> <span class="o">=</span> <span class="p">[</span><span class="n">jid</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">proposals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">jid</span> <span class="o">!=</span> <span class="n">best_vehicle</span><span class="p">]</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>                <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">rejected_vehicles</span><span class="p">:</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>                    <span class="n">reject_msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>                    <span class="n">reject_msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-confirmation&quot;</span><span class="p">)</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>                    
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>                    <span class="n">reject_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>                    <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">,</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>                    <span class="s2">&quot;confirmed&quot;</span> <span class="p">:</span> <span class="kc">False</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>                    <span class="p">}</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>                    
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>                    <span class="n">reject_msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">reject_data</span><span class="p">)</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>                    
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">reject_msg</span><span class="p">)</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Rejection sent to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No vehicles available to assign!&quot;</span><span class="p">)</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>    
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveTimeDelta</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a><span class="sd">        Cyclic behaviour that synchronizes simulation time and applies traffic updates.</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">        </span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">        Receives time delta messages from world agent, updates current_tick, and</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">        applies dynamic graph edge weight changes for traffic simulation.</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>            
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>                
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                <span class="nb">type</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                <span class="n">delta</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">current_tick</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>                
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>                    <span class="n">map_updates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> 
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update_graph</span><span class="p">(</span><span class="n">map_updates</span><span class="p">)</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>    
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>    <span class="c1">#           AUXILIARY FUNCTIONS</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>    
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">        Print comprehensive supplier statistics (debugging utility).</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">        </span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a><span class="sd">        Displays two key metrics:</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="sd">        1. **Total Products Supplied**: Cumulative quantities per product type</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a><span class="sd">        2. **Pending Deliveries**: Orders confirmed but not yet picked up by vehicles</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">        </span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="sd">        Output Format:</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="sd">            ========================================</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a><span class="sd">            supplier1@localhost Statistics:</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">            Total Products Supplied:</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">              electronics: 1500</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">              textiles: 800</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">              food: 1200</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">            </span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">            Pending Deliveries:</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">              Total: 2 order(s)</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">                Order 301000000: 100xelectronics for warehouse1@localhost</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="sd">                Order 301000001: 50xtextiles for warehouse2@localhost</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">            ========================================</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">        </span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">        Metrics Interpretation:</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">            - **Total Products Supplied**: Historical record of all materials provided</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="sd">            - **Pending Deliveries**: Orders awaiting vehicle pickup</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">                - Added when warehouse sends warehouse-confirm</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="sd">                - Removed when vehicle sends vehicle-pickup</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">        </span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">        Use Cases:</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">            - Monitoring supplier throughput</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">            - Tracking pending logistics operations</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="sd">            - Debugging vehicle coordination issues</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a><span class="sd">            - Performance analysis and reporting</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a><span class="sd">        </span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a><span class="sd">        Example Usage:</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="sd">            ```python</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">            # After warehouse confirms order</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">            supplier.pending_deliveries[order_id] = order</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">            supplier.print_stats()  # Shows new pending order</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">            </span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">            # After vehicle pickup</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">            del supplier.pending_deliveries[order_id]</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">            supplier.print_stats()  # Shows order removed</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="sd">            ```</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">        </span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">        Note:</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">            Unlike warehouse and store, supplier statistics are simpler because</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="sd">            there&#39;s no stock tracking (infinite inventory model).</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>        
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2"> Statistics:&quot;</span><span class="p">)</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Products Supplied:&quot;</span><span class="p">)</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">:</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>            <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  None yet&quot;</span><span class="p">)</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pending Deliveries:&quot;</span><span class="p">)</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">:</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">)</span><span class="si">}</span><span class="s2"> order(s)&quot;</span><span class="p">)</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">order</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Order </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  None&quot;</span><span class="p">)</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traffic_data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a><span class="sd">        Update world graph edge weights based on traffic conditions.</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="sd">        </span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a><span class="sd">        This function applies dynamic traffic updates received from the world agent</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a><span class="sd">        to the supplier&#39;s local copy of the world graph. Edge weights represent</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="sd">        travel costs/times and are updated to reflect current traffic conditions.</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="sd">        </span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a><span class="sd">        Args:</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="sd">            traffic_data (dict): Traffic update data with structure:</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a><span class="sd">                {</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a><span class="sd">                    &quot;edges&quot;: [</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a><span class="sd">                        {</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="sd">                            &quot;node1&quot;: int,  # First node ID</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="sd">                            &quot;node2&quot;: int,  # Second node ID</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="sd">                            &quot;weight&quot;: float  # New edge weight (time/cost)</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">                        },</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">                        ...</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a><span class="sd">                    ]</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="sd">                }</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="sd">        </span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a><span class="sd">        Workflow:</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a><span class="sd">            1. Iterate through all edge updates in traffic_data</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="sd">            2. Extract node1_id, node2_id, and new_weight</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a><span class="sd">            3. Retrieve edge from graph using get_edge()</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="sd">            4. Update edge.weight if edge exists</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="sd">        </span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="sd">        Example:</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a><span class="sd">            ```</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="sd">            Traffic Data:</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">            {</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">                &quot;edges&quot;: [</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">                    {&quot;node1&quot;: 10, &quot;node2&quot;: 15, &quot;weight&quot;: 120.5},</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">                    {&quot;node1&quot;: 15, &quot;node2&quot;: 20, &quot;weight&quot;: 95.3}</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="sd">                ]</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">            }</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">            </span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">            Actions:</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">                - Edge (10, 15): weight updated to 120.5</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">                - Edge (15, 20): weight updated to 95.3</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">            </span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">            Impact:</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">                - Vehicle routing recalculated with new weights</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">                - Delivery time estimates adjusted</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">                - Pathfinding uses updated costs</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">            ```</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">        </span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a><span class="sd">        Integration:</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">            - Called by: ReceiveTimeDelta behaviour</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">            - Triggered by: time-delta messages from world agent</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="sd">            - Frequency: Every simulation tick with traffic updates</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">        </span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">        Note:</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">            Only updates existing edges. If an edge doesn&#39;t exist in the graph,</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">            it&#39;s silently skipped (safe behavior for malformed data).</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>        <span class="k">for</span> <span class="n">edge_info</span> <span class="ow">in</span> <span class="n">traffic_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;edges&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>                <span class="n">node1_id</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node1&quot;</span><span class="p">)</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                <span class="n">node2_id</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node2&quot;</span><span class="p">)</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                <span class="n">new_weight</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>                
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>                <span class="n">edge</span> <span class="p">:</span> <span class="n">Edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">node1_id</span><span class="p">,</span> <span class="n">node2_id</span><span class="p">)</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>                <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>                    <span class="n">edge</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">new_weight</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">message_to_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">        Convert warehouse-confirm message to Order object for delivery tracking.</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="sd">        </span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">        This helper function transforms a FIPA accept-proposal message from a warehouse</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">        into a structured Order object that can be stored in pending_deliveries</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a><span class="sd">        and assigned to vehicles for transportation.</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">        </span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">        FIPA Protocol Context:</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">            - Triggered by: warehouse-confirm message (FIPA accept-proposal)</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">            - Used by: ReceiveConfirmationOrDenial behaviour</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">            - Purpose: Create deliverable order from confirmed proposal</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a><span class="sd">        </span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">        Message Parsing:</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">            Body Format: &quot;{quantity} {product}&quot;</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">            Example: &quot;100 electronics&quot;</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">            </span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">            Metadata Extracted:</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">                - request_id: Unique order identifier</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">                - node_id: Warehouse&#39;s graph location (delivery destination)</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a><span class="sd">        </span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">        Args:</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">            msg (Message): warehouse-confirm message with:</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">                - Body: &quot;{quantity} {product}&quot;</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">                - Metadata: request_id, node_id</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a><span class="sd">                - Sender: Warehouse JID</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">        </span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="sd">        Returns:</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a><span class="sd">            Order: Structured order object with:</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a><span class="sd">                - product: Product type</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a><span class="sd">                - quantity: Amount to deliver</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a><span class="sd">                - orderid: Unique identifier</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a><span class="sd">                - sender: Warehouse JID (delivery destination)</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a><span class="sd">                - receiver: Supplier JID (pickup location)</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a><span class="sd">                - sender_location: Warehouse&#39;s graph node</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a><span class="sd">                - receiver_location: Supplier&#39;s graph node</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a><span class="sd">        </span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a><span class="sd">        Order Object Structure:</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a><span class="sd">            The Order uses inverted semantics for delivery context:</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a><span class="sd">            - sender = Warehouse (WHERE to deliver)</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="sd">            - receiver = Supplier (WHERE to pickup)</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="sd">            - sender_location = Warehouse node (delivery destination)</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">            - receiver_location = Supplier node (pickup origin)</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">        </span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="sd">        Example:</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="sd">            ```</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a><span class="sd">            Input Message (warehouse-confirm):</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="sd">                Body: &quot;100 electronics&quot;</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">                Metadata:</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">                    - request_id: &quot;301000000&quot;</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="sd">                    - node_id: &quot;10&quot;</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">                Sender: &quot;warehouse1@localhost&quot;</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">            </span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">            Supplier: &quot;supplier1@localhost&quot; at node 20</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">            </span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">            Output Order:</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">                product: &quot;electronics&quot;</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">                quantity: 100</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">                orderid: &quot;301000000&quot;</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">                sender: &quot;warehouse1@localhost&quot;</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a><span class="sd">                receiver: &quot;supplier1@localhost&quot;</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="sd">                sender_location: 10 (warehouse node)</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">                receiver_location: 20 (supplier node)</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">            ```</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">        </span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">        Integration:</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">            Created Order is added to self.pending_deliveries[order_id]</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">            and passed to AssignVehicle behaviour for transportation.</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">        </span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">        Note:</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">            This mirrors the message_to_order function in warehouse.py but</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">            processes warehouse-confirm instead of store-confirm messages.</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>        <span class="n">quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>        <span class="n">product</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>        
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>        <span class="n">order_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">)</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>        <span class="n">sender</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># Warehouse JID</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>        <span class="n">receiver</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>  <span class="c1"># Supplier JID</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>        <span class="n">warehouse_location</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">))</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>        <span class="n">supplier_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>        <span class="n">tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_tick</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>        
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>            <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>            <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>            <span class="n">orderid</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>            <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>            <span class="n">receiver</span><span class="o">=</span><span class="n">receiver</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>        <span class="p">)</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>        
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>        <span class="c1"># Set locations</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span> <span class="o">=</span> <span class="n">warehouse_location</span>  <span class="c1"># Warehouse location</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span> <span class="o">=</span> <span class="n">supplier_location</span>  <span class="c1"># Supplier location</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>        
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>        <span class="k">return</span> <span class="n">order</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>    
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>    
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dict_to_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a><span class="sd">        Convert dictionary data to Order object (for vehicle communication).</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a><span class="sd">        </span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a><span class="sd">        This helper function reconstructs an Order object from dictionary data,</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="sd">        typically received from vehicle messages (vehicle-pickup). It&#39;s the</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a><span class="sd">        inverse operation of serializing an order to JSON.</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a><span class="sd">        </span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a><span class="sd">        Args:</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a><span class="sd">            data (dict): Dictionary containing order information with keys:</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a><span class="sd">                - product (str): Product type</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="sd">                - quantity (int): Amount to deliver</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">                - orderid (int): Unique order identifier</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">                - sender (str): Warehouse JID (delivery destination)</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a><span class="sd">                - receiver (str): Supplier JID (pickup location)</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">                - sender_location (int, optional): Warehouse graph node</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">                - receiver_location (int, optional): Supplier graph node</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">        </span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">        Returns:</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">            Order: Reconstructed Order object with all attributes populated.</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a><span class="sd">        </span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a><span class="sd">        Example:</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a><span class="sd">            ```</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a><span class="sd">            Input Dictionary:</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a><span class="sd">            {</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="sd">                &quot;product&quot;: &quot;electronics&quot;,</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a><span class="sd">                &quot;quantity&quot;: 100,</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a><span class="sd">                &quot;orderid&quot;: 301000000,</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a><span class="sd">                &quot;sender&quot;: &quot;warehouse1@localhost&quot;,</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">                &quot;receiver&quot;: &quot;supplier1@localhost&quot;,</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a><span class="sd">                &quot;sender_location&quot;: 10,</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a><span class="sd">                &quot;receiver_location&quot;: 20</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a><span class="sd">            }</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a><span class="sd">            </span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a><span class="sd">            Output Order:</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a><span class="sd">                order.product = &quot;electronics&quot;</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a><span class="sd">                order.quantity = 100</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a><span class="sd">                order.orderid = 301000000</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a><span class="sd">                order.sender = &quot;warehouse1@localhost&quot;</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a><span class="sd">                order.receiver = &quot;supplier1@localhost&quot;</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a><span class="sd">                order.sender_location = 10</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="sd">                order.receiver_location = 20</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a><span class="sd">            ```</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="sd">        </span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a><span class="sd">        Use Cases:</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a><span class="sd">            - Parsing vehicle-pickup messages</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a><span class="sd">            - Reconstructing orders from JSON body</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="sd">            - Vehicle coordination communication</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a><span class="sd">        </span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a><span class="sd">        Note:</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a><span class="sd">            Uses safe dictionary access (.get()) for location fields to handle</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a><span class="sd">            cases where location data might not be present.</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>        <span class="n">order</span> <span class="o">=</span>  <span class="n">Order</span><span class="p">(</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>            <span class="n">product</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">],</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>            <span class="n">quantity</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">],</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>            <span class="n">orderid</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;orderid&quot;</span><span class="p">],</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>            <span class="n">sender</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">],</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>            <span class="n">receiver</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;receiver&quot;</span><span class="p">]</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>        <span class="p">)</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sender_location&quot;</span><span class="p">)</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;receiver_location&quot;</span><span class="p">)</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>        <span class="k">return</span> <span class="n">order</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>    
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>    
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="nb">map</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">node_id</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">5222</span><span class="p">,</span> <span class="n">verify_security</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">contact_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a><span class="sd">        Initialize the Supplier agent with connection parameters and world state.</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a><span class="sd">        </span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a><span class="sd">        The constructor configures the supplier&#39;s identity, location, and initial</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a><span class="sd">        state. It implements the ID encoding system for generating unique request</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a><span class="sd">        identifiers compatible with the FIPA Contract Net Protocol.</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a><span class="sd">        </span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a><span class="sd">        ID Encoding System:</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a><span class="sd">            Formula: `agent_type * 100_000_000 + instance_id * 1_000_000 + counter`</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a><span class="sd">            - Agent Type Code: 3 (for Supplier agents)</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a><span class="sd">            - Instance ID: Extracted from JID (e.g., &quot;supplier2&quot; -&gt; 2)</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="sd">            - Base ID Calculation: `3 * 100_000_000 + instance_id * 1_000_000`</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a><span class="sd">            </span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a><span class="sd">            Examples:</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a><span class="sd">                - supplier1: base = 301_000_000 (first request: 301_000_000)</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a><span class="sd">                - supplier2: base = 302_000_000 (first request: 302_000_000)</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a><span class="sd">                - supplier5: base = 305_000_000 (first request: 305_000_000)</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a><span class="sd">            </span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a><span class="sd">            This encoding allows agents to identify:</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a><span class="sd">                1. What type of agent created the request (300M range = supplier)</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a><span class="sd">                2. Which specific supplier instance (next 1M range)</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a><span class="sd">                3. Which request in sequence (counter increments)</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="sd">        </span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a><span class="sd">        Args:</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a><span class="sd">            jid (str): Jabber ID for XMPP communication (e.g., &quot;supplier1@localhost&quot;).</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a><span class="sd">            password (str): Authentication password for XMPP server.</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a><span class="sd">            map (Graph): Reference to the world graph for pathfinding and locations.</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a><span class="sd">            node_id (int): Graph node representing the supplier&#39;s physical location.</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a><span class="sd">            port (int, optional): XMPP server port. Defaults to 5222.</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="sd">            verify_security (bool, optional): Enable SSL/TLS verification. Defaults to False.</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a><span class="sd">            contact_list (list[str], optional): JIDs of warehouses and vehicles for presence</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="sd">                subscription. Defaults to empty list.</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a><span class="sd">            verbose (bool, optional): Enable detailed debug logging. Defaults to False.</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a><span class="sd">        </span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a><span class="sd">        Attributes Initialized:</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a><span class="sd">            Core Identity:</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a><span class="sd">                - node_id: Supplier location on graph</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a><span class="sd">                - map: World graph reference</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a><span class="sd">                - contact_list: Agents for presence subscription</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a><span class="sd">                - verbose: Debug output flag</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a><span class="sd">            </span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a><span class="sd">            Position (Legacy):</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a><span class="sd">                - pos_x: X coordinate from node (TODO: marked for removal)</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a><span class="sd">                - pos_y: Y coordinate from node (TODO: marked for removal)</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a><span class="sd">            </span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a><span class="sd">            ID Encoding:</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a><span class="sd">                - id_base: Base value for generating unique request IDs</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a><span class="sd">        </span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a><span class="sd">        Example:</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a><span class="sd">            ```python</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a><span class="sd">            supplier = Supplier(</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a><span class="sd">                jid=&quot;supplier1@localhost&quot;,</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a><span class="sd">                password=&quot;password123&quot;,</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a><span class="sd">                map=world_graph,</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a><span class="sd">                node_id=20,</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a><span class="sd">                contact_list=[</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a><span class="sd">                    &quot;warehouse1@localhost&quot;,</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a><span class="sd">                    &quot;warehouse2@localhost&quot;,</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a><span class="sd">                    &quot;vehicle1@localhost&quot;</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a><span class="sd">                ],</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a><span class="sd">                verbose=True</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a><span class="sd">            )</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a><span class="sd">            # ID base calculated: 3 * 100_000_000 + 1 * 1_000_000 = 301_000_000</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a><span class="sd">            # First request ID will be: 301_000_000</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a><span class="sd">            # Second request ID will be: 301_000_001</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a><span class="sd">            ```</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a><span class="sd">        </span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a><span class="sd">        Note:</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a><span class="sd">            The constructor only initializes essential attributes. Most supplier</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a><span class="sd">            state (total_supplied, pending_deliveries, behaviours) is configured</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a><span class="sd">            in the setup() method which runs after the agent connects to the XMPP server.</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">verify_security</span><span class="p">)</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="p">:</span> <span class="n">Graph</span> <span class="o">=</span> <span class="nb">map</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>        <span class="n">node</span> <span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span> <span class="c1"># TODO -- remove</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos_x</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span> <span class="c1"># TODO -- remove</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos_y</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span> <span class="c1"># TODO -- remove</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">contact_list</span> <span class="o">=</span> <span class="n">contact_list</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>        <span class="c1"># Extract instance number from JID for ID encoding (e.g., &quot;supplier1@localhost&quot; -&gt; 1)</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>        <span class="n">jid_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>        <span class="n">instance_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">jid_name</span><span class="p">)))</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>        
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>        <span class="c1"># Calculate ID base: Supplier type code = 3</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id_base</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">100_000_000</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">instance_id</span> <span class="o">*</span> <span class="mi">1_000_000</span><span class="p">)</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>    
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="sd">        Configure supplier state and register all FIPA protocol behaviours.</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a><span class="sd">        </span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a><span class="sd">        This method is automatically called by SPADE after the agent successfully</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a><span class="sd">        connects to the XMPP server. It initializes the supplier&#39;s operational</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a><span class="sd">        state and registers all cyclic behaviours needed for the FIPA Contract Net</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a><span class="sd">        Protocol implementation as a participant.</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a><span class="sd">        </span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a><span class="sd">        Setup Process:</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a><span class="sd">        </span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a><span class="sd">            **Phase 1: Presence Management**</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a><span class="sd">                - Enable auto-approval of presence subscriptions</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a><span class="sd">                - Subscribe to all contacts (warehouses and vehicles)</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a><span class="sd">                - Enables presence-based availability checking</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a><span class="sd">            </span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a><span class="sd">            **Phase 2: State Initialization**</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a><span class="sd">                - total_supplied: Dictionary tracking cumulative supply per product</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a><span class="sd">                - current_tick: Simulation time (starts at 0)</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a><span class="sd">                - pending_deliveries: Orders confirmed but not picked up</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a><span class="sd">                - vehicle_proposals: Vehicle delivery quotes per order</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a><span class="sd">                - vehicles: List of vehicle JIDs (populated dynamically)</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a><span class="sd">                - presence_infos: Vehicle availability cache</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="sd">            </span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a><span class="sd">            **Phase 3: Behaviour Registration**</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a><span class="sd">                1. ReceiveBuyRequest (Warehouse Interaction - FIPA Participant)</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a><span class="sd">                2. ReceiveVehicleProposals (Vehicle Coordination - Proposal Collection)</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a><span class="sd">                3. ReceiveVehicleArrival (Vehicle Coordination - Pickup Handling)</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a><span class="sd">        </span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a><span class="sd">        Behaviour Registration Details:</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a><span class="sd">        </span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a><span class="sd">            **ReceiveBuyRequest** (CyclicBehaviour):</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a><span class="sd">                - Template: performative = &quot;warehouse-buy&quot;</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a><span class="sd">                - Purpose: Listen for warehouse purchase requests (FIPA CFP)</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a><span class="sd">                - Role: FIPA Participant (responds to warehouses)</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a><span class="sd">                - Action: Always accepts (infinite stock)</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a><span class="sd">            </span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a><span class="sd">            **ReceiveVehicleProposals** (CyclicBehaviour):</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a><span class="sd">                - Template: performative = &quot;vehicle-proposal&quot;</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a><span class="sd">                - Purpose: Collect vehicle delivery quotes</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a><span class="sd">                - Role: Coordinator for vehicle selection</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">                - Action: Store proposals in vehicle_proposals dictionary</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="sd">            </span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">            **ReceiveVehicleArrival** (CyclicBehaviour):</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="sd">                - Template: performative = &quot;vehicle-pickup&quot;</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">                - Purpose: Handle vehicle pickup notifications</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a><span class="sd">                - Action: Remove order from pending_deliveries, confirm pickup</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a><span class="sd">        </span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a><span class="sd">        Infinite Stock Model:</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a><span class="sd">            Unlike warehouse agents:</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a><span class="sd">            - No stock initialization required</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a><span class="sd">            - No capacity constraints</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a><span class="sd">            - No resupply mechanism needed</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a><span class="sd">            - Only tracks what&#39;s been supplied (statistics)</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a><span class="sd">        </span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a><span class="sd">        State Initialization Example:</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a><span class="sd">            ```</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a><span class="sd">            After setup():</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a><span class="sd">                total_supplied: {} (empty, will populate as orders fulfilled)</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="sd">                current_tick: 0</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="sd">                pending_deliveries: {} (empty, will populate as orders confirmed)</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">                vehicle_proposals: {} (empty, will populate per order)</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a><span class="sd">                vehicles: [] (will populate from presence contacts)</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="sd">                presence_infos: {} (will populate during vehicle coordination)</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="sd">            </span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="sd">            Print Output:</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">                &quot;supplier1@localhost&gt; Supplier initialized with INFINITE stock&quot;</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a><span class="sd">            ```</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="sd">        </span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="sd">        Presence Subscription Example:</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a><span class="sd">            ```</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a><span class="sd">            contact_list: [</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a><span class="sd">                &quot;warehouse1@localhost&quot;,</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a><span class="sd">                &quot;warehouse2@localhost&quot;,</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a><span class="sd">                &quot;vehicle1@localhost&quot;,</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a><span class="sd">                &quot;vehicle2@localhost&quot;</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a><span class="sd">            ]</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a><span class="sd">            </span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a><span class="sd">            Actions:</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a><span class="sd">                1. Subscribe to all 4 contacts</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a><span class="sd">                2. Enable auto-approval for incoming subscriptions</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a><span class="sd">                3. Print: &quot;Sent subscription request to warehouse1@localhost&quot;</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a><span class="sd">                4. Print: &quot;Sent subscription request to warehouse2@localhost&quot;</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a><span class="sd">                5. Print: &quot;Sent subscription request to vehicle1@localhost&quot;</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a><span class="sd">                6. Print: &quot;Sent subscription request to vehicle2@localhost&quot;</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a><span class="sd">                7. Print: &quot;Supplier setup complete. Will auto-accept all presence subscriptions.&quot;</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a><span class="sd">            ```</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a><span class="sd">        </span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a><span class="sd">        Template Configuration:</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a><span class="sd">            Templates use metadata filtering to route messages to correct behaviours:</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a><span class="sd">            - ReceiveBuyRequest: performative=&quot;warehouse-buy&quot;</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a><span class="sd">            - ReceiveVehicleProposals: performative=&quot;vehicle-proposal&quot;</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a><span class="sd">            - ReceiveVehicleArrival: performative=&quot;vehicle-pickup&quot;</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a><span class="sd">        </span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a><span class="sd">        Side Effects:</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a><span class="sd">            - Prints initialization message with INFINITE stock notice</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a><span class="sd">            - Prints statistics if verbose=True</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a><span class="sd">            - Begins listening for warehouse requests immediately</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a><span class="sd">            - Begins listening for vehicle messages immediately</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a><span class="sd">        </span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a><span class="sd">        Note:</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a><span class="sd">            This method must complete before the supplier can participate in any</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a><span class="sd">            FIPA protocol interactions. All behaviours are registered but don&#39;t</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a><span class="sd">            execute until the main agent event loop processes them.</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">approve_all</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>        
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>        <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_list</span><span class="p">:</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">contact</span><span class="p">)</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Sent subscription request to </span><span class="si">{</span><span class="n">contact</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Supplier setup complete. Will auto-accept all presence subscriptions.&quot;</span><span class="p">)</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>        
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>        <span class="c1"># Supplier has infinite stock - no need to track stock levels</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>        <span class="c1"># Just track what&#39;s been supplied</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_tick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>        
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>        <span class="c1"># Track pending deliveries by order_id</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Order</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_proposals</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>        <span class="c1"># Identify vehicles from presence contacts (will be populated dynamically)</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vehicles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence_infos</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Supplier initialized with INFINITE stock&quot;</span><span class="p">)</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>        
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>        <span class="c1"># Add behaviour to receive buy requests from warehouses</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>        <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveBuyRequest</span><span class="p">()</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>        <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;warehouse-buy&quot;</span><span class="p">)</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>        
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>        <span class="c1"># Add behaviour to receive vehicle proposals</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>        <span class="n">vehicle_proposal_behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveVehicleProposals</span><span class="p">()</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>        <span class="n">vehicle_proposal_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>        <span class="n">vehicle_proposal_template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle-proposal&quot;</span><span class="p">)</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">vehicle_proposal_behav</span><span class="p">,</span> <span class="n">vehicle_proposal_template</span><span class="p">)</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>        
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>        <span class="c1"># Add behaviour to receive vehicle pickup notifications</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>        <span class="n">pickup_behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveVehicleArrival</span><span class="p">()</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>        <span class="n">pickup_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>        <span class="n">pickup_template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle-pickup&quot;</span><span class="p">)</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">pickup_behav</span><span class="p">,</span> <span class="n">pickup_template</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="Supplier">
                            <input id="Supplier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier</span><wbr>(<span class="base">spade.agent.Agent</span>):

                <label class="view-source-button" for="Supplier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier-109"><a href="#Supplier-109"><span class="linenos"> 109</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Supplier</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
</span><span id="Supplier-110"><a href="#Supplier-110"><span class="linenos"> 110</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-111"><a href="#Supplier-111"><span class="linenos"> 111</span></a><span class="sd">    Supplier Agent for Supply Chain Management System.</span>
</span><span id="Supplier-112"><a href="#Supplier-112"><span class="linenos"> 112</span></a><span class="sd">    </span>
</span><span id="Supplier-113"><a href="#Supplier-113"><span class="linenos"> 113</span></a><span class="sd">    The Supplier agent acts as the ultimate source of materials in the supply chain,</span>
</span><span id="Supplier-114"><a href="#Supplier-114"><span class="linenos"> 114</span></a><span class="sd">    providing infinite inventory to warehouses. It implements the FIPA Contract Net</span>
</span><span id="Supplier-115"><a href="#Supplier-115"><span class="linenos"> 115</span></a><span class="sd">    Protocol as a **Participant**, responding to warehouse requests and coordinating</span>
</span><span id="Supplier-116"><a href="#Supplier-116"><span class="linenos"> 116</span></a><span class="sd">    vehicle deliveries.</span>
</span><span id="Supplier-117"><a href="#Supplier-117"><span class="linenos"> 117</span></a><span class="sd">    </span>
</span><span id="Supplier-118"><a href="#Supplier-118"><span class="linenos"> 118</span></a><span class="sd">    FIPA Contract Net Protocol - Participant Role Implementation:</span>
</span><span id="Supplier-119"><a href="#Supplier-119"><span class="linenos"> 119</span></a><span class="sd">    </span>
</span><span id="Supplier-120"><a href="#Supplier-120"><span class="linenos"> 120</span></a><span class="sd">    **As Participant (with Warehouses)**:</span>
</span><span id="Supplier-121"><a href="#Supplier-121"><span class="linenos"> 121</span></a><span class="sd">        - **Proposal Phase**: Receives warehouse-buy CFP from warehouses</span>
</span><span id="Supplier-122"><a href="#Supplier-122"><span class="linenos"> 122</span></a><span class="sd">        - **Proposal Submission**: Always sends supplier-accept (has infinite stock)</span>
</span><span id="Supplier-123"><a href="#Supplier-123"><span class="linenos"> 123</span></a><span class="sd">        - **Result Reception**: Receives warehouse-confirm (accept-proposal) or warehouse-deny (reject-proposal)</span>
</span><span id="Supplier-124"><a href="#Supplier-124"><span class="linenos"> 124</span></a><span class="sd">        - **Execution**: Coordinates vehicle delivery for confirmed orders</span>
</span><span id="Supplier-125"><a href="#Supplier-125"><span class="linenos"> 125</span></a><span class="sd">    </span>
</span><span id="Supplier-126"><a href="#Supplier-126"><span class="linenos"> 126</span></a><span class="sd">    Infinite Stock Model:</span>
</span><span id="Supplier-127"><a href="#Supplier-127"><span class="linenos"> 127</span></a><span class="sd">        Unlike Store and Warehouse agents, the Supplier has unlimited inventory:</span>
</span><span id="Supplier-128"><a href="#Supplier-128"><span class="linenos"> 128</span></a><span class="sd">        - Never rejects requests due to insufficient stock</span>
</span><span id="Supplier-129"><a href="#Supplier-129"><span class="linenos"> 129</span></a><span class="sd">        - Always responds with supplier-accept (FIPA propose)</span>
</span><span id="Supplier-130"><a href="#Supplier-130"><span class="linenos"> 130</span></a><span class="sd">        - Tracks total supplied quantities for statistics only</span>
</span><span id="Supplier-131"><a href="#Supplier-131"><span class="linenos"> 131</span></a><span class="sd">        - No stock locking or capacity constraints</span>
</span><span id="Supplier-132"><a href="#Supplier-132"><span class="linenos"> 132</span></a><span class="sd">    </span>
</span><span id="Supplier-133"><a href="#Supplier-133"><span class="linenos"> 133</span></a><span class="sd">    Order Lifecycle:</span>
</span><span id="Supplier-134"><a href="#Supplier-134"><span class="linenos"> 134</span></a><span class="sd">        1. **Request Reception**: Warehouse sends warehouse-buy (FIPA CFP)</span>
</span><span id="Supplier-135"><a href="#Supplier-135"><span class="linenos"> 135</span></a><span class="sd">        2. **Automatic Acceptance**: Supplier sends supplier-accept (FIPA propose)</span>
</span><span id="Supplier-136"><a href="#Supplier-136"><span class="linenos"> 136</span></a><span class="sd">        3. **Awaiting Award**: Wait for warehouse decision (10 second timeout)</span>
</span><span id="Supplier-137"><a href="#Supplier-137"><span class="linenos"> 137</span></a><span class="sd">        4. **Confirmation**: Warehouse sends warehouse-confirm (FIPA accept-proposal)</span>
</span><span id="Supplier-138"><a href="#Supplier-138"><span class="linenos"> 138</span></a><span class="sd">        5. **Vehicle Assignment**: Launch AssignVehicle to coordinate delivery</span>
</span><span id="Supplier-139"><a href="#Supplier-139"><span class="linenos"> 139</span></a><span class="sd">        6. **Delivery Tracking**: Order added to pending_deliveries</span>
</span><span id="Supplier-140"><a href="#Supplier-140"><span class="linenos"> 140</span></a><span class="sd">        7. **Pickup**: Vehicle picks up materials from supplier</span>
</span><span id="Supplier-141"><a href="#Supplier-141"><span class="linenos"> 141</span></a><span class="sd">        8. **Completion**: Order removed from pending_deliveries</span>
</span><span id="Supplier-142"><a href="#Supplier-142"><span class="linenos"> 142</span></a><span class="sd">    </span>
</span><span id="Supplier-143"><a href="#Supplier-143"><span class="linenos"> 143</span></a><span class="sd">    ID Encoding System:</span>
</span><span id="Supplier-144"><a href="#Supplier-144"><span class="linenos"> 144</span></a><span class="sd">        Uses hierarchical encoding for generating unique request identifiers:</span>
</span><span id="Supplier-145"><a href="#Supplier-145"><span class="linenos"> 145</span></a><span class="sd">        - Formula: `agent_type * 100_000_000 + instance_id * 1_000_000 + request_counter`</span>
</span><span id="Supplier-146"><a href="#Supplier-146"><span class="linenos"> 146</span></a><span class="sd">        - Agent type code for Supplier: 3</span>
</span><span id="Supplier-147"><a href="#Supplier-147"><span class="linenos"> 147</span></a><span class="sd">        - Example: supplier1&#39;s base ID = 3_001_000_000</span>
</span><span id="Supplier-148"><a href="#Supplier-148"><span class="linenos"> 148</span></a><span class="sd">    </span>
</span><span id="Supplier-149"><a href="#Supplier-149"><span class="linenos"> 149</span></a><span class="sd">    Attributes:</span>
</span><span id="Supplier-150"><a href="#Supplier-150"><span class="linenos"> 150</span></a><span class="sd">        jid (str): Jabber ID of the supplier agent (e.g., &quot;supplier1@localhost&quot;).</span>
</span><span id="Supplier-151"><a href="#Supplier-151"><span class="linenos"> 151</span></a><span class="sd">        node_id (int): Graph node ID representing the supplier&#39;s physical location.</span>
</span><span id="Supplier-152"><a href="#Supplier-152"><span class="linenos"> 152</span></a><span class="sd">        map (Graph): Reference to the world graph for pathfinding calculations.</span>
</span><span id="Supplier-153"><a href="#Supplier-153"><span class="linenos"> 153</span></a><span class="sd">        contact_list (list[str]): JIDs for warehouses and vehicles.</span>
</span><span id="Supplier-154"><a href="#Supplier-154"><span class="linenos"> 154</span></a><span class="sd">        verbose (bool): Flag to control debug output verbosity.</span>
</span><span id="Supplier-155"><a href="#Supplier-155"><span class="linenos"> 155</span></a><span class="sd">        id_base (int): Base value for generating unique request IDs.</span>
</span><span id="Supplier-156"><a href="#Supplier-156"><span class="linenos"> 156</span></a><span class="sd">        total_supplied (dict[str, int]): Cumulative quantities supplied per product.</span>
</span><span id="Supplier-157"><a href="#Supplier-157"><span class="linenos"> 157</span></a><span class="sd">            Format: {product: total_quantity_supplied}</span>
</span><span id="Supplier-158"><a href="#Supplier-158"><span class="linenos"> 158</span></a><span class="sd">        pending_deliveries (dict[int, Order]): Confirmed orders awaiting vehicle pickup.</span>
</span><span id="Supplier-159"><a href="#Supplier-159"><span class="linenos"> 159</span></a><span class="sd">            Format: {order_id: Order object}</span>
</span><span id="Supplier-160"><a href="#Supplier-160"><span class="linenos"> 160</span></a><span class="sd">        vehicle_proposals (dict[int, dict[str, tuple[bool, int]]]): Vehicle delivery proposals.</span>
</span><span id="Supplier-161"><a href="#Supplier-161"><span class="linenos"> 161</span></a><span class="sd">            Format: {order_id: {vehicle_jid: (can_fit, delivery_time)}}</span>
</span><span id="Supplier-162"><a href="#Supplier-162"><span class="linenos"> 162</span></a><span class="sd">        vehicles (list[str]): List of vehicle JIDs discovered from contacts.</span>
</span><span id="Supplier-163"><a href="#Supplier-163"><span class="linenos"> 163</span></a><span class="sd">        presence_infos (dict[str, str]): Vehicle presence status cache.</span>
</span><span id="Supplier-164"><a href="#Supplier-164"><span class="linenos"> 164</span></a><span class="sd">        current_tick (int): Current simulation time, synchronized by world agent.</span>
</span><span id="Supplier-165"><a href="#Supplier-165"><span class="linenos"> 165</span></a><span class="sd">    </span>
</span><span id="Supplier-166"><a href="#Supplier-166"><span class="linenos"> 166</span></a><span class="sd">    Behaviours:</span>
</span><span id="Supplier-167"><a href="#Supplier-167"><span class="linenos"> 167</span></a><span class="sd">        Warehouse Interaction (FIPA Participant):</span>
</span><span id="Supplier-168"><a href="#Supplier-168"><span class="linenos"> 168</span></a><span class="sd">            - ReceiveBuyRequest: Processes warehouse purchase requests (FIPA CFP)</span>
</span><span id="Supplier-169"><a href="#Supplier-169"><span class="linenos"> 169</span></a><span class="sd">            - AcceptBuyRequest: Sends proposal to warehouse (FIPA propose)</span>
</span><span id="Supplier-170"><a href="#Supplier-170"><span class="linenos"> 170</span></a><span class="sd">            - ReceiveConfirmationOrDenial: Handles warehouse award/rejection</span>
</span><span id="Supplier-171"><a href="#Supplier-171"><span class="linenos"> 171</span></a><span class="sd">        </span>
</span><span id="Supplier-172"><a href="#Supplier-172"><span class="linenos"> 172</span></a><span class="sd">        Vehicle Coordination:</span>
</span><span id="Supplier-173"><a href="#Supplier-173"><span class="linenos"> 173</span></a><span class="sd">            - AssignVehicle: Initiates vehicle assignment for deliveries</span>
</span><span id="Supplier-174"><a href="#Supplier-174"><span class="linenos"> 174</span></a><span class="sd">            - ReceivePresenceInfo: Checks vehicle availability</span>
</span><span id="Supplier-175"><a href="#Supplier-175"><span class="linenos"> 175</span></a><span class="sd">            - ReceiveVehicleProposals: Collects vehicle delivery proposals</span>
</span><span id="Supplier-176"><a href="#Supplier-176"><span class="linenos"> 176</span></a><span class="sd">            - ChooseBestVehicle: Selects optimal vehicle using scoring algorithm</span>
</span><span id="Supplier-177"><a href="#Supplier-177"><span class="linenos"> 177</span></a><span class="sd">            - ReceiveVehicleArrival: Handles vehicle pickup notifications</span>
</span><span id="Supplier-178"><a href="#Supplier-178"><span class="linenos"> 178</span></a><span class="sd">        </span>
</span><span id="Supplier-179"><a href="#Supplier-179"><span class="linenos"> 179</span></a><span class="sd">        Time Management:</span>
</span><span id="Supplier-180"><a href="#Supplier-180"><span class="linenos"> 180</span></a><span class="sd">            - ReceiveTimeDelta: Synchronizes simulation time and traffic updates</span>
</span><span id="Supplier-181"><a href="#Supplier-181"><span class="linenos"> 181</span></a><span class="sd">    </span>
</span><span id="Supplier-182"><a href="#Supplier-182"><span class="linenos"> 182</span></a><span class="sd">    Message Protocols:</span>
</span><span id="Supplier-183"><a href="#Supplier-183"><span class="linenos"> 183</span></a><span class="sd">        Incoming from Warehouses:</span>
</span><span id="Supplier-184"><a href="#Supplier-184"><span class="linenos"> 184</span></a><span class="sd">            - warehouse-buy: Purchase request (FIPA CFP)</span>
</span><span id="Supplier-185"><a href="#Supplier-185"><span class="linenos"> 185</span></a><span class="sd">            - warehouse-confirm: Order confirmation (FIPA accept-proposal)</span>
</span><span id="Supplier-186"><a href="#Supplier-186"><span class="linenos"> 186</span></a><span class="sd">            - warehouse-deny: Order rejection (FIPA reject-proposal)</span>
</span><span id="Supplier-187"><a href="#Supplier-187"><span class="linenos"> 187</span></a><span class="sd">        </span>
</span><span id="Supplier-188"><a href="#Supplier-188"><span class="linenos"> 188</span></a><span class="sd">        Outgoing to Warehouses:</span>
</span><span id="Supplier-189"><a href="#Supplier-189"><span class="linenos"> 189</span></a><span class="sd">            - supplier-accept: Material proposal (FIPA propose)</span>
</span><span id="Supplier-190"><a href="#Supplier-190"><span class="linenos"> 190</span></a><span class="sd">        </span>
</span><span id="Supplier-191"><a href="#Supplier-191"><span class="linenos"> 191</span></a><span class="sd">        Vehicle Communication:</span>
</span><span id="Supplier-192"><a href="#Supplier-192"><span class="linenos"> 192</span></a><span class="sd">            - order-proposal: Request vehicle delivery quote</span>
</span><span id="Supplier-193"><a href="#Supplier-193"><span class="linenos"> 193</span></a><span class="sd">            - vehicle-proposal: Vehicle delivery proposal</span>
</span><span id="Supplier-194"><a href="#Supplier-194"><span class="linenos"> 194</span></a><span class="sd">            - order-confirmation: Confirm vehicle assignment</span>
</span><span id="Supplier-195"><a href="#Supplier-195"><span class="linenos"> 195</span></a><span class="sd">            - vehicle-pickup: Vehicle picks up order from supplier</span>
</span><span id="Supplier-196"><a href="#Supplier-196"><span class="linenos"> 196</span></a><span class="sd">            - presence-info: Request vehicle availability</span>
</span><span id="Supplier-197"><a href="#Supplier-197"><span class="linenos"> 197</span></a><span class="sd">            - presence-response: Vehicle availability status</span>
</span><span id="Supplier-198"><a href="#Supplier-198"><span class="linenos"> 198</span></a><span class="sd">    </span>
</span><span id="Supplier-199"><a href="#Supplier-199"><span class="linenos"> 199</span></a><span class="sd">    Usage Instructions:</span>
</span><span id="Supplier-200"><a href="#Supplier-200"><span class="linenos"> 200</span></a><span class="sd">        **For Vehicle Integration**:</span>
</span><span id="Supplier-201"><a href="#Supplier-201"><span class="linenos"> 201</span></a><span class="sd">            - All vehicles must subscribe to all suppliers (mutual presence subscription)</span>
</span><span id="Supplier-202"><a href="#Supplier-202"><span class="linenos"> 202</span></a><span class="sd">            - Vehicles access pending orders via `supplier_agent.pending_deliveries.values()`</span>
</span><span id="Supplier-203"><a href="#Supplier-203"><span class="linenos"> 203</span></a><span class="sd">            - Vehicle pickup removes order from pending_deliveries</span>
</span><span id="Supplier-204"><a href="#Supplier-204"><span class="linenos"> 204</span></a><span class="sd">        </span>
</span><span id="Supplier-205"><a href="#Supplier-205"><span class="linenos"> 205</span></a><span class="sd">        **For Warehouse Integration**:</span>
</span><span id="Supplier-206"><a href="#Supplier-206"><span class="linenos"> 206</span></a><span class="sd">            - Warehouses send warehouse-buy requests to supplier</span>
</span><span id="Supplier-207"><a href="#Supplier-207"><span class="linenos"> 207</span></a><span class="sd">            - Supplier always accepts (infinite stock)</span>
</span><span id="Supplier-208"><a href="#Supplier-208"><span class="linenos"> 208</span></a><span class="sd">            - Warehouse selects winning supplier based on delivery time</span>
</span><span id="Supplier-209"><a href="#Supplier-209"><span class="linenos"> 209</span></a><span class="sd">    </span>
</span><span id="Supplier-210"><a href="#Supplier-210"><span class="linenos"> 210</span></a><span class="sd">    Example:</span>
</span><span id="Supplier-211"><a href="#Supplier-211"><span class="linenos"> 211</span></a><span class="sd">        ```python</span>
</span><span id="Supplier-212"><a href="#Supplier-212"><span class="linenos"> 212</span></a><span class="sd">        supplier = Supplier(</span>
</span><span id="Supplier-213"><a href="#Supplier-213"><span class="linenos"> 213</span></a><span class="sd">            jid=&quot;supplier1@localhost&quot;,</span>
</span><span id="Supplier-214"><a href="#Supplier-214"><span class="linenos"> 214</span></a><span class="sd">            password=&quot;password&quot;,</span>
</span><span id="Supplier-215"><a href="#Supplier-215"><span class="linenos"> 215</span></a><span class="sd">            map=world_graph,</span>
</span><span id="Supplier-216"><a href="#Supplier-216"><span class="linenos"> 216</span></a><span class="sd">            node_id=20,</span>
</span><span id="Supplier-217"><a href="#Supplier-217"><span class="linenos"> 217</span></a><span class="sd">            contact_list=[&quot;warehouse1@localhost&quot;, &quot;vehicle1@localhost&quot;],</span>
</span><span id="Supplier-218"><a href="#Supplier-218"><span class="linenos"> 218</span></a><span class="sd">            verbose=True</span>
</span><span id="Supplier-219"><a href="#Supplier-219"><span class="linenos"> 219</span></a><span class="sd">        )</span>
</span><span id="Supplier-220"><a href="#Supplier-220"><span class="linenos"> 220</span></a><span class="sd">        await supplier.start()</span>
</span><span id="Supplier-221"><a href="#Supplier-221"><span class="linenos"> 221</span></a><span class="sd">        </span>
</span><span id="Supplier-222"><a href="#Supplier-222"><span class="linenos"> 222</span></a><span class="sd">        # Access statistics</span>
</span><span id="Supplier-223"><a href="#Supplier-223"><span class="linenos"> 223</span></a><span class="sd">        print(supplier.total_supplied)  # {&#39;electronics&#39;: 500, &#39;textiles&#39;: 300}</span>
</span><span id="Supplier-224"><a href="#Supplier-224"><span class="linenos"> 224</span></a><span class="sd">        </span>
</span><span id="Supplier-225"><a href="#Supplier-225"><span class="linenos"> 225</span></a><span class="sd">        # Access pending orders (for vehicles)</span>
</span><span id="Supplier-226"><a href="#Supplier-226"><span class="linenos"> 226</span></a><span class="sd">        for order in supplier.pending_deliveries.values():</span>
</span><span id="Supplier-227"><a href="#Supplier-227"><span class="linenos"> 227</span></a><span class="sd">            print(f&quot;Order {order.orderid}: {order.quantity}x{order.product}&quot;)</span>
</span><span id="Supplier-228"><a href="#Supplier-228"><span class="linenos"> 228</span></a><span class="sd">        ```</span>
</span><span id="Supplier-229"><a href="#Supplier-229"><span class="linenos"> 229</span></a><span class="sd">    </span>
</span><span id="Supplier-230"><a href="#Supplier-230"><span class="linenos"> 230</span></a><span class="sd">    Note:</span>
</span><span id="Supplier-231"><a href="#Supplier-231"><span class="linenos"> 231</span></a><span class="sd">        The infinite stock model simplifies the supply chain by eliminating upstream</span>
</span><span id="Supplier-232"><a href="#Supplier-232"><span class="linenos"> 232</span></a><span class="sd">        constraints, allowing focus on warehouse inventory management and vehicle logistics.</span>
</span><span id="Supplier-233"><a href="#Supplier-233"><span class="linenos"> 233</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Supplier-234"><a href="#Supplier-234"><span class="linenos"> 234</span></a>    
</span><span id="Supplier-235"><a href="#Supplier-235"><span class="linenos"> 235</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="Supplier-236"><a href="#Supplier-236"><span class="linenos"> 236</span></a>    <span class="c1">#          SUPPLIER &lt;-&gt; WAREHOUSE</span>
</span><span id="Supplier-237"><a href="#Supplier-237"><span class="linenos"> 237</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="Supplier-238"><a href="#Supplier-238"><span class="linenos"> 238</span></a>    
</span><span id="Supplier-239"><a href="#Supplier-239"><span class="linenos"> 239</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveBuyRequest</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="Supplier-240"><a href="#Supplier-240"><span class="linenos"> 240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-241"><a href="#Supplier-241"><span class="linenos"> 241</span></a><span class="sd">        Cyclic behaviour that processes incoming purchase requests from warehouses.</span>
</span><span id="Supplier-242"><a href="#Supplier-242"><span class="linenos"> 242</span></a><span class="sd">        </span>
</span><span id="Supplier-243"><a href="#Supplier-243"><span class="linenos"> 243</span></a><span class="sd">        This behaviour implements the proposal phase of the FIPA Contract Net Protocol</span>
</span><span id="Supplier-244"><a href="#Supplier-244"><span class="linenos"> 244</span></a><span class="sd">        where the supplier acts as a **Participant**. It receives CFP messages from</span>
</span><span id="Supplier-245"><a href="#Supplier-245"><span class="linenos"> 245</span></a><span class="sd">        warehouses and automatically accepts all requests since the supplier has</span>
</span><span id="Supplier-246"><a href="#Supplier-246"><span class="linenos"> 246</span></a><span class="sd">        infinite stock.</span>
</span><span id="Supplier-247"><a href="#Supplier-247"><span class="linenos"> 247</span></a><span class="sd">        </span>
</span><span id="Supplier-248"><a href="#Supplier-248"><span class="linenos"> 248</span></a><span class="sd">        FIPA Protocol Phase: **Proposal Phase - Participant Role**</span>
</span><span id="Supplier-249"><a href="#Supplier-249"><span class="linenos"> 249</span></a><span class="sd">            - Role: Participant (Supplier responding to Warehouse&#39;s CFP)</span>
</span><span id="Supplier-250"><a href="#Supplier-250"><span class="linenos"> 250</span></a><span class="sd">            - Receives: warehouse-buy messages (FIPA CFP)</span>
</span><span id="Supplier-251"><a href="#Supplier-251"><span class="linenos"> 251</span></a><span class="sd">            - Evaluates: Always accepts (infinite stock model)</span>
</span><span id="Supplier-252"><a href="#Supplier-252"><span class="linenos"> 252</span></a><span class="sd">            - Responds: supplier-accept (FIPA propose) for every request</span>
</span><span id="Supplier-253"><a href="#Supplier-253"><span class="linenos"> 253</span></a><span class="sd">        </span>
</span><span id="Supplier-254"><a href="#Supplier-254"><span class="linenos"> 254</span></a><span class="sd">        Infinite Stock Advantage:</span>
</span><span id="Supplier-255"><a href="#Supplier-255"><span class="linenos"> 255</span></a><span class="sd">            Unlike warehouses that must check inventory:</span>
</span><span id="Supplier-256"><a href="#Supplier-256"><span class="linenos"> 256</span></a><span class="sd">            - No stock validation needed</span>
</span><span id="Supplier-257"><a href="#Supplier-257"><span class="linenos"> 257</span></a><span class="sd">            - No rejection logic (always accepts)</span>
</span><span id="Supplier-258"><a href="#Supplier-258"><span class="linenos"> 258</span></a><span class="sd">            - No stock locking mechanism required</span>
</span><span id="Supplier-259"><a href="#Supplier-259"><span class="linenos"> 259</span></a><span class="sd">            - Simplifies participant role implementation</span>
</span><span id="Supplier-260"><a href="#Supplier-260"><span class="linenos"> 260</span></a><span class="sd">        </span>
</span><span id="Supplier-261"><a href="#Supplier-261"><span class="linenos"> 261</span></a><span class="sd">        Message Format (warehouse-buy):</span>
</span><span id="Supplier-262"><a href="#Supplier-262"><span class="linenos"> 262</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier-263"><a href="#Supplier-263"><span class="linenos"> 263</span></a><span class="sd">                - performative: &quot;warehouse-buy&quot;</span>
</span><span id="Supplier-264"><a href="#Supplier-264"><span class="linenos"> 264</span></a><span class="sd">                - request_id: Unique request identifier</span>
</span><span id="Supplier-265"><a href="#Supplier-265"><span class="linenos"> 265</span></a><span class="sd">            Body:</span>
</span><span id="Supplier-266"><a href="#Supplier-266"><span class="linenos"> 266</span></a><span class="sd">                - Format: &quot;{quantity} {product}&quot;</span>
</span><span id="Supplier-267"><a href="#Supplier-267"><span class="linenos"> 267</span></a><span class="sd">                - Example: &quot;100 raw_materials&quot;</span>
</span><span id="Supplier-268"><a href="#Supplier-268"><span class="linenos"> 268</span></a><span class="sd">        </span>
</span><span id="Supplier-269"><a href="#Supplier-269"><span class="linenos"> 269</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier-270"><a href="#Supplier-270"><span class="linenos"> 270</span></a><span class="sd">            1. **Receive**: Wait up to 20 seconds for warehouse-buy message</span>
</span><span id="Supplier-271"><a href="#Supplier-271"><span class="linenos"> 271</span></a><span class="sd">            2. **Parse**: Extract request_id, quantity, product from message</span>
</span><span id="Supplier-272"><a href="#Supplier-272"><span class="linenos"> 272</span></a><span class="sd">            3. **Accept**: Launch AcceptBuyRequest behaviour (always accept)</span>
</span><span id="Supplier-273"><a href="#Supplier-273"><span class="linenos"> 273</span></a><span class="sd">            4. **Track**: Update total_supplied statistics</span>
</span><span id="Supplier-274"><a href="#Supplier-274"><span class="linenos"> 274</span></a><span class="sd">            5. **Continue**: Return to listening (cyclic behaviour)</span>
</span><span id="Supplier-275"><a href="#Supplier-275"><span class="linenos"> 275</span></a><span class="sd">        </span>
</span><span id="Supplier-276"><a href="#Supplier-276"><span class="linenos"> 276</span></a><span class="sd">        Statistics Tracking:</span>
</span><span id="Supplier-277"><a href="#Supplier-277"><span class="linenos"> 277</span></a><span class="sd">            Maintains cumulative supply counts per product:</span>
</span><span id="Supplier-278"><a href="#Supplier-278"><span class="linenos"> 278</span></a><span class="sd">            - Increment total_supplied[product] by quantity</span>
</span><span id="Supplier-279"><a href="#Supplier-279"><span class="linenos"> 279</span></a><span class="sd">            - Create entry if product not yet supplied</span>
</span><span id="Supplier-280"><a href="#Supplier-280"><span class="linenos"> 280</span></a><span class="sd">            - Used for monitoring and reporting only</span>
</span><span id="Supplier-281"><a href="#Supplier-281"><span class="linenos"> 281</span></a><span class="sd">        </span>
</span><span id="Supplier-282"><a href="#Supplier-282"><span class="linenos"> 282</span></a><span class="sd">        Concurrency Handling:</span>
</span><span id="Supplier-283"><a href="#Supplier-283"><span class="linenos"> 283</span></a><span class="sd">            - Processes multiple warehouse requests concurrently</span>
</span><span id="Supplier-284"><a href="#Supplier-284"><span class="linenos"> 284</span></a><span class="sd">            - Each request launches independent AcceptBuyRequest behaviour</span>
</span><span id="Supplier-285"><a href="#Supplier-285"><span class="linenos"> 285</span></a><span class="sd">            - No race conditions (infinite stock eliminates conflicts)</span>
</span><span id="Supplier-286"><a href="#Supplier-286"><span class="linenos"> 286</span></a><span class="sd">        </span>
</span><span id="Supplier-287"><a href="#Supplier-287"><span class="linenos"> 287</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier-288"><a href="#Supplier-288"><span class="linenos"> 288</span></a><span class="sd">            ```</span>
</span><span id="Supplier-289"><a href="#Supplier-289"><span class="linenos"> 289</span></a><span class="sd">            Request Received: &quot;100 electronics&quot; (request_id=201000000)</span>
</span><span id="Supplier-290"><a href="#Supplier-290"><span class="linenos"> 290</span></a><span class="sd">            From: warehouse1@localhost</span>
</span><span id="Supplier-291"><a href="#Supplier-291"><span class="linenos"> 291</span></a><span class="sd">            Decision: ACCEPT (always)</span>
</span><span id="Supplier-292"><a href="#Supplier-292"><span class="linenos"> 292</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier-293"><a href="#Supplier-293"><span class="linenos"> 293</span></a><span class="sd">                - total_supplied[electronics]: 500 -&gt; 600</span>
</span><span id="Supplier-294"><a href="#Supplier-294"><span class="linenos"> 294</span></a><span class="sd">                - Launch AcceptBuyRequest</span>
</span><span id="Supplier-295"><a href="#Supplier-295"><span class="linenos"> 295</span></a><span class="sd">                - Print: &quot;Request 201000000: 100 xelectronics from warehouse1 received.&quot;</span>
</span><span id="Supplier-296"><a href="#Supplier-296"><span class="linenos"> 296</span></a><span class="sd">            ```</span>
</span><span id="Supplier-297"><a href="#Supplier-297"><span class="linenos"> 297</span></a><span class="sd">        </span>
</span><span id="Supplier-298"><a href="#Supplier-298"><span class="linenos"> 298</span></a><span class="sd">        Timeout Behavior:</span>
</span><span id="Supplier-299"><a href="#Supplier-299"><span class="linenos"> 299</span></a><span class="sd">            If no message received in 20 seconds:</span>
</span><span id="Supplier-300"><a href="#Supplier-300"><span class="linenos"> 300</span></a><span class="sd">            - Log timeout (if verbose enabled)</span>
</span><span id="Supplier-301"><a href="#Supplier-301"><span class="linenos"> 301</span></a><span class="sd">            - Continue listening (cyclic behaviour doesn&#39;t terminate)</span>
</span><span id="Supplier-302"><a href="#Supplier-302"><span class="linenos"> 302</span></a><span class="sd">        </span>
</span><span id="Supplier-303"><a href="#Supplier-303"><span class="linenos"> 303</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-304"><a href="#Supplier-304"><span class="linenos"> 304</span></a><span class="sd">            This behaviour never terminates (cyclic), continuously listening for</span>
</span><span id="Supplier-305"><a href="#Supplier-305"><span class="linenos"> 305</span></a><span class="sd">            warehouse requests throughout the supplier&#39;s lifecycle.</span>
</span><span id="Supplier-306"><a href="#Supplier-306"><span class="linenos"> 306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-307"><a href="#Supplier-307"><span class="linenos"> 307</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-308"><a href="#Supplier-308"><span class="linenos"> 308</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-309"><a href="#Supplier-309"><span class="linenos"> 309</span></a>        
</span><span id="Supplier-310"><a href="#Supplier-310"><span class="linenos"> 310</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-311"><a href="#Supplier-311"><span class="linenos"> 311</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Awaiting buy request from warehouses...&quot;</span><span class="p">)</span>
</span><span id="Supplier-312"><a href="#Supplier-312"><span class="linenos"> 312</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier-313"><a href="#Supplier-313"><span class="linenos"> 313</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier-314"><a href="#Supplier-314"><span class="linenos"> 314</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-315"><a href="#Supplier-315"><span class="linenos"> 315</span></a><span class="sd">                Messages with metadata (&quot;performative&quot;, &quot;warehouse-buy&quot;) have body</span>
</span><span id="Supplier-316"><a href="#Supplier-316"><span class="linenos"> 316</span></a><span class="sd">                with the following format:</span>
</span><span id="Supplier-317"><a href="#Supplier-317"><span class="linenos"> 317</span></a><span class="sd">                </span>
</span><span id="Supplier-318"><a href="#Supplier-318"><span class="linenos"> 318</span></a><span class="sd">                &quot;product_quantity product_type&quot;</span>
</span><span id="Supplier-319"><a href="#Supplier-319"><span class="linenos"> 319</span></a><span class="sd">                </span>
</span><span id="Supplier-320"><a href="#Supplier-320"><span class="linenos"> 320</span></a><span class="sd">                request_id is in metadata[&quot;request_id&quot;]</span>
</span><span id="Supplier-321"><a href="#Supplier-321"><span class="linenos"> 321</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="Supplier-322"><a href="#Supplier-322"><span class="linenos"> 322</span></a>                <span class="n">request_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier-323"><a href="#Supplier-323"><span class="linenos"> 323</span></a>                <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier-324"><a href="#Supplier-324"><span class="linenos"> 324</span></a>                <span class="n">quant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier-325"><a href="#Supplier-325"><span class="linenos"> 325</span></a>                <span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier-326"><a href="#Supplier-326"><span class="linenos"> 326</span></a>                <span class="c1"># Essential print - request received</span>
</span><span id="Supplier-327"><a href="#Supplier-327"><span class="linenos"> 327</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Request </span><span class="si">{</span><span class="n">request_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quant</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> received.&quot;</span><span class="p">)</span>
</span><span id="Supplier-328"><a href="#Supplier-328"><span class="linenos"> 328</span></a>                
</span><span id="Supplier-329"><a href="#Supplier-329"><span class="linenos"> 329</span></a>                <span class="c1"># Supplier has infinite stock - always accept</span>
</span><span id="Supplier-330"><a href="#Supplier-330"><span class="linenos"> 330</span></a>                <span class="n">accept_behav</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">AcceptBuyRequest</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier-331"><a href="#Supplier-331"><span class="linenos"> 331</span></a>                
</span><span id="Supplier-332"><a href="#Supplier-332"><span class="linenos"> 332</span></a>                <span class="c1"># Track total supplied (no need to lock since infinite)</span>
</span><span id="Supplier-333"><a href="#Supplier-333"><span class="linenos"> 333</span></a>                <span class="k">if</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">:</span>
</span><span id="Supplier-334"><a href="#Supplier-334"><span class="linenos"> 334</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quant</span>
</span><span id="Supplier-335"><a href="#Supplier-335"><span class="linenos"> 335</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-336"><a href="#Supplier-336"><span class="linenos"> 336</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant</span>
</span><span id="Supplier-337"><a href="#Supplier-337"><span class="linenos"> 337</span></a>
</span><span id="Supplier-338"><a href="#Supplier-338"><span class="linenos"> 338</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-339"><a href="#Supplier-339"><span class="linenos"> 339</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> supplied: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-340"><a href="#Supplier-340"><span class="linenos"> 340</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier-341"><a href="#Supplier-341"><span class="linenos"> 341</span></a>                
</span><span id="Supplier-342"><a href="#Supplier-342"><span class="linenos"> 342</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">accept_behav</span><span class="p">)</span>
</span><span id="Supplier-343"><a href="#Supplier-343"><span class="linenos"> 343</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-344"><a href="#Supplier-344"><span class="linenos"> 344</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-345"><a href="#Supplier-345"><span class="linenos"> 345</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Did not get any buy requests in 20 seconds.&quot;</span><span class="p">)</span>
</span><span id="Supplier-346"><a href="#Supplier-346"><span class="linenos"> 346</span></a>
</span><span id="Supplier-347"><a href="#Supplier-347"><span class="linenos"> 347</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">AcceptBuyRequest</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier-348"><a href="#Supplier-348"><span class="linenos"> 348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-349"><a href="#Supplier-349"><span class="linenos"> 349</span></a><span class="sd">        Behaviour that sends proposal acceptance to warehouse (FIPA propose).</span>
</span><span id="Supplier-350"><a href="#Supplier-350"><span class="linenos"> 350</span></a><span class="sd">        </span>
</span><span id="Supplier-351"><a href="#Supplier-351"><span class="linenos"> 351</span></a><span class="sd">        This behaviour implements the proposal submission in the FIPA Contract Net</span>
</span><span id="Supplier-352"><a href="#Supplier-352"><span class="linenos"> 352</span></a><span class="sd">        Protocol where the supplier, acting as a participant, sends its proposal</span>
</span><span id="Supplier-353"><a href="#Supplier-353"><span class="linenos"> 353</span></a><span class="sd">        to fulfill the warehouse&#39;s request. Since the supplier has infinite stock,</span>
</span><span id="Supplier-354"><a href="#Supplier-354"><span class="linenos"> 354</span></a><span class="sd">        this is always an acceptance. It then sets up to receive the warehouse&#39;s</span>
</span><span id="Supplier-355"><a href="#Supplier-355"><span class="linenos"> 355</span></a><span class="sd">        decision (accept-proposal or reject-proposal).</span>
</span><span id="Supplier-356"><a href="#Supplier-356"><span class="linenos"> 356</span></a><span class="sd">        </span>
</span><span id="Supplier-357"><a href="#Supplier-357"><span class="linenos"> 357</span></a><span class="sd">        FIPA Protocol Phase: **Proposal Submission - Participant Role**</span>
</span><span id="Supplier-358"><a href="#Supplier-358"><span class="linenos"> 358</span></a><span class="sd">            - Role: Participant (Supplier proposing to Warehouse)</span>
</span><span id="Supplier-359"><a href="#Supplier-359"><span class="linenos"> 359</span></a><span class="sd">            - Sends: supplier-accept (FIPA propose)</span>
</span><span id="Supplier-360"><a href="#Supplier-360"><span class="linenos"> 360</span></a><span class="sd">            - Purpose: &quot;I can fulfill your request&quot; (always true for supplier)</span>
</span><span id="Supplier-361"><a href="#Supplier-361"><span class="linenos"> 361</span></a><span class="sd">            - Next Phase: Await warehouse&#39;s award or rejection decision</span>
</span><span id="Supplier-362"><a href="#Supplier-362"><span class="linenos"> 362</span></a><span class="sd">        </span>
</span><span id="Supplier-363"><a href="#Supplier-363"><span class="linenos"> 363</span></a><span class="sd">        Attributes:</span>
</span><span id="Supplier-364"><a href="#Supplier-364"><span class="linenos"> 364</span></a><span class="sd">            request_id (int): Unique identifier for this request.</span>
</span><span id="Supplier-365"><a href="#Supplier-365"><span class="linenos"> 365</span></a><span class="sd">            quant (int): Quantity of product being proposed.</span>
</span><span id="Supplier-366"><a href="#Supplier-366"><span class="linenos"> 366</span></a><span class="sd">            product (str): Name of product being proposed.</span>
</span><span id="Supplier-367"><a href="#Supplier-367"><span class="linenos"> 367</span></a><span class="sd">            sender (str): Warehouse JID that initiated the request.</span>
</span><span id="Supplier-368"><a href="#Supplier-368"><span class="linenos"> 368</span></a><span class="sd">        </span>
</span><span id="Supplier-369"><a href="#Supplier-369"><span class="linenos"> 369</span></a><span class="sd">        Message Format (supplier-accept):</span>
</span><span id="Supplier-370"><a href="#Supplier-370"><span class="linenos"> 370</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier-371"><a href="#Supplier-371"><span class="linenos"> 371</span></a><span class="sd">                - performative: &quot;supplier-accept&quot; (FIPA propose)</span>
</span><span id="Supplier-372"><a href="#Supplier-372"><span class="linenos"> 372</span></a><span class="sd">                - supplier_id: This supplier&#39;s JID</span>
</span><span id="Supplier-373"><a href="#Supplier-373"><span class="linenos"> 373</span></a><span class="sd">                - warehouse_id: Requesting warehouse&#39;s JID</span>
</span><span id="Supplier-374"><a href="#Supplier-374"><span class="linenos"> 374</span></a><span class="sd">                - node_id: Supplier&#39;s graph location</span>
</span><span id="Supplier-375"><a href="#Supplier-375"><span class="linenos"> 375</span></a><span class="sd">                - request_id: Original request identifier</span>
</span><span id="Supplier-376"><a href="#Supplier-376"><span class="linenos"> 376</span></a><span class="sd">            Body:</span>
</span><span id="Supplier-377"><a href="#Supplier-377"><span class="linenos"> 377</span></a><span class="sd">                - Format: &quot;{quantity} {product}&quot;</span>
</span><span id="Supplier-378"><a href="#Supplier-378"><span class="linenos"> 378</span></a><span class="sd">                - Example: &quot;100 electronics&quot;</span>
</span><span id="Supplier-379"><a href="#Supplier-379"><span class="linenos"> 379</span></a><span class="sd">        </span>
</span><span id="Supplier-380"><a href="#Supplier-380"><span class="linenos"> 380</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier-381"><a href="#Supplier-381"><span class="linenos"> 381</span></a><span class="sd">            1. **Log Acceptance** (verbose): Print proposal details</span>
</span><span id="Supplier-382"><a href="#Supplier-382"><span class="linenos"> 382</span></a><span class="sd">            2. **Construct Message**: Create supplier-accept with all metadata</span>
</span><span id="Supplier-383"><a href="#Supplier-383"><span class="linenos"> 383</span></a><span class="sd">            3. **Send Proposal**: Transmit to requesting warehouse</span>
</span><span id="Supplier-384"><a href="#Supplier-384"><span class="linenos"> 384</span></a><span class="sd">            4. **Create Listener**: Initialize ReceiveConfirmationOrDenial behaviour</span>
</span><span id="Supplier-385"><a href="#Supplier-385"><span class="linenos"> 385</span></a><span class="sd">            5. **Setup Template**: Configure filter for this specific negotiation</span>
</span><span id="Supplier-386"><a href="#Supplier-386"><span class="linenos"> 386</span></a><span class="sd">            6. **Register Listener**: Add behaviour with template to agent</span>
</span><span id="Supplier-387"><a href="#Supplier-387"><span class="linenos"> 387</span></a><span class="sd">            7. **Return**: Don&#39;t block (listener runs independently)</span>
</span><span id="Supplier-388"><a href="#Supplier-388"><span class="linenos"> 388</span></a><span class="sd">        </span>
</span><span id="Supplier-389"><a href="#Supplier-389"><span class="linenos"> 389</span></a><span class="sd">        Template Configuration:</span>
</span><span id="Supplier-390"><a href="#Supplier-390"><span class="linenos"> 390</span></a><span class="sd">            Filters messages to match:</span>
</span><span id="Supplier-391"><a href="#Supplier-391"><span class="linenos"> 391</span></a><span class="sd">            - supplier_id: This supplier</span>
</span><span id="Supplier-392"><a href="#Supplier-392"><span class="linenos"> 392</span></a><span class="sd">            - warehouse_id: Specific warehouse that made request</span>
</span><span id="Supplier-393"><a href="#Supplier-393"><span class="linenos"> 393</span></a><span class="sd">            - request_id: This specific request</span>
</span><span id="Supplier-394"><a href="#Supplier-394"><span class="linenos"> 394</span></a><span class="sd">            </span>
</span><span id="Supplier-395"><a href="#Supplier-395"><span class="linenos"> 395</span></a><span class="sd">            Accepts both performatives:</span>
</span><span id="Supplier-396"><a href="#Supplier-396"><span class="linenos"> 396</span></a><span class="sd">            - warehouse-confirm (FIPA accept-proposal)</span>
</span><span id="Supplier-397"><a href="#Supplier-397"><span class="linenos"> 397</span></a><span class="sd">            - warehouse-deny (FIPA reject-proposal)</span>
</span><span id="Supplier-398"><a href="#Supplier-398"><span class="linenos"> 398</span></a><span class="sd">        </span>
</span><span id="Supplier-399"><a href="#Supplier-399"><span class="linenos"> 399</span></a><span class="sd">        Non-Blocking Design:</span>
</span><span id="Supplier-400"><a href="#Supplier-400"><span class="linenos"> 400</span></a><span class="sd">            The commented-out `await confirm_deny_behav.join()` demonstrates</span>
</span><span id="Supplier-401"><a href="#Supplier-401"><span class="linenos"> 401</span></a><span class="sd">            that we intentionally DON&#39;T wait for confirmation here. This allows</span>
</span><span id="Supplier-402"><a href="#Supplier-402"><span class="linenos"> 402</span></a><span class="sd">            the supplier to accept multiple warehouse requests concurrently.</span>
</span><span id="Supplier-403"><a href="#Supplier-403"><span class="linenos"> 403</span></a><span class="sd">        </span>
</span><span id="Supplier-404"><a href="#Supplier-404"><span class="linenos"> 404</span></a><span class="sd">        Example:</span>
</span><span id="Supplier-405"><a href="#Supplier-405"><span class="linenos"> 405</span></a><span class="sd">            ```</span>
</span><span id="Supplier-406"><a href="#Supplier-406"><span class="linenos"> 406</span></a><span class="sd">            Input: Warehouse request for &quot;100 electronics&quot;</span>
</span><span id="Supplier-407"><a href="#Supplier-407"><span class="linenos"> 407</span></a><span class="sd">            Proposal Sent: supplier-accept with body &quot;100 electronics&quot;</span>
</span><span id="Supplier-408"><a href="#Supplier-408"><span class="linenos"> 408</span></a><span class="sd">            Listener Setup: ReceiveConfirmationOrDenial waiting for:</span>
</span><span id="Supplier-409"><a href="#Supplier-409"><span class="linenos"> 409</span></a><span class="sd">                - warehouse-confirm (award) OR</span>
</span><span id="Supplier-410"><a href="#Supplier-410"><span class="linenos"> 410</span></a><span class="sd">                - warehouse-deny (rejection)</span>
</span><span id="Supplier-411"><a href="#Supplier-411"><span class="linenos"> 411</span></a><span class="sd">            Result: Supplier ready to process next request</span>
</span><span id="Supplier-412"><a href="#Supplier-412"><span class="linenos"> 412</span></a><span class="sd">            ```</span>
</span><span id="Supplier-413"><a href="#Supplier-413"><span class="linenos"> 413</span></a><span class="sd">        </span>
</span><span id="Supplier-414"><a href="#Supplier-414"><span class="linenos"> 414</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier-415"><a href="#Supplier-415"><span class="linenos"> 415</span></a><span class="sd">            - Sends SPADE message to warehouse</span>
</span><span id="Supplier-416"><a href="#Supplier-416"><span class="linenos"> 416</span></a><span class="sd">            - Adds ReceiveConfirmationOrDenial behaviour to agent</span>
</span><span id="Supplier-417"><a href="#Supplier-417"><span class="linenos"> 417</span></a><span class="sd">            - Prints debug information if verbose enabled</span>
</span><span id="Supplier-418"><a href="#Supplier-418"><span class="linenos"> 418</span></a><span class="sd">        </span>
</span><span id="Supplier-419"><a href="#Supplier-419"><span class="linenos"> 419</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-420"><a href="#Supplier-420"><span class="linenos"> 420</span></a><span class="sd">            Unlike warehouse AcceptBuyRequest, this never needs to lock stock</span>
</span><span id="Supplier-421"><a href="#Supplier-421"><span class="linenos"> 421</span></a><span class="sd">            since the supplier has infinite inventory.</span>
</span><span id="Supplier-422"><a href="#Supplier-422"><span class="linenos"> 422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-423"><a href="#Supplier-423"><span class="linenos"> 423</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">):</span>
</span><span id="Supplier-424"><a href="#Supplier-424"><span class="linenos"> 424</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-425"><a href="#Supplier-425"><span class="linenos"> 425</span></a><span class="sd">            Initialize the AcceptBuyRequest behaviour.</span>
</span><span id="Supplier-426"><a href="#Supplier-426"><span class="linenos"> 426</span></a><span class="sd">            </span>
</span><span id="Supplier-427"><a href="#Supplier-427"><span class="linenos"> 427</span></a><span class="sd">            Args:</span>
</span><span id="Supplier-428"><a href="#Supplier-428"><span class="linenos"> 428</span></a><span class="sd">                msg (Message): The warehouse-buy request message to accept.</span>
</span><span id="Supplier-429"><a href="#Supplier-429"><span class="linenos"> 429</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier-430"><a href="#Supplier-430"><span class="linenos"> 430</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier-431"><a href="#Supplier-431"><span class="linenos"> 431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier-432"><a href="#Supplier-432"><span class="linenos"> 432</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier-433"><a href="#Supplier-433"><span class="linenos"> 433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">quant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier-434"><a href="#Supplier-434"><span class="linenos"> 434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier-435"><a href="#Supplier-435"><span class="linenos"> 435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">sender</span>
</span><span id="Supplier-436"><a href="#Supplier-436"><span class="linenos"> 436</span></a>        
</span><span id="Supplier-437"><a href="#Supplier-437"><span class="linenos"> 437</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-438"><a href="#Supplier-438"><span class="linenos"> 438</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-439"><a href="#Supplier-439"><span class="linenos"> 439</span></a>            
</span><span id="Supplier-440"><a href="#Supplier-440"><span class="linenos"> 440</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-441"><a href="#Supplier-441"><span class="linenos"> 441</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Supplier-442"><a href="#Supplier-442"><span class="linenos"> 442</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Accepted a request from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="Supplier-443"><a href="#Supplier-443"><span class="linenos"> 443</span></a>                    <span class="sa">f</span><span class="s2">&quot;id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier-444"><a href="#Supplier-444"><span class="linenos"> 444</span></a>                    <span class="sa">f</span><span class="s2">&quot;quant=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quant</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier-445"><a href="#Supplier-445"><span class="linenos"> 445</span></a>                    <span class="sa">f</span><span class="s2">&quot;product=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Supplier-446"><a href="#Supplier-446"><span class="linenos"> 446</span></a>                <span class="p">)</span>
</span><span id="Supplier-447"><a href="#Supplier-447"><span class="linenos"> 447</span></a>            
</span><span id="Supplier-448"><a href="#Supplier-448"><span class="linenos"> 448</span></a>            
</span><span id="Supplier-449"><a href="#Supplier-449"><span class="linenos"> 449</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier-450"><a href="#Supplier-450"><span class="linenos"> 450</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;supplier-accept&quot;</span><span class="p">)</span>
</span><span id="Supplier-451"><a href="#Supplier-451"><span class="linenos"> 451</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier-452"><a href="#Supplier-452"><span class="linenos"> 452</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier-453"><a href="#Supplier-453"><span class="linenos"> 453</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="Supplier-454"><a href="#Supplier-454"><span class="linenos"> 454</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">))</span>
</span><span id="Supplier-455"><a href="#Supplier-455"><span class="linenos"> 455</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quant</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Supplier-456"><a href="#Supplier-456"><span class="linenos"> 456</span></a>            
</span><span id="Supplier-457"><a href="#Supplier-457"><span class="linenos"> 457</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-458"><a href="#Supplier-458"><span class="linenos"> 458</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Sending supplier-accept message to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-459"><a href="#Supplier-459"><span class="linenos"> 459</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Message metadata: warehouse_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">, request_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-460"><a href="#Supplier-460"><span class="linenos"> 460</span></a>            
</span><span id="Supplier-461"><a href="#Supplier-461"><span class="linenos"> 461</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier-462"><a href="#Supplier-462"><span class="linenos"> 462</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-463"><a href="#Supplier-463"><span class="linenos"> 463</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Message sent successfully!&quot;</span><span class="p">)</span>
</span><span id="Supplier-464"><a href="#Supplier-464"><span class="linenos"> 464</span></a>            
</span><span id="Supplier-465"><a href="#Supplier-465"><span class="linenos"> 465</span></a>            <span class="c1"># Wait for either confirmation or denial</span>
</span><span id="Supplier-466"><a href="#Supplier-466"><span class="linenos"> 466</span></a>            <span class="n">confirm_deny_behav</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">ReceiveConfirmationOrDenial</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier-467"><a href="#Supplier-467"><span class="linenos"> 467</span></a>            
</span><span id="Supplier-468"><a href="#Supplier-468"><span class="linenos"> 468</span></a>            <span class="c1"># Template that matches BOTH warehouse-confirm AND warehouse-deny</span>
</span><span id="Supplier-469"><a href="#Supplier-469"><span class="linenos"> 469</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier-470"><a href="#Supplier-470"><span class="linenos"> 470</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier-471"><a href="#Supplier-471"><span class="linenos"> 471</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier-472"><a href="#Supplier-472"><span class="linenos"> 472</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">))</span>
</span><span id="Supplier-473"><a href="#Supplier-473"><span class="linenos"> 473</span></a>            
</span><span id="Supplier-474"><a href="#Supplier-474"><span class="linenos"> 474</span></a>            <span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">confirm_deny_behav</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="Supplier-475"><a href="#Supplier-475"><span class="linenos"> 475</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-476"><a href="#Supplier-476"><span class="linenos"> 476</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; AcceptBuyRequest finished, now waiting for confirmation or denial...&quot;</span><span class="p">)</span>
</span><span id="Supplier-477"><a href="#Supplier-477"><span class="linenos"> 477</span></a>            
</span><span id="Supplier-478"><a href="#Supplier-478"><span class="linenos"> 478</span></a>            <span class="c1"># Aguardar a confirmao ser recebida antes de terminar</span>
</span><span id="Supplier-479"><a href="#Supplier-479"><span class="linenos"> 479</span></a>            <span class="c1"># await confirm_deny_behav.join()</span>
</span><span id="Supplier-480"><a href="#Supplier-480"><span class="linenos"> 480</span></a>            
</span><span id="Supplier-481"><a href="#Supplier-481"><span class="linenos"> 481</span></a>    
</span><span id="Supplier-482"><a href="#Supplier-482"><span class="linenos"> 482</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveConfirmationOrDenial</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier-483"><a href="#Supplier-483"><span class="linenos"> 483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-484"><a href="#Supplier-484"><span class="linenos"> 484</span></a><span class="sd">        Behaviour that processes warehouse&#39;s award or rejection decision (FIPA result notification).</span>
</span><span id="Supplier-485"><a href="#Supplier-485"><span class="linenos"> 485</span></a><span class="sd">        </span>
</span><span id="Supplier-486"><a href="#Supplier-486"><span class="linenos"> 486</span></a><span class="sd">        This behaviour implements the result notification reception in the FIPA Contract Net</span>
</span><span id="Supplier-487"><a href="#Supplier-487"><span class="linenos"> 487</span></a><span class="sd">        Protocol where the supplier, acting as a participant, receives the warehouse&#39;s final</span>
</span><span id="Supplier-488"><a href="#Supplier-488"><span class="linenos"> 488</span></a><span class="sd">        decision about whether its proposal was accepted or rejected.</span>
</span><span id="Supplier-489"><a href="#Supplier-489"><span class="linenos"> 489</span></a><span class="sd">        </span>
</span><span id="Supplier-490"><a href="#Supplier-490"><span class="linenos"> 490</span></a><span class="sd">        FIPA Protocol Phase: **Result Notification Reception - Participant Role**</span>
</span><span id="Supplier-491"><a href="#Supplier-491"><span class="linenos"> 491</span></a><span class="sd">            - Role: Participant (Supplier receiving Warehouse&#39;s decision)</span>
</span><span id="Supplier-492"><a href="#Supplier-492"><span class="linenos"> 492</span></a><span class="sd">            - Receives: warehouse-confirm (FIPA accept-proposal) or warehouse-deny (FIPA reject-proposal)</span>
</span><span id="Supplier-493"><a href="#Supplier-493"><span class="linenos"> 493</span></a><span class="sd">            - Actions:</span>
</span><span id="Supplier-494"><a href="#Supplier-494"><span class="linenos"> 494</span></a><span class="sd">                - If confirm: Add order to pending_deliveries, assign vehicle</span>
</span><span id="Supplier-495"><a href="#Supplier-495"><span class="linenos"> 495</span></a><span class="sd">                - If deny: Log rejection (no rollback needed - infinite stock)</span>
</span><span id="Supplier-496"><a href="#Supplier-496"><span class="linenos"> 496</span></a><span class="sd">                - If timeout: Log timeout (warehouse chose another supplier)</span>
</span><span id="Supplier-497"><a href="#Supplier-497"><span class="linenos"> 497</span></a><span class="sd">        </span>
</span><span id="Supplier-498"><a href="#Supplier-498"><span class="linenos"> 498</span></a><span class="sd">        Order State Transitions:</span>
</span><span id="Supplier-499"><a href="#Supplier-499"><span class="linenos"> 499</span></a><span class="sd">        </span>
</span><span id="Supplier-500"><a href="#Supplier-500"><span class="linenos"> 500</span></a><span class="sd">            **On warehouse-confirm (Award)**:</span>
</span><span id="Supplier-501"><a href="#Supplier-501"><span class="linenos"> 501</span></a><span class="sd">                1. Convert message to Order object</span>
</span><span id="Supplier-502"><a href="#Supplier-502"><span class="linenos"> 502</span></a><span class="sd">                2. pending_deliveries[order_id] = order</span>
</span><span id="Supplier-503"><a href="#Supplier-503"><span class="linenos"> 503</span></a><span class="sd">                3. Launch AssignVehicle behaviour</span>
</span><span id="Supplier-504"><a href="#Supplier-504"><span class="linenos"> 504</span></a><span class="sd">                4. Print confirmation message</span>
</span><span id="Supplier-505"><a href="#Supplier-505"><span class="linenos"> 505</span></a><span class="sd">            </span>
</span><span id="Supplier-506"><a href="#Supplier-506"><span class="linenos"> 506</span></a><span class="sd">            **On warehouse-deny or timeout (Rejection/Timeout)**:</span>
</span><span id="Supplier-507"><a href="#Supplier-507"><span class="linenos"> 507</span></a><span class="sd">                1. Log rejection/timeout (if verbose)</span>
</span><span id="Supplier-508"><a href="#Supplier-508"><span class="linenos"> 508</span></a><span class="sd">                2. No state changes needed (infinite stock)</span>
</span><span id="Supplier-509"><a href="#Supplier-509"><span class="linenos"> 509</span></a><span class="sd">                3. No further action required</span>
</span><span id="Supplier-510"><a href="#Supplier-510"><span class="linenos"> 510</span></a><span class="sd">        </span>
</span><span id="Supplier-511"><a href="#Supplier-511"><span class="linenos"> 511</span></a><span class="sd">        Attributes:</span>
</span><span id="Supplier-512"><a href="#Supplier-512"><span class="linenos"> 512</span></a><span class="sd">            accepted_id (int): Request ID for which we sent proposal.</span>
</span><span id="Supplier-513"><a href="#Supplier-513"><span class="linenos"> 513</span></a><span class="sd">            accepted_quantity (int): Quantity that was proposed.</span>
</span><span id="Supplier-514"><a href="#Supplier-514"><span class="linenos"> 514</span></a><span class="sd">            accepted_product (str): Product that was proposed.</span>
</span><span id="Supplier-515"><a href="#Supplier-515"><span class="linenos"> 515</span></a><span class="sd">            sender_jid (str): Warehouse JID that will send decision.</span>
</span><span id="Supplier-516"><a href="#Supplier-516"><span class="linenos"> 516</span></a><span class="sd">        </span>
</span><span id="Supplier-517"><a href="#Supplier-517"><span class="linenos"> 517</span></a><span class="sd">        Timeout Mechanism:</span>
</span><span id="Supplier-518"><a href="#Supplier-518"><span class="linenos"> 518</span></a><span class="sd">            - Wait time: 10 seconds</span>
</span><span id="Supplier-519"><a href="#Supplier-519"><span class="linenos"> 519</span></a><span class="sd">            - Interpretation: Warehouse chose another supplier (implicit rejection)</span>
</span><span id="Supplier-520"><a href="#Supplier-520"><span class="linenos"> 520</span></a><span class="sd">            - Action: Log only (no stock to unlock)</span>
</span><span id="Supplier-521"><a href="#Supplier-521"><span class="linenos"> 521</span></a><span class="sd">        </span>
</span><span id="Supplier-522"><a href="#Supplier-522"><span class="linenos"> 522</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier-523"><a href="#Supplier-523"><span class="linenos"> 523</span></a><span class="sd">        </span>
</span><span id="Supplier-524"><a href="#Supplier-524"><span class="linenos"> 524</span></a><span class="sd">            **Scenario 1: Warehouse Confirms**</span>
</span><span id="Supplier-525"><a href="#Supplier-525"><span class="linenos"> 525</span></a><span class="sd">            ```</span>
</span><span id="Supplier-526"><a href="#Supplier-526"><span class="linenos"> 526</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="Supplier-527"><a href="#Supplier-527"><span class="linenos"> 527</span></a><span class="sd">            Message Received: warehouse-confirm &quot;100 electronics&quot;</span>
</span><span id="Supplier-528"><a href="#Supplier-528"><span class="linenos"> 528</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier-529"><a href="#Supplier-529"><span class="linenos"> 529</span></a><span class="sd">                - Create Order object</span>
</span><span id="Supplier-530"><a href="#Supplier-530"><span class="linenos"> 530</span></a><span class="sd">                - pending_deliveries[301000000] = Order(...)</span>
</span><span id="Supplier-531"><a href="#Supplier-531"><span class="linenos"> 531</span></a><span class="sd">                - Launch AssignVehicle(301000000)</span>
</span><span id="Supplier-532"><a href="#Supplier-532"><span class="linenos"> 532</span></a><span class="sd">                - Print: &quot;Order 301000000 confirmed: 100 xelectronics for warehouse1&quot;</span>
</span><span id="Supplier-533"><a href="#Supplier-533"><span class="linenos"> 533</span></a><span class="sd">            ```</span>
</span><span id="Supplier-534"><a href="#Supplier-534"><span class="linenos"> 534</span></a><span class="sd">            </span>
</span><span id="Supplier-535"><a href="#Supplier-535"><span class="linenos"> 535</span></a><span class="sd">            **Scenario 2: Warehouse Denies**</span>
</span><span id="Supplier-536"><a href="#Supplier-536"><span class="linenos"> 536</span></a><span class="sd">            ```</span>
</span><span id="Supplier-537"><a href="#Supplier-537"><span class="linenos"> 537</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="Supplier-538"><a href="#Supplier-538"><span class="linenos"> 538</span></a><span class="sd">            Message Received: warehouse-deny &quot;100 electronics&quot;</span>
</span><span id="Supplier-539"><a href="#Supplier-539"><span class="linenos"> 539</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier-540"><a href="#Supplier-540"><span class="linenos"> 540</span></a><span class="sd">                - Print: &quot;Denial received! Warehouse chose another supplier.&quot;</span>
</span><span id="Supplier-541"><a href="#Supplier-541"><span class="linenos"> 541</span></a><span class="sd">                - No state changes (infinite stock)</span>
</span><span id="Supplier-542"><a href="#Supplier-542"><span class="linenos"> 542</span></a><span class="sd">            ```</span>
</span><span id="Supplier-543"><a href="#Supplier-543"><span class="linenos"> 543</span></a><span class="sd">            </span>
</span><span id="Supplier-544"><a href="#Supplier-544"><span class="linenos"> 544</span></a><span class="sd">            **Scenario 3: Timeout**</span>
</span><span id="Supplier-545"><a href="#Supplier-545"><span class="linenos"> 545</span></a><span class="sd">            ```</span>
</span><span id="Supplier-546"><a href="#Supplier-546"><span class="linenos"> 546</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="Supplier-547"><a href="#Supplier-547"><span class="linenos"> 547</span></a><span class="sd">            Message Received: None (10 second timeout)</span>
</span><span id="Supplier-548"><a href="#Supplier-548"><span class="linenos"> 548</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier-549"><a href="#Supplier-549"><span class="linenos"> 549</span></a><span class="sd">                - Print: &quot;Timeout: No confirmation or denial received&quot;</span>
</span><span id="Supplier-550"><a href="#Supplier-550"><span class="linenos"> 550</span></a><span class="sd">                - Print: &quot;Order not confirmed for electronics x100&quot;</span>
</span><span id="Supplier-551"><a href="#Supplier-551"><span class="linenos"> 551</span></a><span class="sd">                - No state changes (infinite stock)</span>
</span><span id="Supplier-552"><a href="#Supplier-552"><span class="linenos"> 552</span></a><span class="sd">            ```</span>
</span><span id="Supplier-553"><a href="#Supplier-553"><span class="linenos"> 553</span></a><span class="sd">        </span>
</span><span id="Supplier-554"><a href="#Supplier-554"><span class="linenos"> 554</span></a><span class="sd">        Difference from Warehouse Behaviour:</span>
</span><span id="Supplier-555"><a href="#Supplier-555"><span class="linenos"> 555</span></a><span class="sd">            Unlike warehouse ReceiveConfirmationOrDenial:</span>
</span><span id="Supplier-556"><a href="#Supplier-556"><span class="linenos"> 556</span></a><span class="sd">            - No stock unlocking needed (infinite inventory)</span>
</span><span id="Supplier-557"><a href="#Supplier-557"><span class="linenos"> 557</span></a><span class="sd">            - No capacity adjustments required</span>
</span><span id="Supplier-558"><a href="#Supplier-558"><span class="linenos"> 558</span></a><span class="sd">            - Simpler state management</span>
</span><span id="Supplier-559"><a href="#Supplier-559"><span class="linenos"> 559</span></a><span class="sd">            - Only tracks confirmed orders in pending_deliveries</span>
</span><span id="Supplier-560"><a href="#Supplier-560"><span class="linenos"> 560</span></a><span class="sd">        </span>
</span><span id="Supplier-561"><a href="#Supplier-561"><span class="linenos"> 561</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-562"><a href="#Supplier-562"><span class="linenos"> 562</span></a><span class="sd">            This behaviour is automatically filtered by template to only receive</span>
</span><span id="Supplier-563"><a href="#Supplier-563"><span class="linenos"> 563</span></a><span class="sd">            messages for the specific supplier, warehouse, and request_id combination.</span>
</span><span id="Supplier-564"><a href="#Supplier-564"><span class="linenos"> 564</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-565"><a href="#Supplier-565"><span class="linenos"> 565</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accept_msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">sender_jid</span><span class="p">):</span>
</span><span id="Supplier-566"><a href="#Supplier-566"><span class="linenos"> 566</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-567"><a href="#Supplier-567"><span class="linenos"> 567</span></a><span class="sd">            Initialize the ReceiveConfirmationOrDenial behaviour.</span>
</span><span id="Supplier-568"><a href="#Supplier-568"><span class="linenos"> 568</span></a><span class="sd">            </span>
</span><span id="Supplier-569"><a href="#Supplier-569"><span class="linenos"> 569</span></a><span class="sd">            Args:</span>
</span><span id="Supplier-570"><a href="#Supplier-570"><span class="linenos"> 570</span></a><span class="sd">                accept_msg (Message): The supplier-accept message we sent.</span>
</span><span id="Supplier-571"><a href="#Supplier-571"><span class="linenos"> 571</span></a><span class="sd">                    Used to extract proposal details for logging if needed.</span>
</span><span id="Supplier-572"><a href="#Supplier-572"><span class="linenos"> 572</span></a><span class="sd">                sender_jid (str): JID of the warehouse that will send the decision.</span>
</span><span id="Supplier-573"><a href="#Supplier-573"><span class="linenos"> 573</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier-574"><a href="#Supplier-574"><span class="linenos"> 574</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier-575"><a href="#Supplier-575"><span class="linenos"> 575</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">accept_msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier-576"><a href="#Supplier-576"><span class="linenos"> 576</span></a>            <span class="n">bod</span> <span class="o">=</span> <span class="n">accept_msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier-577"><a href="#Supplier-577"><span class="linenos"> 577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bod</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier-578"><a href="#Supplier-578"><span class="linenos"> 578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_product</span> <span class="o">=</span> <span class="n">bod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier-579"><a href="#Supplier-579"><span class="linenos"> 579</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sender_jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sender_jid</span><span class="p">)</span>
</span><span id="Supplier-580"><a href="#Supplier-580"><span class="linenos"> 580</span></a>        
</span><span id="Supplier-581"><a href="#Supplier-581"><span class="linenos"> 581</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-582"><a href="#Supplier-582"><span class="linenos"> 582</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-583"><a href="#Supplier-583"><span class="linenos"> 583</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Waiting for warehouse confirmation or denial...&quot;</span><span class="p">)</span>
</span><span id="Supplier-584"><a href="#Supplier-584"><span class="linenos"> 584</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Supplier-585"><a href="#Supplier-585"><span class="linenos"> 585</span></a>            
</span><span id="Supplier-586"><a href="#Supplier-586"><span class="linenos"> 586</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier-587"><a href="#Supplier-587"><span class="linenos"> 587</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier-588"><a href="#Supplier-588"><span class="linenos"> 588</span></a>                <span class="n">performative</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">)</span>
</span><span id="Supplier-589"><a href="#Supplier-589"><span class="linenos"> 589</span></a>                
</span><span id="Supplier-590"><a href="#Supplier-590"><span class="linenos"> 590</span></a>                <span class="c1"># Message with body format &quot;quantity product&quot;</span>
</span><span id="Supplier-591"><a href="#Supplier-591"><span class="linenos"> 591</span></a>                <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier-592"><a href="#Supplier-592"><span class="linenos"> 592</span></a>                <span class="n">quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier-593"><a href="#Supplier-593"><span class="linenos"> 593</span></a>                <span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier-594"><a href="#Supplier-594"><span class="linenos"> 594</span></a>                
</span><span id="Supplier-595"><a href="#Supplier-595"><span class="linenos"> 595</span></a>                <span class="k">if</span> <span class="n">performative</span> <span class="o">==</span> <span class="s2">&quot;warehouse-confirm&quot;</span><span class="p">:</span>
</span><span id="Supplier-596"><a href="#Supplier-596"><span class="linenos"> 596</span></a>                    <span class="c1"># Warehouse confirmed - add to pending deliveries</span>
</span><span id="Supplier-597"><a href="#Supplier-597"><span class="linenos"> 597</span></a>                    <span class="c1"># Create Order object from message and add to pending_deliveries</span>
</span><span id="Supplier-598"><a href="#Supplier-598"><span class="linenos"> 598</span></a>                    <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">message_to_order</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier-599"><a href="#Supplier-599"><span class="linenos"> 599</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="Supplier-600"><a href="#Supplier-600"><span class="linenos"> 600</span></a>                            
</span><span id="Supplier-601"><a href="#Supplier-601"><span class="linenos"> 601</span></a>                    <span class="c1"># Essential print - order confirmed</span>
</span><span id="Supplier-602"><a href="#Supplier-602"><span class="linenos"> 602</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> confirmed: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-603"><a href="#Supplier-603"><span class="linenos"> 603</span></a>
</span><span id="Supplier-604"><a href="#Supplier-604"><span class="linenos"> 604</span></a>                    <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">AssignVehicle</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">)</span>
</span><span id="Supplier-605"><a href="#Supplier-605"><span class="linenos"> 605</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">)</span>
</span><span id="Supplier-606"><a href="#Supplier-606"><span class="linenos"> 606</span></a>                    
</span><span id="Supplier-607"><a href="#Supplier-607"><span class="linenos"> 607</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-608"><a href="#Supplier-608"><span class="linenos"> 608</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier-609"><a href="#Supplier-609"><span class="linenos"> 609</span></a>                    
</span><span id="Supplier-610"><a href="#Supplier-610"><span class="linenos"> 610</span></a>                <span class="k">elif</span> <span class="n">performative</span> <span class="o">==</span> <span class="s2">&quot;warehouse-deny&quot;</span><span class="p">:</span>
</span><span id="Supplier-611"><a href="#Supplier-611"><span class="linenos"> 611</span></a>                    <span class="c1"># Warehouse denied (chose another supplier) - just log it</span>
</span><span id="Supplier-612"><a href="#Supplier-612"><span class="linenos"> 612</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-613"><a href="#Supplier-613"><span class="linenos"> 613</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Denial received! Warehouse chose another supplier.&quot;</span><span class="p">)</span>
</span><span id="Supplier-614"><a href="#Supplier-614"><span class="linenos"> 614</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order not confirmed for </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-615"><a href="#Supplier-615"><span class="linenos"> 615</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier-616"><a href="#Supplier-616"><span class="linenos"> 616</span></a>                    
</span><span id="Supplier-617"><a href="#Supplier-617"><span class="linenos"> 617</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-618"><a href="#Supplier-618"><span class="linenos"> 618</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-619"><a href="#Supplier-619"><span class="linenos"> 619</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Timeout: No confirmation or denial received in 10 seconds.&quot;</span><span class="p">)</span>
</span><span id="Supplier-620"><a href="#Supplier-620"><span class="linenos"> 620</span></a>                    <span class="c1"># Since supplier has infinite stock, no need to rollback</span>
</span><span id="Supplier-621"><a href="#Supplier-621"><span class="linenos"> 621</span></a>                    <span class="c1"># Just log that order wasn&#39;t confirmed</span>
</span><span id="Supplier-622"><a href="#Supplier-622"><span class="linenos"> 622</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order not confirmed for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_product</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-623"><a href="#Supplier-623"><span class="linenos"> 623</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier-624"><a href="#Supplier-624"><span class="linenos"> 624</span></a>    
</span><span id="Supplier-625"><a href="#Supplier-625"><span class="linenos"> 625</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveVehicleArrival</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="Supplier-626"><a href="#Supplier-626"><span class="linenos"> 626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-627"><a href="#Supplier-627"><span class="linenos"> 627</span></a><span class="sd">        Cyclic behaviour that processes vehicle pickup notifications.</span>
</span><span id="Supplier-628"><a href="#Supplier-628"><span class="linenos"> 628</span></a><span class="sd">        </span>
</span><span id="Supplier-629"><a href="#Supplier-629"><span class="linenos"> 629</span></a><span class="sd">        Handles vehicle-pickup messages when vehicles arrive to collect confirmed</span>
</span><span id="Supplier-630"><a href="#Supplier-630"><span class="linenos"> 630</span></a><span class="sd">        orders from the supplier, removes order from pending_deliveries, and sends</span>
</span><span id="Supplier-631"><a href="#Supplier-631"><span class="linenos"> 631</span></a><span class="sd">        pickup confirmation back to vehicle.</span>
</span><span id="Supplier-632"><a href="#Supplier-632"><span class="linenos"> 632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-633"><a href="#Supplier-633"><span class="linenos"> 633</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier-634"><a href="#Supplier-634"><span class="linenos"> 634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier-635"><a href="#Supplier-635"><span class="linenos"> 635</span></a>            
</span><span id="Supplier-636"><a href="#Supplier-636"><span class="linenos"> 636</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">r_msg</span>
</span><span id="Supplier-637"><a href="#Supplier-637"><span class="linenos"> 637</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;pickup-confirm&quot;</span><span class="p">)</span>
</span><span id="Supplier-638"><a href="#Supplier-638"><span class="linenos"> 638</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier-639"><a href="#Supplier-639"><span class="linenos"> 639</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier-640"><a href="#Supplier-640"><span class="linenos"> 640</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="Supplier-641"><a href="#Supplier-641"><span class="linenos"> 641</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">))</span>
</span><span id="Supplier-642"><a href="#Supplier-642"><span class="linenos"> 642</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="Supplier-643"><a href="#Supplier-643"><span class="linenos"> 643</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="Supplier-644"><a href="#Supplier-644"><span class="linenos"> 644</span></a>        
</span><span id="Supplier-645"><a href="#Supplier-645"><span class="linenos"> 645</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-646"><a href="#Supplier-646"><span class="linenos"> 646</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-647"><a href="#Supplier-647"><span class="linenos"> 647</span></a>            
</span><span id="Supplier-648"><a href="#Supplier-648"><span class="linenos"> 648</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span>  <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier-649"><a href="#Supplier-649"><span class="linenos"> 649</span></a>            
</span><span id="Supplier-650"><a href="#Supplier-650"><span class="linenos"> 650</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier-651"><a href="#Supplier-651"><span class="linenos"> 651</span></a>                <span class="c1"># Parse message body</span>
</span><span id="Supplier-652"><a href="#Supplier-652"><span class="linenos"> 652</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Supplier-653"><a href="#Supplier-653"><span class="linenos"> 653</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier-654"><a href="#Supplier-654"><span class="linenos"> 654</span></a>                    <span class="n">order</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">dict_to_order</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Supplier-655"><a href="#Supplier-655"><span class="linenos"> 655</span></a>                <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Supplier-656"><a href="#Supplier-656"><span class="linenos"> 656</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; ERROR: Failed to parse vehicle message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-657"><a href="#Supplier-657"><span class="linenos"> 657</span></a>                    <span class="k">return</span>
</span><span id="Supplier-658"><a href="#Supplier-658"><span class="linenos"> 658</span></a>                
</span><span id="Supplier-659"><a href="#Supplier-659"><span class="linenos"> 659</span></a>                <span class="c1"># Vehicle is picking up an order to deliver to warehouse</span>
</span><span id="Supplier-660"><a href="#Supplier-660"><span class="linenos"> 660</span></a>                <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">:</span>
</span><span id="Supplier-661"><a href="#Supplier-661"><span class="linenos"> 661</span></a>                    <span class="k">del</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">]</span>
</span><span id="Supplier-662"><a href="#Supplier-662"><span class="linenos"> 662</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> picked up order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier-663"><a href="#Supplier-663"><span class="linenos"> 663</span></a>                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="Supplier-664"><a href="#Supplier-664"><span class="linenos"> 664</span></a>                    
</span><span id="Supplier-665"><a href="#Supplier-665"><span class="linenos"> 665</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier-666"><a href="#Supplier-666"><span class="linenos"> 666</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</span><span id="Supplier-667"><a href="#Supplier-667"><span class="linenos"> 667</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier-668"><a href="#Supplier-668"><span class="linenos"> 668</span></a>                    
</span><span id="Supplier-669"><a href="#Supplier-669"><span class="linenos"> 669</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-670"><a href="#Supplier-670"><span class="linenos"> 670</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; ERROR: Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> not found in pending orders!&quot;</span><span class="p">)</span>
</span><span id="Supplier-671"><a href="#Supplier-671"><span class="linenos"> 671</span></a>                
</span><span id="Supplier-672"><a href="#Supplier-672"><span class="linenos"> 672</span></a>    
</span><span id="Supplier-673"><a href="#Supplier-673"><span class="linenos"> 673</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">AssignVehicle</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier-674"><a href="#Supplier-674"><span class="linenos"> 674</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-675"><a href="#Supplier-675"><span class="linenos"> 675</span></a><span class="sd">        Behaviour that coordinates vehicle assignment for delivery to warehouse.</span>
</span><span id="Supplier-676"><a href="#Supplier-676"><span class="linenos"> 676</span></a><span class="sd">        </span>
</span><span id="Supplier-677"><a href="#Supplier-677"><span class="linenos"> 677</span></a><span class="sd">        This behaviour implements a vehicle coordination protocol where the supplier</span>
</span><span id="Supplier-678"><a href="#Supplier-678"><span class="linenos"> 678</span></a><span class="sd">        requests delivery quotes from available vehicles to transport materials to</span>
</span><span id="Supplier-679"><a href="#Supplier-679"><span class="linenos"> 679</span></a><span class="sd">        a warehouse. This is similar to a mini FIPA Contract Net but simplified.</span>
</span><span id="Supplier-680"><a href="#Supplier-680"><span class="linenos"> 680</span></a><span class="sd">        </span>
</span><span id="Supplier-681"><a href="#Supplier-681"><span class="linenos"> 681</span></a><span class="sd">        Vehicle Selection Process:</span>
</span><span id="Supplier-682"><a href="#Supplier-682"><span class="linenos"> 682</span></a><span class="sd">        </span>
</span><span id="Supplier-683"><a href="#Supplier-683"><span class="linenos"> 683</span></a><span class="sd">            **Phase 1: Vehicle Discovery**</span>
</span><span id="Supplier-684"><a href="#Supplier-684"><span class="linenos"> 684</span></a><span class="sd">                - Populate vehicles list from presence contacts</span>
</span><span id="Supplier-685"><a href="#Supplier-685"><span class="linenos"> 685</span></a><span class="sd">                - Only vehicles subscribed to supplier are eligible</span>
</span><span id="Supplier-686"><a href="#Supplier-686"><span class="linenos"> 686</span></a><span class="sd">            </span>
</span><span id="Supplier-687"><a href="#Supplier-687"><span class="linenos"> 687</span></a><span class="sd">            **Phase 2: Presence Check**</span>
</span><span id="Supplier-688"><a href="#Supplier-688"><span class="linenos"> 688</span></a><span class="sd">                - Send presence-info request to each vehicle</span>
</span><span id="Supplier-689"><a href="#Supplier-689"><span class="linenos"> 689</span></a><span class="sd">                - Receive presence-response with availability status</span>
</span><span id="Supplier-690"><a href="#Supplier-690"><span class="linenos"> 690</span></a><span class="sd">                - Categorize: CHAT (available) vs AWAY (busy)</span>
</span><span id="Supplier-691"><a href="#Supplier-691"><span class="linenos"> 691</span></a><span class="sd">            </span>
</span><span id="Supplier-692"><a href="#Supplier-692"><span class="linenos"> 692</span></a><span class="sd">            **Phase 3: Proposal Requests**</span>
</span><span id="Supplier-693"><a href="#Supplier-693"><span class="linenos"> 693</span></a><span class="sd">                - Send order-proposal to available vehicles first</span>
</span><span id="Supplier-694"><a href="#Supplier-694"><span class="linenos"> 694</span></a><span class="sd">                - If no available vehicles, send to AWAY vehicles</span>
</span><span id="Supplier-695"><a href="#Supplier-695"><span class="linenos"> 695</span></a><span class="sd">                - Broadcast pickup/delivery details</span>
</span><span id="Supplier-696"><a href="#Supplier-696"><span class="linenos"> 696</span></a><span class="sd">            </span>
</span><span id="Supplier-697"><a href="#Supplier-697"><span class="linenos"> 697</span></a><span class="sd">            **Phase 4: Collect Proposals**</span>
</span><span id="Supplier-698"><a href="#Supplier-698"><span class="linenos"> 698</span></a><span class="sd">                - Launch ReceiveVehicleProposals to gather responses</span>
</span><span id="Supplier-699"><a href="#Supplier-699"><span class="linenos"> 699</span></a><span class="sd">                - Wait for vehicle-proposal messages with can_fit and delivery_time</span>
</span><span id="Supplier-700"><a href="#Supplier-700"><span class="linenos"> 700</span></a><span class="sd">            </span>
</span><span id="Supplier-701"><a href="#Supplier-701"><span class="linenos"> 701</span></a><span class="sd">            **Phase 5: Vehicle Selection**</span>
</span><span id="Supplier-702"><a href="#Supplier-702"><span class="linenos"> 702</span></a><span class="sd">                - Launch ChooseBestVehicle to evaluate proposals</span>
</span><span id="Supplier-703"><a href="#Supplier-703"><span class="linenos"> 703</span></a><span class="sd">                - Selection criteria: can_fit capacity, then delivery_time</span>
</span><span id="Supplier-704"><a href="#Supplier-704"><span class="linenos"> 704</span></a><span class="sd">                - Send order-confirmation to winner</span>
</span><span id="Supplier-705"><a href="#Supplier-705"><span class="linenos"> 705</span></a><span class="sd">        </span>
</span><span id="Supplier-706"><a href="#Supplier-706"><span class="linenos"> 706</span></a><span class="sd">        Attributes:</span>
</span><span id="Supplier-707"><a href="#Supplier-707"><span class="linenos"> 707</span></a><span class="sd">            request_id (int): Unique identifier for the order requiring delivery.</span>
</span><span id="Supplier-708"><a href="#Supplier-708"><span class="linenos"> 708</span></a><span class="sd">        </span>
</span><span id="Supplier-709"><a href="#Supplier-709"><span class="linenos"> 709</span></a><span class="sd">        Order Information Required:</span>
</span><span id="Supplier-710"><a href="#Supplier-710"><span class="linenos"> 710</span></a><span class="sd">            - pickup_node: Supplier&#39;s current graph node</span>
</span><span id="Supplier-711"><a href="#Supplier-711"><span class="linenos"> 711</span></a><span class="sd">            - delivery_node: Warehouse&#39;s graph node location</span>
</span><span id="Supplier-712"><a href="#Supplier-712"><span class="linenos"> 712</span></a><span class="sd">            - product: Product type to deliver</span>
</span><span id="Supplier-713"><a href="#Supplier-713"><span class="linenos"> 713</span></a><span class="sd">            - quantity: Amount to deliver</span>
</span><span id="Supplier-714"><a href="#Supplier-714"><span class="linenos"> 714</span></a><span class="sd">            - sender: Warehouse JID expecting delivery</span>
</span><span id="Supplier-715"><a href="#Supplier-715"><span class="linenos"> 715</span></a><span class="sd">        </span>
</span><span id="Supplier-716"><a href="#Supplier-716"><span class="linenos"> 716</span></a><span class="sd">        Message Format (order-proposal):</span>
</span><span id="Supplier-717"><a href="#Supplier-717"><span class="linenos"> 717</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier-718"><a href="#Supplier-718"><span class="linenos"> 718</span></a><span class="sd">                - performative: &quot;order-proposal&quot;</span>
</span><span id="Supplier-719"><a href="#Supplier-719"><span class="linenos"> 719</span></a><span class="sd">            Body (JSON):</span>
</span><span id="Supplier-720"><a href="#Supplier-720"><span class="linenos"> 720</span></a><span class="sd">                - orderid: Order identifier</span>
</span><span id="Supplier-721"><a href="#Supplier-721"><span class="linenos"> 721</span></a><span class="sd">                - product: Product type</span>
</span><span id="Supplier-722"><a href="#Supplier-722"><span class="linenos"> 722</span></a><span class="sd">                - quantity: Amount to deliver</span>
</span><span id="Supplier-723"><a href="#Supplier-723"><span class="linenos"> 723</span></a><span class="sd">                - sender: Warehouse JID (delivery destination)</span>
</span><span id="Supplier-724"><a href="#Supplier-724"><span class="linenos"> 724</span></a><span class="sd">                - receiver: Supplier JID (pickup location)</span>
</span><span id="Supplier-725"><a href="#Supplier-725"><span class="linenos"> 725</span></a><span class="sd">                - sender_location: Warehouse node</span>
</span><span id="Supplier-726"><a href="#Supplier-726"><span class="linenos"> 726</span></a><span class="sd">                - receiver_location: Supplier node</span>
</span><span id="Supplier-727"><a href="#Supplier-727"><span class="linenos"> 727</span></a><span class="sd">        </span>
</span><span id="Supplier-728"><a href="#Supplier-728"><span class="linenos"> 728</span></a><span class="sd">        Presence Status Handling:</span>
</span><span id="Supplier-729"><a href="#Supplier-729"><span class="linenos"> 729</span></a><span class="sd">            - **PresenceShow.CHAT**: Vehicle available, prioritize for proposals</span>
</span><span id="Supplier-730"><a href="#Supplier-730"><span class="linenos"> 730</span></a><span class="sd">            - **PresenceShow.AWAY**: Vehicle busy, use only if no available vehicles</span>
</span><span id="Supplier-731"><a href="#Supplier-731"><span class="linenos"> 731</span></a><span class="sd">            - Strategy: Try available first, fallback to busy if necessary</span>
</span><span id="Supplier-732"><a href="#Supplier-732"><span class="linenos"> 732</span></a><span class="sd">        </span>
</span><span id="Supplier-733"><a href="#Supplier-733"><span class="linenos"> 733</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier-734"><a href="#Supplier-734"><span class="linenos"> 734</span></a><span class="sd">        </span>
</span><span id="Supplier-735"><a href="#Supplier-735"><span class="linenos"> 735</span></a><span class="sd">            **Scenario: Normal Vehicle Assignment**</span>
</span><span id="Supplier-736"><a href="#Supplier-736"><span class="linenos"> 736</span></a><span class="sd">            ```</span>
</span><span id="Supplier-737"><a href="#Supplier-737"><span class="linenos"> 737</span></a><span class="sd">            Order ID: 301000000</span>
</span><span id="Supplier-738"><a href="#Supplier-738"><span class="linenos"> 738</span></a><span class="sd">            Pickup: Node 20 (Supplier location)</span>
</span><span id="Supplier-739"><a href="#Supplier-739"><span class="linenos"> 739</span></a><span class="sd">            Delivery: Node 10 (Warehouse location)</span>
</span><span id="Supplier-740"><a href="#Supplier-740"><span class="linenos"> 740</span></a><span class="sd">            Product: electronics</span>
</span><span id="Supplier-741"><a href="#Supplier-741"><span class="linenos"> 741</span></a><span class="sd">            Quantity: 100</span>
</span><span id="Supplier-742"><a href="#Supplier-742"><span class="linenos"> 742</span></a><span class="sd">            </span>
</span><span id="Supplier-743"><a href="#Supplier-743"><span class="linenos"> 743</span></a><span class="sd">            Step 1: Discover vehicles</span>
</span><span id="Supplier-744"><a href="#Supplier-744"><span class="linenos"> 744</span></a><span class="sd">                Found: [vehicle-1, vehicle-2, vehicle-3]</span>
</span><span id="Supplier-745"><a href="#Supplier-745"><span class="linenos"> 745</span></a><span class="sd">            </span>
</span><span id="Supplier-746"><a href="#Supplier-746"><span class="linenos"> 746</span></a><span class="sd">            Step 2: Check presence</span>
</span><span id="Supplier-747"><a href="#Supplier-747"><span class="linenos"> 747</span></a><span class="sd">                vehicle-1: CHAT (available)</span>
</span><span id="Supplier-748"><a href="#Supplier-748"><span class="linenos"> 748</span></a><span class="sd">                vehicle-2: AWAY (busy)</span>
</span><span id="Supplier-749"><a href="#Supplier-749"><span class="linenos"> 749</span></a><span class="sd">                vehicle-3: CHAT (available)</span>
</span><span id="Supplier-750"><a href="#Supplier-750"><span class="linenos"> 750</span></a><span class="sd">            </span>
</span><span id="Supplier-751"><a href="#Supplier-751"><span class="linenos"> 751</span></a><span class="sd">            Step 3: Send proposals</span>
</span><span id="Supplier-752"><a href="#Supplier-752"><span class="linenos"> 752</span></a><span class="sd">                Sent to: vehicle-1, vehicle-3 (2 available)</span>
</span><span id="Supplier-753"><a href="#Supplier-753"><span class="linenos"> 753</span></a><span class="sd">            </span>
</span><span id="Supplier-754"><a href="#Supplier-754"><span class="linenos"> 754</span></a><span class="sd">            Step 4: Collect proposals</span>
</span><span id="Supplier-755"><a href="#Supplier-755"><span class="linenos"> 755</span></a><span class="sd">                vehicle-1: can_fit=True, time=120s</span>
</span><span id="Supplier-756"><a href="#Supplier-756"><span class="linenos"> 756</span></a><span class="sd">                vehicle-3: can_fit=True, time=85s</span>
</span><span id="Supplier-757"><a href="#Supplier-757"><span class="linenos"> 757</span></a><span class="sd">            </span>
</span><span id="Supplier-758"><a href="#Supplier-758"><span class="linenos"> 758</span></a><span class="sd">            Step 5: Choose best</span>
</span><span id="Supplier-759"><a href="#Supplier-759"><span class="linenos"> 759</span></a><span class="sd">                Winner: vehicle-3 (lower delivery time)</span>
</span><span id="Supplier-760"><a href="#Supplier-760"><span class="linenos"> 760</span></a><span class="sd">                Send order-confirmation to vehicle-3</span>
</span><span id="Supplier-761"><a href="#Supplier-761"><span class="linenos"> 761</span></a><span class="sd">            ```</span>
</span><span id="Supplier-762"><a href="#Supplier-762"><span class="linenos"> 762</span></a><span class="sd">            </span>
</span><span id="Supplier-763"><a href="#Supplier-763"><span class="linenos"> 763</span></a><span class="sd">            **Scenario: No Available Vehicles**</span>
</span><span id="Supplier-764"><a href="#Supplier-764"><span class="linenos"> 764</span></a><span class="sd">            ```</span>
</span><span id="Supplier-765"><a href="#Supplier-765"><span class="linenos"> 765</span></a><span class="sd">            All vehicles: AWAY (busy)</span>
</span><span id="Supplier-766"><a href="#Supplier-766"><span class="linenos"> 766</span></a><span class="sd">            Action: Send proposals to all AWAY vehicles anyway</span>
</span><span id="Supplier-767"><a href="#Supplier-767"><span class="linenos"> 767</span></a><span class="sd">            Result: Best vehicle will accept when capacity available</span>
</span><span id="Supplier-768"><a href="#Supplier-768"><span class="linenos"> 768</span></a><span class="sd">            ```</span>
</span><span id="Supplier-769"><a href="#Supplier-769"><span class="linenos"> 769</span></a><span class="sd">        </span>
</span><span id="Supplier-770"><a href="#Supplier-770"><span class="linenos"> 770</span></a><span class="sd">        Error Handling:</span>
</span><span id="Supplier-771"><a href="#Supplier-771"><span class="linenos"> 771</span></a><span class="sd">            - If no vehicles found in contacts:</span>
</span><span id="Supplier-772"><a href="#Supplier-772"><span class="linenos"> 772</span></a><span class="sd">                - Print error message</span>
</span><span id="Supplier-773"><a href="#Supplier-773"><span class="linenos"> 773</span></a><span class="sd">                - Return without sending proposals</span>
</span><span id="Supplier-774"><a href="#Supplier-774"><span class="linenos"> 774</span></a><span class="sd">                - Order stays in pending_deliveries for retry</span>
</span><span id="Supplier-775"><a href="#Supplier-775"><span class="linenos"> 775</span></a><span class="sd">        </span>
</span><span id="Supplier-776"><a href="#Supplier-776"><span class="linenos"> 776</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-777"><a href="#Supplier-777"><span class="linenos"> 777</span></a><span class="sd">            This behaviour launches two child behaviours (ReceiveVehicleProposals</span>
</span><span id="Supplier-778"><a href="#Supplier-778"><span class="linenos"> 778</span></a><span class="sd">            and ChooseBestVehicle) that implement the proposal collection and</span>
</span><span id="Supplier-779"><a href="#Supplier-779"><span class="linenos"> 779</span></a><span class="sd">            selection logic.</span>
</span><span id="Supplier-780"><a href="#Supplier-780"><span class="linenos"> 780</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-781"><a href="#Supplier-781"><span class="linenos"> 781</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">):</span>
</span><span id="Supplier-782"><a href="#Supplier-782"><span class="linenos"> 782</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-783"><a href="#Supplier-783"><span class="linenos"> 783</span></a><span class="sd">            Initialize the AssignVehicle behaviour.</span>
</span><span id="Supplier-784"><a href="#Supplier-784"><span class="linenos"> 784</span></a><span class="sd">            </span>
</span><span id="Supplier-785"><a href="#Supplier-785"><span class="linenos"> 785</span></a><span class="sd">            Args:</span>
</span><span id="Supplier-786"><a href="#Supplier-786"><span class="linenos"> 786</span></a><span class="sd">                request_id (int): Unique identifier for the order requiring vehicle assignment.</span>
</span><span id="Supplier-787"><a href="#Supplier-787"><span class="linenos"> 787</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier-788"><a href="#Supplier-788"><span class="linenos"> 788</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier-789"><a href="#Supplier-789"><span class="linenos"> 789</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="Supplier-790"><a href="#Supplier-790"><span class="linenos"> 790</span></a>        
</span><span id="Supplier-791"><a href="#Supplier-791"><span class="linenos"> 791</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">populate_vehicles_from_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-792"><a href="#Supplier-792"><span class="linenos"> 792</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Populate vehicles list from presence contacts if empty&quot;&quot;&quot;</span>
</span><span id="Supplier-793"><a href="#Supplier-793"><span class="linenos"> 793</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-794"><a href="#Supplier-794"><span class="linenos"> 794</span></a>            
</span><span id="Supplier-795"><a href="#Supplier-795"><span class="linenos"> 795</span></a>            <span class="c1"># Get all vehicles from presence contacts</span>
</span><span id="Supplier-796"><a href="#Supplier-796"><span class="linenos"> 796</span></a>            <span class="n">vehicles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;vehicle&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)]</span>
</span><span id="Supplier-797"><a href="#Supplier-797"><span class="linenos"> 797</span></a>            
</span><span id="Supplier-798"><a href="#Supplier-798"><span class="linenos"> 798</span></a>            <span class="k">if</span> <span class="n">vehicles</span><span class="p">:</span>
</span><span id="Supplier-799"><a href="#Supplier-799"><span class="linenos"> 799</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span> <span class="o">=</span> <span class="n">vehicles</span>
</span><span id="Supplier-800"><a href="#Supplier-800"><span class="linenos"> 800</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-801"><a href="#Supplier-801"><span class="linenos"> 801</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Discovered </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> vehicle(s) from presence: </span><span class="si">{</span><span class="n">vehicles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-802"><a href="#Supplier-802"><span class="linenos"> 802</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-803"><a href="#Supplier-803"><span class="linenos"> 803</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-804"><a href="#Supplier-804"><span class="linenos"> 804</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No vehicles found in presence contacts yet!&quot;</span><span class="p">)</span>
</span><span id="Supplier-805"><a href="#Supplier-805"><span class="linenos"> 805</span></a>            
</span><span id="Supplier-806"><a href="#Supplier-806"><span class="linenos"> 806</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">vehicles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Supplier-807"><a href="#Supplier-807"><span class="linenos"> 807</span></a>        
</span><span id="Supplier-808"><a href="#Supplier-808"><span class="linenos"> 808</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_presence_info_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier-809"><a href="#Supplier-809"><span class="linenos"> 809</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier-810"><a href="#Supplier-810"><span class="linenos"> 810</span></a>            
</span><span id="Supplier-811"><a href="#Supplier-811"><span class="linenos"> 811</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</span><span id="Supplier-812"><a href="#Supplier-812"><span class="linenos"> 812</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;presence-info&quot;</span><span class="p">)</span>
</span><span id="Supplier-813"><a href="#Supplier-813"><span class="linenos"> 813</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Supplier-814"><a href="#Supplier-814"><span class="linenos"> 814</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="Supplier-815"><a href="#Supplier-815"><span class="linenos"> 815</span></a>            
</span><span id="Supplier-816"><a href="#Supplier-816"><span class="linenos"> 816</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_call_for_proposal_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier-817"><a href="#Supplier-817"><span class="linenos"> 817</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier-818"><a href="#Supplier-818"><span class="linenos"> 818</span></a>            
</span><span id="Supplier-819"><a href="#Supplier-819"><span class="linenos"> 819</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</span><span id="Supplier-820"><a href="#Supplier-820"><span class="linenos"> 820</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-proposal&quot;</span><span class="p">)</span>
</span><span id="Supplier-821"><a href="#Supplier-821"><span class="linenos"> 821</span></a>            
</span><span id="Supplier-822"><a href="#Supplier-822"><span class="linenos"> 822</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">]</span>
</span><span id="Supplier-823"><a href="#Supplier-823"><span class="linenos"> 823</span></a>
</span><span id="Supplier-824"><a href="#Supplier-824"><span class="linenos"> 824</span></a>            <span class="n">new_body</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier-825"><a href="#Supplier-825"><span class="linenos"> 825</span></a>                <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">,</span>
</span><span id="Supplier-826"><a href="#Supplier-826"><span class="linenos"> 826</span></a>                <span class="s2">&quot;product&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="p">,</span>
</span><span id="Supplier-827"><a href="#Supplier-827"><span class="linenos"> 827</span></a>                <span class="s2">&quot;quantity&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
</span><span id="Supplier-828"><a href="#Supplier-828"><span class="linenos"> 828</span></a>                <span class="s2">&quot;sender&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">receiver</span><span class="p">,</span>
</span><span id="Supplier-829"><a href="#Supplier-829"><span class="linenos"> 829</span></a>                <span class="s2">&quot;receiver&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span>
</span><span id="Supplier-830"><a href="#Supplier-830"><span class="linenos"> 830</span></a>                <span class="s2">&quot;sender_location&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span><span class="p">,</span>
</span><span id="Supplier-831"><a href="#Supplier-831"><span class="linenos"> 831</span></a>                <span class="s2">&quot;receiver_location&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span>
</span><span id="Supplier-832"><a href="#Supplier-832"><span class="linenos"> 832</span></a>            <span class="p">}</span>
</span><span id="Supplier-833"><a href="#Supplier-833"><span class="linenos"> 833</span></a>            
</span><span id="Supplier-834"><a href="#Supplier-834"><span class="linenos"> 834</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_body</span><span class="p">)</span>
</span><span id="Supplier-835"><a href="#Supplier-835"><span class="linenos"> 835</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="Supplier-836"><a href="#Supplier-836"><span class="linenos"> 836</span></a>        
</span><span id="Supplier-837"><a href="#Supplier-837"><span class="linenos"> 837</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-838"><a href="#Supplier-838"><span class="linenos"> 838</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-839"><a href="#Supplier-839"><span class="linenos"> 839</span></a>            
</span><span id="Supplier-840"><a href="#Supplier-840"><span class="linenos"> 840</span></a>            <span class="c1"># Populate vehicles from contacts</span>
</span><span id="Supplier-841"><a href="#Supplier-841"><span class="linenos"> 841</span></a>            <span class="n">has_vehicles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_vehicles_from_contacts</span><span class="p">()</span>
</span><span id="Supplier-842"><a href="#Supplier-842"><span class="linenos"> 842</span></a>            
</span><span id="Supplier-843"><a href="#Supplier-843"><span class="linenos"> 843</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_vehicles</span><span class="p">:</span>
</span><span id="Supplier-844"><a href="#Supplier-844"><span class="linenos"> 844</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  ERROR: No vehicles found in contacts!&quot;</span><span class="p">)</span>
</span><span id="Supplier-845"><a href="#Supplier-845"><span class="linenos"> 845</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Make sure vehicles are started and have subscribed to this supplier.&quot;</span><span class="p">)</span>
</span><span id="Supplier-846"><a href="#Supplier-846"><span class="linenos"> 846</span></a>                <span class="k">return</span>
</span><span id="Supplier-847"><a href="#Supplier-847"><span class="linenos"> 847</span></a>            
</span><span id="Supplier-848"><a href="#Supplier-848"><span class="linenos"> 848</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-849"><a href="#Supplier-849"><span class="linenos"> 849</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Requesting vehicle proposals...&quot;</span><span class="p">)</span>
</span><span id="Supplier-850"><a href="#Supplier-850"><span class="linenos"> 850</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicles to contact: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-851"><a href="#Supplier-851"><span class="linenos"> 851</span></a>            
</span><span id="Supplier-852"><a href="#Supplier-852"><span class="linenos"> 852</span></a>            <span class="c1"># Enviar mensagens de proposal a todos os veculos</span>
</span><span id="Supplier-853"><a href="#Supplier-853"><span class="linenos"> 853</span></a>            <span class="c1"># No verificamos presena - deixamos cada veculo decidir se pode aceitar</span>
</span><span id="Supplier-854"><a href="#Supplier-854"><span class="linenos"> 854</span></a>            <span class="n">n_available_vehicles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Supplier-855"><a href="#Supplier-855"><span class="linenos"> 855</span></a>            <span class="n">away_vehicles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Supplier-856"><a href="#Supplier-856"><span class="linenos"> 856</span></a>            <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span><span class="p">:</span>
</span><span id="Supplier-857"><a href="#Supplier-857"><span class="linenos"> 857</span></a>                
</span><span id="Supplier-858"><a href="#Supplier-858"><span class="linenos"> 858</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_presence_info_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier-859"><a href="#Supplier-859"><span class="linenos"> 859</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier-860"><a href="#Supplier-860"><span class="linenos"> 860</span></a>                
</span><span id="Supplier-861"><a href="#Supplier-861"><span class="linenos"> 861</span></a>                <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">ReceivePresenceInfo</span><span class="p">()</span>
</span><span id="Supplier-862"><a href="#Supplier-862"><span class="linenos"> 862</span></a>                <span class="n">temp</span> <span class="p">:</span> <span class="n">Template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier-863"><a href="#Supplier-863"><span class="linenos"> 863</span></a>                <span class="n">temp</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;presence-response&quot;</span><span class="p">)</span>
</span><span id="Supplier-864"><a href="#Supplier-864"><span class="linenos"> 864</span></a>                <span class="n">temp</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;vehicle_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">))</span>
</span><span id="Supplier-865"><a href="#Supplier-865"><span class="linenos"> 865</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
</span><span id="Supplier-866"><a href="#Supplier-866"><span class="linenos"> 866</span></a>                
</span><span id="Supplier-867"><a href="#Supplier-867"><span class="linenos"> 867</span></a>                <span class="k">await</span> <span class="n">behav</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="Supplier-868"><a href="#Supplier-868"><span class="linenos"> 868</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-869"><a href="#Supplier-869"><span class="linenos"> 869</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Presence info from </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-870"><a href="#Supplier-870"><span class="linenos"> 870</span></a>                
</span><span id="Supplier-871"><a href="#Supplier-871"><span class="linenos"> 871</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">vehicle_jid</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PresenceShow.CHAT&quot;</span><span class="p">:</span>
</span><span id="Supplier-872"><a href="#Supplier-872"><span class="linenos"> 872</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_call_for_proposal_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier-873"><a href="#Supplier-873"><span class="linenos"> 873</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier-874"><a href="#Supplier-874"><span class="linenos"> 874</span></a>                    <span class="n">n_available_vehicles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Supplier-875"><a href="#Supplier-875"><span class="linenos"> 875</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent order proposal to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-876"><a href="#Supplier-876"><span class="linenos"> 876</span></a>                
</span><span id="Supplier-877"><a href="#Supplier-877"><span class="linenos"> 877</span></a>                <span class="k">elif</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">vehicle_jid</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PresenceShow.AWAY&quot;</span> <span class="ow">and</span> <span class="n">n_available_vehicles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Supplier-878"><a href="#Supplier-878"><span class="linenos"> 878</span></a>                    <span class="n">away_vehicles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier-879"><a href="#Supplier-879"><span class="linenos"> 879</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-880"><a href="#Supplier-880"><span class="linenos"> 880</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Vehicle </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2"> is away.&quot;</span><span class="p">)</span>
</span><span id="Supplier-881"><a href="#Supplier-881"><span class="linenos"> 881</span></a>                    
</span><span id="Supplier-882"><a href="#Supplier-882"><span class="linenos"> 882</span></a>            <span class="k">if</span> <span class="n">n_available_vehicles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Supplier-883"><a href="#Supplier-883"><span class="linenos"> 883</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-884"><a href="#Supplier-884"><span class="linenos"> 884</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No AVAILABLE vehicles found. All vehicles are AWAY.&quot;</span><span class="p">)</span>
</span><span id="Supplier-885"><a href="#Supplier-885"><span class="linenos"> 885</span></a>                <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">away_vehicles</span><span class="p">:</span>
</span><span id="Supplier-886"><a href="#Supplier-886"><span class="linenos"> 886</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_call_for_proposal_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier-887"><a href="#Supplier-887"><span class="linenos"> 887</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier-888"><a href="#Supplier-888"><span class="linenos"> 888</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent order proposal to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-889"><a href="#Supplier-889"><span class="linenos"> 889</span></a>            
</span><span id="Supplier-890"><a href="#Supplier-890"><span class="linenos"> 890</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-891"><a href="#Supplier-891"><span class="linenos"> 891</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent proposals to </span><span class="si">{</span><span class="n">n_available_vehicles</span><span class="si">}</span><span class="s2"> vehicle(s)&quot;</span><span class="p">)</span>
</span><span id="Supplier-892"><a href="#Supplier-892"><span class="linenos"> 892</span></a>                    
</span><span id="Supplier-893"><a href="#Supplier-893"><span class="linenos"> 893</span></a>            <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">ChooseBestVehicle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span>
</span><span id="Supplier-894"><a href="#Supplier-894"><span class="linenos"> 894</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
</span><span id="Supplier-895"><a href="#Supplier-895"><span class="linenos"> 895</span></a>            
</span><span id="Supplier-896"><a href="#Supplier-896"><span class="linenos"> 896</span></a>            <span class="c1"># Waits for all vehicle proposals to be received</span>
</span><span id="Supplier-897"><a href="#Supplier-897"><span class="linenos"> 897</span></a>            <span class="k">await</span> <span class="n">behav</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="Supplier-898"><a href="#Supplier-898"><span class="linenos"> 898</span></a>    
</span><span id="Supplier-899"><a href="#Supplier-899"><span class="linenos"> 899</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceivePresenceInfo</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier-900"><a href="#Supplier-900"><span class="linenos"> 900</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-901"><a href="#Supplier-901"><span class="linenos"> 901</span></a><span class="sd">        Behaviour to receive presence information from vehicle agents.</span>
</span><span id="Supplier-902"><a href="#Supplier-902"><span class="linenos"> 902</span></a><span class="sd">        </span>
</span><span id="Supplier-903"><a href="#Supplier-903"><span class="linenos"> 903</span></a><span class="sd">        This behaviour requests and collects availability status from vehicle agents,</span>
</span><span id="Supplier-904"><a href="#Supplier-904"><span class="linenos"> 904</span></a><span class="sd">        which is used to determine which vehicles are available for delivery tasks</span>
</span><span id="Supplier-905"><a href="#Supplier-905"><span class="linenos"> 905</span></a><span class="sd">        from the supplier to warehouses.</span>
</span><span id="Supplier-906"><a href="#Supplier-906"><span class="linenos"> 906</span></a><span class="sd">        </span>
</span><span id="Supplier-907"><a href="#Supplier-907"><span class="linenos"> 907</span></a><span class="sd">        The presence information indicates whether a vehicle is busy, available, or</span>
</span><span id="Supplier-908"><a href="#Supplier-908"><span class="linenos"> 908</span></a><span class="sd">        in another state. This helps the supplier make intelligent vehicle assignment</span>
</span><span id="Supplier-909"><a href="#Supplier-909"><span class="linenos"> 909</span></a><span class="sd">        decisions based on current vehicle availability.</span>
</span><span id="Supplier-910"><a href="#Supplier-910"><span class="linenos"> 910</span></a><span class="sd">        </span>
</span><span id="Supplier-911"><a href="#Supplier-911"><span class="linenos"> 911</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier-912"><a href="#Supplier-912"><span class="linenos"> 912</span></a><span class="sd">            1. **Receive Message**: Wait up to 10 seconds for presence response</span>
</span><span id="Supplier-913"><a href="#Supplier-913"><span class="linenos"> 913</span></a><span class="sd">            2. **Parse JSON**: Extract presence_show status from message body</span>
</span><span id="Supplier-914"><a href="#Supplier-914"><span class="linenos"> 914</span></a><span class="sd">            3. **Store Information**: Save presence info indexed by vehicle_id</span>
</span><span id="Supplier-915"><a href="#Supplier-915"><span class="linenos"> 915</span></a><span class="sd">            4. **Handle Timeout**: Print warning if no response received</span>
</span><span id="Supplier-916"><a href="#Supplier-916"><span class="linenos"> 916</span></a><span class="sd">        </span>
</span><span id="Supplier-917"><a href="#Supplier-917"><span class="linenos"> 917</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier-918"><a href="#Supplier-918"><span class="linenos"> 918</span></a><span class="sd">            - Updates agent.presence_infos dictionary with vehicle status</span>
</span><span id="Supplier-919"><a href="#Supplier-919"><span class="linenos"> 919</span></a><span class="sd">            - Prints presence information if verbose mode enabled</span>
</span><span id="Supplier-920"><a href="#Supplier-920"><span class="linenos"> 920</span></a><span class="sd">        </span>
</span><span id="Supplier-921"><a href="#Supplier-921"><span class="linenos"> 921</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier-922"><a href="#Supplier-922"><span class="linenos"> 922</span></a><span class="sd">            None. Completes after receiving one presence message or timing out.</span>
</span><span id="Supplier-923"><a href="#Supplier-923"><span class="linenos"> 923</span></a><span class="sd">        </span>
</span><span id="Supplier-924"><a href="#Supplier-924"><span class="linenos"> 924</span></a><span class="sd">        Example:</span>
</span><span id="Supplier-925"><a href="#Supplier-925"><span class="linenos"> 925</span></a><span class="sd">            ```</span>
</span><span id="Supplier-926"><a href="#Supplier-926"><span class="linenos"> 926</span></a><span class="sd">            Message Received:</span>
</span><span id="Supplier-927"><a href="#Supplier-927"><span class="linenos"> 927</span></a><span class="sd">                Metadata: vehicle_id = &quot;vehicle2@localhost&quot;</span>
</span><span id="Supplier-928"><a href="#Supplier-928"><span class="linenos"> 928</span></a><span class="sd">                Body: {&quot;presence_show&quot;: &quot;available&quot;}</span>
</span><span id="Supplier-929"><a href="#Supplier-929"><span class="linenos"> 929</span></a><span class="sd">            Processing:</span>
</span><span id="Supplier-930"><a href="#Supplier-930"><span class="linenos"> 930</span></a><span class="sd">                - presence_infos[&quot;vehicle2@localhost&quot;] = &quot;available&quot;</span>
</span><span id="Supplier-931"><a href="#Supplier-931"><span class="linenos"> 931</span></a><span class="sd">            Output:</span>
</span><span id="Supplier-932"><a href="#Supplier-932"><span class="linenos"> 932</span></a><span class="sd">                - Print: &quot;Received presence info response from vehicle2: available&quot;</span>
</span><span id="Supplier-933"><a href="#Supplier-933"><span class="linenos"> 933</span></a><span class="sd">            ```</span>
</span><span id="Supplier-934"><a href="#Supplier-934"><span class="linenos"> 934</span></a><span class="sd">        </span>
</span><span id="Supplier-935"><a href="#Supplier-935"><span class="linenos"> 935</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-936"><a href="#Supplier-936"><span class="linenos"> 936</span></a><span class="sd">            The 10-second timeout prevents indefinite blocking if a vehicle agent</span>
</span><span id="Supplier-937"><a href="#Supplier-937"><span class="linenos"> 937</span></a><span class="sd">            is offline or unresponsive.</span>
</span><span id="Supplier-938"><a href="#Supplier-938"><span class="linenos"> 938</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-939"><a href="#Supplier-939"><span class="linenos"> 939</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-940"><a href="#Supplier-940"><span class="linenos"> 940</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-941"><a href="#Supplier-941"><span class="linenos"> 941</span></a>            
</span><span id="Supplier-942"><a href="#Supplier-942"><span class="linenos"> 942</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Supplier-943"><a href="#Supplier-943"><span class="linenos"> 943</span></a>            
</span><span id="Supplier-944"><a href="#Supplier-944"><span class="linenos"> 944</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier-945"><a href="#Supplier-945"><span class="linenos"> 945</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier-946"><a href="#Supplier-946"><span class="linenos"> 946</span></a>                <span class="n">presence_info</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;presence_show&quot;</span><span class="p">]</span>
</span><span id="Supplier-947"><a href="#Supplier-947"><span class="linenos"> 947</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-948"><a href="#Supplier-948"><span class="linenos"> 948</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Received presence info response from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="Supplier-949"><a href="#Supplier-949"><span class="linenos"> 949</span></a>                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">presence_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-950"><a href="#Supplier-950"><span class="linenos"> 950</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;vehicle_id&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">presence_info</span>
</span><span id="Supplier-951"><a href="#Supplier-951"><span class="linenos"> 951</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-952"><a href="#Supplier-952"><span class="linenos"> 952</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-953"><a href="#Supplier-953"><span class="linenos"> 953</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; No presence info response received from vehicle.&quot;</span><span class="p">)</span>
</span><span id="Supplier-954"><a href="#Supplier-954"><span class="linenos"> 954</span></a>    
</span><span id="Supplier-955"><a href="#Supplier-955"><span class="linenos"> 955</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveVehicleProposals</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="Supplier-956"><a href="#Supplier-956"><span class="linenos"> 956</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-957"><a href="#Supplier-957"><span class="linenos"> 957</span></a><span class="sd">        Cyclic behaviour that collects vehicle delivery proposals for supplier orders.</span>
</span><span id="Supplier-958"><a href="#Supplier-958"><span class="linenos"> 958</span></a><span class="sd">        </span>
</span><span id="Supplier-959"><a href="#Supplier-959"><span class="linenos"> 959</span></a><span class="sd">        This behaviour implements the proposal collection phase of vehicle selection</span>
</span><span id="Supplier-960"><a href="#Supplier-960"><span class="linenos"> 960</span></a><span class="sd">        for deliveries from supplier to warehouses. After the supplier sends delivery</span>
</span><span id="Supplier-961"><a href="#Supplier-961"><span class="linenos"> 961</span></a><span class="sd">        requests to vehicles, this behaviour continuously receives and stores vehicle</span>
</span><span id="Supplier-962"><a href="#Supplier-962"><span class="linenos"> 962</span></a><span class="sd">        proposals containing delivery capacity and estimated delivery time information.</span>
</span><span id="Supplier-963"><a href="#Supplier-963"><span class="linenos"> 963</span></a><span class="sd">        </span>
</span><span id="Supplier-964"><a href="#Supplier-964"><span class="linenos"> 964</span></a><span class="sd">        The behaviour runs in an infinite loop within each execution, collecting all</span>
</span><span id="Supplier-965"><a href="#Supplier-965"><span class="linenos"> 965</span></a><span class="sd">        available proposals until a timeout occurs (no more proposals arriving). Each</span>
</span><span id="Supplier-966"><a href="#Supplier-966"><span class="linenos"> 966</span></a><span class="sd">        proposal is indexed by order_id and vehicle_jid for later evaluation by</span>
</span><span id="Supplier-967"><a href="#Supplier-967"><span class="linenos"> 967</span></a><span class="sd">        ChooseBestVehicle behaviour.</span>
</span><span id="Supplier-968"><a href="#Supplier-968"><span class="linenos"> 968</span></a><span class="sd">        </span>
</span><span id="Supplier-969"><a href="#Supplier-969"><span class="linenos"> 969</span></a><span class="sd">        Proposal Data Structure:</span>
</span><span id="Supplier-970"><a href="#Supplier-970"><span class="linenos"> 970</span></a><span class="sd">            ```python</span>
</span><span id="Supplier-971"><a href="#Supplier-971"><span class="linenos"> 971</span></a><span class="sd">            vehicle_proposals = {</span>
</span><span id="Supplier-972"><a href="#Supplier-972"><span class="linenos"> 972</span></a><span class="sd">                order_id: {</span>
</span><span id="Supplier-973"><a href="#Supplier-973"><span class="linenos"> 973</span></a><span class="sd">                    &quot;vehicle1@localhost&quot;: (can_fit: bool, delivery_time: int),</span>
</span><span id="Supplier-974"><a href="#Supplier-974"><span class="linenos"> 974</span></a><span class="sd">                    &quot;vehicle2@localhost&quot;: (can_fit: bool, delivery_time: int),</span>
</span><span id="Supplier-975"><a href="#Supplier-975"><span class="linenos"> 975</span></a><span class="sd">                    ...</span>
</span><span id="Supplier-976"><a href="#Supplier-976"><span class="linenos"> 976</span></a><span class="sd">                }</span>
</span><span id="Supplier-977"><a href="#Supplier-977"><span class="linenos"> 977</span></a><span class="sd">            }</span>
</span><span id="Supplier-978"><a href="#Supplier-978"><span class="linenos"> 978</span></a><span class="sd">            ```</span>
</span><span id="Supplier-979"><a href="#Supplier-979"><span class="linenos"> 979</span></a><span class="sd">        </span>
</span><span id="Supplier-980"><a href="#Supplier-980"><span class="linenos"> 980</span></a><span class="sd">        Message Format:</span>
</span><span id="Supplier-981"><a href="#Supplier-981"><span class="linenos"> 981</span></a><span class="sd">            Body (JSON):</span>
</span><span id="Supplier-982"><a href="#Supplier-982"><span class="linenos"> 982</span></a><span class="sd">                ```json</span>
</span><span id="Supplier-983"><a href="#Supplier-983"><span class="linenos"> 983</span></a><span class="sd">                {</span>
</span><span id="Supplier-984"><a href="#Supplier-984"><span class="linenos"> 984</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="Supplier-985"><a href="#Supplier-985"><span class="linenos"> 985</span></a><span class="sd">                    &quot;can_fit&quot;: true,</span>
</span><span id="Supplier-986"><a href="#Supplier-986"><span class="linenos"> 986</span></a><span class="sd">                    &quot;delivery_time&quot;: 180</span>
</span><span id="Supplier-987"><a href="#Supplier-987"><span class="linenos"> 987</span></a><span class="sd">                }</span>
</span><span id="Supplier-988"><a href="#Supplier-988"><span class="linenos"> 988</span></a><span class="sd">                ```</span>
</span><span id="Supplier-989"><a href="#Supplier-989"><span class="linenos"> 989</span></a><span class="sd">        </span>
</span><span id="Supplier-990"><a href="#Supplier-990"><span class="linenos"> 990</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier-991"><a href="#Supplier-991"><span class="linenos"> 991</span></a><span class="sd">            1. **Receive Message**: Wait up to 5 seconds for vehicle proposal</span>
</span><span id="Supplier-992"><a href="#Supplier-992"><span class="linenos"> 992</span></a><span class="sd">            2. **Parse Proposal**: Extract orderid, can_fit, delivery_time</span>
</span><span id="Supplier-993"><a href="#Supplier-993"><span class="linenos"> 993</span></a><span class="sd">            3. **Initialize Storage**: Create order_id entry if doesn&#39;t exist</span>
</span><span id="Supplier-994"><a href="#Supplier-994"><span class="linenos"> 994</span></a><span class="sd">            4. **Store Proposal**: Add vehicle proposal to vehicle_proposals dict</span>
</span><span id="Supplier-995"><a href="#Supplier-995"><span class="linenos"> 995</span></a><span class="sd">            5. **Continue Loop**: Repeat until timeout (no more proposals)</span>
</span><span id="Supplier-996"><a href="#Supplier-996"><span class="linenos"> 996</span></a><span class="sd">            6. **Exit**: Break loop when timeout indicates all proposals received</span>
</span><span id="Supplier-997"><a href="#Supplier-997"><span class="linenos"> 997</span></a><span class="sd">        </span>
</span><span id="Supplier-998"><a href="#Supplier-998"><span class="linenos"> 998</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier-999"><a href="#Supplier-999"><span class="linenos"> 999</span></a><span class="sd">            - Updates agent.vehicle_proposals dictionary with new proposals</span>
</span><span id="Supplier-1000"><a href="#Supplier-1000"><span class="linenos">1000</span></a><span class="sd">            - Prints proposal details if verbose mode enabled</span>
</span><span id="Supplier-1001"><a href="#Supplier-1001"><span class="linenos">1001</span></a><span class="sd">            - Breaks loop after 5-second timeout</span>
</span><span id="Supplier-1002"><a href="#Supplier-1002"><span class="linenos">1002</span></a><span class="sd">        </span>
</span><span id="Supplier-1003"><a href="#Supplier-1003"><span class="linenos">1003</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier-1004"><a href="#Supplier-1004"><span class="linenos">1004</span></a><span class="sd">            None. Exits after collecting all available proposals.</span>
</span><span id="Supplier-1005"><a href="#Supplier-1005"><span class="linenos">1005</span></a><span class="sd">        </span>
</span><span id="Supplier-1006"><a href="#Supplier-1006"><span class="linenos">1006</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier-1007"><a href="#Supplier-1007"><span class="linenos">1007</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1008"><a href="#Supplier-1008"><span class="linenos">1008</span></a><span class="sd">            Loop Iteration 1:</span>
</span><span id="Supplier-1009"><a href="#Supplier-1009"><span class="linenos">1009</span></a><span class="sd">                - Receive from vehicle1: can_fit=True, time=150</span>
</span><span id="Supplier-1010"><a href="#Supplier-1010"><span class="linenos">1010</span></a><span class="sd">                - Store: vehicle_proposals[3001000000][&quot;vehicle1&quot;] = (True, 150)</span>
</span><span id="Supplier-1011"><a href="#Supplier-1011"><span class="linenos">1011</span></a><span class="sd">            Loop Iteration 2:</span>
</span><span id="Supplier-1012"><a href="#Supplier-1012"><span class="linenos">1012</span></a><span class="sd">                - Receive from vehicle2: can_fit=True, time=130</span>
</span><span id="Supplier-1013"><a href="#Supplier-1013"><span class="linenos">1013</span></a><span class="sd">                - Store: vehicle_proposals[3001000000][&quot;vehicle2&quot;] = (True, 130)</span>
</span><span id="Supplier-1014"><a href="#Supplier-1014"><span class="linenos">1014</span></a><span class="sd">            Loop Iteration 3:</span>
</span><span id="Supplier-1015"><a href="#Supplier-1015"><span class="linenos">1015</span></a><span class="sd">                - Timeout after 5 seconds</span>
</span><span id="Supplier-1016"><a href="#Supplier-1016"><span class="linenos">1016</span></a><span class="sd">                - Break loop, all proposals collected</span>
</span><span id="Supplier-1017"><a href="#Supplier-1017"><span class="linenos">1017</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1018"><a href="#Supplier-1018"><span class="linenos">1018</span></a><span class="sd">        </span>
</span><span id="Supplier-1019"><a href="#Supplier-1019"><span class="linenos">1019</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-1020"><a href="#Supplier-1020"><span class="linenos">1020</span></a><span class="sd">            The 5-second timeout is optimized to collect multiple proposals quickly</span>
</span><span id="Supplier-1021"><a href="#Supplier-1021"><span class="linenos">1021</span></a><span class="sd">            while not waiting too long for vehicles that won&#39;t respond.</span>
</span><span id="Supplier-1022"><a href="#Supplier-1022"><span class="linenos">1022</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1023"><a href="#Supplier-1023"><span class="linenos">1023</span></a>        
</span><span id="Supplier-1024"><a href="#Supplier-1024"><span class="linenos">1024</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-1025"><a href="#Supplier-1025"><span class="linenos">1025</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-1026"><a href="#Supplier-1026"><span class="linenos">1026</span></a>            
</span><span id="Supplier-1027"><a href="#Supplier-1027"><span class="linenos">1027</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Supplier-1028"><a href="#Supplier-1028"><span class="linenos">1028</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="Supplier-1029"><a href="#Supplier-1029"><span class="linenos">1029</span></a>                
</span><span id="Supplier-1030"><a href="#Supplier-1030"><span class="linenos">1030</span></a>                <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier-1031"><a href="#Supplier-1031"><span class="linenos">1031</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1032"><a href="#Supplier-1032"><span class="linenos">1032</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Received vehicle proposal from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1033"><a href="#Supplier-1033"><span class="linenos">1033</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier-1034"><a href="#Supplier-1034"><span class="linenos">1034</span></a>                    
</span><span id="Supplier-1035"><a href="#Supplier-1035"><span class="linenos">1035</span></a>                    <span class="c1"># A proposta do veculo no  uma Order, so apenas dados da proposta</span>
</span><span id="Supplier-1036"><a href="#Supplier-1036"><span class="linenos">1036</span></a>                    <span class="n">order_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orderid&quot;</span><span class="p">]</span>
</span><span id="Supplier-1037"><a href="#Supplier-1037"><span class="linenos">1037</span></a>                    <span class="n">sender_jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier-1038"><a href="#Supplier-1038"><span class="linenos">1038</span></a>                    <span class="n">can_fit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;can_fit&quot;</span><span class="p">]</span>
</span><span id="Supplier-1039"><a href="#Supplier-1039"><span class="linenos">1039</span></a>                    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span>
</span><span id="Supplier-1040"><a href="#Supplier-1040"><span class="linenos">1040</span></a>                    
</span><span id="Supplier-1041"><a href="#Supplier-1041"><span class="linenos">1041</span></a>                    <span class="c1"># Verificar se a entrada para este order_id existe, se no criar</span>
</span><span id="Supplier-1042"><a href="#Supplier-1042"><span class="linenos">1042</span></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">:</span>
</span><span id="Supplier-1043"><a href="#Supplier-1043"><span class="linenos">1043</span></a>                        <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier-1044"><a href="#Supplier-1044"><span class="linenos">1044</span></a>                    
</span><span id="Supplier-1045"><a href="#Supplier-1045"><span class="linenos">1045</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)][</span><span class="n">sender_jid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">can_fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="Supplier-1046"><a href="#Supplier-1046"><span class="linenos">1046</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1047"><a href="#Supplier-1047"><span class="linenos">1047</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle </span><span class="si">{</span><span class="n">sender_jid</span><span class="si">}</span><span class="s2"> proposal: can_fit=</span><span class="si">{</span><span class="n">can_fit</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1048"><a href="#Supplier-1048"><span class="linenos">1048</span></a>  
</span><span id="Supplier-1049"><a href="#Supplier-1049"><span class="linenos">1049</span></a>                <span class="k">else</span><span class="p">:</span> 
</span><span id="Supplier-1050"><a href="#Supplier-1050"><span class="linenos">1050</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1051"><a href="#Supplier-1051"><span class="linenos">1051</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Timeout - no more proposals received&quot;</span><span class="p">)</span>
</span><span id="Supplier-1052"><a href="#Supplier-1052"><span class="linenos">1052</span></a>                    <span class="k">break</span>
</span><span id="Supplier-1053"><a href="#Supplier-1053"><span class="linenos">1053</span></a>                 
</span><span id="Supplier-1054"><a href="#Supplier-1054"><span class="linenos">1054</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ChooseBestVehicle</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier-1055"><a href="#Supplier-1055"><span class="linenos">1055</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-1056"><a href="#Supplier-1056"><span class="linenos">1056</span></a><span class="sd">        Behaviour that evaluates vehicle proposals and selects optimal vehicle for supplier delivery.</span>
</span><span id="Supplier-1057"><a href="#Supplier-1057"><span class="linenos">1057</span></a><span class="sd">        </span>
</span><span id="Supplier-1058"><a href="#Supplier-1058"><span class="linenos">1058</span></a><span class="sd">        This behaviour implements the proposal evaluation and winner selection phase of</span>
</span><span id="Supplier-1059"><a href="#Supplier-1059"><span class="linenos">1059</span></a><span class="sd">        vehicle assignment for supplier-to-warehouse deliveries. After collecting all</span>
</span><span id="Supplier-1060"><a href="#Supplier-1060"><span class="linenos">1060</span></a><span class="sd">        vehicle proposals via ReceiveVehicleProposals, this behaviour compares them based</span>
</span><span id="Supplier-1061"><a href="#Supplier-1061"><span class="linenos">1061</span></a><span class="sd">        on capacity and delivery time, then notifies the selected vehicle and rejects all others.</span>
</span><span id="Supplier-1062"><a href="#Supplier-1062"><span class="linenos">1062</span></a><span class="sd">        </span>
</span><span id="Supplier-1063"><a href="#Supplier-1063"><span class="linenos">1063</span></a><span class="sd">        Selection Algorithm:</span>
</span><span id="Supplier-1064"><a href="#Supplier-1064"><span class="linenos">1064</span></a><span class="sd">            1. **Priority 1**: Filter vehicles that can fit the order (can_fit=True)</span>
</span><span id="Supplier-1065"><a href="#Supplier-1065"><span class="linenos">1065</span></a><span class="sd">            2. **Priority 2**: Among fitting vehicles, select one with minimum delivery_time</span>
</span><span id="Supplier-1066"><a href="#Supplier-1066"><span class="linenos">1066</span></a><span class="sd">            3. **Fallback**: If no vehicles can fit, select vehicle with minimum delivery_time anyway</span>
</span><span id="Supplier-1067"><a href="#Supplier-1067"><span class="linenos">1067</span></a><span class="sd">        </span>
</span><span id="Supplier-1068"><a href="#Supplier-1068"><span class="linenos">1068</span></a><span class="sd">        Attributes:</span>
</span><span id="Supplier-1069"><a href="#Supplier-1069"><span class="linenos">1069</span></a><span class="sd">            request_id (int): Unique order identifier to find proposals.</span>
</span><span id="Supplier-1070"><a href="#Supplier-1070"><span class="linenos">1070</span></a><span class="sd">        </span>
</span><span id="Supplier-1071"><a href="#Supplier-1071"><span class="linenos">1071</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier-1072"><a href="#Supplier-1072"><span class="linenos">1072</span></a><span class="sd">            1. **Retrieve Proposals**: Get all proposals for this request_id</span>
</span><span id="Supplier-1073"><a href="#Supplier-1073"><span class="linenos">1073</span></a><span class="sd">            2. **Evaluate Proposals**: Call get_best_vehicle() to select winner</span>
</span><span id="Supplier-1074"><a href="#Supplier-1074"><span class="linenos">1074</span></a><span class="sd">            3. **Send Confirmation**: Notify selected vehicle with order-confirmation</span>
</span><span id="Supplier-1075"><a href="#Supplier-1075"><span class="linenos">1075</span></a><span class="sd">            4. **Send Rejections**: Notify all other vehicles they were not selected</span>
</span><span id="Supplier-1076"><a href="#Supplier-1076"><span class="linenos">1076</span></a><span class="sd">        </span>
</span><span id="Supplier-1077"><a href="#Supplier-1077"><span class="linenos">1077</span></a><span class="sd">        Message Format (Confirmation):</span>
</span><span id="Supplier-1078"><a href="#Supplier-1078"><span class="linenos">1078</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier-1079"><a href="#Supplier-1079"><span class="linenos">1079</span></a><span class="sd">                - performative: &quot;order-confirmation&quot;</span>
</span><span id="Supplier-1080"><a href="#Supplier-1080"><span class="linenos">1080</span></a><span class="sd">            Body (JSON):</span>
</span><span id="Supplier-1081"><a href="#Supplier-1081"><span class="linenos">1081</span></a><span class="sd">                ```json</span>
</span><span id="Supplier-1082"><a href="#Supplier-1082"><span class="linenos">1082</span></a><span class="sd">                {</span>
</span><span id="Supplier-1083"><a href="#Supplier-1083"><span class="linenos">1083</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="Supplier-1084"><a href="#Supplier-1084"><span class="linenos">1084</span></a><span class="sd">                    &quot;confirmed&quot;: true</span>
</span><span id="Supplier-1085"><a href="#Supplier-1085"><span class="linenos">1085</span></a><span class="sd">                }</span>
</span><span id="Supplier-1086"><a href="#Supplier-1086"><span class="linenos">1086</span></a><span class="sd">                ```</span>
</span><span id="Supplier-1087"><a href="#Supplier-1087"><span class="linenos">1087</span></a><span class="sd">        </span>
</span><span id="Supplier-1088"><a href="#Supplier-1088"><span class="linenos">1088</span></a><span class="sd">        Message Format (Rejection):</span>
</span><span id="Supplier-1089"><a href="#Supplier-1089"><span class="linenos">1089</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier-1090"><a href="#Supplier-1090"><span class="linenos">1090</span></a><span class="sd">                - performative: &quot;order-confirmation&quot;</span>
</span><span id="Supplier-1091"><a href="#Supplier-1091"><span class="linenos">1091</span></a><span class="sd">            Body (JSON):</span>
</span><span id="Supplier-1092"><a href="#Supplier-1092"><span class="linenos">1092</span></a><span class="sd">                ```json</span>
</span><span id="Supplier-1093"><a href="#Supplier-1093"><span class="linenos">1093</span></a><span class="sd">                {</span>
</span><span id="Supplier-1094"><a href="#Supplier-1094"><span class="linenos">1094</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="Supplier-1095"><a href="#Supplier-1095"><span class="linenos">1095</span></a><span class="sd">                    &quot;confirmed&quot;: false</span>
</span><span id="Supplier-1096"><a href="#Supplier-1096"><span class="linenos">1096</span></a><span class="sd">                }</span>
</span><span id="Supplier-1097"><a href="#Supplier-1097"><span class="linenos">1097</span></a><span class="sd">                ```</span>
</span><span id="Supplier-1098"><a href="#Supplier-1098"><span class="linenos">1098</span></a><span class="sd">        </span>
</span><span id="Supplier-1099"><a href="#Supplier-1099"><span class="linenos">1099</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier-1100"><a href="#Supplier-1100"><span class="linenos">1100</span></a><span class="sd">            - Reads from agent.vehicle_proposals dictionary</span>
</span><span id="Supplier-1101"><a href="#Supplier-1101"><span class="linenos">1101</span></a><span class="sd">            - Reads from agent.pending_deliveries for Order object</span>
</span><span id="Supplier-1102"><a href="#Supplier-1102"><span class="linenos">1102</span></a><span class="sd">            - Sends confirmation message to selected vehicle</span>
</span><span id="Supplier-1103"><a href="#Supplier-1103"><span class="linenos">1103</span></a><span class="sd">            - Sends rejection messages to non-selected vehicles</span>
</span><span id="Supplier-1104"><a href="#Supplier-1104"><span class="linenos">1104</span></a><span class="sd">            - Prints selection decision if verbose mode enabled</span>
</span><span id="Supplier-1105"><a href="#Supplier-1105"><span class="linenos">1105</span></a><span class="sd">        </span>
</span><span id="Supplier-1106"><a href="#Supplier-1106"><span class="linenos">1106</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier-1107"><a href="#Supplier-1107"><span class="linenos">1107</span></a><span class="sd">            None. Completes after sending all confirmation/rejection messages.</span>
</span><span id="Supplier-1108"><a href="#Supplier-1108"><span class="linenos">1108</span></a><span class="sd">        </span>
</span><span id="Supplier-1109"><a href="#Supplier-1109"><span class="linenos">1109</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier-1110"><a href="#Supplier-1110"><span class="linenos">1110</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1111"><a href="#Supplier-1111"><span class="linenos">1111</span></a><span class="sd">            Proposals Received:</span>
</span><span id="Supplier-1112"><a href="#Supplier-1112"><span class="linenos">1112</span></a><span class="sd">                - vehicle1: (can_fit=True, time=150)</span>
</span><span id="Supplier-1113"><a href="#Supplier-1113"><span class="linenos">1113</span></a><span class="sd">                - vehicle2: (can_fit=True, time=130)</span>
</span><span id="Supplier-1114"><a href="#Supplier-1114"><span class="linenos">1114</span></a><span class="sd">                - vehicle3: (can_fit=False, time=120)</span>
</span><span id="Supplier-1115"><a href="#Supplier-1115"><span class="linenos">1115</span></a><span class="sd">            </span>
</span><span id="Supplier-1116"><a href="#Supplier-1116"><span class="linenos">1116</span></a><span class="sd">            Evaluation:</span>
</span><span id="Supplier-1117"><a href="#Supplier-1117"><span class="linenos">1117</span></a><span class="sd">                - Filter: vehicle1, vehicle2 (can fit)</span>
</span><span id="Supplier-1118"><a href="#Supplier-1118"><span class="linenos">1118</span></a><span class="sd">                - Compare times: 130 &lt; 150</span>
</span><span id="Supplier-1119"><a href="#Supplier-1119"><span class="linenos">1119</span></a><span class="sd">                - Winner: vehicle2</span>
</span><span id="Supplier-1120"><a href="#Supplier-1120"><span class="linenos">1120</span></a><span class="sd">            </span>
</span><span id="Supplier-1121"><a href="#Supplier-1121"><span class="linenos">1121</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier-1122"><a href="#Supplier-1122"><span class="linenos">1122</span></a><span class="sd">                - Send confirmation to vehicle2 (confirmed=true)</span>
</span><span id="Supplier-1123"><a href="#Supplier-1123"><span class="linenos">1123</span></a><span class="sd">                - Send rejection to vehicle1 (confirmed=false)</span>
</span><span id="Supplier-1124"><a href="#Supplier-1124"><span class="linenos">1124</span></a><span class="sd">                - Send rejection to vehicle3 (confirmed=false)</span>
</span><span id="Supplier-1125"><a href="#Supplier-1125"><span class="linenos">1125</span></a><span class="sd">            </span>
</span><span id="Supplier-1126"><a href="#Supplier-1126"><span class="linenos">1126</span></a><span class="sd">            Output:</span>
</span><span id="Supplier-1127"><a href="#Supplier-1127"><span class="linenos">1127</span></a><span class="sd">                - Print: &quot;Best vehicle selected: vehicle2@localhost&quot;</span>
</span><span id="Supplier-1128"><a href="#Supplier-1128"><span class="linenos">1128</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1129"><a href="#Supplier-1129"><span class="linenos">1129</span></a><span class="sd">        </span>
</span><span id="Supplier-1130"><a href="#Supplier-1130"><span class="linenos">1130</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-1131"><a href="#Supplier-1131"><span class="linenos">1131</span></a><span class="sd">            Unlike warehouse&#39;s version, this behaviour doesn&#39;t wait for proposals</span>
</span><span id="Supplier-1132"><a href="#Supplier-1132"><span class="linenos">1132</span></a><span class="sd">            as they are already collected by ReceiveVehicleProposals before this</span>
</span><span id="Supplier-1133"><a href="#Supplier-1133"><span class="linenos">1133</span></a><span class="sd">            behaviour is invoked.</span>
</span><span id="Supplier-1134"><a href="#Supplier-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1135"><a href="#Supplier-1135"><span class="linenos">1135</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">):</span>
</span><span id="Supplier-1136"><a href="#Supplier-1136"><span class="linenos">1136</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier-1137"><a href="#Supplier-1137"><span class="linenos">1137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="Supplier-1138"><a href="#Supplier-1138"><span class="linenos">1138</span></a>        
</span><span id="Supplier-1139"><a href="#Supplier-1139"><span class="linenos">1139</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_best_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposals</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Supplier-1140"><a href="#Supplier-1140"><span class="linenos">1140</span></a>            <span class="c1"># First filter vehicles that can fit the order</span>
</span><span id="Supplier-1141"><a href="#Supplier-1141"><span class="linenos">1141</span></a>            <span class="n">can_fit_vehicles</span> <span class="o">=</span> <span class="p">{</span><span class="n">jid</span><span class="p">:</span> <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="ow">in</span> <span class="n">proposals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">fit</span><span class="p">}</span>
</span><span id="Supplier-1142"><a href="#Supplier-1142"><span class="linenos">1142</span></a>
</span><span id="Supplier-1143"><a href="#Supplier-1143"><span class="linenos">1143</span></a>            <span class="k">if</span> <span class="n">can_fit_vehicles</span><span class="p">:</span>
</span><span id="Supplier-1144"><a href="#Supplier-1144"><span class="linenos">1144</span></a>                <span class="c1"># If there are vehicles that can fit, choose the one with lowest delivery time</span>
</span><span id="Supplier-1145"><a href="#Supplier-1145"><span class="linenos">1145</span></a>                <span class="n">best_vehicle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">can_fit_vehicles</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Supplier-1146"><a href="#Supplier-1146"><span class="linenos">1146</span></a>                <span class="k">return</span> <span class="n">best_vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Supplier-1147"><a href="#Supplier-1147"><span class="linenos">1147</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-1148"><a href="#Supplier-1148"><span class="linenos">1148</span></a>                <span class="c1"># If no vehicles can fit, choose the one with lowest delivery time anyway</span>
</span><span id="Supplier-1149"><a href="#Supplier-1149"><span class="linenos">1149</span></a>                <span class="k">if</span> <span class="n">proposals</span><span class="p">:</span>
</span><span id="Supplier-1150"><a href="#Supplier-1150"><span class="linenos">1150</span></a>                    <span class="n">best_vehicle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">proposals</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Supplier-1151"><a href="#Supplier-1151"><span class="linenos">1151</span></a>                    <span class="k">return</span> <span class="n">best_vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Supplier-1152"><a href="#Supplier-1152"><span class="linenos">1152</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Supplier-1153"><a href="#Supplier-1153"><span class="linenos">1153</span></a>        
</span><span id="Supplier-1154"><a href="#Supplier-1154"><span class="linenos">1154</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-1155"><a href="#Supplier-1155"><span class="linenos">1155</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-1156"><a href="#Supplier-1156"><span class="linenos">1156</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1157"><a href="#Supplier-1157"><span class="linenos">1157</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Comparing vehicle proposals...&quot;</span><span class="p">)</span>
</span><span id="Supplier-1158"><a href="#Supplier-1158"><span class="linenos">1158</span></a>            
</span><span id="Supplier-1159"><a href="#Supplier-1159"><span class="linenos">1159</span></a>            <span class="c1"># Verificar se a entrada para este order_id existe, se no criar</span>
</span><span id="Supplier-1160"><a href="#Supplier-1160"><span class="linenos">1160</span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">:</span>
</span><span id="Supplier-1161"><a href="#Supplier-1161"><span class="linenos">1161</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier-1162"><a href="#Supplier-1162"><span class="linenos">1162</span></a>            
</span><span id="Supplier-1163"><a href="#Supplier-1163"><span class="linenos">1163</span></a>            <span class="n">order_proposals</span> <span class="o">=</span>  <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span>
</span><span id="Supplier-1164"><a href="#Supplier-1164"><span class="linenos">1164</span></a>            <span class="n">proposals</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span> <span class="c1"># vehicle_jid : (can_fit, time)</span>
</span><span id="Supplier-1165"><a href="#Supplier-1165"><span class="linenos">1165</span></a>            
</span><span id="Supplier-1166"><a href="#Supplier-1166"><span class="linenos">1166</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1167"><a href="#Supplier-1167"><span class="linenos">1167</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Total proposals received: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">proposals</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1168"><a href="#Supplier-1168"><span class="linenos">1168</span></a>            <span class="n">best_vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_vehicle</span><span class="p">(</span><span class="n">proposals</span><span class="p">)</span>
</span><span id="Supplier-1169"><a href="#Supplier-1169"><span class="linenos">1169</span></a>            
</span><span id="Supplier-1170"><a href="#Supplier-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="n">best_vehicle</span><span class="p">:</span>
</span><span id="Supplier-1171"><a href="#Supplier-1171"><span class="linenos">1171</span></a>                <span class="c1"># Essential print - vehicle assigned</span>
</span><span id="Supplier-1172"><a href="#Supplier-1172"><span class="linenos">1172</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle assigned: </span><span class="si">{</span><span class="n">best_vehicle</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1173"><a href="#Supplier-1173"><span class="linenos">1173</span></a>                
</span><span id="Supplier-1174"><a href="#Supplier-1174"><span class="linenos">1174</span></a>                <span class="c1"># Send confirmation to the selected vehicle</span>
</span><span id="Supplier-1175"><a href="#Supplier-1175"><span class="linenos">1175</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">best_vehicle</span><span class="p">)</span>
</span><span id="Supplier-1176"><a href="#Supplier-1176"><span class="linenos">1176</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-confirmation&quot;</span><span class="p">)</span>
</span><span id="Supplier-1177"><a href="#Supplier-1177"><span class="linenos">1177</span></a>                
</span><span id="Supplier-1178"><a href="#Supplier-1178"><span class="linenos">1178</span></a>                <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">]</span>
</span><span id="Supplier-1179"><a href="#Supplier-1179"><span class="linenos">1179</span></a>                <span class="n">order_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier-1180"><a href="#Supplier-1180"><span class="linenos">1180</span></a>                    <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">,</span>
</span><span id="Supplier-1181"><a href="#Supplier-1181"><span class="linenos">1181</span></a>                    <span class="s2">&quot;confirmed&quot;</span> <span class="p">:</span> <span class="kc">True</span>
</span><span id="Supplier-1182"><a href="#Supplier-1182"><span class="linenos">1182</span></a>                <span class="p">}</span>
</span><span id="Supplier-1183"><a href="#Supplier-1183"><span class="linenos">1183</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order_data</span><span class="p">)</span>
</span><span id="Supplier-1184"><a href="#Supplier-1184"><span class="linenos">1184</span></a>                
</span><span id="Supplier-1185"><a href="#Supplier-1185"><span class="linenos">1185</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier-1186"><a href="#Supplier-1186"><span class="linenos">1186</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1187"><a href="#Supplier-1187"><span class="linenos">1187</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Confirmation sent to </span><span class="si">{</span><span class="n">best_vehicle</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1188"><a href="#Supplier-1188"><span class="linenos">1188</span></a>                
</span><span id="Supplier-1189"><a href="#Supplier-1189"><span class="linenos">1189</span></a>                <span class="c1"># Send rejection to all other vehicles</span>
</span><span id="Supplier-1190"><a href="#Supplier-1190"><span class="linenos">1190</span></a>                <span class="n">rejected_vehicles</span> <span class="o">=</span> <span class="p">[</span><span class="n">jid</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">proposals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">jid</span> <span class="o">!=</span> <span class="n">best_vehicle</span><span class="p">]</span>
</span><span id="Supplier-1191"><a href="#Supplier-1191"><span class="linenos">1191</span></a>                <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">rejected_vehicles</span><span class="p">:</span>
</span><span id="Supplier-1192"><a href="#Supplier-1192"><span class="linenos">1192</span></a>                    <span class="n">reject_msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier-1193"><a href="#Supplier-1193"><span class="linenos">1193</span></a>                    <span class="n">reject_msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-confirmation&quot;</span><span class="p">)</span>
</span><span id="Supplier-1194"><a href="#Supplier-1194"><span class="linenos">1194</span></a>                    
</span><span id="Supplier-1195"><a href="#Supplier-1195"><span class="linenos">1195</span></a>                    <span class="n">reject_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier-1196"><a href="#Supplier-1196"><span class="linenos">1196</span></a>                    <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">,</span>
</span><span id="Supplier-1197"><a href="#Supplier-1197"><span class="linenos">1197</span></a>                    <span class="s2">&quot;confirmed&quot;</span> <span class="p">:</span> <span class="kc">False</span>
</span><span id="Supplier-1198"><a href="#Supplier-1198"><span class="linenos">1198</span></a>                    <span class="p">}</span>
</span><span id="Supplier-1199"><a href="#Supplier-1199"><span class="linenos">1199</span></a>                    
</span><span id="Supplier-1200"><a href="#Supplier-1200"><span class="linenos">1200</span></a>                    <span class="n">reject_msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">reject_data</span><span class="p">)</span>
</span><span id="Supplier-1201"><a href="#Supplier-1201"><span class="linenos">1201</span></a>                    
</span><span id="Supplier-1202"><a href="#Supplier-1202"><span class="linenos">1202</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">reject_msg</span><span class="p">)</span>
</span><span id="Supplier-1203"><a href="#Supplier-1203"><span class="linenos">1203</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1204"><a href="#Supplier-1204"><span class="linenos">1204</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Rejection sent to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1205"><a href="#Supplier-1205"><span class="linenos">1205</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-1206"><a href="#Supplier-1206"><span class="linenos">1206</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No vehicles available to assign!&quot;</span><span class="p">)</span>
</span><span id="Supplier-1207"><a href="#Supplier-1207"><span class="linenos">1207</span></a>    
</span><span id="Supplier-1208"><a href="#Supplier-1208"><span class="linenos">1208</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveTimeDelta</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="Supplier-1209"><a href="#Supplier-1209"><span class="linenos">1209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-1210"><a href="#Supplier-1210"><span class="linenos">1210</span></a><span class="sd">        Cyclic behaviour that synchronizes simulation time and applies traffic updates.</span>
</span><span id="Supplier-1211"><a href="#Supplier-1211"><span class="linenos">1211</span></a><span class="sd">        </span>
</span><span id="Supplier-1212"><a href="#Supplier-1212"><span class="linenos">1212</span></a><span class="sd">        Receives time delta messages from world agent, updates current_tick, and</span>
</span><span id="Supplier-1213"><a href="#Supplier-1213"><span class="linenos">1213</span></a><span class="sd">        applies dynamic graph edge weight changes for traffic simulation.</span>
</span><span id="Supplier-1214"><a href="#Supplier-1214"><span class="linenos">1214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1215"><a href="#Supplier-1215"><span class="linenos">1215</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-1216"><a href="#Supplier-1216"><span class="linenos">1216</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier-1217"><a href="#Supplier-1217"><span class="linenos">1217</span></a>            
</span><span id="Supplier-1218"><a href="#Supplier-1218"><span class="linenos">1218</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier-1219"><a href="#Supplier-1219"><span class="linenos">1219</span></a>            
</span><span id="Supplier-1220"><a href="#Supplier-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier-1221"><a href="#Supplier-1221"><span class="linenos">1221</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier-1222"><a href="#Supplier-1222"><span class="linenos">1222</span></a>                
</span><span id="Supplier-1223"><a href="#Supplier-1223"><span class="linenos">1223</span></a>                <span class="nb">type</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="Supplier-1224"><a href="#Supplier-1224"><span class="linenos">1224</span></a>                <span class="n">delta</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="Supplier-1225"><a href="#Supplier-1225"><span class="linenos">1225</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">current_tick</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="Supplier-1226"><a href="#Supplier-1226"><span class="linenos">1226</span></a>                
</span><span id="Supplier-1227"><a href="#Supplier-1227"><span class="linenos">1227</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="Supplier-1228"><a href="#Supplier-1228"><span class="linenos">1228</span></a>                    <span class="n">map_updates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> 
</span><span id="Supplier-1229"><a href="#Supplier-1229"><span class="linenos">1229</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update_graph</span><span class="p">(</span><span class="n">map_updates</span><span class="p">)</span>
</span><span id="Supplier-1230"><a href="#Supplier-1230"><span class="linenos">1230</span></a>    
</span><span id="Supplier-1231"><a href="#Supplier-1231"><span class="linenos">1231</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="Supplier-1232"><a href="#Supplier-1232"><span class="linenos">1232</span></a>    <span class="c1">#           AUXILIARY FUNCTIONS</span>
</span><span id="Supplier-1233"><a href="#Supplier-1233"><span class="linenos">1233</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="Supplier-1234"><a href="#Supplier-1234"><span class="linenos">1234</span></a>    
</span><span id="Supplier-1235"><a href="#Supplier-1235"><span class="linenos">1235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-1236"><a href="#Supplier-1236"><span class="linenos">1236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-1237"><a href="#Supplier-1237"><span class="linenos">1237</span></a><span class="sd">        Print comprehensive supplier statistics (debugging utility).</span>
</span><span id="Supplier-1238"><a href="#Supplier-1238"><span class="linenos">1238</span></a><span class="sd">        </span>
</span><span id="Supplier-1239"><a href="#Supplier-1239"><span class="linenos">1239</span></a><span class="sd">        Displays two key metrics:</span>
</span><span id="Supplier-1240"><a href="#Supplier-1240"><span class="linenos">1240</span></a><span class="sd">        1. **Total Products Supplied**: Cumulative quantities per product type</span>
</span><span id="Supplier-1241"><a href="#Supplier-1241"><span class="linenos">1241</span></a><span class="sd">        2. **Pending Deliveries**: Orders confirmed but not yet picked up by vehicles</span>
</span><span id="Supplier-1242"><a href="#Supplier-1242"><span class="linenos">1242</span></a><span class="sd">        </span>
</span><span id="Supplier-1243"><a href="#Supplier-1243"><span class="linenos">1243</span></a><span class="sd">        Output Format:</span>
</span><span id="Supplier-1244"><a href="#Supplier-1244"><span class="linenos">1244</span></a><span class="sd">            ========================================</span>
</span><span id="Supplier-1245"><a href="#Supplier-1245"><span class="linenos">1245</span></a><span class="sd">            supplier1@localhost Statistics:</span>
</span><span id="Supplier-1246"><a href="#Supplier-1246"><span class="linenos">1246</span></a><span class="sd">            Total Products Supplied:</span>
</span><span id="Supplier-1247"><a href="#Supplier-1247"><span class="linenos">1247</span></a><span class="sd">              electronics: 1500</span>
</span><span id="Supplier-1248"><a href="#Supplier-1248"><span class="linenos">1248</span></a><span class="sd">              textiles: 800</span>
</span><span id="Supplier-1249"><a href="#Supplier-1249"><span class="linenos">1249</span></a><span class="sd">              food: 1200</span>
</span><span id="Supplier-1250"><a href="#Supplier-1250"><span class="linenos">1250</span></a><span class="sd">            </span>
</span><span id="Supplier-1251"><a href="#Supplier-1251"><span class="linenos">1251</span></a><span class="sd">            Pending Deliveries:</span>
</span><span id="Supplier-1252"><a href="#Supplier-1252"><span class="linenos">1252</span></a><span class="sd">              Total: 2 order(s)</span>
</span><span id="Supplier-1253"><a href="#Supplier-1253"><span class="linenos">1253</span></a><span class="sd">                Order 301000000: 100xelectronics for warehouse1@localhost</span>
</span><span id="Supplier-1254"><a href="#Supplier-1254"><span class="linenos">1254</span></a><span class="sd">                Order 301000001: 50xtextiles for warehouse2@localhost</span>
</span><span id="Supplier-1255"><a href="#Supplier-1255"><span class="linenos">1255</span></a><span class="sd">            ========================================</span>
</span><span id="Supplier-1256"><a href="#Supplier-1256"><span class="linenos">1256</span></a><span class="sd">        </span>
</span><span id="Supplier-1257"><a href="#Supplier-1257"><span class="linenos">1257</span></a><span class="sd">        Metrics Interpretation:</span>
</span><span id="Supplier-1258"><a href="#Supplier-1258"><span class="linenos">1258</span></a><span class="sd">            - **Total Products Supplied**: Historical record of all materials provided</span>
</span><span id="Supplier-1259"><a href="#Supplier-1259"><span class="linenos">1259</span></a><span class="sd">            - **Pending Deliveries**: Orders awaiting vehicle pickup</span>
</span><span id="Supplier-1260"><a href="#Supplier-1260"><span class="linenos">1260</span></a><span class="sd">                - Added when warehouse sends warehouse-confirm</span>
</span><span id="Supplier-1261"><a href="#Supplier-1261"><span class="linenos">1261</span></a><span class="sd">                - Removed when vehicle sends vehicle-pickup</span>
</span><span id="Supplier-1262"><a href="#Supplier-1262"><span class="linenos">1262</span></a><span class="sd">        </span>
</span><span id="Supplier-1263"><a href="#Supplier-1263"><span class="linenos">1263</span></a><span class="sd">        Use Cases:</span>
</span><span id="Supplier-1264"><a href="#Supplier-1264"><span class="linenos">1264</span></a><span class="sd">            - Monitoring supplier throughput</span>
</span><span id="Supplier-1265"><a href="#Supplier-1265"><span class="linenos">1265</span></a><span class="sd">            - Tracking pending logistics operations</span>
</span><span id="Supplier-1266"><a href="#Supplier-1266"><span class="linenos">1266</span></a><span class="sd">            - Debugging vehicle coordination issues</span>
</span><span id="Supplier-1267"><a href="#Supplier-1267"><span class="linenos">1267</span></a><span class="sd">            - Performance analysis and reporting</span>
</span><span id="Supplier-1268"><a href="#Supplier-1268"><span class="linenos">1268</span></a><span class="sd">        </span>
</span><span id="Supplier-1269"><a href="#Supplier-1269"><span class="linenos">1269</span></a><span class="sd">        Example Usage:</span>
</span><span id="Supplier-1270"><a href="#Supplier-1270"><span class="linenos">1270</span></a><span class="sd">            ```python</span>
</span><span id="Supplier-1271"><a href="#Supplier-1271"><span class="linenos">1271</span></a><span class="sd">            # After warehouse confirms order</span>
</span><span id="Supplier-1272"><a href="#Supplier-1272"><span class="linenos">1272</span></a><span class="sd">            supplier.pending_deliveries[order_id] = order</span>
</span><span id="Supplier-1273"><a href="#Supplier-1273"><span class="linenos">1273</span></a><span class="sd">            supplier.print_stats()  # Shows new pending order</span>
</span><span id="Supplier-1274"><a href="#Supplier-1274"><span class="linenos">1274</span></a><span class="sd">            </span>
</span><span id="Supplier-1275"><a href="#Supplier-1275"><span class="linenos">1275</span></a><span class="sd">            # After vehicle pickup</span>
</span><span id="Supplier-1276"><a href="#Supplier-1276"><span class="linenos">1276</span></a><span class="sd">            del supplier.pending_deliveries[order_id]</span>
</span><span id="Supplier-1277"><a href="#Supplier-1277"><span class="linenos">1277</span></a><span class="sd">            supplier.print_stats()  # Shows order removed</span>
</span><span id="Supplier-1278"><a href="#Supplier-1278"><span class="linenos">1278</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1279"><a href="#Supplier-1279"><span class="linenos">1279</span></a><span class="sd">        </span>
</span><span id="Supplier-1280"><a href="#Supplier-1280"><span class="linenos">1280</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-1281"><a href="#Supplier-1281"><span class="linenos">1281</span></a><span class="sd">            Unlike warehouse and store, supplier statistics are simpler because</span>
</span><span id="Supplier-1282"><a href="#Supplier-1282"><span class="linenos">1282</span></a><span class="sd">            there&#39;s no stock tracking (infinite inventory model).</span>
</span><span id="Supplier-1283"><a href="#Supplier-1283"><span class="linenos">1283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1284"><a href="#Supplier-1284"><span class="linenos">1284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
</span><span id="Supplier-1285"><a href="#Supplier-1285"><span class="linenos">1285</span></a>        
</span><span id="Supplier-1286"><a href="#Supplier-1286"><span class="linenos">1286</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2"> Statistics:&quot;</span><span class="p">)</span>
</span><span id="Supplier-1287"><a href="#Supplier-1287"><span class="linenos">1287</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Products Supplied:&quot;</span><span class="p">)</span>
</span><span id="Supplier-1288"><a href="#Supplier-1288"><span class="linenos">1288</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">:</span>
</span><span id="Supplier-1289"><a href="#Supplier-1289"><span class="linenos">1289</span></a>            <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Supplier-1290"><a href="#Supplier-1290"><span class="linenos">1290</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1291"><a href="#Supplier-1291"><span class="linenos">1291</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-1292"><a href="#Supplier-1292"><span class="linenos">1292</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  None yet&quot;</span><span class="p">)</span>
</span><span id="Supplier-1293"><a href="#Supplier-1293"><span class="linenos">1293</span></a>            
</span><span id="Supplier-1294"><a href="#Supplier-1294"><span class="linenos">1294</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pending Deliveries:&quot;</span><span class="p">)</span>
</span><span id="Supplier-1295"><a href="#Supplier-1295"><span class="linenos">1295</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">:</span>
</span><span id="Supplier-1296"><a href="#Supplier-1296"><span class="linenos">1296</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">)</span><span class="si">}</span><span class="s2"> order(s)&quot;</span><span class="p">)</span>
</span><span id="Supplier-1297"><a href="#Supplier-1297"><span class="linenos">1297</span></a>            <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">order</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Supplier-1298"><a href="#Supplier-1298"><span class="linenos">1298</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Order </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1299"><a href="#Supplier-1299"><span class="linenos">1299</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier-1300"><a href="#Supplier-1300"><span class="linenos">1300</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  None&quot;</span><span class="p">)</span>
</span><span id="Supplier-1301"><a href="#Supplier-1301"><span class="linenos">1301</span></a>        
</span><span id="Supplier-1302"><a href="#Supplier-1302"><span class="linenos">1302</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
</span><span id="Supplier-1303"><a href="#Supplier-1303"><span class="linenos">1303</span></a>
</span><span id="Supplier-1304"><a href="#Supplier-1304"><span class="linenos">1304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traffic_data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier-1305"><a href="#Supplier-1305"><span class="linenos">1305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-1306"><a href="#Supplier-1306"><span class="linenos">1306</span></a><span class="sd">        Update world graph edge weights based on traffic conditions.</span>
</span><span id="Supplier-1307"><a href="#Supplier-1307"><span class="linenos">1307</span></a><span class="sd">        </span>
</span><span id="Supplier-1308"><a href="#Supplier-1308"><span class="linenos">1308</span></a><span class="sd">        This function applies dynamic traffic updates received from the world agent</span>
</span><span id="Supplier-1309"><a href="#Supplier-1309"><span class="linenos">1309</span></a><span class="sd">        to the supplier&#39;s local copy of the world graph. Edge weights represent</span>
</span><span id="Supplier-1310"><a href="#Supplier-1310"><span class="linenos">1310</span></a><span class="sd">        travel costs/times and are updated to reflect current traffic conditions.</span>
</span><span id="Supplier-1311"><a href="#Supplier-1311"><span class="linenos">1311</span></a><span class="sd">        </span>
</span><span id="Supplier-1312"><a href="#Supplier-1312"><span class="linenos">1312</span></a><span class="sd">        Args:</span>
</span><span id="Supplier-1313"><a href="#Supplier-1313"><span class="linenos">1313</span></a><span class="sd">            traffic_data (dict): Traffic update data with structure:</span>
</span><span id="Supplier-1314"><a href="#Supplier-1314"><span class="linenos">1314</span></a><span class="sd">                {</span>
</span><span id="Supplier-1315"><a href="#Supplier-1315"><span class="linenos">1315</span></a><span class="sd">                    &quot;edges&quot;: [</span>
</span><span id="Supplier-1316"><a href="#Supplier-1316"><span class="linenos">1316</span></a><span class="sd">                        {</span>
</span><span id="Supplier-1317"><a href="#Supplier-1317"><span class="linenos">1317</span></a><span class="sd">                            &quot;node1&quot;: int,  # First node ID</span>
</span><span id="Supplier-1318"><a href="#Supplier-1318"><span class="linenos">1318</span></a><span class="sd">                            &quot;node2&quot;: int,  # Second node ID</span>
</span><span id="Supplier-1319"><a href="#Supplier-1319"><span class="linenos">1319</span></a><span class="sd">                            &quot;weight&quot;: float  # New edge weight (time/cost)</span>
</span><span id="Supplier-1320"><a href="#Supplier-1320"><span class="linenos">1320</span></a><span class="sd">                        },</span>
</span><span id="Supplier-1321"><a href="#Supplier-1321"><span class="linenos">1321</span></a><span class="sd">                        ...</span>
</span><span id="Supplier-1322"><a href="#Supplier-1322"><span class="linenos">1322</span></a><span class="sd">                    ]</span>
</span><span id="Supplier-1323"><a href="#Supplier-1323"><span class="linenos">1323</span></a><span class="sd">                }</span>
</span><span id="Supplier-1324"><a href="#Supplier-1324"><span class="linenos">1324</span></a><span class="sd">        </span>
</span><span id="Supplier-1325"><a href="#Supplier-1325"><span class="linenos">1325</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier-1326"><a href="#Supplier-1326"><span class="linenos">1326</span></a><span class="sd">            1. Iterate through all edge updates in traffic_data</span>
</span><span id="Supplier-1327"><a href="#Supplier-1327"><span class="linenos">1327</span></a><span class="sd">            2. Extract node1_id, node2_id, and new_weight</span>
</span><span id="Supplier-1328"><a href="#Supplier-1328"><span class="linenos">1328</span></a><span class="sd">            3. Retrieve edge from graph using get_edge()</span>
</span><span id="Supplier-1329"><a href="#Supplier-1329"><span class="linenos">1329</span></a><span class="sd">            4. Update edge.weight if edge exists</span>
</span><span id="Supplier-1330"><a href="#Supplier-1330"><span class="linenos">1330</span></a><span class="sd">        </span>
</span><span id="Supplier-1331"><a href="#Supplier-1331"><span class="linenos">1331</span></a><span class="sd">        Example:</span>
</span><span id="Supplier-1332"><a href="#Supplier-1332"><span class="linenos">1332</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1333"><a href="#Supplier-1333"><span class="linenos">1333</span></a><span class="sd">            Traffic Data:</span>
</span><span id="Supplier-1334"><a href="#Supplier-1334"><span class="linenos">1334</span></a><span class="sd">            {</span>
</span><span id="Supplier-1335"><a href="#Supplier-1335"><span class="linenos">1335</span></a><span class="sd">                &quot;edges&quot;: [</span>
</span><span id="Supplier-1336"><a href="#Supplier-1336"><span class="linenos">1336</span></a><span class="sd">                    {&quot;node1&quot;: 10, &quot;node2&quot;: 15, &quot;weight&quot;: 120.5},</span>
</span><span id="Supplier-1337"><a href="#Supplier-1337"><span class="linenos">1337</span></a><span class="sd">                    {&quot;node1&quot;: 15, &quot;node2&quot;: 20, &quot;weight&quot;: 95.3}</span>
</span><span id="Supplier-1338"><a href="#Supplier-1338"><span class="linenos">1338</span></a><span class="sd">                ]</span>
</span><span id="Supplier-1339"><a href="#Supplier-1339"><span class="linenos">1339</span></a><span class="sd">            }</span>
</span><span id="Supplier-1340"><a href="#Supplier-1340"><span class="linenos">1340</span></a><span class="sd">            </span>
</span><span id="Supplier-1341"><a href="#Supplier-1341"><span class="linenos">1341</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier-1342"><a href="#Supplier-1342"><span class="linenos">1342</span></a><span class="sd">                - Edge (10, 15): weight updated to 120.5</span>
</span><span id="Supplier-1343"><a href="#Supplier-1343"><span class="linenos">1343</span></a><span class="sd">                - Edge (15, 20): weight updated to 95.3</span>
</span><span id="Supplier-1344"><a href="#Supplier-1344"><span class="linenos">1344</span></a><span class="sd">            </span>
</span><span id="Supplier-1345"><a href="#Supplier-1345"><span class="linenos">1345</span></a><span class="sd">            Impact:</span>
</span><span id="Supplier-1346"><a href="#Supplier-1346"><span class="linenos">1346</span></a><span class="sd">                - Vehicle routing recalculated with new weights</span>
</span><span id="Supplier-1347"><a href="#Supplier-1347"><span class="linenos">1347</span></a><span class="sd">                - Delivery time estimates adjusted</span>
</span><span id="Supplier-1348"><a href="#Supplier-1348"><span class="linenos">1348</span></a><span class="sd">                - Pathfinding uses updated costs</span>
</span><span id="Supplier-1349"><a href="#Supplier-1349"><span class="linenos">1349</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1350"><a href="#Supplier-1350"><span class="linenos">1350</span></a><span class="sd">        </span>
</span><span id="Supplier-1351"><a href="#Supplier-1351"><span class="linenos">1351</span></a><span class="sd">        Integration:</span>
</span><span id="Supplier-1352"><a href="#Supplier-1352"><span class="linenos">1352</span></a><span class="sd">            - Called by: ReceiveTimeDelta behaviour</span>
</span><span id="Supplier-1353"><a href="#Supplier-1353"><span class="linenos">1353</span></a><span class="sd">            - Triggered by: time-delta messages from world agent</span>
</span><span id="Supplier-1354"><a href="#Supplier-1354"><span class="linenos">1354</span></a><span class="sd">            - Frequency: Every simulation tick with traffic updates</span>
</span><span id="Supplier-1355"><a href="#Supplier-1355"><span class="linenos">1355</span></a><span class="sd">        </span>
</span><span id="Supplier-1356"><a href="#Supplier-1356"><span class="linenos">1356</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-1357"><a href="#Supplier-1357"><span class="linenos">1357</span></a><span class="sd">            Only updates existing edges. If an edge doesn&#39;t exist in the graph,</span>
</span><span id="Supplier-1358"><a href="#Supplier-1358"><span class="linenos">1358</span></a><span class="sd">            it&#39;s silently skipped (safe behavior for malformed data).</span>
</span><span id="Supplier-1359"><a href="#Supplier-1359"><span class="linenos">1359</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1360"><a href="#Supplier-1360"><span class="linenos">1360</span></a>        <span class="k">for</span> <span class="n">edge_info</span> <span class="ow">in</span> <span class="n">traffic_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;edges&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="Supplier-1361"><a href="#Supplier-1361"><span class="linenos">1361</span></a>                <span class="n">node1_id</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node1&quot;</span><span class="p">)</span>
</span><span id="Supplier-1362"><a href="#Supplier-1362"><span class="linenos">1362</span></a>                <span class="n">node2_id</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node2&quot;</span><span class="p">)</span>
</span><span id="Supplier-1363"><a href="#Supplier-1363"><span class="linenos">1363</span></a>                <span class="n">new_weight</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span>
</span><span id="Supplier-1364"><a href="#Supplier-1364"><span class="linenos">1364</span></a>                
</span><span id="Supplier-1365"><a href="#Supplier-1365"><span class="linenos">1365</span></a>                <span class="n">edge</span> <span class="p">:</span> <span class="n">Edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">node1_id</span><span class="p">,</span> <span class="n">node2_id</span><span class="p">)</span>
</span><span id="Supplier-1366"><a href="#Supplier-1366"><span class="linenos">1366</span></a>                <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
</span><span id="Supplier-1367"><a href="#Supplier-1367"><span class="linenos">1367</span></a>                    <span class="n">edge</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">new_weight</span>
</span><span id="Supplier-1368"><a href="#Supplier-1368"><span class="linenos">1368</span></a>
</span><span id="Supplier-1369"><a href="#Supplier-1369"><span class="linenos">1369</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">message_to_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="Supplier-1370"><a href="#Supplier-1370"><span class="linenos">1370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-1371"><a href="#Supplier-1371"><span class="linenos">1371</span></a><span class="sd">        Convert warehouse-confirm message to Order object for delivery tracking.</span>
</span><span id="Supplier-1372"><a href="#Supplier-1372"><span class="linenos">1372</span></a><span class="sd">        </span>
</span><span id="Supplier-1373"><a href="#Supplier-1373"><span class="linenos">1373</span></a><span class="sd">        This helper function transforms a FIPA accept-proposal message from a warehouse</span>
</span><span id="Supplier-1374"><a href="#Supplier-1374"><span class="linenos">1374</span></a><span class="sd">        into a structured Order object that can be stored in pending_deliveries</span>
</span><span id="Supplier-1375"><a href="#Supplier-1375"><span class="linenos">1375</span></a><span class="sd">        and assigned to vehicles for transportation.</span>
</span><span id="Supplier-1376"><a href="#Supplier-1376"><span class="linenos">1376</span></a><span class="sd">        </span>
</span><span id="Supplier-1377"><a href="#Supplier-1377"><span class="linenos">1377</span></a><span class="sd">        FIPA Protocol Context:</span>
</span><span id="Supplier-1378"><a href="#Supplier-1378"><span class="linenos">1378</span></a><span class="sd">            - Triggered by: warehouse-confirm message (FIPA accept-proposal)</span>
</span><span id="Supplier-1379"><a href="#Supplier-1379"><span class="linenos">1379</span></a><span class="sd">            - Used by: ReceiveConfirmationOrDenial behaviour</span>
</span><span id="Supplier-1380"><a href="#Supplier-1380"><span class="linenos">1380</span></a><span class="sd">            - Purpose: Create deliverable order from confirmed proposal</span>
</span><span id="Supplier-1381"><a href="#Supplier-1381"><span class="linenos">1381</span></a><span class="sd">        </span>
</span><span id="Supplier-1382"><a href="#Supplier-1382"><span class="linenos">1382</span></a><span class="sd">        Message Parsing:</span>
</span><span id="Supplier-1383"><a href="#Supplier-1383"><span class="linenos">1383</span></a><span class="sd">            Body Format: &quot;{quantity} {product}&quot;</span>
</span><span id="Supplier-1384"><a href="#Supplier-1384"><span class="linenos">1384</span></a><span class="sd">            Example: &quot;100 electronics&quot;</span>
</span><span id="Supplier-1385"><a href="#Supplier-1385"><span class="linenos">1385</span></a><span class="sd">            </span>
</span><span id="Supplier-1386"><a href="#Supplier-1386"><span class="linenos">1386</span></a><span class="sd">            Metadata Extracted:</span>
</span><span id="Supplier-1387"><a href="#Supplier-1387"><span class="linenos">1387</span></a><span class="sd">                - request_id: Unique order identifier</span>
</span><span id="Supplier-1388"><a href="#Supplier-1388"><span class="linenos">1388</span></a><span class="sd">                - node_id: Warehouse&#39;s graph location (delivery destination)</span>
</span><span id="Supplier-1389"><a href="#Supplier-1389"><span class="linenos">1389</span></a><span class="sd">        </span>
</span><span id="Supplier-1390"><a href="#Supplier-1390"><span class="linenos">1390</span></a><span class="sd">        Args:</span>
</span><span id="Supplier-1391"><a href="#Supplier-1391"><span class="linenos">1391</span></a><span class="sd">            msg (Message): warehouse-confirm message with:</span>
</span><span id="Supplier-1392"><a href="#Supplier-1392"><span class="linenos">1392</span></a><span class="sd">                - Body: &quot;{quantity} {product}&quot;</span>
</span><span id="Supplier-1393"><a href="#Supplier-1393"><span class="linenos">1393</span></a><span class="sd">                - Metadata: request_id, node_id</span>
</span><span id="Supplier-1394"><a href="#Supplier-1394"><span class="linenos">1394</span></a><span class="sd">                - Sender: Warehouse JID</span>
</span><span id="Supplier-1395"><a href="#Supplier-1395"><span class="linenos">1395</span></a><span class="sd">        </span>
</span><span id="Supplier-1396"><a href="#Supplier-1396"><span class="linenos">1396</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier-1397"><a href="#Supplier-1397"><span class="linenos">1397</span></a><span class="sd">            Order: Structured order object with:</span>
</span><span id="Supplier-1398"><a href="#Supplier-1398"><span class="linenos">1398</span></a><span class="sd">                - product: Product type</span>
</span><span id="Supplier-1399"><a href="#Supplier-1399"><span class="linenos">1399</span></a><span class="sd">                - quantity: Amount to deliver</span>
</span><span id="Supplier-1400"><a href="#Supplier-1400"><span class="linenos">1400</span></a><span class="sd">                - orderid: Unique identifier</span>
</span><span id="Supplier-1401"><a href="#Supplier-1401"><span class="linenos">1401</span></a><span class="sd">                - sender: Warehouse JID (delivery destination)</span>
</span><span id="Supplier-1402"><a href="#Supplier-1402"><span class="linenos">1402</span></a><span class="sd">                - receiver: Supplier JID (pickup location)</span>
</span><span id="Supplier-1403"><a href="#Supplier-1403"><span class="linenos">1403</span></a><span class="sd">                - sender_location: Warehouse&#39;s graph node</span>
</span><span id="Supplier-1404"><a href="#Supplier-1404"><span class="linenos">1404</span></a><span class="sd">                - receiver_location: Supplier&#39;s graph node</span>
</span><span id="Supplier-1405"><a href="#Supplier-1405"><span class="linenos">1405</span></a><span class="sd">        </span>
</span><span id="Supplier-1406"><a href="#Supplier-1406"><span class="linenos">1406</span></a><span class="sd">        Order Object Structure:</span>
</span><span id="Supplier-1407"><a href="#Supplier-1407"><span class="linenos">1407</span></a><span class="sd">            The Order uses inverted semantics for delivery context:</span>
</span><span id="Supplier-1408"><a href="#Supplier-1408"><span class="linenos">1408</span></a><span class="sd">            - sender = Warehouse (WHERE to deliver)</span>
</span><span id="Supplier-1409"><a href="#Supplier-1409"><span class="linenos">1409</span></a><span class="sd">            - receiver = Supplier (WHERE to pickup)</span>
</span><span id="Supplier-1410"><a href="#Supplier-1410"><span class="linenos">1410</span></a><span class="sd">            - sender_location = Warehouse node (delivery destination)</span>
</span><span id="Supplier-1411"><a href="#Supplier-1411"><span class="linenos">1411</span></a><span class="sd">            - receiver_location = Supplier node (pickup origin)</span>
</span><span id="Supplier-1412"><a href="#Supplier-1412"><span class="linenos">1412</span></a><span class="sd">        </span>
</span><span id="Supplier-1413"><a href="#Supplier-1413"><span class="linenos">1413</span></a><span class="sd">        Example:</span>
</span><span id="Supplier-1414"><a href="#Supplier-1414"><span class="linenos">1414</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1415"><a href="#Supplier-1415"><span class="linenos">1415</span></a><span class="sd">            Input Message (warehouse-confirm):</span>
</span><span id="Supplier-1416"><a href="#Supplier-1416"><span class="linenos">1416</span></a><span class="sd">                Body: &quot;100 electronics&quot;</span>
</span><span id="Supplier-1417"><a href="#Supplier-1417"><span class="linenos">1417</span></a><span class="sd">                Metadata:</span>
</span><span id="Supplier-1418"><a href="#Supplier-1418"><span class="linenos">1418</span></a><span class="sd">                    - request_id: &quot;301000000&quot;</span>
</span><span id="Supplier-1419"><a href="#Supplier-1419"><span class="linenos">1419</span></a><span class="sd">                    - node_id: &quot;10&quot;</span>
</span><span id="Supplier-1420"><a href="#Supplier-1420"><span class="linenos">1420</span></a><span class="sd">                Sender: &quot;warehouse1@localhost&quot;</span>
</span><span id="Supplier-1421"><a href="#Supplier-1421"><span class="linenos">1421</span></a><span class="sd">            </span>
</span><span id="Supplier-1422"><a href="#Supplier-1422"><span class="linenos">1422</span></a><span class="sd">            Supplier: &quot;supplier1@localhost&quot; at node 20</span>
</span><span id="Supplier-1423"><a href="#Supplier-1423"><span class="linenos">1423</span></a><span class="sd">            </span>
</span><span id="Supplier-1424"><a href="#Supplier-1424"><span class="linenos">1424</span></a><span class="sd">            Output Order:</span>
</span><span id="Supplier-1425"><a href="#Supplier-1425"><span class="linenos">1425</span></a><span class="sd">                product: &quot;electronics&quot;</span>
</span><span id="Supplier-1426"><a href="#Supplier-1426"><span class="linenos">1426</span></a><span class="sd">                quantity: 100</span>
</span><span id="Supplier-1427"><a href="#Supplier-1427"><span class="linenos">1427</span></a><span class="sd">                orderid: &quot;301000000&quot;</span>
</span><span id="Supplier-1428"><a href="#Supplier-1428"><span class="linenos">1428</span></a><span class="sd">                sender: &quot;warehouse1@localhost&quot;</span>
</span><span id="Supplier-1429"><a href="#Supplier-1429"><span class="linenos">1429</span></a><span class="sd">                receiver: &quot;supplier1@localhost&quot;</span>
</span><span id="Supplier-1430"><a href="#Supplier-1430"><span class="linenos">1430</span></a><span class="sd">                sender_location: 10 (warehouse node)</span>
</span><span id="Supplier-1431"><a href="#Supplier-1431"><span class="linenos">1431</span></a><span class="sd">                receiver_location: 20 (supplier node)</span>
</span><span id="Supplier-1432"><a href="#Supplier-1432"><span class="linenos">1432</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1433"><a href="#Supplier-1433"><span class="linenos">1433</span></a><span class="sd">        </span>
</span><span id="Supplier-1434"><a href="#Supplier-1434"><span class="linenos">1434</span></a><span class="sd">        Integration:</span>
</span><span id="Supplier-1435"><a href="#Supplier-1435"><span class="linenos">1435</span></a><span class="sd">            Created Order is added to self.pending_deliveries[order_id]</span>
</span><span id="Supplier-1436"><a href="#Supplier-1436"><span class="linenos">1436</span></a><span class="sd">            and passed to AssignVehicle behaviour for transportation.</span>
</span><span id="Supplier-1437"><a href="#Supplier-1437"><span class="linenos">1437</span></a><span class="sd">        </span>
</span><span id="Supplier-1438"><a href="#Supplier-1438"><span class="linenos">1438</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-1439"><a href="#Supplier-1439"><span class="linenos">1439</span></a><span class="sd">            This mirrors the message_to_order function in warehouse.py but</span>
</span><span id="Supplier-1440"><a href="#Supplier-1440"><span class="linenos">1440</span></a><span class="sd">            processes warehouse-confirm instead of store-confirm messages.</span>
</span><span id="Supplier-1441"><a href="#Supplier-1441"><span class="linenos">1441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1442"><a href="#Supplier-1442"><span class="linenos">1442</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span>
</span><span id="Supplier-1443"><a href="#Supplier-1443"><span class="linenos">1443</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier-1444"><a href="#Supplier-1444"><span class="linenos">1444</span></a>        <span class="n">quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier-1445"><a href="#Supplier-1445"><span class="linenos">1445</span></a>        <span class="n">product</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier-1446"><a href="#Supplier-1446"><span class="linenos">1446</span></a>        
</span><span id="Supplier-1447"><a href="#Supplier-1447"><span class="linenos">1447</span></a>        <span class="n">order_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">)</span>
</span><span id="Supplier-1448"><a href="#Supplier-1448"><span class="linenos">1448</span></a>        <span class="n">sender</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># Warehouse JID</span>
</span><span id="Supplier-1449"><a href="#Supplier-1449"><span class="linenos">1449</span></a>        <span class="n">receiver</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>  <span class="c1"># Supplier JID</span>
</span><span id="Supplier-1450"><a href="#Supplier-1450"><span class="linenos">1450</span></a>        <span class="n">warehouse_location</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">))</span>
</span><span id="Supplier-1451"><a href="#Supplier-1451"><span class="linenos">1451</span></a>        <span class="n">supplier_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span>
</span><span id="Supplier-1452"><a href="#Supplier-1452"><span class="linenos">1452</span></a>        <span class="n">tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_tick</span>
</span><span id="Supplier-1453"><a href="#Supplier-1453"><span class="linenos">1453</span></a>        
</span><span id="Supplier-1454"><a href="#Supplier-1454"><span class="linenos">1454</span></a>        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
</span><span id="Supplier-1455"><a href="#Supplier-1455"><span class="linenos">1455</span></a>            <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span>
</span><span id="Supplier-1456"><a href="#Supplier-1456"><span class="linenos">1456</span></a>            <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
</span><span id="Supplier-1457"><a href="#Supplier-1457"><span class="linenos">1457</span></a>            <span class="n">orderid</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
</span><span id="Supplier-1458"><a href="#Supplier-1458"><span class="linenos">1458</span></a>            <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span>
</span><span id="Supplier-1459"><a href="#Supplier-1459"><span class="linenos">1459</span></a>            <span class="n">receiver</span><span class="o">=</span><span class="n">receiver</span>
</span><span id="Supplier-1460"><a href="#Supplier-1460"><span class="linenos">1460</span></a>        <span class="p">)</span>
</span><span id="Supplier-1461"><a href="#Supplier-1461"><span class="linenos">1461</span></a>        
</span><span id="Supplier-1462"><a href="#Supplier-1462"><span class="linenos">1462</span></a>        <span class="c1"># Set locations</span>
</span><span id="Supplier-1463"><a href="#Supplier-1463"><span class="linenos">1463</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span> <span class="o">=</span> <span class="n">warehouse_location</span>  <span class="c1"># Warehouse location</span>
</span><span id="Supplier-1464"><a href="#Supplier-1464"><span class="linenos">1464</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span> <span class="o">=</span> <span class="n">supplier_location</span>  <span class="c1"># Supplier location</span>
</span><span id="Supplier-1465"><a href="#Supplier-1465"><span class="linenos">1465</span></a>        
</span><span id="Supplier-1466"><a href="#Supplier-1466"><span class="linenos">1466</span></a>        <span class="k">return</span> <span class="n">order</span>
</span><span id="Supplier-1467"><a href="#Supplier-1467"><span class="linenos">1467</span></a>    
</span><span id="Supplier-1468"><a href="#Supplier-1468"><span class="linenos">1468</span></a>    
</span><span id="Supplier-1469"><a href="#Supplier-1469"><span class="linenos">1469</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dict_to_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="Supplier-1470"><a href="#Supplier-1470"><span class="linenos">1470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-1471"><a href="#Supplier-1471"><span class="linenos">1471</span></a><span class="sd">        Convert dictionary data to Order object (for vehicle communication).</span>
</span><span id="Supplier-1472"><a href="#Supplier-1472"><span class="linenos">1472</span></a><span class="sd">        </span>
</span><span id="Supplier-1473"><a href="#Supplier-1473"><span class="linenos">1473</span></a><span class="sd">        This helper function reconstructs an Order object from dictionary data,</span>
</span><span id="Supplier-1474"><a href="#Supplier-1474"><span class="linenos">1474</span></a><span class="sd">        typically received from vehicle messages (vehicle-pickup). It&#39;s the</span>
</span><span id="Supplier-1475"><a href="#Supplier-1475"><span class="linenos">1475</span></a><span class="sd">        inverse operation of serializing an order to JSON.</span>
</span><span id="Supplier-1476"><a href="#Supplier-1476"><span class="linenos">1476</span></a><span class="sd">        </span>
</span><span id="Supplier-1477"><a href="#Supplier-1477"><span class="linenos">1477</span></a><span class="sd">        Args:</span>
</span><span id="Supplier-1478"><a href="#Supplier-1478"><span class="linenos">1478</span></a><span class="sd">            data (dict): Dictionary containing order information with keys:</span>
</span><span id="Supplier-1479"><a href="#Supplier-1479"><span class="linenos">1479</span></a><span class="sd">                - product (str): Product type</span>
</span><span id="Supplier-1480"><a href="#Supplier-1480"><span class="linenos">1480</span></a><span class="sd">                - quantity (int): Amount to deliver</span>
</span><span id="Supplier-1481"><a href="#Supplier-1481"><span class="linenos">1481</span></a><span class="sd">                - orderid (int): Unique order identifier</span>
</span><span id="Supplier-1482"><a href="#Supplier-1482"><span class="linenos">1482</span></a><span class="sd">                - sender (str): Warehouse JID (delivery destination)</span>
</span><span id="Supplier-1483"><a href="#Supplier-1483"><span class="linenos">1483</span></a><span class="sd">                - receiver (str): Supplier JID (pickup location)</span>
</span><span id="Supplier-1484"><a href="#Supplier-1484"><span class="linenos">1484</span></a><span class="sd">                - sender_location (int, optional): Warehouse graph node</span>
</span><span id="Supplier-1485"><a href="#Supplier-1485"><span class="linenos">1485</span></a><span class="sd">                - receiver_location (int, optional): Supplier graph node</span>
</span><span id="Supplier-1486"><a href="#Supplier-1486"><span class="linenos">1486</span></a><span class="sd">        </span>
</span><span id="Supplier-1487"><a href="#Supplier-1487"><span class="linenos">1487</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier-1488"><a href="#Supplier-1488"><span class="linenos">1488</span></a><span class="sd">            Order: Reconstructed Order object with all attributes populated.</span>
</span><span id="Supplier-1489"><a href="#Supplier-1489"><span class="linenos">1489</span></a><span class="sd">        </span>
</span><span id="Supplier-1490"><a href="#Supplier-1490"><span class="linenos">1490</span></a><span class="sd">        Example:</span>
</span><span id="Supplier-1491"><a href="#Supplier-1491"><span class="linenos">1491</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1492"><a href="#Supplier-1492"><span class="linenos">1492</span></a><span class="sd">            Input Dictionary:</span>
</span><span id="Supplier-1493"><a href="#Supplier-1493"><span class="linenos">1493</span></a><span class="sd">            {</span>
</span><span id="Supplier-1494"><a href="#Supplier-1494"><span class="linenos">1494</span></a><span class="sd">                &quot;product&quot;: &quot;electronics&quot;,</span>
</span><span id="Supplier-1495"><a href="#Supplier-1495"><span class="linenos">1495</span></a><span class="sd">                &quot;quantity&quot;: 100,</span>
</span><span id="Supplier-1496"><a href="#Supplier-1496"><span class="linenos">1496</span></a><span class="sd">                &quot;orderid&quot;: 301000000,</span>
</span><span id="Supplier-1497"><a href="#Supplier-1497"><span class="linenos">1497</span></a><span class="sd">                &quot;sender&quot;: &quot;warehouse1@localhost&quot;,</span>
</span><span id="Supplier-1498"><a href="#Supplier-1498"><span class="linenos">1498</span></a><span class="sd">                &quot;receiver&quot;: &quot;supplier1@localhost&quot;,</span>
</span><span id="Supplier-1499"><a href="#Supplier-1499"><span class="linenos">1499</span></a><span class="sd">                &quot;sender_location&quot;: 10,</span>
</span><span id="Supplier-1500"><a href="#Supplier-1500"><span class="linenos">1500</span></a><span class="sd">                &quot;receiver_location&quot;: 20</span>
</span><span id="Supplier-1501"><a href="#Supplier-1501"><span class="linenos">1501</span></a><span class="sd">            }</span>
</span><span id="Supplier-1502"><a href="#Supplier-1502"><span class="linenos">1502</span></a><span class="sd">            </span>
</span><span id="Supplier-1503"><a href="#Supplier-1503"><span class="linenos">1503</span></a><span class="sd">            Output Order:</span>
</span><span id="Supplier-1504"><a href="#Supplier-1504"><span class="linenos">1504</span></a><span class="sd">                order.product = &quot;electronics&quot;</span>
</span><span id="Supplier-1505"><a href="#Supplier-1505"><span class="linenos">1505</span></a><span class="sd">                order.quantity = 100</span>
</span><span id="Supplier-1506"><a href="#Supplier-1506"><span class="linenos">1506</span></a><span class="sd">                order.orderid = 301000000</span>
</span><span id="Supplier-1507"><a href="#Supplier-1507"><span class="linenos">1507</span></a><span class="sd">                order.sender = &quot;warehouse1@localhost&quot;</span>
</span><span id="Supplier-1508"><a href="#Supplier-1508"><span class="linenos">1508</span></a><span class="sd">                order.receiver = &quot;supplier1@localhost&quot;</span>
</span><span id="Supplier-1509"><a href="#Supplier-1509"><span class="linenos">1509</span></a><span class="sd">                order.sender_location = 10</span>
</span><span id="Supplier-1510"><a href="#Supplier-1510"><span class="linenos">1510</span></a><span class="sd">                order.receiver_location = 20</span>
</span><span id="Supplier-1511"><a href="#Supplier-1511"><span class="linenos">1511</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1512"><a href="#Supplier-1512"><span class="linenos">1512</span></a><span class="sd">        </span>
</span><span id="Supplier-1513"><a href="#Supplier-1513"><span class="linenos">1513</span></a><span class="sd">        Use Cases:</span>
</span><span id="Supplier-1514"><a href="#Supplier-1514"><span class="linenos">1514</span></a><span class="sd">            - Parsing vehicle-pickup messages</span>
</span><span id="Supplier-1515"><a href="#Supplier-1515"><span class="linenos">1515</span></a><span class="sd">            - Reconstructing orders from JSON body</span>
</span><span id="Supplier-1516"><a href="#Supplier-1516"><span class="linenos">1516</span></a><span class="sd">            - Vehicle coordination communication</span>
</span><span id="Supplier-1517"><a href="#Supplier-1517"><span class="linenos">1517</span></a><span class="sd">        </span>
</span><span id="Supplier-1518"><a href="#Supplier-1518"><span class="linenos">1518</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-1519"><a href="#Supplier-1519"><span class="linenos">1519</span></a><span class="sd">            Uses safe dictionary access (.get()) for location fields to handle</span>
</span><span id="Supplier-1520"><a href="#Supplier-1520"><span class="linenos">1520</span></a><span class="sd">            cases where location data might not be present.</span>
</span><span id="Supplier-1521"><a href="#Supplier-1521"><span class="linenos">1521</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1522"><a href="#Supplier-1522"><span class="linenos">1522</span></a>        <span class="n">order</span> <span class="o">=</span>  <span class="n">Order</span><span class="p">(</span>
</span><span id="Supplier-1523"><a href="#Supplier-1523"><span class="linenos">1523</span></a>            <span class="n">product</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">],</span>
</span><span id="Supplier-1524"><a href="#Supplier-1524"><span class="linenos">1524</span></a>            <span class="n">quantity</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">],</span>
</span><span id="Supplier-1525"><a href="#Supplier-1525"><span class="linenos">1525</span></a>            <span class="n">orderid</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;orderid&quot;</span><span class="p">],</span>
</span><span id="Supplier-1526"><a href="#Supplier-1526"><span class="linenos">1526</span></a>            <span class="n">sender</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">],</span>
</span><span id="Supplier-1527"><a href="#Supplier-1527"><span class="linenos">1527</span></a>            <span class="n">receiver</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;receiver&quot;</span><span class="p">]</span>
</span><span id="Supplier-1528"><a href="#Supplier-1528"><span class="linenos">1528</span></a>        <span class="p">)</span>
</span><span id="Supplier-1529"><a href="#Supplier-1529"><span class="linenos">1529</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sender_location&quot;</span><span class="p">)</span>
</span><span id="Supplier-1530"><a href="#Supplier-1530"><span class="linenos">1530</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;receiver_location&quot;</span><span class="p">)</span>
</span><span id="Supplier-1531"><a href="#Supplier-1531"><span class="linenos">1531</span></a>        <span class="k">return</span> <span class="n">order</span>
</span><span id="Supplier-1532"><a href="#Supplier-1532"><span class="linenos">1532</span></a>    
</span><span id="Supplier-1533"><a href="#Supplier-1533"><span class="linenos">1533</span></a>    <span class="c1"># ------------------------------------------</span>
</span><span id="Supplier-1534"><a href="#Supplier-1534"><span class="linenos">1534</span></a>    
</span><span id="Supplier-1535"><a href="#Supplier-1535"><span class="linenos">1535</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="nb">map</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">node_id</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">5222</span><span class="p">,</span> <span class="n">verify_security</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">contact_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Supplier-1536"><a href="#Supplier-1536"><span class="linenos">1536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-1537"><a href="#Supplier-1537"><span class="linenos">1537</span></a><span class="sd">        Initialize the Supplier agent with connection parameters and world state.</span>
</span><span id="Supplier-1538"><a href="#Supplier-1538"><span class="linenos">1538</span></a><span class="sd">        </span>
</span><span id="Supplier-1539"><a href="#Supplier-1539"><span class="linenos">1539</span></a><span class="sd">        The constructor configures the supplier&#39;s identity, location, and initial</span>
</span><span id="Supplier-1540"><a href="#Supplier-1540"><span class="linenos">1540</span></a><span class="sd">        state. It implements the ID encoding system for generating unique request</span>
</span><span id="Supplier-1541"><a href="#Supplier-1541"><span class="linenos">1541</span></a><span class="sd">        identifiers compatible with the FIPA Contract Net Protocol.</span>
</span><span id="Supplier-1542"><a href="#Supplier-1542"><span class="linenos">1542</span></a><span class="sd">        </span>
</span><span id="Supplier-1543"><a href="#Supplier-1543"><span class="linenos">1543</span></a><span class="sd">        ID Encoding System:</span>
</span><span id="Supplier-1544"><a href="#Supplier-1544"><span class="linenos">1544</span></a><span class="sd">            Formula: `agent_type * 100_000_000 + instance_id * 1_000_000 + counter`</span>
</span><span id="Supplier-1545"><a href="#Supplier-1545"><span class="linenos">1545</span></a><span class="sd">            - Agent Type Code: 3 (for Supplier agents)</span>
</span><span id="Supplier-1546"><a href="#Supplier-1546"><span class="linenos">1546</span></a><span class="sd">            - Instance ID: Extracted from JID (e.g., &quot;supplier2&quot; -&gt; 2)</span>
</span><span id="Supplier-1547"><a href="#Supplier-1547"><span class="linenos">1547</span></a><span class="sd">            - Base ID Calculation: `3 * 100_000_000 + instance_id * 1_000_000`</span>
</span><span id="Supplier-1548"><a href="#Supplier-1548"><span class="linenos">1548</span></a><span class="sd">            </span>
</span><span id="Supplier-1549"><a href="#Supplier-1549"><span class="linenos">1549</span></a><span class="sd">            Examples:</span>
</span><span id="Supplier-1550"><a href="#Supplier-1550"><span class="linenos">1550</span></a><span class="sd">                - supplier1: base = 301_000_000 (first request: 301_000_000)</span>
</span><span id="Supplier-1551"><a href="#Supplier-1551"><span class="linenos">1551</span></a><span class="sd">                - supplier2: base = 302_000_000 (first request: 302_000_000)</span>
</span><span id="Supplier-1552"><a href="#Supplier-1552"><span class="linenos">1552</span></a><span class="sd">                - supplier5: base = 305_000_000 (first request: 305_000_000)</span>
</span><span id="Supplier-1553"><a href="#Supplier-1553"><span class="linenos">1553</span></a><span class="sd">            </span>
</span><span id="Supplier-1554"><a href="#Supplier-1554"><span class="linenos">1554</span></a><span class="sd">            This encoding allows agents to identify:</span>
</span><span id="Supplier-1555"><a href="#Supplier-1555"><span class="linenos">1555</span></a><span class="sd">                1. What type of agent created the request (300M range = supplier)</span>
</span><span id="Supplier-1556"><a href="#Supplier-1556"><span class="linenos">1556</span></a><span class="sd">                2. Which specific supplier instance (next 1M range)</span>
</span><span id="Supplier-1557"><a href="#Supplier-1557"><span class="linenos">1557</span></a><span class="sd">                3. Which request in sequence (counter increments)</span>
</span><span id="Supplier-1558"><a href="#Supplier-1558"><span class="linenos">1558</span></a><span class="sd">        </span>
</span><span id="Supplier-1559"><a href="#Supplier-1559"><span class="linenos">1559</span></a><span class="sd">        Args:</span>
</span><span id="Supplier-1560"><a href="#Supplier-1560"><span class="linenos">1560</span></a><span class="sd">            jid (str): Jabber ID for XMPP communication (e.g., &quot;supplier1@localhost&quot;).</span>
</span><span id="Supplier-1561"><a href="#Supplier-1561"><span class="linenos">1561</span></a><span class="sd">            password (str): Authentication password for XMPP server.</span>
</span><span id="Supplier-1562"><a href="#Supplier-1562"><span class="linenos">1562</span></a><span class="sd">            map (Graph): Reference to the world graph for pathfinding and locations.</span>
</span><span id="Supplier-1563"><a href="#Supplier-1563"><span class="linenos">1563</span></a><span class="sd">            node_id (int): Graph node representing the supplier&#39;s physical location.</span>
</span><span id="Supplier-1564"><a href="#Supplier-1564"><span class="linenos">1564</span></a><span class="sd">            port (int, optional): XMPP server port. Defaults to 5222.</span>
</span><span id="Supplier-1565"><a href="#Supplier-1565"><span class="linenos">1565</span></a><span class="sd">            verify_security (bool, optional): Enable SSL/TLS verification. Defaults to False.</span>
</span><span id="Supplier-1566"><a href="#Supplier-1566"><span class="linenos">1566</span></a><span class="sd">            contact_list (list[str], optional): JIDs of warehouses and vehicles for presence</span>
</span><span id="Supplier-1567"><a href="#Supplier-1567"><span class="linenos">1567</span></a><span class="sd">                subscription. Defaults to empty list.</span>
</span><span id="Supplier-1568"><a href="#Supplier-1568"><span class="linenos">1568</span></a><span class="sd">            verbose (bool, optional): Enable detailed debug logging. Defaults to False.</span>
</span><span id="Supplier-1569"><a href="#Supplier-1569"><span class="linenos">1569</span></a><span class="sd">        </span>
</span><span id="Supplier-1570"><a href="#Supplier-1570"><span class="linenos">1570</span></a><span class="sd">        Attributes Initialized:</span>
</span><span id="Supplier-1571"><a href="#Supplier-1571"><span class="linenos">1571</span></a><span class="sd">            Core Identity:</span>
</span><span id="Supplier-1572"><a href="#Supplier-1572"><span class="linenos">1572</span></a><span class="sd">                - node_id: Supplier location on graph</span>
</span><span id="Supplier-1573"><a href="#Supplier-1573"><span class="linenos">1573</span></a><span class="sd">                - map: World graph reference</span>
</span><span id="Supplier-1574"><a href="#Supplier-1574"><span class="linenos">1574</span></a><span class="sd">                - contact_list: Agents for presence subscription</span>
</span><span id="Supplier-1575"><a href="#Supplier-1575"><span class="linenos">1575</span></a><span class="sd">                - verbose: Debug output flag</span>
</span><span id="Supplier-1576"><a href="#Supplier-1576"><span class="linenos">1576</span></a><span class="sd">            </span>
</span><span id="Supplier-1577"><a href="#Supplier-1577"><span class="linenos">1577</span></a><span class="sd">            Position (Legacy):</span>
</span><span id="Supplier-1578"><a href="#Supplier-1578"><span class="linenos">1578</span></a><span class="sd">                - pos_x: X coordinate from node (TODO: marked for removal)</span>
</span><span id="Supplier-1579"><a href="#Supplier-1579"><span class="linenos">1579</span></a><span class="sd">                - pos_y: Y coordinate from node (TODO: marked for removal)</span>
</span><span id="Supplier-1580"><a href="#Supplier-1580"><span class="linenos">1580</span></a><span class="sd">            </span>
</span><span id="Supplier-1581"><a href="#Supplier-1581"><span class="linenos">1581</span></a><span class="sd">            ID Encoding:</span>
</span><span id="Supplier-1582"><a href="#Supplier-1582"><span class="linenos">1582</span></a><span class="sd">                - id_base: Base value for generating unique request IDs</span>
</span><span id="Supplier-1583"><a href="#Supplier-1583"><span class="linenos">1583</span></a><span class="sd">        </span>
</span><span id="Supplier-1584"><a href="#Supplier-1584"><span class="linenos">1584</span></a><span class="sd">        Example:</span>
</span><span id="Supplier-1585"><a href="#Supplier-1585"><span class="linenos">1585</span></a><span class="sd">            ```python</span>
</span><span id="Supplier-1586"><a href="#Supplier-1586"><span class="linenos">1586</span></a><span class="sd">            supplier = Supplier(</span>
</span><span id="Supplier-1587"><a href="#Supplier-1587"><span class="linenos">1587</span></a><span class="sd">                jid=&quot;supplier1@localhost&quot;,</span>
</span><span id="Supplier-1588"><a href="#Supplier-1588"><span class="linenos">1588</span></a><span class="sd">                password=&quot;password123&quot;,</span>
</span><span id="Supplier-1589"><a href="#Supplier-1589"><span class="linenos">1589</span></a><span class="sd">                map=world_graph,</span>
</span><span id="Supplier-1590"><a href="#Supplier-1590"><span class="linenos">1590</span></a><span class="sd">                node_id=20,</span>
</span><span id="Supplier-1591"><a href="#Supplier-1591"><span class="linenos">1591</span></a><span class="sd">                contact_list=[</span>
</span><span id="Supplier-1592"><a href="#Supplier-1592"><span class="linenos">1592</span></a><span class="sd">                    &quot;warehouse1@localhost&quot;,</span>
</span><span id="Supplier-1593"><a href="#Supplier-1593"><span class="linenos">1593</span></a><span class="sd">                    &quot;warehouse2@localhost&quot;,</span>
</span><span id="Supplier-1594"><a href="#Supplier-1594"><span class="linenos">1594</span></a><span class="sd">                    &quot;vehicle1@localhost&quot;</span>
</span><span id="Supplier-1595"><a href="#Supplier-1595"><span class="linenos">1595</span></a><span class="sd">                ],</span>
</span><span id="Supplier-1596"><a href="#Supplier-1596"><span class="linenos">1596</span></a><span class="sd">                verbose=True</span>
</span><span id="Supplier-1597"><a href="#Supplier-1597"><span class="linenos">1597</span></a><span class="sd">            )</span>
</span><span id="Supplier-1598"><a href="#Supplier-1598"><span class="linenos">1598</span></a><span class="sd">            # ID base calculated: 3 * 100_000_000 + 1 * 1_000_000 = 301_000_000</span>
</span><span id="Supplier-1599"><a href="#Supplier-1599"><span class="linenos">1599</span></a><span class="sd">            # First request ID will be: 301_000_000</span>
</span><span id="Supplier-1600"><a href="#Supplier-1600"><span class="linenos">1600</span></a><span class="sd">            # Second request ID will be: 301_000_001</span>
</span><span id="Supplier-1601"><a href="#Supplier-1601"><span class="linenos">1601</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1602"><a href="#Supplier-1602"><span class="linenos">1602</span></a><span class="sd">        </span>
</span><span id="Supplier-1603"><a href="#Supplier-1603"><span class="linenos">1603</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-1604"><a href="#Supplier-1604"><span class="linenos">1604</span></a><span class="sd">            The constructor only initializes essential attributes. Most supplier</span>
</span><span id="Supplier-1605"><a href="#Supplier-1605"><span class="linenos">1605</span></a><span class="sd">            state (total_supplied, pending_deliveries, behaviours) is configured</span>
</span><span id="Supplier-1606"><a href="#Supplier-1606"><span class="linenos">1606</span></a><span class="sd">            in the setup() method which runs after the agent connects to the XMPP server.</span>
</span><span id="Supplier-1607"><a href="#Supplier-1607"><span class="linenos">1607</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1608"><a href="#Supplier-1608"><span class="linenos">1608</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">verify_security</span><span class="p">)</span>
</span><span id="Supplier-1609"><a href="#Supplier-1609"><span class="linenos">1609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="Supplier-1610"><a href="#Supplier-1610"><span class="linenos">1610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="p">:</span> <span class="n">Graph</span> <span class="o">=</span> <span class="nb">map</span>
</span><span id="Supplier-1611"><a href="#Supplier-1611"><span class="linenos">1611</span></a>        <span class="n">node</span> <span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span> <span class="c1"># TODO -- remove</span>
</span><span id="Supplier-1612"><a href="#Supplier-1612"><span class="linenos">1612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos_x</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span> <span class="c1"># TODO -- remove</span>
</span><span id="Supplier-1613"><a href="#Supplier-1613"><span class="linenos">1613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos_y</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span> <span class="c1"># TODO -- remove</span>
</span><span id="Supplier-1614"><a href="#Supplier-1614"><span class="linenos">1614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">contact_list</span> <span class="o">=</span> <span class="n">contact_list</span>
</span><span id="Supplier-1615"><a href="#Supplier-1615"><span class="linenos">1615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="Supplier-1616"><a href="#Supplier-1616"><span class="linenos">1616</span></a>        <span class="c1"># Extract instance number from JID for ID encoding (e.g., &quot;supplier1@localhost&quot; -&gt; 1)</span>
</span><span id="Supplier-1617"><a href="#Supplier-1617"><span class="linenos">1617</span></a>        <span class="n">jid_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Supplier-1618"><a href="#Supplier-1618"><span class="linenos">1618</span></a>        <span class="n">instance_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">jid_name</span><span class="p">)))</span>
</span><span id="Supplier-1619"><a href="#Supplier-1619"><span class="linenos">1619</span></a>        
</span><span id="Supplier-1620"><a href="#Supplier-1620"><span class="linenos">1620</span></a>        <span class="c1"># Calculate ID base: Supplier type code = 3</span>
</span><span id="Supplier-1621"><a href="#Supplier-1621"><span class="linenos">1621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id_base</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">100_000_000</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">instance_id</span> <span class="o">*</span> <span class="mi">1_000_000</span><span class="p">)</span>
</span><span id="Supplier-1622"><a href="#Supplier-1622"><span class="linenos">1622</span></a>    
</span><span id="Supplier-1623"><a href="#Supplier-1623"><span class="linenos">1623</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier-1624"><a href="#Supplier-1624"><span class="linenos">1624</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier-1625"><a href="#Supplier-1625"><span class="linenos">1625</span></a><span class="sd">        Configure supplier state and register all FIPA protocol behaviours.</span>
</span><span id="Supplier-1626"><a href="#Supplier-1626"><span class="linenos">1626</span></a><span class="sd">        </span>
</span><span id="Supplier-1627"><a href="#Supplier-1627"><span class="linenos">1627</span></a><span class="sd">        This method is automatically called by SPADE after the agent successfully</span>
</span><span id="Supplier-1628"><a href="#Supplier-1628"><span class="linenos">1628</span></a><span class="sd">        connects to the XMPP server. It initializes the supplier&#39;s operational</span>
</span><span id="Supplier-1629"><a href="#Supplier-1629"><span class="linenos">1629</span></a><span class="sd">        state and registers all cyclic behaviours needed for the FIPA Contract Net</span>
</span><span id="Supplier-1630"><a href="#Supplier-1630"><span class="linenos">1630</span></a><span class="sd">        Protocol implementation as a participant.</span>
</span><span id="Supplier-1631"><a href="#Supplier-1631"><span class="linenos">1631</span></a><span class="sd">        </span>
</span><span id="Supplier-1632"><a href="#Supplier-1632"><span class="linenos">1632</span></a><span class="sd">        Setup Process:</span>
</span><span id="Supplier-1633"><a href="#Supplier-1633"><span class="linenos">1633</span></a><span class="sd">        </span>
</span><span id="Supplier-1634"><a href="#Supplier-1634"><span class="linenos">1634</span></a><span class="sd">            **Phase 1: Presence Management**</span>
</span><span id="Supplier-1635"><a href="#Supplier-1635"><span class="linenos">1635</span></a><span class="sd">                - Enable auto-approval of presence subscriptions</span>
</span><span id="Supplier-1636"><a href="#Supplier-1636"><span class="linenos">1636</span></a><span class="sd">                - Subscribe to all contacts (warehouses and vehicles)</span>
</span><span id="Supplier-1637"><a href="#Supplier-1637"><span class="linenos">1637</span></a><span class="sd">                - Enables presence-based availability checking</span>
</span><span id="Supplier-1638"><a href="#Supplier-1638"><span class="linenos">1638</span></a><span class="sd">            </span>
</span><span id="Supplier-1639"><a href="#Supplier-1639"><span class="linenos">1639</span></a><span class="sd">            **Phase 2: State Initialization**</span>
</span><span id="Supplier-1640"><a href="#Supplier-1640"><span class="linenos">1640</span></a><span class="sd">                - total_supplied: Dictionary tracking cumulative supply per product</span>
</span><span id="Supplier-1641"><a href="#Supplier-1641"><span class="linenos">1641</span></a><span class="sd">                - current_tick: Simulation time (starts at 0)</span>
</span><span id="Supplier-1642"><a href="#Supplier-1642"><span class="linenos">1642</span></a><span class="sd">                - pending_deliveries: Orders confirmed but not picked up</span>
</span><span id="Supplier-1643"><a href="#Supplier-1643"><span class="linenos">1643</span></a><span class="sd">                - vehicle_proposals: Vehicle delivery quotes per order</span>
</span><span id="Supplier-1644"><a href="#Supplier-1644"><span class="linenos">1644</span></a><span class="sd">                - vehicles: List of vehicle JIDs (populated dynamically)</span>
</span><span id="Supplier-1645"><a href="#Supplier-1645"><span class="linenos">1645</span></a><span class="sd">                - presence_infos: Vehicle availability cache</span>
</span><span id="Supplier-1646"><a href="#Supplier-1646"><span class="linenos">1646</span></a><span class="sd">            </span>
</span><span id="Supplier-1647"><a href="#Supplier-1647"><span class="linenos">1647</span></a><span class="sd">            **Phase 3: Behaviour Registration**</span>
</span><span id="Supplier-1648"><a href="#Supplier-1648"><span class="linenos">1648</span></a><span class="sd">                1. ReceiveBuyRequest (Warehouse Interaction - FIPA Participant)</span>
</span><span id="Supplier-1649"><a href="#Supplier-1649"><span class="linenos">1649</span></a><span class="sd">                2. ReceiveVehicleProposals (Vehicle Coordination - Proposal Collection)</span>
</span><span id="Supplier-1650"><a href="#Supplier-1650"><span class="linenos">1650</span></a><span class="sd">                3. ReceiveVehicleArrival (Vehicle Coordination - Pickup Handling)</span>
</span><span id="Supplier-1651"><a href="#Supplier-1651"><span class="linenos">1651</span></a><span class="sd">        </span>
</span><span id="Supplier-1652"><a href="#Supplier-1652"><span class="linenos">1652</span></a><span class="sd">        Behaviour Registration Details:</span>
</span><span id="Supplier-1653"><a href="#Supplier-1653"><span class="linenos">1653</span></a><span class="sd">        </span>
</span><span id="Supplier-1654"><a href="#Supplier-1654"><span class="linenos">1654</span></a><span class="sd">            **ReceiveBuyRequest** (CyclicBehaviour):</span>
</span><span id="Supplier-1655"><a href="#Supplier-1655"><span class="linenos">1655</span></a><span class="sd">                - Template: performative = &quot;warehouse-buy&quot;</span>
</span><span id="Supplier-1656"><a href="#Supplier-1656"><span class="linenos">1656</span></a><span class="sd">                - Purpose: Listen for warehouse purchase requests (FIPA CFP)</span>
</span><span id="Supplier-1657"><a href="#Supplier-1657"><span class="linenos">1657</span></a><span class="sd">                - Role: FIPA Participant (responds to warehouses)</span>
</span><span id="Supplier-1658"><a href="#Supplier-1658"><span class="linenos">1658</span></a><span class="sd">                - Action: Always accepts (infinite stock)</span>
</span><span id="Supplier-1659"><a href="#Supplier-1659"><span class="linenos">1659</span></a><span class="sd">            </span>
</span><span id="Supplier-1660"><a href="#Supplier-1660"><span class="linenos">1660</span></a><span class="sd">            **ReceiveVehicleProposals** (CyclicBehaviour):</span>
</span><span id="Supplier-1661"><a href="#Supplier-1661"><span class="linenos">1661</span></a><span class="sd">                - Template: performative = &quot;vehicle-proposal&quot;</span>
</span><span id="Supplier-1662"><a href="#Supplier-1662"><span class="linenos">1662</span></a><span class="sd">                - Purpose: Collect vehicle delivery quotes</span>
</span><span id="Supplier-1663"><a href="#Supplier-1663"><span class="linenos">1663</span></a><span class="sd">                - Role: Coordinator for vehicle selection</span>
</span><span id="Supplier-1664"><a href="#Supplier-1664"><span class="linenos">1664</span></a><span class="sd">                - Action: Store proposals in vehicle_proposals dictionary</span>
</span><span id="Supplier-1665"><a href="#Supplier-1665"><span class="linenos">1665</span></a><span class="sd">            </span>
</span><span id="Supplier-1666"><a href="#Supplier-1666"><span class="linenos">1666</span></a><span class="sd">            **ReceiveVehicleArrival** (CyclicBehaviour):</span>
</span><span id="Supplier-1667"><a href="#Supplier-1667"><span class="linenos">1667</span></a><span class="sd">                - Template: performative = &quot;vehicle-pickup&quot;</span>
</span><span id="Supplier-1668"><a href="#Supplier-1668"><span class="linenos">1668</span></a><span class="sd">                - Purpose: Handle vehicle pickup notifications</span>
</span><span id="Supplier-1669"><a href="#Supplier-1669"><span class="linenos">1669</span></a><span class="sd">                - Action: Remove order from pending_deliveries, confirm pickup</span>
</span><span id="Supplier-1670"><a href="#Supplier-1670"><span class="linenos">1670</span></a><span class="sd">        </span>
</span><span id="Supplier-1671"><a href="#Supplier-1671"><span class="linenos">1671</span></a><span class="sd">        Infinite Stock Model:</span>
</span><span id="Supplier-1672"><a href="#Supplier-1672"><span class="linenos">1672</span></a><span class="sd">            Unlike warehouse agents:</span>
</span><span id="Supplier-1673"><a href="#Supplier-1673"><span class="linenos">1673</span></a><span class="sd">            - No stock initialization required</span>
</span><span id="Supplier-1674"><a href="#Supplier-1674"><span class="linenos">1674</span></a><span class="sd">            - No capacity constraints</span>
</span><span id="Supplier-1675"><a href="#Supplier-1675"><span class="linenos">1675</span></a><span class="sd">            - No resupply mechanism needed</span>
</span><span id="Supplier-1676"><a href="#Supplier-1676"><span class="linenos">1676</span></a><span class="sd">            - Only tracks what&#39;s been supplied (statistics)</span>
</span><span id="Supplier-1677"><a href="#Supplier-1677"><span class="linenos">1677</span></a><span class="sd">        </span>
</span><span id="Supplier-1678"><a href="#Supplier-1678"><span class="linenos">1678</span></a><span class="sd">        State Initialization Example:</span>
</span><span id="Supplier-1679"><a href="#Supplier-1679"><span class="linenos">1679</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1680"><a href="#Supplier-1680"><span class="linenos">1680</span></a><span class="sd">            After setup():</span>
</span><span id="Supplier-1681"><a href="#Supplier-1681"><span class="linenos">1681</span></a><span class="sd">                total_supplied: {} (empty, will populate as orders fulfilled)</span>
</span><span id="Supplier-1682"><a href="#Supplier-1682"><span class="linenos">1682</span></a><span class="sd">                current_tick: 0</span>
</span><span id="Supplier-1683"><a href="#Supplier-1683"><span class="linenos">1683</span></a><span class="sd">                pending_deliveries: {} (empty, will populate as orders confirmed)</span>
</span><span id="Supplier-1684"><a href="#Supplier-1684"><span class="linenos">1684</span></a><span class="sd">                vehicle_proposals: {} (empty, will populate per order)</span>
</span><span id="Supplier-1685"><a href="#Supplier-1685"><span class="linenos">1685</span></a><span class="sd">                vehicles: [] (will populate from presence contacts)</span>
</span><span id="Supplier-1686"><a href="#Supplier-1686"><span class="linenos">1686</span></a><span class="sd">                presence_infos: {} (will populate during vehicle coordination)</span>
</span><span id="Supplier-1687"><a href="#Supplier-1687"><span class="linenos">1687</span></a><span class="sd">            </span>
</span><span id="Supplier-1688"><a href="#Supplier-1688"><span class="linenos">1688</span></a><span class="sd">            Print Output:</span>
</span><span id="Supplier-1689"><a href="#Supplier-1689"><span class="linenos">1689</span></a><span class="sd">                &quot;supplier1@localhost&gt; Supplier initialized with INFINITE stock&quot;</span>
</span><span id="Supplier-1690"><a href="#Supplier-1690"><span class="linenos">1690</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1691"><a href="#Supplier-1691"><span class="linenos">1691</span></a><span class="sd">        </span>
</span><span id="Supplier-1692"><a href="#Supplier-1692"><span class="linenos">1692</span></a><span class="sd">        Presence Subscription Example:</span>
</span><span id="Supplier-1693"><a href="#Supplier-1693"><span class="linenos">1693</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1694"><a href="#Supplier-1694"><span class="linenos">1694</span></a><span class="sd">            contact_list: [</span>
</span><span id="Supplier-1695"><a href="#Supplier-1695"><span class="linenos">1695</span></a><span class="sd">                &quot;warehouse1@localhost&quot;,</span>
</span><span id="Supplier-1696"><a href="#Supplier-1696"><span class="linenos">1696</span></a><span class="sd">                &quot;warehouse2@localhost&quot;,</span>
</span><span id="Supplier-1697"><a href="#Supplier-1697"><span class="linenos">1697</span></a><span class="sd">                &quot;vehicle1@localhost&quot;,</span>
</span><span id="Supplier-1698"><a href="#Supplier-1698"><span class="linenos">1698</span></a><span class="sd">                &quot;vehicle2@localhost&quot;</span>
</span><span id="Supplier-1699"><a href="#Supplier-1699"><span class="linenos">1699</span></a><span class="sd">            ]</span>
</span><span id="Supplier-1700"><a href="#Supplier-1700"><span class="linenos">1700</span></a><span class="sd">            </span>
</span><span id="Supplier-1701"><a href="#Supplier-1701"><span class="linenos">1701</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier-1702"><a href="#Supplier-1702"><span class="linenos">1702</span></a><span class="sd">                1. Subscribe to all 4 contacts</span>
</span><span id="Supplier-1703"><a href="#Supplier-1703"><span class="linenos">1703</span></a><span class="sd">                2. Enable auto-approval for incoming subscriptions</span>
</span><span id="Supplier-1704"><a href="#Supplier-1704"><span class="linenos">1704</span></a><span class="sd">                3. Print: &quot;Sent subscription request to warehouse1@localhost&quot;</span>
</span><span id="Supplier-1705"><a href="#Supplier-1705"><span class="linenos">1705</span></a><span class="sd">                4. Print: &quot;Sent subscription request to warehouse2@localhost&quot;</span>
</span><span id="Supplier-1706"><a href="#Supplier-1706"><span class="linenos">1706</span></a><span class="sd">                5. Print: &quot;Sent subscription request to vehicle1@localhost&quot;</span>
</span><span id="Supplier-1707"><a href="#Supplier-1707"><span class="linenos">1707</span></a><span class="sd">                6. Print: &quot;Sent subscription request to vehicle2@localhost&quot;</span>
</span><span id="Supplier-1708"><a href="#Supplier-1708"><span class="linenos">1708</span></a><span class="sd">                7. Print: &quot;Supplier setup complete. Will auto-accept all presence subscriptions.&quot;</span>
</span><span id="Supplier-1709"><a href="#Supplier-1709"><span class="linenos">1709</span></a><span class="sd">            ```</span>
</span><span id="Supplier-1710"><a href="#Supplier-1710"><span class="linenos">1710</span></a><span class="sd">        </span>
</span><span id="Supplier-1711"><a href="#Supplier-1711"><span class="linenos">1711</span></a><span class="sd">        Template Configuration:</span>
</span><span id="Supplier-1712"><a href="#Supplier-1712"><span class="linenos">1712</span></a><span class="sd">            Templates use metadata filtering to route messages to correct behaviours:</span>
</span><span id="Supplier-1713"><a href="#Supplier-1713"><span class="linenos">1713</span></a><span class="sd">            - ReceiveBuyRequest: performative=&quot;warehouse-buy&quot;</span>
</span><span id="Supplier-1714"><a href="#Supplier-1714"><span class="linenos">1714</span></a><span class="sd">            - ReceiveVehicleProposals: performative=&quot;vehicle-proposal&quot;</span>
</span><span id="Supplier-1715"><a href="#Supplier-1715"><span class="linenos">1715</span></a><span class="sd">            - ReceiveVehicleArrival: performative=&quot;vehicle-pickup&quot;</span>
</span><span id="Supplier-1716"><a href="#Supplier-1716"><span class="linenos">1716</span></a><span class="sd">        </span>
</span><span id="Supplier-1717"><a href="#Supplier-1717"><span class="linenos">1717</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier-1718"><a href="#Supplier-1718"><span class="linenos">1718</span></a><span class="sd">            - Prints initialization message with INFINITE stock notice</span>
</span><span id="Supplier-1719"><a href="#Supplier-1719"><span class="linenos">1719</span></a><span class="sd">            - Prints statistics if verbose=True</span>
</span><span id="Supplier-1720"><a href="#Supplier-1720"><span class="linenos">1720</span></a><span class="sd">            - Begins listening for warehouse requests immediately</span>
</span><span id="Supplier-1721"><a href="#Supplier-1721"><span class="linenos">1721</span></a><span class="sd">            - Begins listening for vehicle messages immediately</span>
</span><span id="Supplier-1722"><a href="#Supplier-1722"><span class="linenos">1722</span></a><span class="sd">        </span>
</span><span id="Supplier-1723"><a href="#Supplier-1723"><span class="linenos">1723</span></a><span class="sd">        Note:</span>
</span><span id="Supplier-1724"><a href="#Supplier-1724"><span class="linenos">1724</span></a><span class="sd">            This method must complete before the supplier can participate in any</span>
</span><span id="Supplier-1725"><a href="#Supplier-1725"><span class="linenos">1725</span></a><span class="sd">            FIPA protocol interactions. All behaviours are registered but don&#39;t</span>
</span><span id="Supplier-1726"><a href="#Supplier-1726"><span class="linenos">1726</span></a><span class="sd">            execute until the main agent event loop processes them.</span>
</span><span id="Supplier-1727"><a href="#Supplier-1727"><span class="linenos">1727</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier-1728"><a href="#Supplier-1728"><span class="linenos">1728</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">approve_all</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Supplier-1729"><a href="#Supplier-1729"><span class="linenos">1729</span></a>        
</span><span id="Supplier-1730"><a href="#Supplier-1730"><span class="linenos">1730</span></a>        <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_list</span><span class="p">:</span>
</span><span id="Supplier-1731"><a href="#Supplier-1731"><span class="linenos">1731</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">contact</span><span class="p">)</span>
</span><span id="Supplier-1732"><a href="#Supplier-1732"><span class="linenos">1732</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1733"><a href="#Supplier-1733"><span class="linenos">1733</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Sent subscription request to </span><span class="si">{</span><span class="n">contact</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier-1734"><a href="#Supplier-1734"><span class="linenos">1734</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1735"><a href="#Supplier-1735"><span class="linenos">1735</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Supplier setup complete. Will auto-accept all presence subscriptions.&quot;</span><span class="p">)</span>
</span><span id="Supplier-1736"><a href="#Supplier-1736"><span class="linenos">1736</span></a>        
</span><span id="Supplier-1737"><a href="#Supplier-1737"><span class="linenos">1737</span></a>        <span class="c1"># Supplier has infinite stock - no need to track stock levels</span>
</span><span id="Supplier-1738"><a href="#Supplier-1738"><span class="linenos">1738</span></a>        <span class="c1"># Just track what&#39;s been supplied</span>
</span><span id="Supplier-1739"><a href="#Supplier-1739"><span class="linenos">1739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier-1740"><a href="#Supplier-1740"><span class="linenos">1740</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_tick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Supplier-1741"><a href="#Supplier-1741"><span class="linenos">1741</span></a>        
</span><span id="Supplier-1742"><a href="#Supplier-1742"><span class="linenos">1742</span></a>        <span class="c1"># Track pending deliveries by order_id</span>
</span><span id="Supplier-1743"><a href="#Supplier-1743"><span class="linenos">1743</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Order</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier-1744"><a href="#Supplier-1744"><span class="linenos">1744</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_proposals</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier-1745"><a href="#Supplier-1745"><span class="linenos">1745</span></a>        <span class="c1"># Identify vehicles from presence contacts (will be populated dynamically)</span>
</span><span id="Supplier-1746"><a href="#Supplier-1746"><span class="linenos">1746</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vehicles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Supplier-1747"><a href="#Supplier-1747"><span class="linenos">1747</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence_infos</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier-1748"><a href="#Supplier-1748"><span class="linenos">1748</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Supplier initialized with INFINITE stock&quot;</span><span class="p">)</span>
</span><span id="Supplier-1749"><a href="#Supplier-1749"><span class="linenos">1749</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier-1750"><a href="#Supplier-1750"><span class="linenos">1750</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier-1751"><a href="#Supplier-1751"><span class="linenos">1751</span></a>        
</span><span id="Supplier-1752"><a href="#Supplier-1752"><span class="linenos">1752</span></a>        <span class="c1"># Add behaviour to receive buy requests from warehouses</span>
</span><span id="Supplier-1753"><a href="#Supplier-1753"><span class="linenos">1753</span></a>        <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveBuyRequest</span><span class="p">()</span>
</span><span id="Supplier-1754"><a href="#Supplier-1754"><span class="linenos">1754</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier-1755"><a href="#Supplier-1755"><span class="linenos">1755</span></a>        <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;warehouse-buy&quot;</span><span class="p">)</span>
</span><span id="Supplier-1756"><a href="#Supplier-1756"><span class="linenos">1756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="Supplier-1757"><a href="#Supplier-1757"><span class="linenos">1757</span></a>        
</span><span id="Supplier-1758"><a href="#Supplier-1758"><span class="linenos">1758</span></a>        <span class="c1"># Add behaviour to receive vehicle proposals</span>
</span><span id="Supplier-1759"><a href="#Supplier-1759"><span class="linenos">1759</span></a>        <span class="n">vehicle_proposal_behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveVehicleProposals</span><span class="p">()</span>
</span><span id="Supplier-1760"><a href="#Supplier-1760"><span class="linenos">1760</span></a>        <span class="n">vehicle_proposal_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier-1761"><a href="#Supplier-1761"><span class="linenos">1761</span></a>        <span class="n">vehicle_proposal_template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle-proposal&quot;</span><span class="p">)</span>
</span><span id="Supplier-1762"><a href="#Supplier-1762"><span class="linenos">1762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">vehicle_proposal_behav</span><span class="p">,</span> <span class="n">vehicle_proposal_template</span><span class="p">)</span>
</span><span id="Supplier-1763"><a href="#Supplier-1763"><span class="linenos">1763</span></a>        
</span><span id="Supplier-1764"><a href="#Supplier-1764"><span class="linenos">1764</span></a>        <span class="c1"># Add behaviour to receive vehicle pickup notifications</span>
</span><span id="Supplier-1765"><a href="#Supplier-1765"><span class="linenos">1765</span></a>        <span class="n">pickup_behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveVehicleArrival</span><span class="p">()</span>
</span><span id="Supplier-1766"><a href="#Supplier-1766"><span class="linenos">1766</span></a>        <span class="n">pickup_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier-1767"><a href="#Supplier-1767"><span class="linenos">1767</span></a>        <span class="n">pickup_template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle-pickup&quot;</span><span class="p">)</span>
</span><span id="Supplier-1768"><a href="#Supplier-1768"><span class="linenos">1768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">pickup_behav</span><span class="p">,</span> <span class="n">pickup_template</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Supplier Agent for Supply Chain Management System.</p>

<p>The Supplier agent acts as the ultimate source of materials in the supply chain,
providing infinite inventory to warehouses. It implements the FIPA Contract Net
Protocol as a <strong>Participant</strong>, responding to warehouse requests and coordinating
vehicle deliveries.</p>

<p>FIPA Contract Net Protocol - Participant Role Implementation:</p>

<p><strong>As Participant (with Warehouses)</strong>:
    - <strong>Proposal Phase</strong>: Receives warehouse-buy CFP from warehouses
    - <strong>Proposal Submission</strong>: Always sends supplier-accept (has infinite stock)
    - <strong>Result Reception</strong>: Receives warehouse-confirm (accept-proposal) or warehouse-deny (reject-proposal)
    - <strong>Execution</strong>: Coordinates vehicle delivery for confirmed orders</p>

<h6 id="infinite-stock-model">Infinite Stock Model:</h6>

<blockquote>
  <p>Unlike Store and Warehouse agents, the Supplier has unlimited inventory:</p>
  
  <ul>
  <li>Never rejects requests due to insufficient stock</li>
  <li>Always responds with supplier-accept (FIPA propose)</li>
  <li>Tracks total supplied quantities for statistics only</li>
  <li>No stock locking or capacity constraints</li>
  </ul>
</blockquote>

<h6 id="order-lifecycle">Order Lifecycle:</h6>

<blockquote>
  <ol>
  <li><strong>Request Reception</strong>: Warehouse sends warehouse-buy (FIPA CFP)</li>
  <li><strong>Automatic Acceptance</strong>: Supplier sends supplier-accept (FIPA propose)</li>
  <li><strong>Awaiting Award</strong>: Wait for warehouse decision (10 second timeout)</li>
  <li><strong>Confirmation</strong>: Warehouse sends warehouse-confirm (FIPA accept-proposal)</li>
  <li><strong>Vehicle Assignment</strong>: Launch AssignVehicle to coordinate delivery</li>
  <li><strong>Delivery Tracking</strong>: Order added to pending_deliveries</li>
  <li><strong>Pickup</strong>: Vehicle picks up materials from supplier</li>
  <li><strong>Completion</strong>: Order removed from pending_deliveries</li>
  </ol>
</blockquote>

<h6 id="id-encoding-system">ID Encoding System:</h6>

<blockquote>
  <p>Uses hierarchical encoding for generating unique request identifiers:</p>
  
  <ul>
  <li>Formula: <code>agent_type * 100_000_000 + instance_id * 1_000_000 + request_counter</code></li>
  <li>Agent type code for Supplier: 3</li>
  <li>Example: supplier1's base ID = 3_001_000_000</li>
  </ul>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>jid (str):</strong>  Jabber ID of the supplier agent (e.g., "supplier1@localhost").</li>
<li><strong>node_id (int):</strong>  Graph node ID representing the supplier's physical location.</li>
<li><strong>map (Graph):</strong>  Reference to the world graph for pathfinding calculations.</li>
<li><strong>contact_list (list[str]):</strong>  JIDs for warehouses and vehicles.</li>
<li><strong>verbose (bool):</strong>  Flag to control debug output verbosity.</li>
<li><strong>id_base (int):</strong>  Base value for generating unique request IDs.</li>
<li><strong>total_supplied (dict[str, int]):</strong>  Cumulative quantities supplied per product.
Format: {product: total_quantity_supplied}</li>
<li><strong>pending_deliveries (dict[int, Order]):</strong>  Confirmed orders awaiting vehicle pickup.
Format: {order_id: Order object}</li>
<li><strong>vehicle_proposals (dict[int, dict[str, tuple[bool, int]]]):</strong>  Vehicle delivery proposals.
Format: {order_id: {vehicle_jid: (can_fit, delivery_time)}}</li>
<li><strong>vehicles (list[str]):</strong>  List of vehicle JIDs discovered from contacts.</li>
<li><strong>presence_infos (dict[str, str]):</strong>  Vehicle presence status cache.</li>
<li><strong>current_tick (int):</strong>  Current simulation time, synchronized by world agent.</li>
</ul>

<h6 id="behaviours">Behaviours:</h6>

<blockquote>
  <p>Warehouse Interaction (FIPA Participant):
      - ReceiveBuyRequest: Processes warehouse purchase requests (FIPA CFP)
      - AcceptBuyRequest: Sends proposal to warehouse (FIPA propose)
      - ReceiveConfirmationOrDenial: Handles warehouse award/rejection</p>
  
  <p>Vehicle Coordination:
      - AssignVehicle: Initiates vehicle assignment for deliveries
      - ReceivePresenceInfo: Checks vehicle availability
      - ReceiveVehicleProposals: Collects vehicle delivery proposals
      - ChooseBestVehicle: Selects optimal vehicle using scoring algorithm
      - ReceiveVehicleArrival: Handles vehicle pickup notifications</p>
  
  <p>Time Management:
      - ReceiveTimeDelta: Synchronizes simulation time and traffic updates</p>
</blockquote>

<h6 id="message-protocols">Message Protocols:</h6>

<blockquote>
  <p>Incoming from Warehouses:
      - warehouse-buy: Purchase request (FIPA CFP)
      - warehouse-confirm: Order confirmation (FIPA accept-proposal)
      - warehouse-deny: Order rejection (FIPA reject-proposal)</p>
  
  <p>Outgoing to Warehouses:
      - supplier-accept: Material proposal (FIPA propose)</p>
  
  <p>Vehicle Communication:
      - order-proposal: Request vehicle delivery quote
      - vehicle-proposal: Vehicle delivery proposal
      - order-confirmation: Confirm vehicle assignment
      - vehicle-pickup: Vehicle picks up order from supplier
      - presence-info: Request vehicle availability
      - presence-response: Vehicle availability status</p>
</blockquote>

<h6 id="usage-instructions">Usage Instructions:</h6>

<blockquote>
  <p><strong>For Vehicle Integration</strong>:
      - All vehicles must subscribe to all suppliers (mutual presence subscription)
      - Vehicles access pending orders via <code>supplier_agent.pending_deliveries.values()</code>
      - Vehicle pickup removes order from pending_deliveries</p>
  
  <p><strong>For Warehouse Integration</strong>:
      - Warehouses send warehouse-buy requests to supplier
      - Supplier always accepts (infinite stock)
      - Warehouse selects winning supplier based on delivery time</p>
</blockquote>

<h6 id="example">Example:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">supplier</span> <span class="o">=</span> <span class="n">Supplier</span><span class="p">(</span>
    <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;supplier1@localhost&quot;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
    <span class="nb">map</span><span class="o">=</span><span class="n">world_graph</span><span class="p">,</span>
    <span class="n">node_id</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">contact_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;warehouse1@localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle1@localhost&quot;</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">supplier</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># Access statistics</span>
<span class="nb">print</span><span class="p">(</span><span class="n">supplier</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">)</span>  <span class="c1"># {&#39;electronics&#39;: 500, &#39;textiles&#39;: 300}</span>

<span class="c1"># Access pending orders (for vehicles)</span>
<span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">supplier</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The infinite stock model simplifies the supply chain by eliminating upstream
  constraints, allowing focus on warehouse inventory management and vehicle logistics.</p>
</blockquote>
</div>


                            <div id="Supplier.__init__" class="classattr">
                                        <input id="Supplier.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Supplier</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">jid</span>,</span><span class="param">	<span class="n">password</span>,</span><span class="param">	<span class="nb">map</span><span class="p">:</span> <span class="n">world</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">Graph</span>,</span><span class="param">	<span class="n">node_id</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">port</span><span class="o">=</span><span class="mi">5222</span>,</span><span class="param">	<span class="n">verify_security</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">contact_list</span><span class="o">=</span><span class="p">[]</span>,</span><span class="param">	<span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="Supplier.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.__init__-1535"><a href="#Supplier.__init__-1535"><span class="linenos">1535</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="nb">map</span> <span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">node_id</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">5222</span><span class="p">,</span> <span class="n">verify_security</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">contact_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Supplier.__init__-1536"><a href="#Supplier.__init__-1536"><span class="linenos">1536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.__init__-1537"><a href="#Supplier.__init__-1537"><span class="linenos">1537</span></a><span class="sd">        Initialize the Supplier agent with connection parameters and world state.</span>
</span><span id="Supplier.__init__-1538"><a href="#Supplier.__init__-1538"><span class="linenos">1538</span></a><span class="sd">        </span>
</span><span id="Supplier.__init__-1539"><a href="#Supplier.__init__-1539"><span class="linenos">1539</span></a><span class="sd">        The constructor configures the supplier&#39;s identity, location, and initial</span>
</span><span id="Supplier.__init__-1540"><a href="#Supplier.__init__-1540"><span class="linenos">1540</span></a><span class="sd">        state. It implements the ID encoding system for generating unique request</span>
</span><span id="Supplier.__init__-1541"><a href="#Supplier.__init__-1541"><span class="linenos">1541</span></a><span class="sd">        identifiers compatible with the FIPA Contract Net Protocol.</span>
</span><span id="Supplier.__init__-1542"><a href="#Supplier.__init__-1542"><span class="linenos">1542</span></a><span class="sd">        </span>
</span><span id="Supplier.__init__-1543"><a href="#Supplier.__init__-1543"><span class="linenos">1543</span></a><span class="sd">        ID Encoding System:</span>
</span><span id="Supplier.__init__-1544"><a href="#Supplier.__init__-1544"><span class="linenos">1544</span></a><span class="sd">            Formula: `agent_type * 100_000_000 + instance_id * 1_000_000 + counter`</span>
</span><span id="Supplier.__init__-1545"><a href="#Supplier.__init__-1545"><span class="linenos">1545</span></a><span class="sd">            - Agent Type Code: 3 (for Supplier agents)</span>
</span><span id="Supplier.__init__-1546"><a href="#Supplier.__init__-1546"><span class="linenos">1546</span></a><span class="sd">            - Instance ID: Extracted from JID (e.g., &quot;supplier2&quot; -&gt; 2)</span>
</span><span id="Supplier.__init__-1547"><a href="#Supplier.__init__-1547"><span class="linenos">1547</span></a><span class="sd">            - Base ID Calculation: `3 * 100_000_000 + instance_id * 1_000_000`</span>
</span><span id="Supplier.__init__-1548"><a href="#Supplier.__init__-1548"><span class="linenos">1548</span></a><span class="sd">            </span>
</span><span id="Supplier.__init__-1549"><a href="#Supplier.__init__-1549"><span class="linenos">1549</span></a><span class="sd">            Examples:</span>
</span><span id="Supplier.__init__-1550"><a href="#Supplier.__init__-1550"><span class="linenos">1550</span></a><span class="sd">                - supplier1: base = 301_000_000 (first request: 301_000_000)</span>
</span><span id="Supplier.__init__-1551"><a href="#Supplier.__init__-1551"><span class="linenos">1551</span></a><span class="sd">                - supplier2: base = 302_000_000 (first request: 302_000_000)</span>
</span><span id="Supplier.__init__-1552"><a href="#Supplier.__init__-1552"><span class="linenos">1552</span></a><span class="sd">                - supplier5: base = 305_000_000 (first request: 305_000_000)</span>
</span><span id="Supplier.__init__-1553"><a href="#Supplier.__init__-1553"><span class="linenos">1553</span></a><span class="sd">            </span>
</span><span id="Supplier.__init__-1554"><a href="#Supplier.__init__-1554"><span class="linenos">1554</span></a><span class="sd">            This encoding allows agents to identify:</span>
</span><span id="Supplier.__init__-1555"><a href="#Supplier.__init__-1555"><span class="linenos">1555</span></a><span class="sd">                1. What type of agent created the request (300M range = supplier)</span>
</span><span id="Supplier.__init__-1556"><a href="#Supplier.__init__-1556"><span class="linenos">1556</span></a><span class="sd">                2. Which specific supplier instance (next 1M range)</span>
</span><span id="Supplier.__init__-1557"><a href="#Supplier.__init__-1557"><span class="linenos">1557</span></a><span class="sd">                3. Which request in sequence (counter increments)</span>
</span><span id="Supplier.__init__-1558"><a href="#Supplier.__init__-1558"><span class="linenos">1558</span></a><span class="sd">        </span>
</span><span id="Supplier.__init__-1559"><a href="#Supplier.__init__-1559"><span class="linenos">1559</span></a><span class="sd">        Args:</span>
</span><span id="Supplier.__init__-1560"><a href="#Supplier.__init__-1560"><span class="linenos">1560</span></a><span class="sd">            jid (str): Jabber ID for XMPP communication (e.g., &quot;supplier1@localhost&quot;).</span>
</span><span id="Supplier.__init__-1561"><a href="#Supplier.__init__-1561"><span class="linenos">1561</span></a><span class="sd">            password (str): Authentication password for XMPP server.</span>
</span><span id="Supplier.__init__-1562"><a href="#Supplier.__init__-1562"><span class="linenos">1562</span></a><span class="sd">            map (Graph): Reference to the world graph for pathfinding and locations.</span>
</span><span id="Supplier.__init__-1563"><a href="#Supplier.__init__-1563"><span class="linenos">1563</span></a><span class="sd">            node_id (int): Graph node representing the supplier&#39;s physical location.</span>
</span><span id="Supplier.__init__-1564"><a href="#Supplier.__init__-1564"><span class="linenos">1564</span></a><span class="sd">            port (int, optional): XMPP server port. Defaults to 5222.</span>
</span><span id="Supplier.__init__-1565"><a href="#Supplier.__init__-1565"><span class="linenos">1565</span></a><span class="sd">            verify_security (bool, optional): Enable SSL/TLS verification. Defaults to False.</span>
</span><span id="Supplier.__init__-1566"><a href="#Supplier.__init__-1566"><span class="linenos">1566</span></a><span class="sd">            contact_list (list[str], optional): JIDs of warehouses and vehicles for presence</span>
</span><span id="Supplier.__init__-1567"><a href="#Supplier.__init__-1567"><span class="linenos">1567</span></a><span class="sd">                subscription. Defaults to empty list.</span>
</span><span id="Supplier.__init__-1568"><a href="#Supplier.__init__-1568"><span class="linenos">1568</span></a><span class="sd">            verbose (bool, optional): Enable detailed debug logging. Defaults to False.</span>
</span><span id="Supplier.__init__-1569"><a href="#Supplier.__init__-1569"><span class="linenos">1569</span></a><span class="sd">        </span>
</span><span id="Supplier.__init__-1570"><a href="#Supplier.__init__-1570"><span class="linenos">1570</span></a><span class="sd">        Attributes Initialized:</span>
</span><span id="Supplier.__init__-1571"><a href="#Supplier.__init__-1571"><span class="linenos">1571</span></a><span class="sd">            Core Identity:</span>
</span><span id="Supplier.__init__-1572"><a href="#Supplier.__init__-1572"><span class="linenos">1572</span></a><span class="sd">                - node_id: Supplier location on graph</span>
</span><span id="Supplier.__init__-1573"><a href="#Supplier.__init__-1573"><span class="linenos">1573</span></a><span class="sd">                - map: World graph reference</span>
</span><span id="Supplier.__init__-1574"><a href="#Supplier.__init__-1574"><span class="linenos">1574</span></a><span class="sd">                - contact_list: Agents for presence subscription</span>
</span><span id="Supplier.__init__-1575"><a href="#Supplier.__init__-1575"><span class="linenos">1575</span></a><span class="sd">                - verbose: Debug output flag</span>
</span><span id="Supplier.__init__-1576"><a href="#Supplier.__init__-1576"><span class="linenos">1576</span></a><span class="sd">            </span>
</span><span id="Supplier.__init__-1577"><a href="#Supplier.__init__-1577"><span class="linenos">1577</span></a><span class="sd">            Position (Legacy):</span>
</span><span id="Supplier.__init__-1578"><a href="#Supplier.__init__-1578"><span class="linenos">1578</span></a><span class="sd">                - pos_x: X coordinate from node (TODO: marked for removal)</span>
</span><span id="Supplier.__init__-1579"><a href="#Supplier.__init__-1579"><span class="linenos">1579</span></a><span class="sd">                - pos_y: Y coordinate from node (TODO: marked for removal)</span>
</span><span id="Supplier.__init__-1580"><a href="#Supplier.__init__-1580"><span class="linenos">1580</span></a><span class="sd">            </span>
</span><span id="Supplier.__init__-1581"><a href="#Supplier.__init__-1581"><span class="linenos">1581</span></a><span class="sd">            ID Encoding:</span>
</span><span id="Supplier.__init__-1582"><a href="#Supplier.__init__-1582"><span class="linenos">1582</span></a><span class="sd">                - id_base: Base value for generating unique request IDs</span>
</span><span id="Supplier.__init__-1583"><a href="#Supplier.__init__-1583"><span class="linenos">1583</span></a><span class="sd">        </span>
</span><span id="Supplier.__init__-1584"><a href="#Supplier.__init__-1584"><span class="linenos">1584</span></a><span class="sd">        Example:</span>
</span><span id="Supplier.__init__-1585"><a href="#Supplier.__init__-1585"><span class="linenos">1585</span></a><span class="sd">            ```python</span>
</span><span id="Supplier.__init__-1586"><a href="#Supplier.__init__-1586"><span class="linenos">1586</span></a><span class="sd">            supplier = Supplier(</span>
</span><span id="Supplier.__init__-1587"><a href="#Supplier.__init__-1587"><span class="linenos">1587</span></a><span class="sd">                jid=&quot;supplier1@localhost&quot;,</span>
</span><span id="Supplier.__init__-1588"><a href="#Supplier.__init__-1588"><span class="linenos">1588</span></a><span class="sd">                password=&quot;password123&quot;,</span>
</span><span id="Supplier.__init__-1589"><a href="#Supplier.__init__-1589"><span class="linenos">1589</span></a><span class="sd">                map=world_graph,</span>
</span><span id="Supplier.__init__-1590"><a href="#Supplier.__init__-1590"><span class="linenos">1590</span></a><span class="sd">                node_id=20,</span>
</span><span id="Supplier.__init__-1591"><a href="#Supplier.__init__-1591"><span class="linenos">1591</span></a><span class="sd">                contact_list=[</span>
</span><span id="Supplier.__init__-1592"><a href="#Supplier.__init__-1592"><span class="linenos">1592</span></a><span class="sd">                    &quot;warehouse1@localhost&quot;,</span>
</span><span id="Supplier.__init__-1593"><a href="#Supplier.__init__-1593"><span class="linenos">1593</span></a><span class="sd">                    &quot;warehouse2@localhost&quot;,</span>
</span><span id="Supplier.__init__-1594"><a href="#Supplier.__init__-1594"><span class="linenos">1594</span></a><span class="sd">                    &quot;vehicle1@localhost&quot;</span>
</span><span id="Supplier.__init__-1595"><a href="#Supplier.__init__-1595"><span class="linenos">1595</span></a><span class="sd">                ],</span>
</span><span id="Supplier.__init__-1596"><a href="#Supplier.__init__-1596"><span class="linenos">1596</span></a><span class="sd">                verbose=True</span>
</span><span id="Supplier.__init__-1597"><a href="#Supplier.__init__-1597"><span class="linenos">1597</span></a><span class="sd">            )</span>
</span><span id="Supplier.__init__-1598"><a href="#Supplier.__init__-1598"><span class="linenos">1598</span></a><span class="sd">            # ID base calculated: 3 * 100_000_000 + 1 * 1_000_000 = 301_000_000</span>
</span><span id="Supplier.__init__-1599"><a href="#Supplier.__init__-1599"><span class="linenos">1599</span></a><span class="sd">            # First request ID will be: 301_000_000</span>
</span><span id="Supplier.__init__-1600"><a href="#Supplier.__init__-1600"><span class="linenos">1600</span></a><span class="sd">            # Second request ID will be: 301_000_001</span>
</span><span id="Supplier.__init__-1601"><a href="#Supplier.__init__-1601"><span class="linenos">1601</span></a><span class="sd">            ```</span>
</span><span id="Supplier.__init__-1602"><a href="#Supplier.__init__-1602"><span class="linenos">1602</span></a><span class="sd">        </span>
</span><span id="Supplier.__init__-1603"><a href="#Supplier.__init__-1603"><span class="linenos">1603</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.__init__-1604"><a href="#Supplier.__init__-1604"><span class="linenos">1604</span></a><span class="sd">            The constructor only initializes essential attributes. Most supplier</span>
</span><span id="Supplier.__init__-1605"><a href="#Supplier.__init__-1605"><span class="linenos">1605</span></a><span class="sd">            state (total_supplied, pending_deliveries, behaviours) is configured</span>
</span><span id="Supplier.__init__-1606"><a href="#Supplier.__init__-1606"><span class="linenos">1606</span></a><span class="sd">            in the setup() method which runs after the agent connects to the XMPP server.</span>
</span><span id="Supplier.__init__-1607"><a href="#Supplier.__init__-1607"><span class="linenos">1607</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.__init__-1608"><a href="#Supplier.__init__-1608"><span class="linenos">1608</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">verify_security</span><span class="p">)</span>
</span><span id="Supplier.__init__-1609"><a href="#Supplier.__init__-1609"><span class="linenos">1609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="Supplier.__init__-1610"><a href="#Supplier.__init__-1610"><span class="linenos">1610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="p">:</span> <span class="n">Graph</span> <span class="o">=</span> <span class="nb">map</span>
</span><span id="Supplier.__init__-1611"><a href="#Supplier.__init__-1611"><span class="linenos">1611</span></a>        <span class="n">node</span> <span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span> <span class="c1"># TODO -- remove</span>
</span><span id="Supplier.__init__-1612"><a href="#Supplier.__init__-1612"><span class="linenos">1612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos_x</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span> <span class="c1"># TODO -- remove</span>
</span><span id="Supplier.__init__-1613"><a href="#Supplier.__init__-1613"><span class="linenos">1613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos_y</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span> <span class="c1"># TODO -- remove</span>
</span><span id="Supplier.__init__-1614"><a href="#Supplier.__init__-1614"><span class="linenos">1614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">contact_list</span> <span class="o">=</span> <span class="n">contact_list</span>
</span><span id="Supplier.__init__-1615"><a href="#Supplier.__init__-1615"><span class="linenos">1615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
</span><span id="Supplier.__init__-1616"><a href="#Supplier.__init__-1616"><span class="linenos">1616</span></a>        <span class="c1"># Extract instance number from JID for ID encoding (e.g., &quot;supplier1@localhost&quot; -&gt; 1)</span>
</span><span id="Supplier.__init__-1617"><a href="#Supplier.__init__-1617"><span class="linenos">1617</span></a>        <span class="n">jid_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Supplier.__init__-1618"><a href="#Supplier.__init__-1618"><span class="linenos">1618</span></a>        <span class="n">instance_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">,</span> <span class="n">jid_name</span><span class="p">)))</span>
</span><span id="Supplier.__init__-1619"><a href="#Supplier.__init__-1619"><span class="linenos">1619</span></a>        
</span><span id="Supplier.__init__-1620"><a href="#Supplier.__init__-1620"><span class="linenos">1620</span></a>        <span class="c1"># Calculate ID base: Supplier type code = 3</span>
</span><span id="Supplier.__init__-1621"><a href="#Supplier.__init__-1621"><span class="linenos">1621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id_base</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">100_000_000</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">instance_id</span> <span class="o">*</span> <span class="mi">1_000_000</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the Supplier agent with connection parameters and world state.</p>

<p>The constructor configures the supplier's identity, location, and initial
state. It implements the ID encoding system for generating unique request
identifiers compatible with the FIPA Contract Net Protocol.</p>

<h6 id="id-encoding-system">ID Encoding System:</h6>

<blockquote>
  <p>Formula: <code>agent_type * 100_000_000 + instance_id * 1_000_000 + counter</code></p>
  
  <ul>
  <li>Agent Type Code: 3 (for Supplier agents)</li>
  <li>Instance ID: Extracted from JID (e.g., "supplier2" -> 2)</li>
  <li>Base ID Calculation: <code>3 * 100_000_000 + instance_id * 1_000_000</code></li>
  </ul>
  
  <p>Examples:
      - supplier1: base = 301_000_000 (first request: 301_000_000)
      - supplier2: base = 302_000_000 (first request: 302_000_000)
      - supplier5: base = 305_000_000 (first request: 305_000_000)</p>
  
  <p>This encoding allows agents to identify:
      1. What type of agent created the request (300M range = supplier)
      2. Which specific supplier instance (next 1M range)
      3. Which request in sequence (counter increments)</p>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>jid (str):</strong>  Jabber ID for XMPP communication (e.g., "supplier1@localhost").</li>
<li><strong>password (str):</strong>  Authentication password for XMPP server.</li>
<li><strong>map (Graph):</strong>  Reference to the world graph for pathfinding and locations.</li>
<li><strong>node_id (int):</strong>  Graph node representing the supplier's physical location.</li>
<li><strong>port (int, optional):</strong>  XMPP server port. Defaults to 5222.</li>
<li><strong>verify_security (bool, optional):</strong>  Enable SSL/TLS verification. Defaults to False.</li>
<li><strong>contact_list (list[str], optional):</strong>  JIDs of warehouses and vehicles for presence
subscription. Defaults to empty list.</li>
<li><strong>verbose (bool, optional):</strong>  Enable detailed debug logging. Defaults to False.</li>
</ul>

<h6 id="attributes-initialized">Attributes Initialized:</h6>

<blockquote>
  <p>Core Identity:
      - node_id: Supplier location on graph
      - map: World graph reference
      - contact_list: Agents for presence subscription
      - verbose: Debug output flag</p>
  
  <p>Position (Legacy):
      - pos_x: X coordinate from node (TODO: marked for removal)
      - pos_y: Y coordinate from node (TODO: marked for removal)</p>
  
  <p>ID Encoding:
      - id_base: Base value for generating unique request IDs</p>
</blockquote>

<h6 id="example">Example:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">supplier</span> <span class="o">=</span> <span class="n">Supplier</span><span class="p">(</span>
    <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;supplier1@localhost&quot;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password123&quot;</span><span class="p">,</span>
    <span class="nb">map</span><span class="o">=</span><span class="n">world_graph</span><span class="p">,</span>
    <span class="n">node_id</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">contact_list</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;warehouse1@localhost&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warehouse2@localhost&quot;</span><span class="p">,</span>
        <span class="s2">&quot;vehicle1@localhost&quot;</span>
    <span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="c1"># ID base calculated: 3 * 100_000_000 + 1 * 1_000_000 = 301_000_000</span>
<span class="c1"># First request ID will be: 301_000_000</span>
<span class="c1"># Second request ID will be: 301_000_001</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The constructor only initializes essential attributes. Most supplier
  state (total_supplied, pending_deliveries, behaviours) is configured
  in the setup() method which runs after the agent connects to the XMPP server.</p>
</blockquote>
</div>


                            </div>
                            <div id="Supplier.print_stats" class="classattr">
                                        <input id="Supplier.print_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.print_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.print_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.print_stats-1235"><a href="#Supplier.print_stats-1235"><span class="linenos">1235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.print_stats-1236"><a href="#Supplier.print_stats-1236"><span class="linenos">1236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.print_stats-1237"><a href="#Supplier.print_stats-1237"><span class="linenos">1237</span></a><span class="sd">        Print comprehensive supplier statistics (debugging utility).</span>
</span><span id="Supplier.print_stats-1238"><a href="#Supplier.print_stats-1238"><span class="linenos">1238</span></a><span class="sd">        </span>
</span><span id="Supplier.print_stats-1239"><a href="#Supplier.print_stats-1239"><span class="linenos">1239</span></a><span class="sd">        Displays two key metrics:</span>
</span><span id="Supplier.print_stats-1240"><a href="#Supplier.print_stats-1240"><span class="linenos">1240</span></a><span class="sd">        1. **Total Products Supplied**: Cumulative quantities per product type</span>
</span><span id="Supplier.print_stats-1241"><a href="#Supplier.print_stats-1241"><span class="linenos">1241</span></a><span class="sd">        2. **Pending Deliveries**: Orders confirmed but not yet picked up by vehicles</span>
</span><span id="Supplier.print_stats-1242"><a href="#Supplier.print_stats-1242"><span class="linenos">1242</span></a><span class="sd">        </span>
</span><span id="Supplier.print_stats-1243"><a href="#Supplier.print_stats-1243"><span class="linenos">1243</span></a><span class="sd">        Output Format:</span>
</span><span id="Supplier.print_stats-1244"><a href="#Supplier.print_stats-1244"><span class="linenos">1244</span></a><span class="sd">            ========================================</span>
</span><span id="Supplier.print_stats-1245"><a href="#Supplier.print_stats-1245"><span class="linenos">1245</span></a><span class="sd">            supplier1@localhost Statistics:</span>
</span><span id="Supplier.print_stats-1246"><a href="#Supplier.print_stats-1246"><span class="linenos">1246</span></a><span class="sd">            Total Products Supplied:</span>
</span><span id="Supplier.print_stats-1247"><a href="#Supplier.print_stats-1247"><span class="linenos">1247</span></a><span class="sd">              electronics: 1500</span>
</span><span id="Supplier.print_stats-1248"><a href="#Supplier.print_stats-1248"><span class="linenos">1248</span></a><span class="sd">              textiles: 800</span>
</span><span id="Supplier.print_stats-1249"><a href="#Supplier.print_stats-1249"><span class="linenos">1249</span></a><span class="sd">              food: 1200</span>
</span><span id="Supplier.print_stats-1250"><a href="#Supplier.print_stats-1250"><span class="linenos">1250</span></a><span class="sd">            </span>
</span><span id="Supplier.print_stats-1251"><a href="#Supplier.print_stats-1251"><span class="linenos">1251</span></a><span class="sd">            Pending Deliveries:</span>
</span><span id="Supplier.print_stats-1252"><a href="#Supplier.print_stats-1252"><span class="linenos">1252</span></a><span class="sd">              Total: 2 order(s)</span>
</span><span id="Supplier.print_stats-1253"><a href="#Supplier.print_stats-1253"><span class="linenos">1253</span></a><span class="sd">                Order 301000000: 100xelectronics for warehouse1@localhost</span>
</span><span id="Supplier.print_stats-1254"><a href="#Supplier.print_stats-1254"><span class="linenos">1254</span></a><span class="sd">                Order 301000001: 50xtextiles for warehouse2@localhost</span>
</span><span id="Supplier.print_stats-1255"><a href="#Supplier.print_stats-1255"><span class="linenos">1255</span></a><span class="sd">            ========================================</span>
</span><span id="Supplier.print_stats-1256"><a href="#Supplier.print_stats-1256"><span class="linenos">1256</span></a><span class="sd">        </span>
</span><span id="Supplier.print_stats-1257"><a href="#Supplier.print_stats-1257"><span class="linenos">1257</span></a><span class="sd">        Metrics Interpretation:</span>
</span><span id="Supplier.print_stats-1258"><a href="#Supplier.print_stats-1258"><span class="linenos">1258</span></a><span class="sd">            - **Total Products Supplied**: Historical record of all materials provided</span>
</span><span id="Supplier.print_stats-1259"><a href="#Supplier.print_stats-1259"><span class="linenos">1259</span></a><span class="sd">            - **Pending Deliveries**: Orders awaiting vehicle pickup</span>
</span><span id="Supplier.print_stats-1260"><a href="#Supplier.print_stats-1260"><span class="linenos">1260</span></a><span class="sd">                - Added when warehouse sends warehouse-confirm</span>
</span><span id="Supplier.print_stats-1261"><a href="#Supplier.print_stats-1261"><span class="linenos">1261</span></a><span class="sd">                - Removed when vehicle sends vehicle-pickup</span>
</span><span id="Supplier.print_stats-1262"><a href="#Supplier.print_stats-1262"><span class="linenos">1262</span></a><span class="sd">        </span>
</span><span id="Supplier.print_stats-1263"><a href="#Supplier.print_stats-1263"><span class="linenos">1263</span></a><span class="sd">        Use Cases:</span>
</span><span id="Supplier.print_stats-1264"><a href="#Supplier.print_stats-1264"><span class="linenos">1264</span></a><span class="sd">            - Monitoring supplier throughput</span>
</span><span id="Supplier.print_stats-1265"><a href="#Supplier.print_stats-1265"><span class="linenos">1265</span></a><span class="sd">            - Tracking pending logistics operations</span>
</span><span id="Supplier.print_stats-1266"><a href="#Supplier.print_stats-1266"><span class="linenos">1266</span></a><span class="sd">            - Debugging vehicle coordination issues</span>
</span><span id="Supplier.print_stats-1267"><a href="#Supplier.print_stats-1267"><span class="linenos">1267</span></a><span class="sd">            - Performance analysis and reporting</span>
</span><span id="Supplier.print_stats-1268"><a href="#Supplier.print_stats-1268"><span class="linenos">1268</span></a><span class="sd">        </span>
</span><span id="Supplier.print_stats-1269"><a href="#Supplier.print_stats-1269"><span class="linenos">1269</span></a><span class="sd">        Example Usage:</span>
</span><span id="Supplier.print_stats-1270"><a href="#Supplier.print_stats-1270"><span class="linenos">1270</span></a><span class="sd">            ```python</span>
</span><span id="Supplier.print_stats-1271"><a href="#Supplier.print_stats-1271"><span class="linenos">1271</span></a><span class="sd">            # After warehouse confirms order</span>
</span><span id="Supplier.print_stats-1272"><a href="#Supplier.print_stats-1272"><span class="linenos">1272</span></a><span class="sd">            supplier.pending_deliveries[order_id] = order</span>
</span><span id="Supplier.print_stats-1273"><a href="#Supplier.print_stats-1273"><span class="linenos">1273</span></a><span class="sd">            supplier.print_stats()  # Shows new pending order</span>
</span><span id="Supplier.print_stats-1274"><a href="#Supplier.print_stats-1274"><span class="linenos">1274</span></a><span class="sd">            </span>
</span><span id="Supplier.print_stats-1275"><a href="#Supplier.print_stats-1275"><span class="linenos">1275</span></a><span class="sd">            # After vehicle pickup</span>
</span><span id="Supplier.print_stats-1276"><a href="#Supplier.print_stats-1276"><span class="linenos">1276</span></a><span class="sd">            del supplier.pending_deliveries[order_id]</span>
</span><span id="Supplier.print_stats-1277"><a href="#Supplier.print_stats-1277"><span class="linenos">1277</span></a><span class="sd">            supplier.print_stats()  # Shows order removed</span>
</span><span id="Supplier.print_stats-1278"><a href="#Supplier.print_stats-1278"><span class="linenos">1278</span></a><span class="sd">            ```</span>
</span><span id="Supplier.print_stats-1279"><a href="#Supplier.print_stats-1279"><span class="linenos">1279</span></a><span class="sd">        </span>
</span><span id="Supplier.print_stats-1280"><a href="#Supplier.print_stats-1280"><span class="linenos">1280</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.print_stats-1281"><a href="#Supplier.print_stats-1281"><span class="linenos">1281</span></a><span class="sd">            Unlike warehouse and store, supplier statistics are simpler because</span>
</span><span id="Supplier.print_stats-1282"><a href="#Supplier.print_stats-1282"><span class="linenos">1282</span></a><span class="sd">            there&#39;s no stock tracking (infinite inventory model).</span>
</span><span id="Supplier.print_stats-1283"><a href="#Supplier.print_stats-1283"><span class="linenos">1283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.print_stats-1284"><a href="#Supplier.print_stats-1284"><span class="linenos">1284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1285"><a href="#Supplier.print_stats-1285"><span class="linenos">1285</span></a>        
</span><span id="Supplier.print_stats-1286"><a href="#Supplier.print_stats-1286"><span class="linenos">1286</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2"> Statistics:&quot;</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1287"><a href="#Supplier.print_stats-1287"><span class="linenos">1287</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Products Supplied:&quot;</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1288"><a href="#Supplier.print_stats-1288"><span class="linenos">1288</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">:</span>
</span><span id="Supplier.print_stats-1289"><a href="#Supplier.print_stats-1289"><span class="linenos">1289</span></a>            <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">amount</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Supplier.print_stats-1290"><a href="#Supplier.print_stats-1290"><span class="linenos">1290</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1291"><a href="#Supplier.print_stats-1291"><span class="linenos">1291</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.print_stats-1292"><a href="#Supplier.print_stats-1292"><span class="linenos">1292</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  None yet&quot;</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1293"><a href="#Supplier.print_stats-1293"><span class="linenos">1293</span></a>            
</span><span id="Supplier.print_stats-1294"><a href="#Supplier.print_stats-1294"><span class="linenos">1294</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pending Deliveries:&quot;</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1295"><a href="#Supplier.print_stats-1295"><span class="linenos">1295</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">:</span>
</span><span id="Supplier.print_stats-1296"><a href="#Supplier.print_stats-1296"><span class="linenos">1296</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">)</span><span class="si">}</span><span class="s2"> order(s)&quot;</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1297"><a href="#Supplier.print_stats-1297"><span class="linenos">1297</span></a>            <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">order</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Supplier.print_stats-1298"><a href="#Supplier.print_stats-1298"><span class="linenos">1298</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Order </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1299"><a href="#Supplier.print_stats-1299"><span class="linenos">1299</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.print_stats-1300"><a href="#Supplier.print_stats-1300"><span class="linenos">1300</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  None&quot;</span><span class="p">)</span>
</span><span id="Supplier.print_stats-1301"><a href="#Supplier.print_stats-1301"><span class="linenos">1301</span></a>        
</span><span id="Supplier.print_stats-1302"><a href="#Supplier.print_stats-1302"><span class="linenos">1302</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">40</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print comprehensive supplier statistics (debugging utility).</p>

<p>Displays two key metrics:</p>

<ol>
<li><strong>Total Products Supplied</strong>: Cumulative quantities per product type</li>
<li><strong>Pending Deliveries</strong>: Orders confirmed but not yet picked up by vehicles</li>
</ol>

<h6 id="output-format">Output Format:</h6>

<blockquote>
  <p>========================================
  supplier1@localhost Statistics:
  Total Products Supplied:
    electronics: 1500
    textiles: 800
    food: 1200</p>
  
  <p>Pending Deliveries:
    Total: 2 order(s)
      Order 301000000: 100xelectronics for warehouse1@localhost</p>
  
  <h1 id="order-301000001-50xtextiles-for-warehouse2localhost">    Order 301000001: 50xtextiles for warehouse2@localhost</h1>
</blockquote>

<h6 id="metrics-interpretation">Metrics Interpretation:</h6>

<blockquote>
  <ul>
  <li><strong>Total Products Supplied</strong>: Historical record of all materials provided</li>
  <li><strong>Pending Deliveries</strong>: Orders awaiting vehicle pickup
  <ul>
  <li>Added when warehouse sends warehouse-confirm</li>
  <li>Removed when vehicle sends vehicle-pickup</li>
  </ul></li>
  </ul>
</blockquote>

<h6 id="use-cases">Use Cases:</h6>

<blockquote>
  <ul>
  <li>Monitoring supplier throughput</li>
  <li>Tracking pending logistics operations</li>
  <li>Debugging vehicle coordination issues</li>
  <li>Performance analysis and reporting</li>
  </ul>
</blockquote>

<h6 id="example-usage">Example Usage:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># After warehouse confirms order</span>
<span class="n">supplier</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
<span class="n">supplier</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>  <span class="c1"># Shows new pending order</span>

<span class="c1"># After vehicle pickup</span>
<span class="k">del</span> <span class="n">supplier</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order_id</span><span class="p">]</span>
<span class="n">supplier</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>  <span class="c1"># Shows order removed</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Unlike warehouse and store, supplier statistics are simpler because
  there's no stock tracking (infinite inventory model).</p>
</blockquote>
</div>


                            </div>
                            <div id="Supplier.update_graph" class="classattr">
                                        <input id="Supplier.update_graph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_graph</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">traffic_data</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Supplier.update_graph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.update_graph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.update_graph-1304"><a href="#Supplier.update_graph-1304"><span class="linenos">1304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traffic_data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier.update_graph-1305"><a href="#Supplier.update_graph-1305"><span class="linenos">1305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.update_graph-1306"><a href="#Supplier.update_graph-1306"><span class="linenos">1306</span></a><span class="sd">        Update world graph edge weights based on traffic conditions.</span>
</span><span id="Supplier.update_graph-1307"><a href="#Supplier.update_graph-1307"><span class="linenos">1307</span></a><span class="sd">        </span>
</span><span id="Supplier.update_graph-1308"><a href="#Supplier.update_graph-1308"><span class="linenos">1308</span></a><span class="sd">        This function applies dynamic traffic updates received from the world agent</span>
</span><span id="Supplier.update_graph-1309"><a href="#Supplier.update_graph-1309"><span class="linenos">1309</span></a><span class="sd">        to the supplier&#39;s local copy of the world graph. Edge weights represent</span>
</span><span id="Supplier.update_graph-1310"><a href="#Supplier.update_graph-1310"><span class="linenos">1310</span></a><span class="sd">        travel costs/times and are updated to reflect current traffic conditions.</span>
</span><span id="Supplier.update_graph-1311"><a href="#Supplier.update_graph-1311"><span class="linenos">1311</span></a><span class="sd">        </span>
</span><span id="Supplier.update_graph-1312"><a href="#Supplier.update_graph-1312"><span class="linenos">1312</span></a><span class="sd">        Args:</span>
</span><span id="Supplier.update_graph-1313"><a href="#Supplier.update_graph-1313"><span class="linenos">1313</span></a><span class="sd">            traffic_data (dict): Traffic update data with structure:</span>
</span><span id="Supplier.update_graph-1314"><a href="#Supplier.update_graph-1314"><span class="linenos">1314</span></a><span class="sd">                {</span>
</span><span id="Supplier.update_graph-1315"><a href="#Supplier.update_graph-1315"><span class="linenos">1315</span></a><span class="sd">                    &quot;edges&quot;: [</span>
</span><span id="Supplier.update_graph-1316"><a href="#Supplier.update_graph-1316"><span class="linenos">1316</span></a><span class="sd">                        {</span>
</span><span id="Supplier.update_graph-1317"><a href="#Supplier.update_graph-1317"><span class="linenos">1317</span></a><span class="sd">                            &quot;node1&quot;: int,  # First node ID</span>
</span><span id="Supplier.update_graph-1318"><a href="#Supplier.update_graph-1318"><span class="linenos">1318</span></a><span class="sd">                            &quot;node2&quot;: int,  # Second node ID</span>
</span><span id="Supplier.update_graph-1319"><a href="#Supplier.update_graph-1319"><span class="linenos">1319</span></a><span class="sd">                            &quot;weight&quot;: float  # New edge weight (time/cost)</span>
</span><span id="Supplier.update_graph-1320"><a href="#Supplier.update_graph-1320"><span class="linenos">1320</span></a><span class="sd">                        },</span>
</span><span id="Supplier.update_graph-1321"><a href="#Supplier.update_graph-1321"><span class="linenos">1321</span></a><span class="sd">                        ...</span>
</span><span id="Supplier.update_graph-1322"><a href="#Supplier.update_graph-1322"><span class="linenos">1322</span></a><span class="sd">                    ]</span>
</span><span id="Supplier.update_graph-1323"><a href="#Supplier.update_graph-1323"><span class="linenos">1323</span></a><span class="sd">                }</span>
</span><span id="Supplier.update_graph-1324"><a href="#Supplier.update_graph-1324"><span class="linenos">1324</span></a><span class="sd">        </span>
</span><span id="Supplier.update_graph-1325"><a href="#Supplier.update_graph-1325"><span class="linenos">1325</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier.update_graph-1326"><a href="#Supplier.update_graph-1326"><span class="linenos">1326</span></a><span class="sd">            1. Iterate through all edge updates in traffic_data</span>
</span><span id="Supplier.update_graph-1327"><a href="#Supplier.update_graph-1327"><span class="linenos">1327</span></a><span class="sd">            2. Extract node1_id, node2_id, and new_weight</span>
</span><span id="Supplier.update_graph-1328"><a href="#Supplier.update_graph-1328"><span class="linenos">1328</span></a><span class="sd">            3. Retrieve edge from graph using get_edge()</span>
</span><span id="Supplier.update_graph-1329"><a href="#Supplier.update_graph-1329"><span class="linenos">1329</span></a><span class="sd">            4. Update edge.weight if edge exists</span>
</span><span id="Supplier.update_graph-1330"><a href="#Supplier.update_graph-1330"><span class="linenos">1330</span></a><span class="sd">        </span>
</span><span id="Supplier.update_graph-1331"><a href="#Supplier.update_graph-1331"><span class="linenos">1331</span></a><span class="sd">        Example:</span>
</span><span id="Supplier.update_graph-1332"><a href="#Supplier.update_graph-1332"><span class="linenos">1332</span></a><span class="sd">            ```</span>
</span><span id="Supplier.update_graph-1333"><a href="#Supplier.update_graph-1333"><span class="linenos">1333</span></a><span class="sd">            Traffic Data:</span>
</span><span id="Supplier.update_graph-1334"><a href="#Supplier.update_graph-1334"><span class="linenos">1334</span></a><span class="sd">            {</span>
</span><span id="Supplier.update_graph-1335"><a href="#Supplier.update_graph-1335"><span class="linenos">1335</span></a><span class="sd">                &quot;edges&quot;: [</span>
</span><span id="Supplier.update_graph-1336"><a href="#Supplier.update_graph-1336"><span class="linenos">1336</span></a><span class="sd">                    {&quot;node1&quot;: 10, &quot;node2&quot;: 15, &quot;weight&quot;: 120.5},</span>
</span><span id="Supplier.update_graph-1337"><a href="#Supplier.update_graph-1337"><span class="linenos">1337</span></a><span class="sd">                    {&quot;node1&quot;: 15, &quot;node2&quot;: 20, &quot;weight&quot;: 95.3}</span>
</span><span id="Supplier.update_graph-1338"><a href="#Supplier.update_graph-1338"><span class="linenos">1338</span></a><span class="sd">                ]</span>
</span><span id="Supplier.update_graph-1339"><a href="#Supplier.update_graph-1339"><span class="linenos">1339</span></a><span class="sd">            }</span>
</span><span id="Supplier.update_graph-1340"><a href="#Supplier.update_graph-1340"><span class="linenos">1340</span></a><span class="sd">            </span>
</span><span id="Supplier.update_graph-1341"><a href="#Supplier.update_graph-1341"><span class="linenos">1341</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier.update_graph-1342"><a href="#Supplier.update_graph-1342"><span class="linenos">1342</span></a><span class="sd">                - Edge (10, 15): weight updated to 120.5</span>
</span><span id="Supplier.update_graph-1343"><a href="#Supplier.update_graph-1343"><span class="linenos">1343</span></a><span class="sd">                - Edge (15, 20): weight updated to 95.3</span>
</span><span id="Supplier.update_graph-1344"><a href="#Supplier.update_graph-1344"><span class="linenos">1344</span></a><span class="sd">            </span>
</span><span id="Supplier.update_graph-1345"><a href="#Supplier.update_graph-1345"><span class="linenos">1345</span></a><span class="sd">            Impact:</span>
</span><span id="Supplier.update_graph-1346"><a href="#Supplier.update_graph-1346"><span class="linenos">1346</span></a><span class="sd">                - Vehicle routing recalculated with new weights</span>
</span><span id="Supplier.update_graph-1347"><a href="#Supplier.update_graph-1347"><span class="linenos">1347</span></a><span class="sd">                - Delivery time estimates adjusted</span>
</span><span id="Supplier.update_graph-1348"><a href="#Supplier.update_graph-1348"><span class="linenos">1348</span></a><span class="sd">                - Pathfinding uses updated costs</span>
</span><span id="Supplier.update_graph-1349"><a href="#Supplier.update_graph-1349"><span class="linenos">1349</span></a><span class="sd">            ```</span>
</span><span id="Supplier.update_graph-1350"><a href="#Supplier.update_graph-1350"><span class="linenos">1350</span></a><span class="sd">        </span>
</span><span id="Supplier.update_graph-1351"><a href="#Supplier.update_graph-1351"><span class="linenos">1351</span></a><span class="sd">        Integration:</span>
</span><span id="Supplier.update_graph-1352"><a href="#Supplier.update_graph-1352"><span class="linenos">1352</span></a><span class="sd">            - Called by: ReceiveTimeDelta behaviour</span>
</span><span id="Supplier.update_graph-1353"><a href="#Supplier.update_graph-1353"><span class="linenos">1353</span></a><span class="sd">            - Triggered by: time-delta messages from world agent</span>
</span><span id="Supplier.update_graph-1354"><a href="#Supplier.update_graph-1354"><span class="linenos">1354</span></a><span class="sd">            - Frequency: Every simulation tick with traffic updates</span>
</span><span id="Supplier.update_graph-1355"><a href="#Supplier.update_graph-1355"><span class="linenos">1355</span></a><span class="sd">        </span>
</span><span id="Supplier.update_graph-1356"><a href="#Supplier.update_graph-1356"><span class="linenos">1356</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.update_graph-1357"><a href="#Supplier.update_graph-1357"><span class="linenos">1357</span></a><span class="sd">            Only updates existing edges. If an edge doesn&#39;t exist in the graph,</span>
</span><span id="Supplier.update_graph-1358"><a href="#Supplier.update_graph-1358"><span class="linenos">1358</span></a><span class="sd">            it&#39;s silently skipped (safe behavior for malformed data).</span>
</span><span id="Supplier.update_graph-1359"><a href="#Supplier.update_graph-1359"><span class="linenos">1359</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.update_graph-1360"><a href="#Supplier.update_graph-1360"><span class="linenos">1360</span></a>        <span class="k">for</span> <span class="n">edge_info</span> <span class="ow">in</span> <span class="n">traffic_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;edges&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="Supplier.update_graph-1361"><a href="#Supplier.update_graph-1361"><span class="linenos">1361</span></a>                <span class="n">node1_id</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node1&quot;</span><span class="p">)</span>
</span><span id="Supplier.update_graph-1362"><a href="#Supplier.update_graph-1362"><span class="linenos">1362</span></a>                <span class="n">node2_id</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node2&quot;</span><span class="p">)</span>
</span><span id="Supplier.update_graph-1363"><a href="#Supplier.update_graph-1363"><span class="linenos">1363</span></a>                <span class="n">new_weight</span> <span class="o">=</span> <span class="n">edge_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span>
</span><span id="Supplier.update_graph-1364"><a href="#Supplier.update_graph-1364"><span class="linenos">1364</span></a>                
</span><span id="Supplier.update_graph-1365"><a href="#Supplier.update_graph-1365"><span class="linenos">1365</span></a>                <span class="n">edge</span> <span class="p">:</span> <span class="n">Edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">node1_id</span><span class="p">,</span> <span class="n">node2_id</span><span class="p">)</span>
</span><span id="Supplier.update_graph-1366"><a href="#Supplier.update_graph-1366"><span class="linenos">1366</span></a>                <span class="k">if</span> <span class="n">edge</span><span class="p">:</span>
</span><span id="Supplier.update_graph-1367"><a href="#Supplier.update_graph-1367"><span class="linenos">1367</span></a>                    <span class="n">edge</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">new_weight</span>
</span></pre></div>


            <div class="docstring"><p>Update world graph edge weights based on traffic conditions.</p>

<p>This function applies dynamic traffic updates received from the world agent
to the supplier's local copy of the world graph. Edge weights represent
travel costs/times and are updated to reflect current traffic conditions.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>traffic_data (dict):</strong>  Traffic update data with structure:
{
    "edges": [
        {
            "node1": int,  # First node ID
            "node2": int,  # Second node ID
            "weight": float  # New edge weight (time/cost)
        },
        ...
    ]
}</li>
</ul>

<h6 id="workflow">Workflow:</h6>

<blockquote>
  <ol>
  <li>Iterate through all edge updates in traffic_data</li>
  <li>Extract node1_id, node2_id, and new_weight</li>
  <li>Retrieve edge from graph using get_edge()</li>
  <li>Update edge.weight if edge exists</li>
  </ol>
</blockquote>

<h6 id="example">Example:</h6>

<blockquote>
<pre><code>Traffic Data:
{
    "edges": [
        {"node1": 10, "node2": 15, "weight": 120.5},
        {"node1": 15, "node2": 20, "weight": 95.3}
    ]
}

Actions:
    - Edge (10, 15): weight updated to 120.5
    - Edge (15, 20): weight updated to 95.3

Impact:
    - Vehicle routing recalculated with new weights
    - Delivery time estimates adjusted
    - Pathfinding uses updated costs
</code></pre>
</blockquote>

<h6 id="integration">Integration:</h6>

<blockquote>
  <ul>
  <li>Called by: ReceiveTimeDelta behaviour</li>
  <li>Triggered by: time-delta messages from world agent</li>
  <li>Frequency: Every simulation tick with traffic updates</li>
  </ul>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Only updates existing edges. If an edge doesn't exist in the graph,
  it's silently skipped (safe behavior for malformed data).</p>
</blockquote>
</div>


                            </div>
                            <div id="Supplier.message_to_order" class="classattr">
                                        <input id="Supplier.message_to_order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">message_to_order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">msg</span><span class="p">:</span> <span class="n">spade</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span></span><span class="return-annotation">) -> <span class="n">veiculos</span><span class="o">.</span><span class="n">veiculos</span><span class="o">.</span><span class="n">Order</span>:</span></span>

                <label class="view-source-button" for="Supplier.message_to_order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.message_to_order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.message_to_order-1369"><a href="#Supplier.message_to_order-1369"><span class="linenos">1369</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">message_to_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="Supplier.message_to_order-1370"><a href="#Supplier.message_to_order-1370"><span class="linenos">1370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.message_to_order-1371"><a href="#Supplier.message_to_order-1371"><span class="linenos">1371</span></a><span class="sd">        Convert warehouse-confirm message to Order object for delivery tracking.</span>
</span><span id="Supplier.message_to_order-1372"><a href="#Supplier.message_to_order-1372"><span class="linenos">1372</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1373"><a href="#Supplier.message_to_order-1373"><span class="linenos">1373</span></a><span class="sd">        This helper function transforms a FIPA accept-proposal message from a warehouse</span>
</span><span id="Supplier.message_to_order-1374"><a href="#Supplier.message_to_order-1374"><span class="linenos">1374</span></a><span class="sd">        into a structured Order object that can be stored in pending_deliveries</span>
</span><span id="Supplier.message_to_order-1375"><a href="#Supplier.message_to_order-1375"><span class="linenos">1375</span></a><span class="sd">        and assigned to vehicles for transportation.</span>
</span><span id="Supplier.message_to_order-1376"><a href="#Supplier.message_to_order-1376"><span class="linenos">1376</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1377"><a href="#Supplier.message_to_order-1377"><span class="linenos">1377</span></a><span class="sd">        FIPA Protocol Context:</span>
</span><span id="Supplier.message_to_order-1378"><a href="#Supplier.message_to_order-1378"><span class="linenos">1378</span></a><span class="sd">            - Triggered by: warehouse-confirm message (FIPA accept-proposal)</span>
</span><span id="Supplier.message_to_order-1379"><a href="#Supplier.message_to_order-1379"><span class="linenos">1379</span></a><span class="sd">            - Used by: ReceiveConfirmationOrDenial behaviour</span>
</span><span id="Supplier.message_to_order-1380"><a href="#Supplier.message_to_order-1380"><span class="linenos">1380</span></a><span class="sd">            - Purpose: Create deliverable order from confirmed proposal</span>
</span><span id="Supplier.message_to_order-1381"><a href="#Supplier.message_to_order-1381"><span class="linenos">1381</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1382"><a href="#Supplier.message_to_order-1382"><span class="linenos">1382</span></a><span class="sd">        Message Parsing:</span>
</span><span id="Supplier.message_to_order-1383"><a href="#Supplier.message_to_order-1383"><span class="linenos">1383</span></a><span class="sd">            Body Format: &quot;{quantity} {product}&quot;</span>
</span><span id="Supplier.message_to_order-1384"><a href="#Supplier.message_to_order-1384"><span class="linenos">1384</span></a><span class="sd">            Example: &quot;100 electronics&quot;</span>
</span><span id="Supplier.message_to_order-1385"><a href="#Supplier.message_to_order-1385"><span class="linenos">1385</span></a><span class="sd">            </span>
</span><span id="Supplier.message_to_order-1386"><a href="#Supplier.message_to_order-1386"><span class="linenos">1386</span></a><span class="sd">            Metadata Extracted:</span>
</span><span id="Supplier.message_to_order-1387"><a href="#Supplier.message_to_order-1387"><span class="linenos">1387</span></a><span class="sd">                - request_id: Unique order identifier</span>
</span><span id="Supplier.message_to_order-1388"><a href="#Supplier.message_to_order-1388"><span class="linenos">1388</span></a><span class="sd">                - node_id: Warehouse&#39;s graph location (delivery destination)</span>
</span><span id="Supplier.message_to_order-1389"><a href="#Supplier.message_to_order-1389"><span class="linenos">1389</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1390"><a href="#Supplier.message_to_order-1390"><span class="linenos">1390</span></a><span class="sd">        Args:</span>
</span><span id="Supplier.message_to_order-1391"><a href="#Supplier.message_to_order-1391"><span class="linenos">1391</span></a><span class="sd">            msg (Message): warehouse-confirm message with:</span>
</span><span id="Supplier.message_to_order-1392"><a href="#Supplier.message_to_order-1392"><span class="linenos">1392</span></a><span class="sd">                - Body: &quot;{quantity} {product}&quot;</span>
</span><span id="Supplier.message_to_order-1393"><a href="#Supplier.message_to_order-1393"><span class="linenos">1393</span></a><span class="sd">                - Metadata: request_id, node_id</span>
</span><span id="Supplier.message_to_order-1394"><a href="#Supplier.message_to_order-1394"><span class="linenos">1394</span></a><span class="sd">                - Sender: Warehouse JID</span>
</span><span id="Supplier.message_to_order-1395"><a href="#Supplier.message_to_order-1395"><span class="linenos">1395</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1396"><a href="#Supplier.message_to_order-1396"><span class="linenos">1396</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier.message_to_order-1397"><a href="#Supplier.message_to_order-1397"><span class="linenos">1397</span></a><span class="sd">            Order: Structured order object with:</span>
</span><span id="Supplier.message_to_order-1398"><a href="#Supplier.message_to_order-1398"><span class="linenos">1398</span></a><span class="sd">                - product: Product type</span>
</span><span id="Supplier.message_to_order-1399"><a href="#Supplier.message_to_order-1399"><span class="linenos">1399</span></a><span class="sd">                - quantity: Amount to deliver</span>
</span><span id="Supplier.message_to_order-1400"><a href="#Supplier.message_to_order-1400"><span class="linenos">1400</span></a><span class="sd">                - orderid: Unique identifier</span>
</span><span id="Supplier.message_to_order-1401"><a href="#Supplier.message_to_order-1401"><span class="linenos">1401</span></a><span class="sd">                - sender: Warehouse JID (delivery destination)</span>
</span><span id="Supplier.message_to_order-1402"><a href="#Supplier.message_to_order-1402"><span class="linenos">1402</span></a><span class="sd">                - receiver: Supplier JID (pickup location)</span>
</span><span id="Supplier.message_to_order-1403"><a href="#Supplier.message_to_order-1403"><span class="linenos">1403</span></a><span class="sd">                - sender_location: Warehouse&#39;s graph node</span>
</span><span id="Supplier.message_to_order-1404"><a href="#Supplier.message_to_order-1404"><span class="linenos">1404</span></a><span class="sd">                - receiver_location: Supplier&#39;s graph node</span>
</span><span id="Supplier.message_to_order-1405"><a href="#Supplier.message_to_order-1405"><span class="linenos">1405</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1406"><a href="#Supplier.message_to_order-1406"><span class="linenos">1406</span></a><span class="sd">        Order Object Structure:</span>
</span><span id="Supplier.message_to_order-1407"><a href="#Supplier.message_to_order-1407"><span class="linenos">1407</span></a><span class="sd">            The Order uses inverted semantics for delivery context:</span>
</span><span id="Supplier.message_to_order-1408"><a href="#Supplier.message_to_order-1408"><span class="linenos">1408</span></a><span class="sd">            - sender = Warehouse (WHERE to deliver)</span>
</span><span id="Supplier.message_to_order-1409"><a href="#Supplier.message_to_order-1409"><span class="linenos">1409</span></a><span class="sd">            - receiver = Supplier (WHERE to pickup)</span>
</span><span id="Supplier.message_to_order-1410"><a href="#Supplier.message_to_order-1410"><span class="linenos">1410</span></a><span class="sd">            - sender_location = Warehouse node (delivery destination)</span>
</span><span id="Supplier.message_to_order-1411"><a href="#Supplier.message_to_order-1411"><span class="linenos">1411</span></a><span class="sd">            - receiver_location = Supplier node (pickup origin)</span>
</span><span id="Supplier.message_to_order-1412"><a href="#Supplier.message_to_order-1412"><span class="linenos">1412</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1413"><a href="#Supplier.message_to_order-1413"><span class="linenos">1413</span></a><span class="sd">        Example:</span>
</span><span id="Supplier.message_to_order-1414"><a href="#Supplier.message_to_order-1414"><span class="linenos">1414</span></a><span class="sd">            ```</span>
</span><span id="Supplier.message_to_order-1415"><a href="#Supplier.message_to_order-1415"><span class="linenos">1415</span></a><span class="sd">            Input Message (warehouse-confirm):</span>
</span><span id="Supplier.message_to_order-1416"><a href="#Supplier.message_to_order-1416"><span class="linenos">1416</span></a><span class="sd">                Body: &quot;100 electronics&quot;</span>
</span><span id="Supplier.message_to_order-1417"><a href="#Supplier.message_to_order-1417"><span class="linenos">1417</span></a><span class="sd">                Metadata:</span>
</span><span id="Supplier.message_to_order-1418"><a href="#Supplier.message_to_order-1418"><span class="linenos">1418</span></a><span class="sd">                    - request_id: &quot;301000000&quot;</span>
</span><span id="Supplier.message_to_order-1419"><a href="#Supplier.message_to_order-1419"><span class="linenos">1419</span></a><span class="sd">                    - node_id: &quot;10&quot;</span>
</span><span id="Supplier.message_to_order-1420"><a href="#Supplier.message_to_order-1420"><span class="linenos">1420</span></a><span class="sd">                Sender: &quot;warehouse1@localhost&quot;</span>
</span><span id="Supplier.message_to_order-1421"><a href="#Supplier.message_to_order-1421"><span class="linenos">1421</span></a><span class="sd">            </span>
</span><span id="Supplier.message_to_order-1422"><a href="#Supplier.message_to_order-1422"><span class="linenos">1422</span></a><span class="sd">            Supplier: &quot;supplier1@localhost&quot; at node 20</span>
</span><span id="Supplier.message_to_order-1423"><a href="#Supplier.message_to_order-1423"><span class="linenos">1423</span></a><span class="sd">            </span>
</span><span id="Supplier.message_to_order-1424"><a href="#Supplier.message_to_order-1424"><span class="linenos">1424</span></a><span class="sd">            Output Order:</span>
</span><span id="Supplier.message_to_order-1425"><a href="#Supplier.message_to_order-1425"><span class="linenos">1425</span></a><span class="sd">                product: &quot;electronics&quot;</span>
</span><span id="Supplier.message_to_order-1426"><a href="#Supplier.message_to_order-1426"><span class="linenos">1426</span></a><span class="sd">                quantity: 100</span>
</span><span id="Supplier.message_to_order-1427"><a href="#Supplier.message_to_order-1427"><span class="linenos">1427</span></a><span class="sd">                orderid: &quot;301000000&quot;</span>
</span><span id="Supplier.message_to_order-1428"><a href="#Supplier.message_to_order-1428"><span class="linenos">1428</span></a><span class="sd">                sender: &quot;warehouse1@localhost&quot;</span>
</span><span id="Supplier.message_to_order-1429"><a href="#Supplier.message_to_order-1429"><span class="linenos">1429</span></a><span class="sd">                receiver: &quot;supplier1@localhost&quot;</span>
</span><span id="Supplier.message_to_order-1430"><a href="#Supplier.message_to_order-1430"><span class="linenos">1430</span></a><span class="sd">                sender_location: 10 (warehouse node)</span>
</span><span id="Supplier.message_to_order-1431"><a href="#Supplier.message_to_order-1431"><span class="linenos">1431</span></a><span class="sd">                receiver_location: 20 (supplier node)</span>
</span><span id="Supplier.message_to_order-1432"><a href="#Supplier.message_to_order-1432"><span class="linenos">1432</span></a><span class="sd">            ```</span>
</span><span id="Supplier.message_to_order-1433"><a href="#Supplier.message_to_order-1433"><span class="linenos">1433</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1434"><a href="#Supplier.message_to_order-1434"><span class="linenos">1434</span></a><span class="sd">        Integration:</span>
</span><span id="Supplier.message_to_order-1435"><a href="#Supplier.message_to_order-1435"><span class="linenos">1435</span></a><span class="sd">            Created Order is added to self.pending_deliveries[order_id]</span>
</span><span id="Supplier.message_to_order-1436"><a href="#Supplier.message_to_order-1436"><span class="linenos">1436</span></a><span class="sd">            and passed to AssignVehicle behaviour for transportation.</span>
</span><span id="Supplier.message_to_order-1437"><a href="#Supplier.message_to_order-1437"><span class="linenos">1437</span></a><span class="sd">        </span>
</span><span id="Supplier.message_to_order-1438"><a href="#Supplier.message_to_order-1438"><span class="linenos">1438</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.message_to_order-1439"><a href="#Supplier.message_to_order-1439"><span class="linenos">1439</span></a><span class="sd">            This mirrors the message_to_order function in warehouse.py but</span>
</span><span id="Supplier.message_to_order-1440"><a href="#Supplier.message_to_order-1440"><span class="linenos">1440</span></a><span class="sd">            processes warehouse-confirm instead of store-confirm messages.</span>
</span><span id="Supplier.message_to_order-1441"><a href="#Supplier.message_to_order-1441"><span class="linenos">1441</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.message_to_order-1442"><a href="#Supplier.message_to_order-1442"><span class="linenos">1442</span></a>        <span class="n">body</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span>
</span><span id="Supplier.message_to_order-1443"><a href="#Supplier.message_to_order-1443"><span class="linenos">1443</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.message_to_order-1444"><a href="#Supplier.message_to_order-1444"><span class="linenos">1444</span></a>        <span class="n">quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.message_to_order-1445"><a href="#Supplier.message_to_order-1445"><span class="linenos">1445</span></a>        <span class="n">product</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.message_to_order-1446"><a href="#Supplier.message_to_order-1446"><span class="linenos">1446</span></a>        
</span><span id="Supplier.message_to_order-1447"><a href="#Supplier.message_to_order-1447"><span class="linenos">1447</span></a>        <span class="n">order_id</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">)</span>
</span><span id="Supplier.message_to_order-1448"><a href="#Supplier.message_to_order-1448"><span class="linenos">1448</span></a>        <span class="n">sender</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>  <span class="c1"># Warehouse JID</span>
</span><span id="Supplier.message_to_order-1449"><a href="#Supplier.message_to_order-1449"><span class="linenos">1449</span></a>        <span class="n">receiver</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>  <span class="c1"># Supplier JID</span>
</span><span id="Supplier.message_to_order-1450"><a href="#Supplier.message_to_order-1450"><span class="linenos">1450</span></a>        <span class="n">warehouse_location</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">))</span>
</span><span id="Supplier.message_to_order-1451"><a href="#Supplier.message_to_order-1451"><span class="linenos">1451</span></a>        <span class="n">supplier_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span>
</span><span id="Supplier.message_to_order-1452"><a href="#Supplier.message_to_order-1452"><span class="linenos">1452</span></a>        <span class="n">tick</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_tick</span>
</span><span id="Supplier.message_to_order-1453"><a href="#Supplier.message_to_order-1453"><span class="linenos">1453</span></a>        
</span><span id="Supplier.message_to_order-1454"><a href="#Supplier.message_to_order-1454"><span class="linenos">1454</span></a>        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
</span><span id="Supplier.message_to_order-1455"><a href="#Supplier.message_to_order-1455"><span class="linenos">1455</span></a>            <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span>
</span><span id="Supplier.message_to_order-1456"><a href="#Supplier.message_to_order-1456"><span class="linenos">1456</span></a>            <span class="n">quantity</span><span class="o">=</span><span class="n">quantity</span><span class="p">,</span>
</span><span id="Supplier.message_to_order-1457"><a href="#Supplier.message_to_order-1457"><span class="linenos">1457</span></a>            <span class="n">orderid</span><span class="o">=</span><span class="n">order_id</span><span class="p">,</span>
</span><span id="Supplier.message_to_order-1458"><a href="#Supplier.message_to_order-1458"><span class="linenos">1458</span></a>            <span class="n">sender</span><span class="o">=</span><span class="n">sender</span><span class="p">,</span>
</span><span id="Supplier.message_to_order-1459"><a href="#Supplier.message_to_order-1459"><span class="linenos">1459</span></a>            <span class="n">receiver</span><span class="o">=</span><span class="n">receiver</span>
</span><span id="Supplier.message_to_order-1460"><a href="#Supplier.message_to_order-1460"><span class="linenos">1460</span></a>        <span class="p">)</span>
</span><span id="Supplier.message_to_order-1461"><a href="#Supplier.message_to_order-1461"><span class="linenos">1461</span></a>        
</span><span id="Supplier.message_to_order-1462"><a href="#Supplier.message_to_order-1462"><span class="linenos">1462</span></a>        <span class="c1"># Set locations</span>
</span><span id="Supplier.message_to_order-1463"><a href="#Supplier.message_to_order-1463"><span class="linenos">1463</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span> <span class="o">=</span> <span class="n">warehouse_location</span>  <span class="c1"># Warehouse location</span>
</span><span id="Supplier.message_to_order-1464"><a href="#Supplier.message_to_order-1464"><span class="linenos">1464</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span> <span class="o">=</span> <span class="n">supplier_location</span>  <span class="c1"># Supplier location</span>
</span><span id="Supplier.message_to_order-1465"><a href="#Supplier.message_to_order-1465"><span class="linenos">1465</span></a>        
</span><span id="Supplier.message_to_order-1466"><a href="#Supplier.message_to_order-1466"><span class="linenos">1466</span></a>        <span class="k">return</span> <span class="n">order</span>
</span></pre></div>


            <div class="docstring"><p>Convert warehouse-confirm message to Order object for delivery tracking.</p>

<p>This helper function transforms a FIPA accept-proposal message from a warehouse
into a structured Order object that can be stored in pending_deliveries
and assigned to vehicles for transportation.</p>

<h6 id="fipa-protocol-context">FIPA Protocol Context:</h6>

<blockquote>
  <ul>
  <li>Triggered by: warehouse-confirm message (FIPA accept-proposal)</li>
  <li>Used by: ReceiveConfirmationOrDenial behaviour</li>
  <li>Purpose: Create deliverable order from confirmed proposal</li>
  </ul>
</blockquote>

<h6 id="message-parsing">Message Parsing:</h6>

<blockquote>
  <p>Body Format: "{quantity} {product}"
  Example: "100 electronics"</p>
  
  <p>Metadata Extracted:
      - request_id: Unique order identifier
      - node_id: Warehouse's graph location (delivery destination)</p>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>msg (Message):</strong>  warehouse-confirm message with:
<ul>
<li>Body: "{quantity} {product}"</li>
<li>Metadata: request_id, node_id</li>
<li>Sender: Warehouse JID</li>
</ul></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Order: Structured order object with:
      - product: Product type
      - quantity: Amount to deliver
      - orderid: Unique identifier
      - sender: Warehouse JID (delivery destination)
      - receiver: Supplier JID (pickup location)
      - sender_location: Warehouse's graph node
      - receiver_location: Supplier's graph node</p>
</blockquote>

<h6 id="order-object-structure">Order Object Structure:</h6>

<blockquote>
  <p>The Order uses inverted semantics for delivery context:</p>
  
  <ul>
  <li>sender = Warehouse (WHERE to deliver)</li>
  <li>receiver = Supplier (WHERE to pickup)</li>
  <li>sender_location = Warehouse node (delivery destination)</li>
  <li>receiver_location = Supplier node (pickup origin)</li>
  </ul>
</blockquote>

<h6 id="example">Example:</h6>

<blockquote>
<pre><code>Input Message (warehouse-confirm):
    Body: "100 electronics"
    Metadata:
        - request_id: "301000000"
        - node_id: "10"
    Sender: "warehouse1@localhost"

Supplier: "supplier1@localhost" at node 20

Output Order:
    product: "electronics"
    quantity: 100
    orderid: "301000000"
    sender: "warehouse1@localhost"
    receiver: "supplier1@localhost"
    sender_location: 10 (warehouse node)
    receiver_location: 20 (supplier node)
</code></pre>
</blockquote>

<h6 id="integration">Integration:</h6>

<blockquote>
  <p>Created Order is added to self.pending_deliveries[order_id]
  and passed to AssignVehicle behaviour for transportation.</p>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>This mirrors the message_to_order function in warehouse.py but
  processes warehouse-confirm instead of store-confirm messages.</p>
</blockquote>
</div>


                            </div>
                            <div id="Supplier.dict_to_order" class="classattr">
                                        <input id="Supplier.dict_to_order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dict_to_order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="n">veiculos</span><span class="o">.</span><span class="n">veiculos</span><span class="o">.</span><span class="n">Order</span>:</span></span>

                <label class="view-source-button" for="Supplier.dict_to_order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.dict_to_order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.dict_to_order-1469"><a href="#Supplier.dict_to_order-1469"><span class="linenos">1469</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dict_to_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="Supplier.dict_to_order-1470"><a href="#Supplier.dict_to_order-1470"><span class="linenos">1470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.dict_to_order-1471"><a href="#Supplier.dict_to_order-1471"><span class="linenos">1471</span></a><span class="sd">        Convert dictionary data to Order object (for vehicle communication).</span>
</span><span id="Supplier.dict_to_order-1472"><a href="#Supplier.dict_to_order-1472"><span class="linenos">1472</span></a><span class="sd">        </span>
</span><span id="Supplier.dict_to_order-1473"><a href="#Supplier.dict_to_order-1473"><span class="linenos">1473</span></a><span class="sd">        This helper function reconstructs an Order object from dictionary data,</span>
</span><span id="Supplier.dict_to_order-1474"><a href="#Supplier.dict_to_order-1474"><span class="linenos">1474</span></a><span class="sd">        typically received from vehicle messages (vehicle-pickup). It&#39;s the</span>
</span><span id="Supplier.dict_to_order-1475"><a href="#Supplier.dict_to_order-1475"><span class="linenos">1475</span></a><span class="sd">        inverse operation of serializing an order to JSON.</span>
</span><span id="Supplier.dict_to_order-1476"><a href="#Supplier.dict_to_order-1476"><span class="linenos">1476</span></a><span class="sd">        </span>
</span><span id="Supplier.dict_to_order-1477"><a href="#Supplier.dict_to_order-1477"><span class="linenos">1477</span></a><span class="sd">        Args:</span>
</span><span id="Supplier.dict_to_order-1478"><a href="#Supplier.dict_to_order-1478"><span class="linenos">1478</span></a><span class="sd">            data (dict): Dictionary containing order information with keys:</span>
</span><span id="Supplier.dict_to_order-1479"><a href="#Supplier.dict_to_order-1479"><span class="linenos">1479</span></a><span class="sd">                - product (str): Product type</span>
</span><span id="Supplier.dict_to_order-1480"><a href="#Supplier.dict_to_order-1480"><span class="linenos">1480</span></a><span class="sd">                - quantity (int): Amount to deliver</span>
</span><span id="Supplier.dict_to_order-1481"><a href="#Supplier.dict_to_order-1481"><span class="linenos">1481</span></a><span class="sd">                - orderid (int): Unique order identifier</span>
</span><span id="Supplier.dict_to_order-1482"><a href="#Supplier.dict_to_order-1482"><span class="linenos">1482</span></a><span class="sd">                - sender (str): Warehouse JID (delivery destination)</span>
</span><span id="Supplier.dict_to_order-1483"><a href="#Supplier.dict_to_order-1483"><span class="linenos">1483</span></a><span class="sd">                - receiver (str): Supplier JID (pickup location)</span>
</span><span id="Supplier.dict_to_order-1484"><a href="#Supplier.dict_to_order-1484"><span class="linenos">1484</span></a><span class="sd">                - sender_location (int, optional): Warehouse graph node</span>
</span><span id="Supplier.dict_to_order-1485"><a href="#Supplier.dict_to_order-1485"><span class="linenos">1485</span></a><span class="sd">                - receiver_location (int, optional): Supplier graph node</span>
</span><span id="Supplier.dict_to_order-1486"><a href="#Supplier.dict_to_order-1486"><span class="linenos">1486</span></a><span class="sd">        </span>
</span><span id="Supplier.dict_to_order-1487"><a href="#Supplier.dict_to_order-1487"><span class="linenos">1487</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier.dict_to_order-1488"><a href="#Supplier.dict_to_order-1488"><span class="linenos">1488</span></a><span class="sd">            Order: Reconstructed Order object with all attributes populated.</span>
</span><span id="Supplier.dict_to_order-1489"><a href="#Supplier.dict_to_order-1489"><span class="linenos">1489</span></a><span class="sd">        </span>
</span><span id="Supplier.dict_to_order-1490"><a href="#Supplier.dict_to_order-1490"><span class="linenos">1490</span></a><span class="sd">        Example:</span>
</span><span id="Supplier.dict_to_order-1491"><a href="#Supplier.dict_to_order-1491"><span class="linenos">1491</span></a><span class="sd">            ```</span>
</span><span id="Supplier.dict_to_order-1492"><a href="#Supplier.dict_to_order-1492"><span class="linenos">1492</span></a><span class="sd">            Input Dictionary:</span>
</span><span id="Supplier.dict_to_order-1493"><a href="#Supplier.dict_to_order-1493"><span class="linenos">1493</span></a><span class="sd">            {</span>
</span><span id="Supplier.dict_to_order-1494"><a href="#Supplier.dict_to_order-1494"><span class="linenos">1494</span></a><span class="sd">                &quot;product&quot;: &quot;electronics&quot;,</span>
</span><span id="Supplier.dict_to_order-1495"><a href="#Supplier.dict_to_order-1495"><span class="linenos">1495</span></a><span class="sd">                &quot;quantity&quot;: 100,</span>
</span><span id="Supplier.dict_to_order-1496"><a href="#Supplier.dict_to_order-1496"><span class="linenos">1496</span></a><span class="sd">                &quot;orderid&quot;: 301000000,</span>
</span><span id="Supplier.dict_to_order-1497"><a href="#Supplier.dict_to_order-1497"><span class="linenos">1497</span></a><span class="sd">                &quot;sender&quot;: &quot;warehouse1@localhost&quot;,</span>
</span><span id="Supplier.dict_to_order-1498"><a href="#Supplier.dict_to_order-1498"><span class="linenos">1498</span></a><span class="sd">                &quot;receiver&quot;: &quot;supplier1@localhost&quot;,</span>
</span><span id="Supplier.dict_to_order-1499"><a href="#Supplier.dict_to_order-1499"><span class="linenos">1499</span></a><span class="sd">                &quot;sender_location&quot;: 10,</span>
</span><span id="Supplier.dict_to_order-1500"><a href="#Supplier.dict_to_order-1500"><span class="linenos">1500</span></a><span class="sd">                &quot;receiver_location&quot;: 20</span>
</span><span id="Supplier.dict_to_order-1501"><a href="#Supplier.dict_to_order-1501"><span class="linenos">1501</span></a><span class="sd">            }</span>
</span><span id="Supplier.dict_to_order-1502"><a href="#Supplier.dict_to_order-1502"><span class="linenos">1502</span></a><span class="sd">            </span>
</span><span id="Supplier.dict_to_order-1503"><a href="#Supplier.dict_to_order-1503"><span class="linenos">1503</span></a><span class="sd">            Output Order:</span>
</span><span id="Supplier.dict_to_order-1504"><a href="#Supplier.dict_to_order-1504"><span class="linenos">1504</span></a><span class="sd">                order.product = &quot;electronics&quot;</span>
</span><span id="Supplier.dict_to_order-1505"><a href="#Supplier.dict_to_order-1505"><span class="linenos">1505</span></a><span class="sd">                order.quantity = 100</span>
</span><span id="Supplier.dict_to_order-1506"><a href="#Supplier.dict_to_order-1506"><span class="linenos">1506</span></a><span class="sd">                order.orderid = 301000000</span>
</span><span id="Supplier.dict_to_order-1507"><a href="#Supplier.dict_to_order-1507"><span class="linenos">1507</span></a><span class="sd">                order.sender = &quot;warehouse1@localhost&quot;</span>
</span><span id="Supplier.dict_to_order-1508"><a href="#Supplier.dict_to_order-1508"><span class="linenos">1508</span></a><span class="sd">                order.receiver = &quot;supplier1@localhost&quot;</span>
</span><span id="Supplier.dict_to_order-1509"><a href="#Supplier.dict_to_order-1509"><span class="linenos">1509</span></a><span class="sd">                order.sender_location = 10</span>
</span><span id="Supplier.dict_to_order-1510"><a href="#Supplier.dict_to_order-1510"><span class="linenos">1510</span></a><span class="sd">                order.receiver_location = 20</span>
</span><span id="Supplier.dict_to_order-1511"><a href="#Supplier.dict_to_order-1511"><span class="linenos">1511</span></a><span class="sd">            ```</span>
</span><span id="Supplier.dict_to_order-1512"><a href="#Supplier.dict_to_order-1512"><span class="linenos">1512</span></a><span class="sd">        </span>
</span><span id="Supplier.dict_to_order-1513"><a href="#Supplier.dict_to_order-1513"><span class="linenos">1513</span></a><span class="sd">        Use Cases:</span>
</span><span id="Supplier.dict_to_order-1514"><a href="#Supplier.dict_to_order-1514"><span class="linenos">1514</span></a><span class="sd">            - Parsing vehicle-pickup messages</span>
</span><span id="Supplier.dict_to_order-1515"><a href="#Supplier.dict_to_order-1515"><span class="linenos">1515</span></a><span class="sd">            - Reconstructing orders from JSON body</span>
</span><span id="Supplier.dict_to_order-1516"><a href="#Supplier.dict_to_order-1516"><span class="linenos">1516</span></a><span class="sd">            - Vehicle coordination communication</span>
</span><span id="Supplier.dict_to_order-1517"><a href="#Supplier.dict_to_order-1517"><span class="linenos">1517</span></a><span class="sd">        </span>
</span><span id="Supplier.dict_to_order-1518"><a href="#Supplier.dict_to_order-1518"><span class="linenos">1518</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.dict_to_order-1519"><a href="#Supplier.dict_to_order-1519"><span class="linenos">1519</span></a><span class="sd">            Uses safe dictionary access (.get()) for location fields to handle</span>
</span><span id="Supplier.dict_to_order-1520"><a href="#Supplier.dict_to_order-1520"><span class="linenos">1520</span></a><span class="sd">            cases where location data might not be present.</span>
</span><span id="Supplier.dict_to_order-1521"><a href="#Supplier.dict_to_order-1521"><span class="linenos">1521</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.dict_to_order-1522"><a href="#Supplier.dict_to_order-1522"><span class="linenos">1522</span></a>        <span class="n">order</span> <span class="o">=</span>  <span class="n">Order</span><span class="p">(</span>
</span><span id="Supplier.dict_to_order-1523"><a href="#Supplier.dict_to_order-1523"><span class="linenos">1523</span></a>            <span class="n">product</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">],</span>
</span><span id="Supplier.dict_to_order-1524"><a href="#Supplier.dict_to_order-1524"><span class="linenos">1524</span></a>            <span class="n">quantity</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">],</span>
</span><span id="Supplier.dict_to_order-1525"><a href="#Supplier.dict_to_order-1525"><span class="linenos">1525</span></a>            <span class="n">orderid</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;orderid&quot;</span><span class="p">],</span>
</span><span id="Supplier.dict_to_order-1526"><a href="#Supplier.dict_to_order-1526"><span class="linenos">1526</span></a>            <span class="n">sender</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sender&quot;</span><span class="p">],</span>
</span><span id="Supplier.dict_to_order-1527"><a href="#Supplier.dict_to_order-1527"><span class="linenos">1527</span></a>            <span class="n">receiver</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;receiver&quot;</span><span class="p">]</span>
</span><span id="Supplier.dict_to_order-1528"><a href="#Supplier.dict_to_order-1528"><span class="linenos">1528</span></a>        <span class="p">)</span>
</span><span id="Supplier.dict_to_order-1529"><a href="#Supplier.dict_to_order-1529"><span class="linenos">1529</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sender_location&quot;</span><span class="p">)</span>
</span><span id="Supplier.dict_to_order-1530"><a href="#Supplier.dict_to_order-1530"><span class="linenos">1530</span></a>        <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;receiver_location&quot;</span><span class="p">)</span>
</span><span id="Supplier.dict_to_order-1531"><a href="#Supplier.dict_to_order-1531"><span class="linenos">1531</span></a>        <span class="k">return</span> <span class="n">order</span>
</span></pre></div>


            <div class="docstring"><p>Convert dictionary data to Order object (for vehicle communication).</p>

<p>This helper function reconstructs an Order object from dictionary data,
typically received from vehicle messages (vehicle-pickup). It's the
inverse operation of serializing an order to JSON.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data (dict):</strong>  Dictionary containing order information with keys:
<ul>
<li>product (str): Product type</li>
<li>quantity (int): Amount to deliver</li>
<li>orderid (int): Unique order identifier</li>
<li>sender (str): Warehouse JID (delivery destination)</li>
<li>receiver (str): Supplier JID (pickup location)</li>
<li>sender_location (int, optional): Warehouse graph node</li>
<li>receiver_location (int, optional): Supplier graph node</li>
</ul></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Order: Reconstructed Order object with all attributes populated.</p>
</blockquote>

<h6 id="example">Example:</h6>

<blockquote>
<pre><code>Input Dictionary:
{
    "product": "electronics",
    "quantity": 100,
    "orderid": 301000000,
    "sender": "warehouse1@localhost",
    "receiver": "supplier1@localhost",
    "sender_location": 10,
    "receiver_location": 20
}

Output Order:
    order.product = "electronics"
    order.quantity = 100
    order.orderid = 301000000
    order.sender = "warehouse1@localhost"
    order.receiver = "supplier1@localhost"
    order.sender_location = 10
    order.receiver_location = 20
</code></pre>
</blockquote>

<h6 id="use-cases">Use Cases:</h6>

<blockquote>
  <ul>
  <li>Parsing vehicle-pickup messages</li>
  <li>Reconstructing orders from JSON body</li>
  <li>Vehicle coordination communication</li>
  </ul>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Uses safe dictionary access (.get()) for location fields to handle
  cases where location data might not be present.</p>
</blockquote>
</div>


                            </div>
                            <div id="Supplier.node_id" class="classattr">
                                <div class="attr variable">
            <span class="name">node_id</span>

        
    </div>
    <a class="headerlink" href="#Supplier.node_id"></a>
    
    

                            </div>
                            <div id="Supplier.map" class="classattr">
                                <div class="attr variable">
            <span class="name">map</span><span class="annotation">: world.graph.Graph</span>

        
    </div>
    <a class="headerlink" href="#Supplier.map"></a>
    
    

                            </div>
                            <div id="Supplier.pos_x" class="classattr">
                                <div class="attr variable">
            <span class="name">pos_x</span>

        
    </div>
    <a class="headerlink" href="#Supplier.pos_x"></a>
    
    

                            </div>
                            <div id="Supplier.pos_y" class="classattr">
                                <div class="attr variable">
            <span class="name">pos_y</span>

        
    </div>
    <a class="headerlink" href="#Supplier.pos_y"></a>
    
    

                            </div>
                            <div id="Supplier.contact_list" class="classattr">
                                <div class="attr variable">
            <span class="name">contact_list</span>

        
    </div>
    <a class="headerlink" href="#Supplier.contact_list"></a>
    
    

                            </div>
                            <div id="Supplier.verbose" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose</span>

        
    </div>
    <a class="headerlink" href="#Supplier.verbose"></a>
    
    

                            </div>
                            <div id="Supplier.id_base" class="classattr">
                                <div class="attr variable">
            <span class="name">id_base</span>

        
    </div>
    <a class="headerlink" href="#Supplier.id_base"></a>
    
    

                            </div>
                            <div id="Supplier.setup" class="classattr">
                                        <input id="Supplier.setup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">setup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.setup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.setup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.setup-1623"><a href="#Supplier.setup-1623"><span class="linenos">1623</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.setup-1624"><a href="#Supplier.setup-1624"><span class="linenos">1624</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.setup-1625"><a href="#Supplier.setup-1625"><span class="linenos">1625</span></a><span class="sd">        Configure supplier state and register all FIPA protocol behaviours.</span>
</span><span id="Supplier.setup-1626"><a href="#Supplier.setup-1626"><span class="linenos">1626</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1627"><a href="#Supplier.setup-1627"><span class="linenos">1627</span></a><span class="sd">        This method is automatically called by SPADE after the agent successfully</span>
</span><span id="Supplier.setup-1628"><a href="#Supplier.setup-1628"><span class="linenos">1628</span></a><span class="sd">        connects to the XMPP server. It initializes the supplier&#39;s operational</span>
</span><span id="Supplier.setup-1629"><a href="#Supplier.setup-1629"><span class="linenos">1629</span></a><span class="sd">        state and registers all cyclic behaviours needed for the FIPA Contract Net</span>
</span><span id="Supplier.setup-1630"><a href="#Supplier.setup-1630"><span class="linenos">1630</span></a><span class="sd">        Protocol implementation as a participant.</span>
</span><span id="Supplier.setup-1631"><a href="#Supplier.setup-1631"><span class="linenos">1631</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1632"><a href="#Supplier.setup-1632"><span class="linenos">1632</span></a><span class="sd">        Setup Process:</span>
</span><span id="Supplier.setup-1633"><a href="#Supplier.setup-1633"><span class="linenos">1633</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1634"><a href="#Supplier.setup-1634"><span class="linenos">1634</span></a><span class="sd">            **Phase 1: Presence Management**</span>
</span><span id="Supplier.setup-1635"><a href="#Supplier.setup-1635"><span class="linenos">1635</span></a><span class="sd">                - Enable auto-approval of presence subscriptions</span>
</span><span id="Supplier.setup-1636"><a href="#Supplier.setup-1636"><span class="linenos">1636</span></a><span class="sd">                - Subscribe to all contacts (warehouses and vehicles)</span>
</span><span id="Supplier.setup-1637"><a href="#Supplier.setup-1637"><span class="linenos">1637</span></a><span class="sd">                - Enables presence-based availability checking</span>
</span><span id="Supplier.setup-1638"><a href="#Supplier.setup-1638"><span class="linenos">1638</span></a><span class="sd">            </span>
</span><span id="Supplier.setup-1639"><a href="#Supplier.setup-1639"><span class="linenos">1639</span></a><span class="sd">            **Phase 2: State Initialization**</span>
</span><span id="Supplier.setup-1640"><a href="#Supplier.setup-1640"><span class="linenos">1640</span></a><span class="sd">                - total_supplied: Dictionary tracking cumulative supply per product</span>
</span><span id="Supplier.setup-1641"><a href="#Supplier.setup-1641"><span class="linenos">1641</span></a><span class="sd">                - current_tick: Simulation time (starts at 0)</span>
</span><span id="Supplier.setup-1642"><a href="#Supplier.setup-1642"><span class="linenos">1642</span></a><span class="sd">                - pending_deliveries: Orders confirmed but not picked up</span>
</span><span id="Supplier.setup-1643"><a href="#Supplier.setup-1643"><span class="linenos">1643</span></a><span class="sd">                - vehicle_proposals: Vehicle delivery quotes per order</span>
</span><span id="Supplier.setup-1644"><a href="#Supplier.setup-1644"><span class="linenos">1644</span></a><span class="sd">                - vehicles: List of vehicle JIDs (populated dynamically)</span>
</span><span id="Supplier.setup-1645"><a href="#Supplier.setup-1645"><span class="linenos">1645</span></a><span class="sd">                - presence_infos: Vehicle availability cache</span>
</span><span id="Supplier.setup-1646"><a href="#Supplier.setup-1646"><span class="linenos">1646</span></a><span class="sd">            </span>
</span><span id="Supplier.setup-1647"><a href="#Supplier.setup-1647"><span class="linenos">1647</span></a><span class="sd">            **Phase 3: Behaviour Registration**</span>
</span><span id="Supplier.setup-1648"><a href="#Supplier.setup-1648"><span class="linenos">1648</span></a><span class="sd">                1. ReceiveBuyRequest (Warehouse Interaction - FIPA Participant)</span>
</span><span id="Supplier.setup-1649"><a href="#Supplier.setup-1649"><span class="linenos">1649</span></a><span class="sd">                2. ReceiveVehicleProposals (Vehicle Coordination - Proposal Collection)</span>
</span><span id="Supplier.setup-1650"><a href="#Supplier.setup-1650"><span class="linenos">1650</span></a><span class="sd">                3. ReceiveVehicleArrival (Vehicle Coordination - Pickup Handling)</span>
</span><span id="Supplier.setup-1651"><a href="#Supplier.setup-1651"><span class="linenos">1651</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1652"><a href="#Supplier.setup-1652"><span class="linenos">1652</span></a><span class="sd">        Behaviour Registration Details:</span>
</span><span id="Supplier.setup-1653"><a href="#Supplier.setup-1653"><span class="linenos">1653</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1654"><a href="#Supplier.setup-1654"><span class="linenos">1654</span></a><span class="sd">            **ReceiveBuyRequest** (CyclicBehaviour):</span>
</span><span id="Supplier.setup-1655"><a href="#Supplier.setup-1655"><span class="linenos">1655</span></a><span class="sd">                - Template: performative = &quot;warehouse-buy&quot;</span>
</span><span id="Supplier.setup-1656"><a href="#Supplier.setup-1656"><span class="linenos">1656</span></a><span class="sd">                - Purpose: Listen for warehouse purchase requests (FIPA CFP)</span>
</span><span id="Supplier.setup-1657"><a href="#Supplier.setup-1657"><span class="linenos">1657</span></a><span class="sd">                - Role: FIPA Participant (responds to warehouses)</span>
</span><span id="Supplier.setup-1658"><a href="#Supplier.setup-1658"><span class="linenos">1658</span></a><span class="sd">                - Action: Always accepts (infinite stock)</span>
</span><span id="Supplier.setup-1659"><a href="#Supplier.setup-1659"><span class="linenos">1659</span></a><span class="sd">            </span>
</span><span id="Supplier.setup-1660"><a href="#Supplier.setup-1660"><span class="linenos">1660</span></a><span class="sd">            **ReceiveVehicleProposals** (CyclicBehaviour):</span>
</span><span id="Supplier.setup-1661"><a href="#Supplier.setup-1661"><span class="linenos">1661</span></a><span class="sd">                - Template: performative = &quot;vehicle-proposal&quot;</span>
</span><span id="Supplier.setup-1662"><a href="#Supplier.setup-1662"><span class="linenos">1662</span></a><span class="sd">                - Purpose: Collect vehicle delivery quotes</span>
</span><span id="Supplier.setup-1663"><a href="#Supplier.setup-1663"><span class="linenos">1663</span></a><span class="sd">                - Role: Coordinator for vehicle selection</span>
</span><span id="Supplier.setup-1664"><a href="#Supplier.setup-1664"><span class="linenos">1664</span></a><span class="sd">                - Action: Store proposals in vehicle_proposals dictionary</span>
</span><span id="Supplier.setup-1665"><a href="#Supplier.setup-1665"><span class="linenos">1665</span></a><span class="sd">            </span>
</span><span id="Supplier.setup-1666"><a href="#Supplier.setup-1666"><span class="linenos">1666</span></a><span class="sd">            **ReceiveVehicleArrival** (CyclicBehaviour):</span>
</span><span id="Supplier.setup-1667"><a href="#Supplier.setup-1667"><span class="linenos">1667</span></a><span class="sd">                - Template: performative = &quot;vehicle-pickup&quot;</span>
</span><span id="Supplier.setup-1668"><a href="#Supplier.setup-1668"><span class="linenos">1668</span></a><span class="sd">                - Purpose: Handle vehicle pickup notifications</span>
</span><span id="Supplier.setup-1669"><a href="#Supplier.setup-1669"><span class="linenos">1669</span></a><span class="sd">                - Action: Remove order from pending_deliveries, confirm pickup</span>
</span><span id="Supplier.setup-1670"><a href="#Supplier.setup-1670"><span class="linenos">1670</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1671"><a href="#Supplier.setup-1671"><span class="linenos">1671</span></a><span class="sd">        Infinite Stock Model:</span>
</span><span id="Supplier.setup-1672"><a href="#Supplier.setup-1672"><span class="linenos">1672</span></a><span class="sd">            Unlike warehouse agents:</span>
</span><span id="Supplier.setup-1673"><a href="#Supplier.setup-1673"><span class="linenos">1673</span></a><span class="sd">            - No stock initialization required</span>
</span><span id="Supplier.setup-1674"><a href="#Supplier.setup-1674"><span class="linenos">1674</span></a><span class="sd">            - No capacity constraints</span>
</span><span id="Supplier.setup-1675"><a href="#Supplier.setup-1675"><span class="linenos">1675</span></a><span class="sd">            - No resupply mechanism needed</span>
</span><span id="Supplier.setup-1676"><a href="#Supplier.setup-1676"><span class="linenos">1676</span></a><span class="sd">            - Only tracks what&#39;s been supplied (statistics)</span>
</span><span id="Supplier.setup-1677"><a href="#Supplier.setup-1677"><span class="linenos">1677</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1678"><a href="#Supplier.setup-1678"><span class="linenos">1678</span></a><span class="sd">        State Initialization Example:</span>
</span><span id="Supplier.setup-1679"><a href="#Supplier.setup-1679"><span class="linenos">1679</span></a><span class="sd">            ```</span>
</span><span id="Supplier.setup-1680"><a href="#Supplier.setup-1680"><span class="linenos">1680</span></a><span class="sd">            After setup():</span>
</span><span id="Supplier.setup-1681"><a href="#Supplier.setup-1681"><span class="linenos">1681</span></a><span class="sd">                total_supplied: {} (empty, will populate as orders fulfilled)</span>
</span><span id="Supplier.setup-1682"><a href="#Supplier.setup-1682"><span class="linenos">1682</span></a><span class="sd">                current_tick: 0</span>
</span><span id="Supplier.setup-1683"><a href="#Supplier.setup-1683"><span class="linenos">1683</span></a><span class="sd">                pending_deliveries: {} (empty, will populate as orders confirmed)</span>
</span><span id="Supplier.setup-1684"><a href="#Supplier.setup-1684"><span class="linenos">1684</span></a><span class="sd">                vehicle_proposals: {} (empty, will populate per order)</span>
</span><span id="Supplier.setup-1685"><a href="#Supplier.setup-1685"><span class="linenos">1685</span></a><span class="sd">                vehicles: [] (will populate from presence contacts)</span>
</span><span id="Supplier.setup-1686"><a href="#Supplier.setup-1686"><span class="linenos">1686</span></a><span class="sd">                presence_infos: {} (will populate during vehicle coordination)</span>
</span><span id="Supplier.setup-1687"><a href="#Supplier.setup-1687"><span class="linenos">1687</span></a><span class="sd">            </span>
</span><span id="Supplier.setup-1688"><a href="#Supplier.setup-1688"><span class="linenos">1688</span></a><span class="sd">            Print Output:</span>
</span><span id="Supplier.setup-1689"><a href="#Supplier.setup-1689"><span class="linenos">1689</span></a><span class="sd">                &quot;supplier1@localhost&gt; Supplier initialized with INFINITE stock&quot;</span>
</span><span id="Supplier.setup-1690"><a href="#Supplier.setup-1690"><span class="linenos">1690</span></a><span class="sd">            ```</span>
</span><span id="Supplier.setup-1691"><a href="#Supplier.setup-1691"><span class="linenos">1691</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1692"><a href="#Supplier.setup-1692"><span class="linenos">1692</span></a><span class="sd">        Presence Subscription Example:</span>
</span><span id="Supplier.setup-1693"><a href="#Supplier.setup-1693"><span class="linenos">1693</span></a><span class="sd">            ```</span>
</span><span id="Supplier.setup-1694"><a href="#Supplier.setup-1694"><span class="linenos">1694</span></a><span class="sd">            contact_list: [</span>
</span><span id="Supplier.setup-1695"><a href="#Supplier.setup-1695"><span class="linenos">1695</span></a><span class="sd">                &quot;warehouse1@localhost&quot;,</span>
</span><span id="Supplier.setup-1696"><a href="#Supplier.setup-1696"><span class="linenos">1696</span></a><span class="sd">                &quot;warehouse2@localhost&quot;,</span>
</span><span id="Supplier.setup-1697"><a href="#Supplier.setup-1697"><span class="linenos">1697</span></a><span class="sd">                &quot;vehicle1@localhost&quot;,</span>
</span><span id="Supplier.setup-1698"><a href="#Supplier.setup-1698"><span class="linenos">1698</span></a><span class="sd">                &quot;vehicle2@localhost&quot;</span>
</span><span id="Supplier.setup-1699"><a href="#Supplier.setup-1699"><span class="linenos">1699</span></a><span class="sd">            ]</span>
</span><span id="Supplier.setup-1700"><a href="#Supplier.setup-1700"><span class="linenos">1700</span></a><span class="sd">            </span>
</span><span id="Supplier.setup-1701"><a href="#Supplier.setup-1701"><span class="linenos">1701</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier.setup-1702"><a href="#Supplier.setup-1702"><span class="linenos">1702</span></a><span class="sd">                1. Subscribe to all 4 contacts</span>
</span><span id="Supplier.setup-1703"><a href="#Supplier.setup-1703"><span class="linenos">1703</span></a><span class="sd">                2. Enable auto-approval for incoming subscriptions</span>
</span><span id="Supplier.setup-1704"><a href="#Supplier.setup-1704"><span class="linenos">1704</span></a><span class="sd">                3. Print: &quot;Sent subscription request to warehouse1@localhost&quot;</span>
</span><span id="Supplier.setup-1705"><a href="#Supplier.setup-1705"><span class="linenos">1705</span></a><span class="sd">                4. Print: &quot;Sent subscription request to warehouse2@localhost&quot;</span>
</span><span id="Supplier.setup-1706"><a href="#Supplier.setup-1706"><span class="linenos">1706</span></a><span class="sd">                5. Print: &quot;Sent subscription request to vehicle1@localhost&quot;</span>
</span><span id="Supplier.setup-1707"><a href="#Supplier.setup-1707"><span class="linenos">1707</span></a><span class="sd">                6. Print: &quot;Sent subscription request to vehicle2@localhost&quot;</span>
</span><span id="Supplier.setup-1708"><a href="#Supplier.setup-1708"><span class="linenos">1708</span></a><span class="sd">                7. Print: &quot;Supplier setup complete. Will auto-accept all presence subscriptions.&quot;</span>
</span><span id="Supplier.setup-1709"><a href="#Supplier.setup-1709"><span class="linenos">1709</span></a><span class="sd">            ```</span>
</span><span id="Supplier.setup-1710"><a href="#Supplier.setup-1710"><span class="linenos">1710</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1711"><a href="#Supplier.setup-1711"><span class="linenos">1711</span></a><span class="sd">        Template Configuration:</span>
</span><span id="Supplier.setup-1712"><a href="#Supplier.setup-1712"><span class="linenos">1712</span></a><span class="sd">            Templates use metadata filtering to route messages to correct behaviours:</span>
</span><span id="Supplier.setup-1713"><a href="#Supplier.setup-1713"><span class="linenos">1713</span></a><span class="sd">            - ReceiveBuyRequest: performative=&quot;warehouse-buy&quot;</span>
</span><span id="Supplier.setup-1714"><a href="#Supplier.setup-1714"><span class="linenos">1714</span></a><span class="sd">            - ReceiveVehicleProposals: performative=&quot;vehicle-proposal&quot;</span>
</span><span id="Supplier.setup-1715"><a href="#Supplier.setup-1715"><span class="linenos">1715</span></a><span class="sd">            - ReceiveVehicleArrival: performative=&quot;vehicle-pickup&quot;</span>
</span><span id="Supplier.setup-1716"><a href="#Supplier.setup-1716"><span class="linenos">1716</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1717"><a href="#Supplier.setup-1717"><span class="linenos">1717</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier.setup-1718"><a href="#Supplier.setup-1718"><span class="linenos">1718</span></a><span class="sd">            - Prints initialization message with INFINITE stock notice</span>
</span><span id="Supplier.setup-1719"><a href="#Supplier.setup-1719"><span class="linenos">1719</span></a><span class="sd">            - Prints statistics if verbose=True</span>
</span><span id="Supplier.setup-1720"><a href="#Supplier.setup-1720"><span class="linenos">1720</span></a><span class="sd">            - Begins listening for warehouse requests immediately</span>
</span><span id="Supplier.setup-1721"><a href="#Supplier.setup-1721"><span class="linenos">1721</span></a><span class="sd">            - Begins listening for vehicle messages immediately</span>
</span><span id="Supplier.setup-1722"><a href="#Supplier.setup-1722"><span class="linenos">1722</span></a><span class="sd">        </span>
</span><span id="Supplier.setup-1723"><a href="#Supplier.setup-1723"><span class="linenos">1723</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.setup-1724"><a href="#Supplier.setup-1724"><span class="linenos">1724</span></a><span class="sd">            This method must complete before the supplier can participate in any</span>
</span><span id="Supplier.setup-1725"><a href="#Supplier.setup-1725"><span class="linenos">1725</span></a><span class="sd">            FIPA protocol interactions. All behaviours are registered but don&#39;t</span>
</span><span id="Supplier.setup-1726"><a href="#Supplier.setup-1726"><span class="linenos">1726</span></a><span class="sd">            execute until the main agent event loop processes them.</span>
</span><span id="Supplier.setup-1727"><a href="#Supplier.setup-1727"><span class="linenos">1727</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.setup-1728"><a href="#Supplier.setup-1728"><span class="linenos">1728</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">approve_all</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Supplier.setup-1729"><a href="#Supplier.setup-1729"><span class="linenos">1729</span></a>        
</span><span id="Supplier.setup-1730"><a href="#Supplier.setup-1730"><span class="linenos">1730</span></a>        <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_list</span><span class="p">:</span>
</span><span id="Supplier.setup-1731"><a href="#Supplier.setup-1731"><span class="linenos">1731</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">contact</span><span class="p">)</span>
</span><span id="Supplier.setup-1732"><a href="#Supplier.setup-1732"><span class="linenos">1732</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.setup-1733"><a href="#Supplier.setup-1733"><span class="linenos">1733</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Sent subscription request to </span><span class="si">{</span><span class="n">contact</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.setup-1734"><a href="#Supplier.setup-1734"><span class="linenos">1734</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.setup-1735"><a href="#Supplier.setup-1735"><span class="linenos">1735</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Supplier setup complete. Will auto-accept all presence subscriptions.&quot;</span><span class="p">)</span>
</span><span id="Supplier.setup-1736"><a href="#Supplier.setup-1736"><span class="linenos">1736</span></a>        
</span><span id="Supplier.setup-1737"><a href="#Supplier.setup-1737"><span class="linenos">1737</span></a>        <span class="c1"># Supplier has infinite stock - no need to track stock levels</span>
</span><span id="Supplier.setup-1738"><a href="#Supplier.setup-1738"><span class="linenos">1738</span></a>        <span class="c1"># Just track what&#39;s been supplied</span>
</span><span id="Supplier.setup-1739"><a href="#Supplier.setup-1739"><span class="linenos">1739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_supplied</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier.setup-1740"><a href="#Supplier.setup-1740"><span class="linenos">1740</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_tick</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Supplier.setup-1741"><a href="#Supplier.setup-1741"><span class="linenos">1741</span></a>        
</span><span id="Supplier.setup-1742"><a href="#Supplier.setup-1742"><span class="linenos">1742</span></a>        <span class="c1"># Track pending deliveries by order_id</span>
</span><span id="Supplier.setup-1743"><a href="#Supplier.setup-1743"><span class="linenos">1743</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pending_deliveries</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Order</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier.setup-1744"><a href="#Supplier.setup-1744"><span class="linenos">1744</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vehicle_proposals</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier.setup-1745"><a href="#Supplier.setup-1745"><span class="linenos">1745</span></a>        <span class="c1"># Identify vehicles from presence contacts (will be populated dynamically)</span>
</span><span id="Supplier.setup-1746"><a href="#Supplier.setup-1746"><span class="linenos">1746</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vehicles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Supplier.setup-1747"><a href="#Supplier.setup-1747"><span class="linenos">1747</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence_infos</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier.setup-1748"><a href="#Supplier.setup-1748"><span class="linenos">1748</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Supplier initialized with INFINITE stock&quot;</span><span class="p">)</span>
</span><span id="Supplier.setup-1749"><a href="#Supplier.setup-1749"><span class="linenos">1749</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.setup-1750"><a href="#Supplier.setup-1750"><span class="linenos">1750</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier.setup-1751"><a href="#Supplier.setup-1751"><span class="linenos">1751</span></a>        
</span><span id="Supplier.setup-1752"><a href="#Supplier.setup-1752"><span class="linenos">1752</span></a>        <span class="c1"># Add behaviour to receive buy requests from warehouses</span>
</span><span id="Supplier.setup-1753"><a href="#Supplier.setup-1753"><span class="linenos">1753</span></a>        <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveBuyRequest</span><span class="p">()</span>
</span><span id="Supplier.setup-1754"><a href="#Supplier.setup-1754"><span class="linenos">1754</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier.setup-1755"><a href="#Supplier.setup-1755"><span class="linenos">1755</span></a>        <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;warehouse-buy&quot;</span><span class="p">)</span>
</span><span id="Supplier.setup-1756"><a href="#Supplier.setup-1756"><span class="linenos">1756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="Supplier.setup-1757"><a href="#Supplier.setup-1757"><span class="linenos">1757</span></a>        
</span><span id="Supplier.setup-1758"><a href="#Supplier.setup-1758"><span class="linenos">1758</span></a>        <span class="c1"># Add behaviour to receive vehicle proposals</span>
</span><span id="Supplier.setup-1759"><a href="#Supplier.setup-1759"><span class="linenos">1759</span></a>        <span class="n">vehicle_proposal_behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveVehicleProposals</span><span class="p">()</span>
</span><span id="Supplier.setup-1760"><a href="#Supplier.setup-1760"><span class="linenos">1760</span></a>        <span class="n">vehicle_proposal_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier.setup-1761"><a href="#Supplier.setup-1761"><span class="linenos">1761</span></a>        <span class="n">vehicle_proposal_template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle-proposal&quot;</span><span class="p">)</span>
</span><span id="Supplier.setup-1762"><a href="#Supplier.setup-1762"><span class="linenos">1762</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">vehicle_proposal_behav</span><span class="p">,</span> <span class="n">vehicle_proposal_template</span><span class="p">)</span>
</span><span id="Supplier.setup-1763"><a href="#Supplier.setup-1763"><span class="linenos">1763</span></a>        
</span><span id="Supplier.setup-1764"><a href="#Supplier.setup-1764"><span class="linenos">1764</span></a>        <span class="c1"># Add behaviour to receive vehicle pickup notifications</span>
</span><span id="Supplier.setup-1765"><a href="#Supplier.setup-1765"><span class="linenos">1765</span></a>        <span class="n">pickup_behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveVehicleArrival</span><span class="p">()</span>
</span><span id="Supplier.setup-1766"><a href="#Supplier.setup-1766"><span class="linenos">1766</span></a>        <span class="n">pickup_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier.setup-1767"><a href="#Supplier.setup-1767"><span class="linenos">1767</span></a>        <span class="n">pickup_template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle-pickup&quot;</span><span class="p">)</span>
</span><span id="Supplier.setup-1768"><a href="#Supplier.setup-1768"><span class="linenos">1768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">pickup_behav</span><span class="p">,</span> <span class="n">pickup_template</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Configure supplier state and register all FIPA protocol behaviours.</p>

<p>This method is automatically called by SPADE after the agent successfully
connects to the XMPP server. It initializes the supplier's operational
state and registers all cyclic behaviours needed for the FIPA Contract Net
Protocol implementation as a participant.</p>

<h6 id="setup-process">Setup Process:</h6>

<blockquote>
  <p><strong>Phase 1: Presence Management</strong>
      - Enable auto-approval of presence subscriptions
      - Subscribe to all contacts (warehouses and vehicles)
      - Enables presence-based availability checking</p>
  
  <p><strong>Phase 2: State Initialization</strong>
      - total_supplied: Dictionary tracking cumulative supply per product
      - current_tick: Simulation time (starts at 0)
      - pending_deliveries: Orders confirmed but not picked up
      - vehicle_proposals: Vehicle delivery quotes per order
      - vehicles: List of vehicle JIDs (populated dynamically)
      - presence_infos: Vehicle availability cache</p>
  
  <p><strong>Phase 3: Behaviour Registration</strong>
      1. ReceiveBuyRequest (Warehouse Interaction - FIPA Participant)
      2. ReceiveVehicleProposals (Vehicle Coordination - Proposal Collection)
      3. ReceiveVehicleArrival (Vehicle Coordination - Pickup Handling)</p>
</blockquote>

<h6 id="behaviour-registration-details">Behaviour Registration Details:</h6>

<blockquote>
  <p><strong>ReceiveBuyRequest</strong> (CyclicBehaviour):
      - Template: performative = "warehouse-buy"
      - Purpose: Listen for warehouse purchase requests (FIPA CFP)
      - Role: FIPA Participant (responds to warehouses)
      - Action: Always accepts (infinite stock)</p>
  
  <p><strong>ReceiveVehicleProposals</strong> (CyclicBehaviour):
      - Template: performative = "vehicle-proposal"
      - Purpose: Collect vehicle delivery quotes
      - Role: Coordinator for vehicle selection
      - Action: Store proposals in vehicle_proposals dictionary</p>
  
  <p><strong>ReceiveVehicleArrival</strong> (CyclicBehaviour):
      - Template: performative = "vehicle-pickup"
      - Purpose: Handle vehicle pickup notifications
      - Action: Remove order from pending_deliveries, confirm pickup</p>
</blockquote>

<h6 id="infinite-stock-model">Infinite Stock Model:</h6>

<blockquote>
  <p>Unlike warehouse agents:</p>
  
  <ul>
  <li>No stock initialization required</li>
  <li>No capacity constraints</li>
  <li>No resupply mechanism needed</li>
  <li>Only tracks what's been supplied (statistics)</li>
  </ul>
</blockquote>

<h6 id="state-initialization-example">State Initialization Example:</h6>

<blockquote>
<pre><code>After setup():
    total_supplied: {} (empty, will populate as orders fulfilled)
    current_tick: 0
    pending_deliveries: {} (empty, will populate as orders confirmed)
    vehicle_proposals: {} (empty, will populate per order)
    vehicles: [] (will populate from presence contacts)
    presence_infos: {} (will populate during vehicle coordination)

Print Output:
    "supplier1@localhost&gt; Supplier initialized with INFINITE stock"
</code></pre>
</blockquote>

<h6 id="presence-subscription-example">Presence Subscription Example:</h6>

<blockquote>
<pre><code>contact_list: [
    "warehouse1@localhost",
    "warehouse2@localhost",
    "vehicle1@localhost",
    "vehicle2@localhost"
]

Actions:
    1. Subscribe to all 4 contacts
    2. Enable auto-approval for incoming subscriptions
    3. Print: "Sent subscription request to warehouse1@localhost"
    4. Print: "Sent subscription request to warehouse2@localhost"
    5. Print: "Sent subscription request to vehicle1@localhost"
    6. Print: "Sent subscription request to vehicle2@localhost"
    7. Print: "Supplier setup complete. Will auto-accept all presence subscriptions."
</code></pre>
</blockquote>

<h6 id="template-configuration">Template Configuration:</h6>

<blockquote>
  <p>Templates use metadata filtering to route messages to correct behaviours:</p>
  
  <ul>
  <li>ReceiveBuyRequest: performative="warehouse-buy"</li>
  <li>ReceiveVehicleProposals: performative="vehicle-proposal"</li>
  <li>ReceiveVehicleArrival: performative="vehicle-pickup"</li>
  </ul>
</blockquote>

<h6 id="side-effects">Side Effects:</h6>

<blockquote>
  <ul>
  <li>Prints initialization message with INFINITE stock notice</li>
  <li>Prints statistics if verbose=True</li>
  <li>Begins listening for warehouse requests immediately</li>
  <li>Begins listening for vehicle messages immediately</li>
  </ul>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>This method must complete before the supplier can participate in any
  FIPA protocol interactions. All behaviours are registered but don't
  execute until the main agent event loop processes them.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="Supplier.ReceiveBuyRequest">
                            <input id="Supplier.ReceiveBuyRequest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.ReceiveBuyRequest</span><wbr>(<span class="base">spade.behaviour.CyclicBehaviour</span>):

                <label class="view-source-button" for="Supplier.ReceiveBuyRequest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveBuyRequest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveBuyRequest-239"><a href="#Supplier.ReceiveBuyRequest-239"><span class="linenos">239</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveBuyRequest</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="Supplier.ReceiveBuyRequest-240"><a href="#Supplier.ReceiveBuyRequest-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-241"><a href="#Supplier.ReceiveBuyRequest-241"><span class="linenos">241</span></a><span class="sd">        Cyclic behaviour that processes incoming purchase requests from warehouses.</span>
</span><span id="Supplier.ReceiveBuyRequest-242"><a href="#Supplier.ReceiveBuyRequest-242"><span class="linenos">242</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-243"><a href="#Supplier.ReceiveBuyRequest-243"><span class="linenos">243</span></a><span class="sd">        This behaviour implements the proposal phase of the FIPA Contract Net Protocol</span>
</span><span id="Supplier.ReceiveBuyRequest-244"><a href="#Supplier.ReceiveBuyRequest-244"><span class="linenos">244</span></a><span class="sd">        where the supplier acts as a **Participant**. It receives CFP messages from</span>
</span><span id="Supplier.ReceiveBuyRequest-245"><a href="#Supplier.ReceiveBuyRequest-245"><span class="linenos">245</span></a><span class="sd">        warehouses and automatically accepts all requests since the supplier has</span>
</span><span id="Supplier.ReceiveBuyRequest-246"><a href="#Supplier.ReceiveBuyRequest-246"><span class="linenos">246</span></a><span class="sd">        infinite stock.</span>
</span><span id="Supplier.ReceiveBuyRequest-247"><a href="#Supplier.ReceiveBuyRequest-247"><span class="linenos">247</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-248"><a href="#Supplier.ReceiveBuyRequest-248"><span class="linenos">248</span></a><span class="sd">        FIPA Protocol Phase: **Proposal Phase - Participant Role**</span>
</span><span id="Supplier.ReceiveBuyRequest-249"><a href="#Supplier.ReceiveBuyRequest-249"><span class="linenos">249</span></a><span class="sd">            - Role: Participant (Supplier responding to Warehouse&#39;s CFP)</span>
</span><span id="Supplier.ReceiveBuyRequest-250"><a href="#Supplier.ReceiveBuyRequest-250"><span class="linenos">250</span></a><span class="sd">            - Receives: warehouse-buy messages (FIPA CFP)</span>
</span><span id="Supplier.ReceiveBuyRequest-251"><a href="#Supplier.ReceiveBuyRequest-251"><span class="linenos">251</span></a><span class="sd">            - Evaluates: Always accepts (infinite stock model)</span>
</span><span id="Supplier.ReceiveBuyRequest-252"><a href="#Supplier.ReceiveBuyRequest-252"><span class="linenos">252</span></a><span class="sd">            - Responds: supplier-accept (FIPA propose) for every request</span>
</span><span id="Supplier.ReceiveBuyRequest-253"><a href="#Supplier.ReceiveBuyRequest-253"><span class="linenos">253</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-254"><a href="#Supplier.ReceiveBuyRequest-254"><span class="linenos">254</span></a><span class="sd">        Infinite Stock Advantage:</span>
</span><span id="Supplier.ReceiveBuyRequest-255"><a href="#Supplier.ReceiveBuyRequest-255"><span class="linenos">255</span></a><span class="sd">            Unlike warehouses that must check inventory:</span>
</span><span id="Supplier.ReceiveBuyRequest-256"><a href="#Supplier.ReceiveBuyRequest-256"><span class="linenos">256</span></a><span class="sd">            - No stock validation needed</span>
</span><span id="Supplier.ReceiveBuyRequest-257"><a href="#Supplier.ReceiveBuyRequest-257"><span class="linenos">257</span></a><span class="sd">            - No rejection logic (always accepts)</span>
</span><span id="Supplier.ReceiveBuyRequest-258"><a href="#Supplier.ReceiveBuyRequest-258"><span class="linenos">258</span></a><span class="sd">            - No stock locking mechanism required</span>
</span><span id="Supplier.ReceiveBuyRequest-259"><a href="#Supplier.ReceiveBuyRequest-259"><span class="linenos">259</span></a><span class="sd">            - Simplifies participant role implementation</span>
</span><span id="Supplier.ReceiveBuyRequest-260"><a href="#Supplier.ReceiveBuyRequest-260"><span class="linenos">260</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-261"><a href="#Supplier.ReceiveBuyRequest-261"><span class="linenos">261</span></a><span class="sd">        Message Format (warehouse-buy):</span>
</span><span id="Supplier.ReceiveBuyRequest-262"><a href="#Supplier.ReceiveBuyRequest-262"><span class="linenos">262</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier.ReceiveBuyRequest-263"><a href="#Supplier.ReceiveBuyRequest-263"><span class="linenos">263</span></a><span class="sd">                - performative: &quot;warehouse-buy&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-264"><a href="#Supplier.ReceiveBuyRequest-264"><span class="linenos">264</span></a><span class="sd">                - request_id: Unique request identifier</span>
</span><span id="Supplier.ReceiveBuyRequest-265"><a href="#Supplier.ReceiveBuyRequest-265"><span class="linenos">265</span></a><span class="sd">            Body:</span>
</span><span id="Supplier.ReceiveBuyRequest-266"><a href="#Supplier.ReceiveBuyRequest-266"><span class="linenos">266</span></a><span class="sd">                - Format: &quot;{quantity} {product}&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-267"><a href="#Supplier.ReceiveBuyRequest-267"><span class="linenos">267</span></a><span class="sd">                - Example: &quot;100 raw_materials&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-268"><a href="#Supplier.ReceiveBuyRequest-268"><span class="linenos">268</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-269"><a href="#Supplier.ReceiveBuyRequest-269"><span class="linenos">269</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier.ReceiveBuyRequest-270"><a href="#Supplier.ReceiveBuyRequest-270"><span class="linenos">270</span></a><span class="sd">            1. **Receive**: Wait up to 20 seconds for warehouse-buy message</span>
</span><span id="Supplier.ReceiveBuyRequest-271"><a href="#Supplier.ReceiveBuyRequest-271"><span class="linenos">271</span></a><span class="sd">            2. **Parse**: Extract request_id, quantity, product from message</span>
</span><span id="Supplier.ReceiveBuyRequest-272"><a href="#Supplier.ReceiveBuyRequest-272"><span class="linenos">272</span></a><span class="sd">            3. **Accept**: Launch AcceptBuyRequest behaviour (always accept)</span>
</span><span id="Supplier.ReceiveBuyRequest-273"><a href="#Supplier.ReceiveBuyRequest-273"><span class="linenos">273</span></a><span class="sd">            4. **Track**: Update total_supplied statistics</span>
</span><span id="Supplier.ReceiveBuyRequest-274"><a href="#Supplier.ReceiveBuyRequest-274"><span class="linenos">274</span></a><span class="sd">            5. **Continue**: Return to listening (cyclic behaviour)</span>
</span><span id="Supplier.ReceiveBuyRequest-275"><a href="#Supplier.ReceiveBuyRequest-275"><span class="linenos">275</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-276"><a href="#Supplier.ReceiveBuyRequest-276"><span class="linenos">276</span></a><span class="sd">        Statistics Tracking:</span>
</span><span id="Supplier.ReceiveBuyRequest-277"><a href="#Supplier.ReceiveBuyRequest-277"><span class="linenos">277</span></a><span class="sd">            Maintains cumulative supply counts per product:</span>
</span><span id="Supplier.ReceiveBuyRequest-278"><a href="#Supplier.ReceiveBuyRequest-278"><span class="linenos">278</span></a><span class="sd">            - Increment total_supplied[product] by quantity</span>
</span><span id="Supplier.ReceiveBuyRequest-279"><a href="#Supplier.ReceiveBuyRequest-279"><span class="linenos">279</span></a><span class="sd">            - Create entry if product not yet supplied</span>
</span><span id="Supplier.ReceiveBuyRequest-280"><a href="#Supplier.ReceiveBuyRequest-280"><span class="linenos">280</span></a><span class="sd">            - Used for monitoring and reporting only</span>
</span><span id="Supplier.ReceiveBuyRequest-281"><a href="#Supplier.ReceiveBuyRequest-281"><span class="linenos">281</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-282"><a href="#Supplier.ReceiveBuyRequest-282"><span class="linenos">282</span></a><span class="sd">        Concurrency Handling:</span>
</span><span id="Supplier.ReceiveBuyRequest-283"><a href="#Supplier.ReceiveBuyRequest-283"><span class="linenos">283</span></a><span class="sd">            - Processes multiple warehouse requests concurrently</span>
</span><span id="Supplier.ReceiveBuyRequest-284"><a href="#Supplier.ReceiveBuyRequest-284"><span class="linenos">284</span></a><span class="sd">            - Each request launches independent AcceptBuyRequest behaviour</span>
</span><span id="Supplier.ReceiveBuyRequest-285"><a href="#Supplier.ReceiveBuyRequest-285"><span class="linenos">285</span></a><span class="sd">            - No race conditions (infinite stock eliminates conflicts)</span>
</span><span id="Supplier.ReceiveBuyRequest-286"><a href="#Supplier.ReceiveBuyRequest-286"><span class="linenos">286</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-287"><a href="#Supplier.ReceiveBuyRequest-287"><span class="linenos">287</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier.ReceiveBuyRequest-288"><a href="#Supplier.ReceiveBuyRequest-288"><span class="linenos">288</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveBuyRequest-289"><a href="#Supplier.ReceiveBuyRequest-289"><span class="linenos">289</span></a><span class="sd">            Request Received: &quot;100 electronics&quot; (request_id=201000000)</span>
</span><span id="Supplier.ReceiveBuyRequest-290"><a href="#Supplier.ReceiveBuyRequest-290"><span class="linenos">290</span></a><span class="sd">            From: warehouse1@localhost</span>
</span><span id="Supplier.ReceiveBuyRequest-291"><a href="#Supplier.ReceiveBuyRequest-291"><span class="linenos">291</span></a><span class="sd">            Decision: ACCEPT (always)</span>
</span><span id="Supplier.ReceiveBuyRequest-292"><a href="#Supplier.ReceiveBuyRequest-292"><span class="linenos">292</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier.ReceiveBuyRequest-293"><a href="#Supplier.ReceiveBuyRequest-293"><span class="linenos">293</span></a><span class="sd">                - total_supplied[electronics]: 500 -&gt; 600</span>
</span><span id="Supplier.ReceiveBuyRequest-294"><a href="#Supplier.ReceiveBuyRequest-294"><span class="linenos">294</span></a><span class="sd">                - Launch AcceptBuyRequest</span>
</span><span id="Supplier.ReceiveBuyRequest-295"><a href="#Supplier.ReceiveBuyRequest-295"><span class="linenos">295</span></a><span class="sd">                - Print: &quot;Request 201000000: 100 xelectronics from warehouse1 received.&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-296"><a href="#Supplier.ReceiveBuyRequest-296"><span class="linenos">296</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveBuyRequest-297"><a href="#Supplier.ReceiveBuyRequest-297"><span class="linenos">297</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-298"><a href="#Supplier.ReceiveBuyRequest-298"><span class="linenos">298</span></a><span class="sd">        Timeout Behavior:</span>
</span><span id="Supplier.ReceiveBuyRequest-299"><a href="#Supplier.ReceiveBuyRequest-299"><span class="linenos">299</span></a><span class="sd">            If no message received in 20 seconds:</span>
</span><span id="Supplier.ReceiveBuyRequest-300"><a href="#Supplier.ReceiveBuyRequest-300"><span class="linenos">300</span></a><span class="sd">            - Log timeout (if verbose enabled)</span>
</span><span id="Supplier.ReceiveBuyRequest-301"><a href="#Supplier.ReceiveBuyRequest-301"><span class="linenos">301</span></a><span class="sd">            - Continue listening (cyclic behaviour doesn&#39;t terminate)</span>
</span><span id="Supplier.ReceiveBuyRequest-302"><a href="#Supplier.ReceiveBuyRequest-302"><span class="linenos">302</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveBuyRequest-303"><a href="#Supplier.ReceiveBuyRequest-303"><span class="linenos">303</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.ReceiveBuyRequest-304"><a href="#Supplier.ReceiveBuyRequest-304"><span class="linenos">304</span></a><span class="sd">            This behaviour never terminates (cyclic), continuously listening for</span>
</span><span id="Supplier.ReceiveBuyRequest-305"><a href="#Supplier.ReceiveBuyRequest-305"><span class="linenos">305</span></a><span class="sd">            warehouse requests throughout the supplier&#39;s lifecycle.</span>
</span><span id="Supplier.ReceiveBuyRequest-306"><a href="#Supplier.ReceiveBuyRequest-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-307"><a href="#Supplier.ReceiveBuyRequest-307"><span class="linenos">307</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveBuyRequest-308"><a href="#Supplier.ReceiveBuyRequest-308"><span class="linenos">308</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceiveBuyRequest-309"><a href="#Supplier.ReceiveBuyRequest-309"><span class="linenos">309</span></a>        
</span><span id="Supplier.ReceiveBuyRequest-310"><a href="#Supplier.ReceiveBuyRequest-310"><span class="linenos">310</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest-311"><a href="#Supplier.ReceiveBuyRequest-311"><span class="linenos">311</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Awaiting buy request from warehouses...&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest-312"><a href="#Supplier.ReceiveBuyRequest-312"><span class="linenos">312</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest-313"><a href="#Supplier.ReceiveBuyRequest-313"><span class="linenos">313</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest-314"><a href="#Supplier.ReceiveBuyRequest-314"><span class="linenos">314</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-315"><a href="#Supplier.ReceiveBuyRequest-315"><span class="linenos">315</span></a><span class="sd">                Messages with metadata (&quot;performative&quot;, &quot;warehouse-buy&quot;) have body</span>
</span><span id="Supplier.ReceiveBuyRequest-316"><a href="#Supplier.ReceiveBuyRequest-316"><span class="linenos">316</span></a><span class="sd">                with the following format:</span>
</span><span id="Supplier.ReceiveBuyRequest-317"><a href="#Supplier.ReceiveBuyRequest-317"><span class="linenos">317</span></a><span class="sd">                </span>
</span><span id="Supplier.ReceiveBuyRequest-318"><a href="#Supplier.ReceiveBuyRequest-318"><span class="linenos">318</span></a><span class="sd">                &quot;product_quantity product_type&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-319"><a href="#Supplier.ReceiveBuyRequest-319"><span class="linenos">319</span></a><span class="sd">                </span>
</span><span id="Supplier.ReceiveBuyRequest-320"><a href="#Supplier.ReceiveBuyRequest-320"><span class="linenos">320</span></a><span class="sd">                request_id is in metadata[&quot;request_id&quot;]</span>
</span><span id="Supplier.ReceiveBuyRequest-321"><a href="#Supplier.ReceiveBuyRequest-321"><span class="linenos">321</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest-322"><a href="#Supplier.ReceiveBuyRequest-322"><span class="linenos">322</span></a>                <span class="n">request_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier.ReceiveBuyRequest-323"><a href="#Supplier.ReceiveBuyRequest-323"><span class="linenos">323</span></a>                <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest-324"><a href="#Supplier.ReceiveBuyRequest-324"><span class="linenos">324</span></a>                <span class="n">quant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.ReceiveBuyRequest-325"><a href="#Supplier.ReceiveBuyRequest-325"><span class="linenos">325</span></a>                <span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.ReceiveBuyRequest-326"><a href="#Supplier.ReceiveBuyRequest-326"><span class="linenos">326</span></a>                <span class="c1"># Essential print - request received</span>
</span><span id="Supplier.ReceiveBuyRequest-327"><a href="#Supplier.ReceiveBuyRequest-327"><span class="linenos">327</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Request </span><span class="si">{</span><span class="n">request_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quant</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> received.&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest-328"><a href="#Supplier.ReceiveBuyRequest-328"><span class="linenos">328</span></a>                
</span><span id="Supplier.ReceiveBuyRequest-329"><a href="#Supplier.ReceiveBuyRequest-329"><span class="linenos">329</span></a>                <span class="c1"># Supplier has infinite stock - always accept</span>
</span><span id="Supplier.ReceiveBuyRequest-330"><a href="#Supplier.ReceiveBuyRequest-330"><span class="linenos">330</span></a>                <span class="n">accept_behav</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">AcceptBuyRequest</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest-331"><a href="#Supplier.ReceiveBuyRequest-331"><span class="linenos">331</span></a>                
</span><span id="Supplier.ReceiveBuyRequest-332"><a href="#Supplier.ReceiveBuyRequest-332"><span class="linenos">332</span></a>                <span class="c1"># Track total supplied (no need to lock since infinite)</span>
</span><span id="Supplier.ReceiveBuyRequest-333"><a href="#Supplier.ReceiveBuyRequest-333"><span class="linenos">333</span></a>                <span class="k">if</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest-334"><a href="#Supplier.ReceiveBuyRequest-334"><span class="linenos">334</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quant</span>
</span><span id="Supplier.ReceiveBuyRequest-335"><a href="#Supplier.ReceiveBuyRequest-335"><span class="linenos">335</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest-336"><a href="#Supplier.ReceiveBuyRequest-336"><span class="linenos">336</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant</span>
</span><span id="Supplier.ReceiveBuyRequest-337"><a href="#Supplier.ReceiveBuyRequest-337"><span class="linenos">337</span></a>
</span><span id="Supplier.ReceiveBuyRequest-338"><a href="#Supplier.ReceiveBuyRequest-338"><span class="linenos">338</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest-339"><a href="#Supplier.ReceiveBuyRequest-339"><span class="linenos">339</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> supplied: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest-340"><a href="#Supplier.ReceiveBuyRequest-340"><span class="linenos">340</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier.ReceiveBuyRequest-341"><a href="#Supplier.ReceiveBuyRequest-341"><span class="linenos">341</span></a>                
</span><span id="Supplier.ReceiveBuyRequest-342"><a href="#Supplier.ReceiveBuyRequest-342"><span class="linenos">342</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">accept_behav</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest-343"><a href="#Supplier.ReceiveBuyRequest-343"><span class="linenos">343</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest-344"><a href="#Supplier.ReceiveBuyRequest-344"><span class="linenos">344</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest-345"><a href="#Supplier.ReceiveBuyRequest-345"><span class="linenos">345</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Did not get any buy requests in 20 seconds.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cyclic behaviour that processes incoming purchase requests from warehouses.</p>

<p>This behaviour implements the proposal phase of the FIPA Contract Net Protocol
where the supplier acts as a <strong>Participant</strong>. It receives CFP messages from
warehouses and automatically accepts all requests since the supplier has
infinite stock.</p>

<p>FIPA Protocol Phase: <strong>Proposal Phase - Participant Role</strong>
    - Role: Participant (Supplier responding to Warehouse's CFP)
    - Receives: warehouse-buy messages (FIPA CFP)
    - Evaluates: Always accepts (infinite stock model)
    - Responds: supplier-accept (FIPA propose) for every request</p>

<h6 id="infinite-stock-advantage">Infinite Stock Advantage:</h6>

<blockquote>
  <p>Unlike warehouses that must check inventory:</p>
  
  <ul>
  <li>No stock validation needed</li>
  <li>No rejection logic (always accepts)</li>
  <li>No stock locking mechanism required</li>
  <li>Simplifies participant role implementation</li>
  </ul>
</blockquote>

<p>Message Format (warehouse-buy):
    Metadata:
        - performative: "warehouse-buy"
        - request_id: Unique request identifier
    Body:
        - Format: "{quantity} {product}"
        - Example: "100 raw_materials"</p>

<h6 id="workflow">Workflow:</h6>

<blockquote>
  <ol>
  <li><strong>Receive</strong>: Wait up to 20 seconds for warehouse-buy message</li>
  <li><strong>Parse</strong>: Extract request_id, quantity, product from message</li>
  <li><strong>Accept</strong>: Launch AcceptBuyRequest behaviour (always accept)</li>
  <li><strong>Track</strong>: Update total_supplied statistics</li>
  <li><strong>Continue</strong>: Return to listening (cyclic behaviour)</li>
  </ol>
</blockquote>

<h6 id="statistics-tracking">Statistics Tracking:</h6>

<blockquote>
  <p>Maintains cumulative supply counts per product:</p>
  
  <ul>
  <li>Increment total_supplied[product] by quantity</li>
  <li>Create entry if product not yet supplied</li>
  <li>Used for monitoring and reporting only</li>
  </ul>
</blockquote>

<h6 id="concurrency-handling">Concurrency Handling:</h6>

<blockquote>
  <ul>
  <li>Processes multiple warehouse requests concurrently</li>
  <li>Each request launches independent AcceptBuyRequest behaviour</li>
  <li>No race conditions (infinite stock eliminates conflicts)</li>
  </ul>
</blockquote>

<h6 id="example-execution">Example Execution:</h6>

<blockquote>
<pre><code>Request Received: "100 electronics" (request_id=201000000)
From: warehouse1@localhost
Decision: ACCEPT (always)
Actions:
    - total_supplied[electronics]: 500 -&gt; 600
    - Launch AcceptBuyRequest
    - Print: "Request 201000000: 100 xelectronics from warehouse1 received."
</code></pre>
</blockquote>

<h6 id="timeout-behavior">Timeout Behavior:</h6>

<blockquote>
  <p>If no message received in 20 seconds:</p>
  
  <ul>
  <li>Log timeout (if verbose enabled)</li>
  <li>Continue listening (cyclic behaviour doesn't terminate)</li>
  </ul>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>This behaviour never terminates (cyclic), continuously listening for
  warehouse requests throughout the supplier's lifecycle.</p>
</blockquote>
</div>


                            <div id="Supplier.ReceiveBuyRequest.run" class="classattr">
                                        <input id="Supplier.ReceiveBuyRequest.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.ReceiveBuyRequest.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveBuyRequest.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveBuyRequest.run-307"><a href="#Supplier.ReceiveBuyRequest.run-307"><span class="linenos">307</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveBuyRequest.run-308"><a href="#Supplier.ReceiveBuyRequest.run-308"><span class="linenos">308</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceiveBuyRequest.run-309"><a href="#Supplier.ReceiveBuyRequest.run-309"><span class="linenos">309</span></a>        
</span><span id="Supplier.ReceiveBuyRequest.run-310"><a href="#Supplier.ReceiveBuyRequest.run-310"><span class="linenos">310</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest.run-311"><a href="#Supplier.ReceiveBuyRequest.run-311"><span class="linenos">311</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Awaiting buy request from warehouses...&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest.run-312"><a href="#Supplier.ReceiveBuyRequest.run-312"><span class="linenos">312</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest.run-313"><a href="#Supplier.ReceiveBuyRequest.run-313"><span class="linenos">313</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest.run-314"><a href="#Supplier.ReceiveBuyRequest.run-314"><span class="linenos">314</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest.run-315"><a href="#Supplier.ReceiveBuyRequest.run-315"><span class="linenos">315</span></a><span class="sd">                Messages with metadata (&quot;performative&quot;, &quot;warehouse-buy&quot;) have body</span>
</span><span id="Supplier.ReceiveBuyRequest.run-316"><a href="#Supplier.ReceiveBuyRequest.run-316"><span class="linenos">316</span></a><span class="sd">                with the following format:</span>
</span><span id="Supplier.ReceiveBuyRequest.run-317"><a href="#Supplier.ReceiveBuyRequest.run-317"><span class="linenos">317</span></a><span class="sd">                </span>
</span><span id="Supplier.ReceiveBuyRequest.run-318"><a href="#Supplier.ReceiveBuyRequest.run-318"><span class="linenos">318</span></a><span class="sd">                &quot;product_quantity product_type&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest.run-319"><a href="#Supplier.ReceiveBuyRequest.run-319"><span class="linenos">319</span></a><span class="sd">                </span>
</span><span id="Supplier.ReceiveBuyRequest.run-320"><a href="#Supplier.ReceiveBuyRequest.run-320"><span class="linenos">320</span></a><span class="sd">                request_id is in metadata[&quot;request_id&quot;]</span>
</span><span id="Supplier.ReceiveBuyRequest.run-321"><a href="#Supplier.ReceiveBuyRequest.run-321"><span class="linenos">321</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveBuyRequest.run-322"><a href="#Supplier.ReceiveBuyRequest.run-322"><span class="linenos">322</span></a>                <span class="n">request_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier.ReceiveBuyRequest.run-323"><a href="#Supplier.ReceiveBuyRequest.run-323"><span class="linenos">323</span></a>                <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest.run-324"><a href="#Supplier.ReceiveBuyRequest.run-324"><span class="linenos">324</span></a>                <span class="n">quant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.ReceiveBuyRequest.run-325"><a href="#Supplier.ReceiveBuyRequest.run-325"><span class="linenos">325</span></a>                <span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.ReceiveBuyRequest.run-326"><a href="#Supplier.ReceiveBuyRequest.run-326"><span class="linenos">326</span></a>                <span class="c1"># Essential print - request received</span>
</span><span id="Supplier.ReceiveBuyRequest.run-327"><a href="#Supplier.ReceiveBuyRequest.run-327"><span class="linenos">327</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Request </span><span class="si">{</span><span class="n">request_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quant</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> received.&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest.run-328"><a href="#Supplier.ReceiveBuyRequest.run-328"><span class="linenos">328</span></a>                
</span><span id="Supplier.ReceiveBuyRequest.run-329"><a href="#Supplier.ReceiveBuyRequest.run-329"><span class="linenos">329</span></a>                <span class="c1"># Supplier has infinite stock - always accept</span>
</span><span id="Supplier.ReceiveBuyRequest.run-330"><a href="#Supplier.ReceiveBuyRequest.run-330"><span class="linenos">330</span></a>                <span class="n">accept_behav</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">AcceptBuyRequest</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest.run-331"><a href="#Supplier.ReceiveBuyRequest.run-331"><span class="linenos">331</span></a>                
</span><span id="Supplier.ReceiveBuyRequest.run-332"><a href="#Supplier.ReceiveBuyRequest.run-332"><span class="linenos">332</span></a>                <span class="c1"># Track total supplied (no need to lock since infinite)</span>
</span><span id="Supplier.ReceiveBuyRequest.run-333"><a href="#Supplier.ReceiveBuyRequest.run-333"><span class="linenos">333</span></a>                <span class="k">if</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest.run-334"><a href="#Supplier.ReceiveBuyRequest.run-334"><span class="linenos">334</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quant</span>
</span><span id="Supplier.ReceiveBuyRequest.run-335"><a href="#Supplier.ReceiveBuyRequest.run-335"><span class="linenos">335</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest.run-336"><a href="#Supplier.ReceiveBuyRequest.run-336"><span class="linenos">336</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">quant</span>
</span><span id="Supplier.ReceiveBuyRequest.run-337"><a href="#Supplier.ReceiveBuyRequest.run-337"><span class="linenos">337</span></a>
</span><span id="Supplier.ReceiveBuyRequest.run-338"><a href="#Supplier.ReceiveBuyRequest.run-338"><span class="linenos">338</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest.run-339"><a href="#Supplier.ReceiveBuyRequest.run-339"><span class="linenos">339</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> supplied: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">total_supplied</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest.run-340"><a href="#Supplier.ReceiveBuyRequest.run-340"><span class="linenos">340</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier.ReceiveBuyRequest.run-341"><a href="#Supplier.ReceiveBuyRequest.run-341"><span class="linenos">341</span></a>                
</span><span id="Supplier.ReceiveBuyRequest.run-342"><a href="#Supplier.ReceiveBuyRequest.run-342"><span class="linenos">342</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">accept_behav</span><span class="p">)</span>
</span><span id="Supplier.ReceiveBuyRequest.run-343"><a href="#Supplier.ReceiveBuyRequest.run-343"><span class="linenos">343</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest.run-344"><a href="#Supplier.ReceiveBuyRequest.run-344"><span class="linenos">344</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveBuyRequest.run-345"><a href="#Supplier.ReceiveBuyRequest.run-345"><span class="linenos">345</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Did not get any buy requests in 20 seconds.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
                <section id="Supplier.AcceptBuyRequest">
                            <input id="Supplier.AcceptBuyRequest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.AcceptBuyRequest</span><wbr>(<span class="base">spade.behaviour.OneShotBehaviour</span>):

                <label class="view-source-button" for="Supplier.AcceptBuyRequest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AcceptBuyRequest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AcceptBuyRequest-347"><a href="#Supplier.AcceptBuyRequest-347"><span class="linenos">347</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">AcceptBuyRequest</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier.AcceptBuyRequest-348"><a href="#Supplier.AcceptBuyRequest-348"><span class="linenos">348</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-349"><a href="#Supplier.AcceptBuyRequest-349"><span class="linenos">349</span></a><span class="sd">        Behaviour that sends proposal acceptance to warehouse (FIPA propose).</span>
</span><span id="Supplier.AcceptBuyRequest-350"><a href="#Supplier.AcceptBuyRequest-350"><span class="linenos">350</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-351"><a href="#Supplier.AcceptBuyRequest-351"><span class="linenos">351</span></a><span class="sd">        This behaviour implements the proposal submission in the FIPA Contract Net</span>
</span><span id="Supplier.AcceptBuyRequest-352"><a href="#Supplier.AcceptBuyRequest-352"><span class="linenos">352</span></a><span class="sd">        Protocol where the supplier, acting as a participant, sends its proposal</span>
</span><span id="Supplier.AcceptBuyRequest-353"><a href="#Supplier.AcceptBuyRequest-353"><span class="linenos">353</span></a><span class="sd">        to fulfill the warehouse&#39;s request. Since the supplier has infinite stock,</span>
</span><span id="Supplier.AcceptBuyRequest-354"><a href="#Supplier.AcceptBuyRequest-354"><span class="linenos">354</span></a><span class="sd">        this is always an acceptance. It then sets up to receive the warehouse&#39;s</span>
</span><span id="Supplier.AcceptBuyRequest-355"><a href="#Supplier.AcceptBuyRequest-355"><span class="linenos">355</span></a><span class="sd">        decision (accept-proposal or reject-proposal).</span>
</span><span id="Supplier.AcceptBuyRequest-356"><a href="#Supplier.AcceptBuyRequest-356"><span class="linenos">356</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-357"><a href="#Supplier.AcceptBuyRequest-357"><span class="linenos">357</span></a><span class="sd">        FIPA Protocol Phase: **Proposal Submission - Participant Role**</span>
</span><span id="Supplier.AcceptBuyRequest-358"><a href="#Supplier.AcceptBuyRequest-358"><span class="linenos">358</span></a><span class="sd">            - Role: Participant (Supplier proposing to Warehouse)</span>
</span><span id="Supplier.AcceptBuyRequest-359"><a href="#Supplier.AcceptBuyRequest-359"><span class="linenos">359</span></a><span class="sd">            - Sends: supplier-accept (FIPA propose)</span>
</span><span id="Supplier.AcceptBuyRequest-360"><a href="#Supplier.AcceptBuyRequest-360"><span class="linenos">360</span></a><span class="sd">            - Purpose: &quot;I can fulfill your request&quot; (always true for supplier)</span>
</span><span id="Supplier.AcceptBuyRequest-361"><a href="#Supplier.AcceptBuyRequest-361"><span class="linenos">361</span></a><span class="sd">            - Next Phase: Await warehouse&#39;s award or rejection decision</span>
</span><span id="Supplier.AcceptBuyRequest-362"><a href="#Supplier.AcceptBuyRequest-362"><span class="linenos">362</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-363"><a href="#Supplier.AcceptBuyRequest-363"><span class="linenos">363</span></a><span class="sd">        Attributes:</span>
</span><span id="Supplier.AcceptBuyRequest-364"><a href="#Supplier.AcceptBuyRequest-364"><span class="linenos">364</span></a><span class="sd">            request_id (int): Unique identifier for this request.</span>
</span><span id="Supplier.AcceptBuyRequest-365"><a href="#Supplier.AcceptBuyRequest-365"><span class="linenos">365</span></a><span class="sd">            quant (int): Quantity of product being proposed.</span>
</span><span id="Supplier.AcceptBuyRequest-366"><a href="#Supplier.AcceptBuyRequest-366"><span class="linenos">366</span></a><span class="sd">            product (str): Name of product being proposed.</span>
</span><span id="Supplier.AcceptBuyRequest-367"><a href="#Supplier.AcceptBuyRequest-367"><span class="linenos">367</span></a><span class="sd">            sender (str): Warehouse JID that initiated the request.</span>
</span><span id="Supplier.AcceptBuyRequest-368"><a href="#Supplier.AcceptBuyRequest-368"><span class="linenos">368</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-369"><a href="#Supplier.AcceptBuyRequest-369"><span class="linenos">369</span></a><span class="sd">        Message Format (supplier-accept):</span>
</span><span id="Supplier.AcceptBuyRequest-370"><a href="#Supplier.AcceptBuyRequest-370"><span class="linenos">370</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier.AcceptBuyRequest-371"><a href="#Supplier.AcceptBuyRequest-371"><span class="linenos">371</span></a><span class="sd">                - performative: &quot;supplier-accept&quot; (FIPA propose)</span>
</span><span id="Supplier.AcceptBuyRequest-372"><a href="#Supplier.AcceptBuyRequest-372"><span class="linenos">372</span></a><span class="sd">                - supplier_id: This supplier&#39;s JID</span>
</span><span id="Supplier.AcceptBuyRequest-373"><a href="#Supplier.AcceptBuyRequest-373"><span class="linenos">373</span></a><span class="sd">                - warehouse_id: Requesting warehouse&#39;s JID</span>
</span><span id="Supplier.AcceptBuyRequest-374"><a href="#Supplier.AcceptBuyRequest-374"><span class="linenos">374</span></a><span class="sd">                - node_id: Supplier&#39;s graph location</span>
</span><span id="Supplier.AcceptBuyRequest-375"><a href="#Supplier.AcceptBuyRequest-375"><span class="linenos">375</span></a><span class="sd">                - request_id: Original request identifier</span>
</span><span id="Supplier.AcceptBuyRequest-376"><a href="#Supplier.AcceptBuyRequest-376"><span class="linenos">376</span></a><span class="sd">            Body:</span>
</span><span id="Supplier.AcceptBuyRequest-377"><a href="#Supplier.AcceptBuyRequest-377"><span class="linenos">377</span></a><span class="sd">                - Format: &quot;{quantity} {product}&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-378"><a href="#Supplier.AcceptBuyRequest-378"><span class="linenos">378</span></a><span class="sd">                - Example: &quot;100 electronics&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-379"><a href="#Supplier.AcceptBuyRequest-379"><span class="linenos">379</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-380"><a href="#Supplier.AcceptBuyRequest-380"><span class="linenos">380</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier.AcceptBuyRequest-381"><a href="#Supplier.AcceptBuyRequest-381"><span class="linenos">381</span></a><span class="sd">            1. **Log Acceptance** (verbose): Print proposal details</span>
</span><span id="Supplier.AcceptBuyRequest-382"><a href="#Supplier.AcceptBuyRequest-382"><span class="linenos">382</span></a><span class="sd">            2. **Construct Message**: Create supplier-accept with all metadata</span>
</span><span id="Supplier.AcceptBuyRequest-383"><a href="#Supplier.AcceptBuyRequest-383"><span class="linenos">383</span></a><span class="sd">            3. **Send Proposal**: Transmit to requesting warehouse</span>
</span><span id="Supplier.AcceptBuyRequest-384"><a href="#Supplier.AcceptBuyRequest-384"><span class="linenos">384</span></a><span class="sd">            4. **Create Listener**: Initialize ReceiveConfirmationOrDenial behaviour</span>
</span><span id="Supplier.AcceptBuyRequest-385"><a href="#Supplier.AcceptBuyRequest-385"><span class="linenos">385</span></a><span class="sd">            5. **Setup Template**: Configure filter for this specific negotiation</span>
</span><span id="Supplier.AcceptBuyRequest-386"><a href="#Supplier.AcceptBuyRequest-386"><span class="linenos">386</span></a><span class="sd">            6. **Register Listener**: Add behaviour with template to agent</span>
</span><span id="Supplier.AcceptBuyRequest-387"><a href="#Supplier.AcceptBuyRequest-387"><span class="linenos">387</span></a><span class="sd">            7. **Return**: Don&#39;t block (listener runs independently)</span>
</span><span id="Supplier.AcceptBuyRequest-388"><a href="#Supplier.AcceptBuyRequest-388"><span class="linenos">388</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-389"><a href="#Supplier.AcceptBuyRequest-389"><span class="linenos">389</span></a><span class="sd">        Template Configuration:</span>
</span><span id="Supplier.AcceptBuyRequest-390"><a href="#Supplier.AcceptBuyRequest-390"><span class="linenos">390</span></a><span class="sd">            Filters messages to match:</span>
</span><span id="Supplier.AcceptBuyRequest-391"><a href="#Supplier.AcceptBuyRequest-391"><span class="linenos">391</span></a><span class="sd">            - supplier_id: This supplier</span>
</span><span id="Supplier.AcceptBuyRequest-392"><a href="#Supplier.AcceptBuyRequest-392"><span class="linenos">392</span></a><span class="sd">            - warehouse_id: Specific warehouse that made request</span>
</span><span id="Supplier.AcceptBuyRequest-393"><a href="#Supplier.AcceptBuyRequest-393"><span class="linenos">393</span></a><span class="sd">            - request_id: This specific request</span>
</span><span id="Supplier.AcceptBuyRequest-394"><a href="#Supplier.AcceptBuyRequest-394"><span class="linenos">394</span></a><span class="sd">            </span>
</span><span id="Supplier.AcceptBuyRequest-395"><a href="#Supplier.AcceptBuyRequest-395"><span class="linenos">395</span></a><span class="sd">            Accepts both performatives:</span>
</span><span id="Supplier.AcceptBuyRequest-396"><a href="#Supplier.AcceptBuyRequest-396"><span class="linenos">396</span></a><span class="sd">            - warehouse-confirm (FIPA accept-proposal)</span>
</span><span id="Supplier.AcceptBuyRequest-397"><a href="#Supplier.AcceptBuyRequest-397"><span class="linenos">397</span></a><span class="sd">            - warehouse-deny (FIPA reject-proposal)</span>
</span><span id="Supplier.AcceptBuyRequest-398"><a href="#Supplier.AcceptBuyRequest-398"><span class="linenos">398</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-399"><a href="#Supplier.AcceptBuyRequest-399"><span class="linenos">399</span></a><span class="sd">        Non-Blocking Design:</span>
</span><span id="Supplier.AcceptBuyRequest-400"><a href="#Supplier.AcceptBuyRequest-400"><span class="linenos">400</span></a><span class="sd">            The commented-out `await confirm_deny_behav.join()` demonstrates</span>
</span><span id="Supplier.AcceptBuyRequest-401"><a href="#Supplier.AcceptBuyRequest-401"><span class="linenos">401</span></a><span class="sd">            that we intentionally DON&#39;T wait for confirmation here. This allows</span>
</span><span id="Supplier.AcceptBuyRequest-402"><a href="#Supplier.AcceptBuyRequest-402"><span class="linenos">402</span></a><span class="sd">            the supplier to accept multiple warehouse requests concurrently.</span>
</span><span id="Supplier.AcceptBuyRequest-403"><a href="#Supplier.AcceptBuyRequest-403"><span class="linenos">403</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-404"><a href="#Supplier.AcceptBuyRequest-404"><span class="linenos">404</span></a><span class="sd">        Example:</span>
</span><span id="Supplier.AcceptBuyRequest-405"><a href="#Supplier.AcceptBuyRequest-405"><span class="linenos">405</span></a><span class="sd">            ```</span>
</span><span id="Supplier.AcceptBuyRequest-406"><a href="#Supplier.AcceptBuyRequest-406"><span class="linenos">406</span></a><span class="sd">            Input: Warehouse request for &quot;100 electronics&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-407"><a href="#Supplier.AcceptBuyRequest-407"><span class="linenos">407</span></a><span class="sd">            Proposal Sent: supplier-accept with body &quot;100 electronics&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-408"><a href="#Supplier.AcceptBuyRequest-408"><span class="linenos">408</span></a><span class="sd">            Listener Setup: ReceiveConfirmationOrDenial waiting for:</span>
</span><span id="Supplier.AcceptBuyRequest-409"><a href="#Supplier.AcceptBuyRequest-409"><span class="linenos">409</span></a><span class="sd">                - warehouse-confirm (award) OR</span>
</span><span id="Supplier.AcceptBuyRequest-410"><a href="#Supplier.AcceptBuyRequest-410"><span class="linenos">410</span></a><span class="sd">                - warehouse-deny (rejection)</span>
</span><span id="Supplier.AcceptBuyRequest-411"><a href="#Supplier.AcceptBuyRequest-411"><span class="linenos">411</span></a><span class="sd">            Result: Supplier ready to process next request</span>
</span><span id="Supplier.AcceptBuyRequest-412"><a href="#Supplier.AcceptBuyRequest-412"><span class="linenos">412</span></a><span class="sd">            ```</span>
</span><span id="Supplier.AcceptBuyRequest-413"><a href="#Supplier.AcceptBuyRequest-413"><span class="linenos">413</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-414"><a href="#Supplier.AcceptBuyRequest-414"><span class="linenos">414</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier.AcceptBuyRequest-415"><a href="#Supplier.AcceptBuyRequest-415"><span class="linenos">415</span></a><span class="sd">            - Sends SPADE message to warehouse</span>
</span><span id="Supplier.AcceptBuyRequest-416"><a href="#Supplier.AcceptBuyRequest-416"><span class="linenos">416</span></a><span class="sd">            - Adds ReceiveConfirmationOrDenial behaviour to agent</span>
</span><span id="Supplier.AcceptBuyRequest-417"><a href="#Supplier.AcceptBuyRequest-417"><span class="linenos">417</span></a><span class="sd">            - Prints debug information if verbose enabled</span>
</span><span id="Supplier.AcceptBuyRequest-418"><a href="#Supplier.AcceptBuyRequest-418"><span class="linenos">418</span></a><span class="sd">        </span>
</span><span id="Supplier.AcceptBuyRequest-419"><a href="#Supplier.AcceptBuyRequest-419"><span class="linenos">419</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.AcceptBuyRequest-420"><a href="#Supplier.AcceptBuyRequest-420"><span class="linenos">420</span></a><span class="sd">            Unlike warehouse AcceptBuyRequest, this never needs to lock stock</span>
</span><span id="Supplier.AcceptBuyRequest-421"><a href="#Supplier.AcceptBuyRequest-421"><span class="linenos">421</span></a><span class="sd">            since the supplier has infinite inventory.</span>
</span><span id="Supplier.AcceptBuyRequest-422"><a href="#Supplier.AcceptBuyRequest-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-423"><a href="#Supplier.AcceptBuyRequest-423"><span class="linenos">423</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">):</span>
</span><span id="Supplier.AcceptBuyRequest-424"><a href="#Supplier.AcceptBuyRequest-424"><span class="linenos">424</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-425"><a href="#Supplier.AcceptBuyRequest-425"><span class="linenos">425</span></a><span class="sd">            Initialize the AcceptBuyRequest behaviour.</span>
</span><span id="Supplier.AcceptBuyRequest-426"><a href="#Supplier.AcceptBuyRequest-426"><span class="linenos">426</span></a><span class="sd">            </span>
</span><span id="Supplier.AcceptBuyRequest-427"><a href="#Supplier.AcceptBuyRequest-427"><span class="linenos">427</span></a><span class="sd">            Args:</span>
</span><span id="Supplier.AcceptBuyRequest-428"><a href="#Supplier.AcceptBuyRequest-428"><span class="linenos">428</span></a><span class="sd">                msg (Message): The warehouse-buy request message to accept.</span>
</span><span id="Supplier.AcceptBuyRequest-429"><a href="#Supplier.AcceptBuyRequest-429"><span class="linenos">429</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-430"><a href="#Supplier.AcceptBuyRequest-430"><span class="linenos">430</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier.AcceptBuyRequest-431"><a href="#Supplier.AcceptBuyRequest-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest-432"><a href="#Supplier.AcceptBuyRequest-432"><span class="linenos">432</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-433"><a href="#Supplier.AcceptBuyRequest-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">quant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.AcceptBuyRequest-434"><a href="#Supplier.AcceptBuyRequest-434"><span class="linenos">434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.AcceptBuyRequest-435"><a href="#Supplier.AcceptBuyRequest-435"><span class="linenos">435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">sender</span>
</span><span id="Supplier.AcceptBuyRequest-436"><a href="#Supplier.AcceptBuyRequest-436"><span class="linenos">436</span></a>        
</span><span id="Supplier.AcceptBuyRequest-437"><a href="#Supplier.AcceptBuyRequest-437"><span class="linenos">437</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.AcceptBuyRequest-438"><a href="#Supplier.AcceptBuyRequest-438"><span class="linenos">438</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.AcceptBuyRequest-439"><a href="#Supplier.AcceptBuyRequest-439"><span class="linenos">439</span></a>            
</span><span id="Supplier.AcceptBuyRequest-440"><a href="#Supplier.AcceptBuyRequest-440"><span class="linenos">440</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AcceptBuyRequest-441"><a href="#Supplier.AcceptBuyRequest-441"><span class="linenos">441</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Supplier.AcceptBuyRequest-442"><a href="#Supplier.AcceptBuyRequest-442"><span class="linenos">442</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Accepted a request from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="Supplier.AcceptBuyRequest-443"><a href="#Supplier.AcceptBuyRequest-443"><span class="linenos">443</span></a>                    <span class="sa">f</span><span class="s2">&quot;id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier.AcceptBuyRequest-444"><a href="#Supplier.AcceptBuyRequest-444"><span class="linenos">444</span></a>                    <span class="sa">f</span><span class="s2">&quot;quant=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quant</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier.AcceptBuyRequest-445"><a href="#Supplier.AcceptBuyRequest-445"><span class="linenos">445</span></a>                    <span class="sa">f</span><span class="s2">&quot;product=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-446"><a href="#Supplier.AcceptBuyRequest-446"><span class="linenos">446</span></a>                <span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-447"><a href="#Supplier.AcceptBuyRequest-447"><span class="linenos">447</span></a>            
</span><span id="Supplier.AcceptBuyRequest-448"><a href="#Supplier.AcceptBuyRequest-448"><span class="linenos">448</span></a>            
</span><span id="Supplier.AcceptBuyRequest-449"><a href="#Supplier.AcceptBuyRequest-449"><span class="linenos">449</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-450"><a href="#Supplier.AcceptBuyRequest-450"><span class="linenos">450</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;supplier-accept&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-451"><a href="#Supplier.AcceptBuyRequest-451"><span class="linenos">451</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest-452"><a href="#Supplier.AcceptBuyRequest-452"><span class="linenos">452</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest-453"><a href="#Supplier.AcceptBuyRequest-453"><span class="linenos">453</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest-454"><a href="#Supplier.AcceptBuyRequest-454"><span class="linenos">454</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest-455"><a href="#Supplier.AcceptBuyRequest-455"><span class="linenos">455</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quant</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Supplier.AcceptBuyRequest-456"><a href="#Supplier.AcceptBuyRequest-456"><span class="linenos">456</span></a>            
</span><span id="Supplier.AcceptBuyRequest-457"><a href="#Supplier.AcceptBuyRequest-457"><span class="linenos">457</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AcceptBuyRequest-458"><a href="#Supplier.AcceptBuyRequest-458"><span class="linenos">458</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Sending supplier-accept message to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-459"><a href="#Supplier.AcceptBuyRequest-459"><span class="linenos">459</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Message metadata: warehouse_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">, request_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-460"><a href="#Supplier.AcceptBuyRequest-460"><span class="linenos">460</span></a>            
</span><span id="Supplier.AcceptBuyRequest-461"><a href="#Supplier.AcceptBuyRequest-461"><span class="linenos">461</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-462"><a href="#Supplier.AcceptBuyRequest-462"><span class="linenos">462</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AcceptBuyRequest-463"><a href="#Supplier.AcceptBuyRequest-463"><span class="linenos">463</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Message sent successfully!&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-464"><a href="#Supplier.AcceptBuyRequest-464"><span class="linenos">464</span></a>            
</span><span id="Supplier.AcceptBuyRequest-465"><a href="#Supplier.AcceptBuyRequest-465"><span class="linenos">465</span></a>            <span class="c1"># Wait for either confirmation or denial</span>
</span><span id="Supplier.AcceptBuyRequest-466"><a href="#Supplier.AcceptBuyRequest-466"><span class="linenos">466</span></a>            <span class="n">confirm_deny_behav</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">ReceiveConfirmationOrDenial</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-467"><a href="#Supplier.AcceptBuyRequest-467"><span class="linenos">467</span></a>            
</span><span id="Supplier.AcceptBuyRequest-468"><a href="#Supplier.AcceptBuyRequest-468"><span class="linenos">468</span></a>            <span class="c1"># Template that matches BOTH warehouse-confirm AND warehouse-deny</span>
</span><span id="Supplier.AcceptBuyRequest-469"><a href="#Supplier.AcceptBuyRequest-469"><span class="linenos">469</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier.AcceptBuyRequest-470"><a href="#Supplier.AcceptBuyRequest-470"><span class="linenos">470</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest-471"><a href="#Supplier.AcceptBuyRequest-471"><span class="linenos">471</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest-472"><a href="#Supplier.AcceptBuyRequest-472"><span class="linenos">472</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest-473"><a href="#Supplier.AcceptBuyRequest-473"><span class="linenos">473</span></a>            
</span><span id="Supplier.AcceptBuyRequest-474"><a href="#Supplier.AcceptBuyRequest-474"><span class="linenos">474</span></a>            <span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">confirm_deny_behav</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-475"><a href="#Supplier.AcceptBuyRequest-475"><span class="linenos">475</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AcceptBuyRequest-476"><a href="#Supplier.AcceptBuyRequest-476"><span class="linenos">476</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; AcceptBuyRequest finished, now waiting for confirmation or denial...&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest-477"><a href="#Supplier.AcceptBuyRequest-477"><span class="linenos">477</span></a>            
</span><span id="Supplier.AcceptBuyRequest-478"><a href="#Supplier.AcceptBuyRequest-478"><span class="linenos">478</span></a>            <span class="c1"># Aguardar a confirmao ser recebida antes de terminar</span>
</span><span id="Supplier.AcceptBuyRequest-479"><a href="#Supplier.AcceptBuyRequest-479"><span class="linenos">479</span></a>            <span class="c1"># await confirm_deny_behav.join()</span>
</span></pre></div>


            <div class="docstring"><p>Behaviour that sends proposal acceptance to warehouse (FIPA propose).</p>

<p>This behaviour implements the proposal submission in the FIPA Contract Net
Protocol where the supplier, acting as a participant, sends its proposal
to fulfill the warehouse's request. Since the supplier has infinite stock,
this is always an acceptance. It then sets up to receive the warehouse's
decision (accept-proposal or reject-proposal).</p>

<p>FIPA Protocol Phase: <strong>Proposal Submission - Participant Role</strong>
    - Role: Participant (Supplier proposing to Warehouse)
    - Sends: supplier-accept (FIPA propose)
    - Purpose: "I can fulfill your request" (always true for supplier)
    - Next Phase: Await warehouse's award or rejection decision</p>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>request_id (int):</strong>  Unique identifier for this request.</li>
<li><strong>quant (int):</strong>  Quantity of product being proposed.</li>
<li><strong>product (str):</strong>  Name of product being proposed.</li>
<li><strong>sender (str):</strong>  Warehouse JID that initiated the request.</li>
</ul>

<p>Message Format (supplier-accept):
    Metadata:
        - performative: "supplier-accept" (FIPA propose)
        - supplier_id: This supplier's JID
        - warehouse_id: Requesting warehouse's JID
        - node_id: Supplier's graph location
        - request_id: Original request identifier
    Body:
        - Format: "{quantity} {product}"
        - Example: "100 electronics"</p>

<h6 id="workflow">Workflow:</h6>

<blockquote>
  <ol>
  <li><strong>Log Acceptance</strong> (verbose): Print proposal details</li>
  <li><strong>Construct Message</strong>: Create supplier-accept with all metadata</li>
  <li><strong>Send Proposal</strong>: Transmit to requesting warehouse</li>
  <li><strong>Create Listener</strong>: Initialize ReceiveConfirmationOrDenial behaviour</li>
  <li><strong>Setup Template</strong>: Configure filter for this specific negotiation</li>
  <li><strong>Register Listener</strong>: Add behaviour with template to agent</li>
  <li><strong>Return</strong>: Don't block (listener runs independently)</li>
  </ol>
</blockquote>

<h6 id="template-configuration">Template Configuration:</h6>

<blockquote>
  <p>Filters messages to match:</p>
  
  <ul>
  <li>supplier_id: This supplier</li>
  <li>warehouse_id: Specific warehouse that made request</li>
  <li>request_id: This specific request</li>
  </ul>
  
  <p>Accepts both performatives:</p>
  
  <ul>
  <li>warehouse-confirm (FIPA accept-proposal)</li>
  <li>warehouse-deny (FIPA reject-proposal)</li>
  </ul>
</blockquote>

<p>Non-Blocking Design:
    The commented-out <code>await confirm_deny_behav.join()</code> demonstrates
    that we intentionally DON'T wait for confirmation here. This allows
    the supplier to accept multiple warehouse requests concurrently.</p>

<h6 id="example">Example:</h6>

<blockquote>
<pre><code>Input: Warehouse request for "100 electronics"
Proposal Sent: supplier-accept with body "100 electronics"
Listener Setup: ReceiveConfirmationOrDenial waiting for:
    - warehouse-confirm (award) OR
    - warehouse-deny (rejection)
Result: Supplier ready to process next request
</code></pre>
</blockquote>

<h6 id="side-effects">Side Effects:</h6>

<blockquote>
  <ul>
  <li>Sends SPADE message to warehouse</li>
  <li>Adds ReceiveConfirmationOrDenial behaviour to agent</li>
  <li>Prints debug information if verbose enabled</li>
  </ul>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Unlike warehouse AcceptBuyRequest, this never needs to lock stock
  since the supplier has infinite inventory.</p>
</blockquote>
</div>


                            <div id="Supplier.AcceptBuyRequest.__init__" class="classattr">
                                        <input id="Supplier.AcceptBuyRequest.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Supplier.AcceptBuyRequest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">msg</span><span class="p">:</span> <span class="n">spade</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span></span>)</span>

                <label class="view-source-button" for="Supplier.AcceptBuyRequest.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AcceptBuyRequest.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AcceptBuyRequest.__init__-423"><a href="#Supplier.AcceptBuyRequest.__init__-423"><span class="linenos">423</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">):</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-424"><a href="#Supplier.AcceptBuyRequest.__init__-424"><span class="linenos">424</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-425"><a href="#Supplier.AcceptBuyRequest.__init__-425"><span class="linenos">425</span></a><span class="sd">            Initialize the AcceptBuyRequest behaviour.</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-426"><a href="#Supplier.AcceptBuyRequest.__init__-426"><span class="linenos">426</span></a><span class="sd">            </span>
</span><span id="Supplier.AcceptBuyRequest.__init__-427"><a href="#Supplier.AcceptBuyRequest.__init__-427"><span class="linenos">427</span></a><span class="sd">            Args:</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-428"><a href="#Supplier.AcceptBuyRequest.__init__-428"><span class="linenos">428</span></a><span class="sd">                msg (Message): The warehouse-buy request message to accept.</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-429"><a href="#Supplier.AcceptBuyRequest.__init__-429"><span class="linenos">429</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-430"><a href="#Supplier.AcceptBuyRequest.__init__-430"><span class="linenos">430</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-431"><a href="#Supplier.AcceptBuyRequest.__init__-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-432"><a href="#Supplier.AcceptBuyRequest.__init__-432"><span class="linenos">432</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-433"><a href="#Supplier.AcceptBuyRequest.__init__-433"><span class="linenos">433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">quant</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-434"><a href="#Supplier.AcceptBuyRequest.__init__-434"><span class="linenos">434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.AcceptBuyRequest.__init__-435"><a href="#Supplier.AcceptBuyRequest.__init__-435"><span class="linenos">435</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">sender</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the AcceptBuyRequest behaviour.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>msg (Message):</strong>  The warehouse-buy request message to accept.</li>
</ul>
</div>


                            </div>
                            <div id="Supplier.AcceptBuyRequest.request_id" class="classattr">
                                <div class="attr variable">
            <span class="name">request_id</span>

        
    </div>
    <a class="headerlink" href="#Supplier.AcceptBuyRequest.request_id"></a>
    
    

                            </div>
                            <div id="Supplier.AcceptBuyRequest.quant" class="classattr">
                                <div class="attr variable">
            <span class="name">quant</span>

        
    </div>
    <a class="headerlink" href="#Supplier.AcceptBuyRequest.quant"></a>
    
    

                            </div>
                            <div id="Supplier.AcceptBuyRequest.product" class="classattr">
                                <div class="attr variable">
            <span class="name">product</span>

        
    </div>
    <a class="headerlink" href="#Supplier.AcceptBuyRequest.product"></a>
    
    

                            </div>
                            <div id="Supplier.AcceptBuyRequest.sender" class="classattr">
                                <div class="attr variable">
            <span class="name">sender</span>

        
    </div>
    <a class="headerlink" href="#Supplier.AcceptBuyRequest.sender"></a>
    
    

                            </div>
                            <div id="Supplier.AcceptBuyRequest.run" class="classattr">
                                        <input id="Supplier.AcceptBuyRequest.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.AcceptBuyRequest.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AcceptBuyRequest.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AcceptBuyRequest.run-437"><a href="#Supplier.AcceptBuyRequest.run-437"><span class="linenos">437</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.AcceptBuyRequest.run-438"><a href="#Supplier.AcceptBuyRequest.run-438"><span class="linenos">438</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.AcceptBuyRequest.run-439"><a href="#Supplier.AcceptBuyRequest.run-439"><span class="linenos">439</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-440"><a href="#Supplier.AcceptBuyRequest.run-440"><span class="linenos">440</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AcceptBuyRequest.run-441"><a href="#Supplier.AcceptBuyRequest.run-441"><span class="linenos">441</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Supplier.AcceptBuyRequest.run-442"><a href="#Supplier.AcceptBuyRequest.run-442"><span class="linenos">442</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Accepted a request from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span id="Supplier.AcceptBuyRequest.run-443"><a href="#Supplier.AcceptBuyRequest.run-443"><span class="linenos">443</span></a>                    <span class="sa">f</span><span class="s2">&quot;id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier.AcceptBuyRequest.run-444"><a href="#Supplier.AcceptBuyRequest.run-444"><span class="linenos">444</span></a>                    <span class="sa">f</span><span class="s2">&quot;quant=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quant</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier.AcceptBuyRequest.run-445"><a href="#Supplier.AcceptBuyRequest.run-445"><span class="linenos">445</span></a>                    <span class="sa">f</span><span class="s2">&quot;product=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Supplier.AcceptBuyRequest.run-446"><a href="#Supplier.AcceptBuyRequest.run-446"><span class="linenos">446</span></a>                <span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-447"><a href="#Supplier.AcceptBuyRequest.run-447"><span class="linenos">447</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-448"><a href="#Supplier.AcceptBuyRequest.run-448"><span class="linenos">448</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-449"><a href="#Supplier.AcceptBuyRequest.run-449"><span class="linenos">449</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-450"><a href="#Supplier.AcceptBuyRequest.run-450"><span class="linenos">450</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;supplier-accept&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-451"><a href="#Supplier.AcceptBuyRequest.run-451"><span class="linenos">451</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest.run-452"><a href="#Supplier.AcceptBuyRequest.run-452"><span class="linenos">452</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest.run-453"><a href="#Supplier.AcceptBuyRequest.run-453"><span class="linenos">453</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest.run-454"><a href="#Supplier.AcceptBuyRequest.run-454"><span class="linenos">454</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest.run-455"><a href="#Supplier.AcceptBuyRequest.run-455"><span class="linenos">455</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quant</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Supplier.AcceptBuyRequest.run-456"><a href="#Supplier.AcceptBuyRequest.run-456"><span class="linenos">456</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-457"><a href="#Supplier.AcceptBuyRequest.run-457"><span class="linenos">457</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AcceptBuyRequest.run-458"><a href="#Supplier.AcceptBuyRequest.run-458"><span class="linenos">458</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Sending supplier-accept message to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-459"><a href="#Supplier.AcceptBuyRequest.run-459"><span class="linenos">459</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Message metadata: warehouse_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">, request_id=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-460"><a href="#Supplier.AcceptBuyRequest.run-460"><span class="linenos">460</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-461"><a href="#Supplier.AcceptBuyRequest.run-461"><span class="linenos">461</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-462"><a href="#Supplier.AcceptBuyRequest.run-462"><span class="linenos">462</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AcceptBuyRequest.run-463"><a href="#Supplier.AcceptBuyRequest.run-463"><span class="linenos">463</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Message sent successfully!&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-464"><a href="#Supplier.AcceptBuyRequest.run-464"><span class="linenos">464</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-465"><a href="#Supplier.AcceptBuyRequest.run-465"><span class="linenos">465</span></a>            <span class="c1"># Wait for either confirmation or denial</span>
</span><span id="Supplier.AcceptBuyRequest.run-466"><a href="#Supplier.AcceptBuyRequest.run-466"><span class="linenos">466</span></a>            <span class="n">confirm_deny_behav</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">ReceiveConfirmationOrDenial</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-467"><a href="#Supplier.AcceptBuyRequest.run-467"><span class="linenos">467</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-468"><a href="#Supplier.AcceptBuyRequest.run-468"><span class="linenos">468</span></a>            <span class="c1"># Template that matches BOTH warehouse-confirm AND warehouse-deny</span>
</span><span id="Supplier.AcceptBuyRequest.run-469"><a href="#Supplier.AcceptBuyRequest.run-469"><span class="linenos">469</span></a>            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier.AcceptBuyRequest.run-470"><a href="#Supplier.AcceptBuyRequest.run-470"><span class="linenos">470</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest.run-471"><a href="#Supplier.AcceptBuyRequest.run-471"><span class="linenos">471</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest.run-472"><a href="#Supplier.AcceptBuyRequest.run-472"><span class="linenos">472</span></a>            <span class="n">template</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">))</span>
</span><span id="Supplier.AcceptBuyRequest.run-473"><a href="#Supplier.AcceptBuyRequest.run-473"><span class="linenos">473</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-474"><a href="#Supplier.AcceptBuyRequest.run-474"><span class="linenos">474</span></a>            <span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">confirm_deny_behav</span><span class="p">,</span> <span class="n">template</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-475"><a href="#Supplier.AcceptBuyRequest.run-475"><span class="linenos">475</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AcceptBuyRequest.run-476"><a href="#Supplier.AcceptBuyRequest.run-476"><span class="linenos">476</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; AcceptBuyRequest finished, now waiting for confirmation or denial...&quot;</span><span class="p">)</span>
</span><span id="Supplier.AcceptBuyRequest.run-477"><a href="#Supplier.AcceptBuyRequest.run-477"><span class="linenos">477</span></a>            
</span><span id="Supplier.AcceptBuyRequest.run-478"><a href="#Supplier.AcceptBuyRequest.run-478"><span class="linenos">478</span></a>            <span class="c1"># Aguardar a confirmao ser recebida antes de terminar</span>
</span><span id="Supplier.AcceptBuyRequest.run-479"><a href="#Supplier.AcceptBuyRequest.run-479"><span class="linenos">479</span></a>            <span class="c1"># await confirm_deny_behav.join()</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
                <section id="Supplier.ReceiveConfirmationOrDenial">
                            <input id="Supplier.ReceiveConfirmationOrDenial-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.ReceiveConfirmationOrDenial</span><wbr>(<span class="base">spade.behaviour.OneShotBehaviour</span>):

                <label class="view-source-button" for="Supplier.ReceiveConfirmationOrDenial-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveConfirmationOrDenial"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveConfirmationOrDenial-482"><a href="#Supplier.ReceiveConfirmationOrDenial-482"><span class="linenos">482</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveConfirmationOrDenial</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-483"><a href="#Supplier.ReceiveConfirmationOrDenial-483"><span class="linenos">483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-484"><a href="#Supplier.ReceiveConfirmationOrDenial-484"><span class="linenos">484</span></a><span class="sd">        Behaviour that processes warehouse&#39;s award or rejection decision (FIPA result notification).</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-485"><a href="#Supplier.ReceiveConfirmationOrDenial-485"><span class="linenos">485</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-486"><a href="#Supplier.ReceiveConfirmationOrDenial-486"><span class="linenos">486</span></a><span class="sd">        This behaviour implements the result notification reception in the FIPA Contract Net</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-487"><a href="#Supplier.ReceiveConfirmationOrDenial-487"><span class="linenos">487</span></a><span class="sd">        Protocol where the supplier, acting as a participant, receives the warehouse&#39;s final</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-488"><a href="#Supplier.ReceiveConfirmationOrDenial-488"><span class="linenos">488</span></a><span class="sd">        decision about whether its proposal was accepted or rejected.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-489"><a href="#Supplier.ReceiveConfirmationOrDenial-489"><span class="linenos">489</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-490"><a href="#Supplier.ReceiveConfirmationOrDenial-490"><span class="linenos">490</span></a><span class="sd">        FIPA Protocol Phase: **Result Notification Reception - Participant Role**</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-491"><a href="#Supplier.ReceiveConfirmationOrDenial-491"><span class="linenos">491</span></a><span class="sd">            - Role: Participant (Supplier receiving Warehouse&#39;s decision)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-492"><a href="#Supplier.ReceiveConfirmationOrDenial-492"><span class="linenos">492</span></a><span class="sd">            - Receives: warehouse-confirm (FIPA accept-proposal) or warehouse-deny (FIPA reject-proposal)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-493"><a href="#Supplier.ReceiveConfirmationOrDenial-493"><span class="linenos">493</span></a><span class="sd">            - Actions:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-494"><a href="#Supplier.ReceiveConfirmationOrDenial-494"><span class="linenos">494</span></a><span class="sd">                - If confirm: Add order to pending_deliveries, assign vehicle</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-495"><a href="#Supplier.ReceiveConfirmationOrDenial-495"><span class="linenos">495</span></a><span class="sd">                - If deny: Log rejection (no rollback needed - infinite stock)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-496"><a href="#Supplier.ReceiveConfirmationOrDenial-496"><span class="linenos">496</span></a><span class="sd">                - If timeout: Log timeout (warehouse chose another supplier)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-497"><a href="#Supplier.ReceiveConfirmationOrDenial-497"><span class="linenos">497</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-498"><a href="#Supplier.ReceiveConfirmationOrDenial-498"><span class="linenos">498</span></a><span class="sd">        Order State Transitions:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-499"><a href="#Supplier.ReceiveConfirmationOrDenial-499"><span class="linenos">499</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-500"><a href="#Supplier.ReceiveConfirmationOrDenial-500"><span class="linenos">500</span></a><span class="sd">            **On warehouse-confirm (Award)**:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-501"><a href="#Supplier.ReceiveConfirmationOrDenial-501"><span class="linenos">501</span></a><span class="sd">                1. Convert message to Order object</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-502"><a href="#Supplier.ReceiveConfirmationOrDenial-502"><span class="linenos">502</span></a><span class="sd">                2. pending_deliveries[order_id] = order</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-503"><a href="#Supplier.ReceiveConfirmationOrDenial-503"><span class="linenos">503</span></a><span class="sd">                3. Launch AssignVehicle behaviour</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-504"><a href="#Supplier.ReceiveConfirmationOrDenial-504"><span class="linenos">504</span></a><span class="sd">                4. Print confirmation message</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-505"><a href="#Supplier.ReceiveConfirmationOrDenial-505"><span class="linenos">505</span></a><span class="sd">            </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-506"><a href="#Supplier.ReceiveConfirmationOrDenial-506"><span class="linenos">506</span></a><span class="sd">            **On warehouse-deny or timeout (Rejection/Timeout)**:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-507"><a href="#Supplier.ReceiveConfirmationOrDenial-507"><span class="linenos">507</span></a><span class="sd">                1. Log rejection/timeout (if verbose)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-508"><a href="#Supplier.ReceiveConfirmationOrDenial-508"><span class="linenos">508</span></a><span class="sd">                2. No state changes needed (infinite stock)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-509"><a href="#Supplier.ReceiveConfirmationOrDenial-509"><span class="linenos">509</span></a><span class="sd">                3. No further action required</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-510"><a href="#Supplier.ReceiveConfirmationOrDenial-510"><span class="linenos">510</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-511"><a href="#Supplier.ReceiveConfirmationOrDenial-511"><span class="linenos">511</span></a><span class="sd">        Attributes:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-512"><a href="#Supplier.ReceiveConfirmationOrDenial-512"><span class="linenos">512</span></a><span class="sd">            accepted_id (int): Request ID for which we sent proposal.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-513"><a href="#Supplier.ReceiveConfirmationOrDenial-513"><span class="linenos">513</span></a><span class="sd">            accepted_quantity (int): Quantity that was proposed.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-514"><a href="#Supplier.ReceiveConfirmationOrDenial-514"><span class="linenos">514</span></a><span class="sd">            accepted_product (str): Product that was proposed.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-515"><a href="#Supplier.ReceiveConfirmationOrDenial-515"><span class="linenos">515</span></a><span class="sd">            sender_jid (str): Warehouse JID that will send decision.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-516"><a href="#Supplier.ReceiveConfirmationOrDenial-516"><span class="linenos">516</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-517"><a href="#Supplier.ReceiveConfirmationOrDenial-517"><span class="linenos">517</span></a><span class="sd">        Timeout Mechanism:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-518"><a href="#Supplier.ReceiveConfirmationOrDenial-518"><span class="linenos">518</span></a><span class="sd">            - Wait time: 10 seconds</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-519"><a href="#Supplier.ReceiveConfirmationOrDenial-519"><span class="linenos">519</span></a><span class="sd">            - Interpretation: Warehouse chose another supplier (implicit rejection)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-520"><a href="#Supplier.ReceiveConfirmationOrDenial-520"><span class="linenos">520</span></a><span class="sd">            - Action: Log only (no stock to unlock)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-521"><a href="#Supplier.ReceiveConfirmationOrDenial-521"><span class="linenos">521</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-522"><a href="#Supplier.ReceiveConfirmationOrDenial-522"><span class="linenos">522</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-523"><a href="#Supplier.ReceiveConfirmationOrDenial-523"><span class="linenos">523</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-524"><a href="#Supplier.ReceiveConfirmationOrDenial-524"><span class="linenos">524</span></a><span class="sd">            **Scenario 1: Warehouse Confirms**</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-525"><a href="#Supplier.ReceiveConfirmationOrDenial-525"><span class="linenos">525</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-526"><a href="#Supplier.ReceiveConfirmationOrDenial-526"><span class="linenos">526</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-527"><a href="#Supplier.ReceiveConfirmationOrDenial-527"><span class="linenos">527</span></a><span class="sd">            Message Received: warehouse-confirm &quot;100 electronics&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-528"><a href="#Supplier.ReceiveConfirmationOrDenial-528"><span class="linenos">528</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-529"><a href="#Supplier.ReceiveConfirmationOrDenial-529"><span class="linenos">529</span></a><span class="sd">                - Create Order object</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-530"><a href="#Supplier.ReceiveConfirmationOrDenial-530"><span class="linenos">530</span></a><span class="sd">                - pending_deliveries[301000000] = Order(...)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-531"><a href="#Supplier.ReceiveConfirmationOrDenial-531"><span class="linenos">531</span></a><span class="sd">                - Launch AssignVehicle(301000000)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-532"><a href="#Supplier.ReceiveConfirmationOrDenial-532"><span class="linenos">532</span></a><span class="sd">                - Print: &quot;Order 301000000 confirmed: 100 xelectronics for warehouse1&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-533"><a href="#Supplier.ReceiveConfirmationOrDenial-533"><span class="linenos">533</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-534"><a href="#Supplier.ReceiveConfirmationOrDenial-534"><span class="linenos">534</span></a><span class="sd">            </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-535"><a href="#Supplier.ReceiveConfirmationOrDenial-535"><span class="linenos">535</span></a><span class="sd">            **Scenario 2: Warehouse Denies**</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-536"><a href="#Supplier.ReceiveConfirmationOrDenial-536"><span class="linenos">536</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-537"><a href="#Supplier.ReceiveConfirmationOrDenial-537"><span class="linenos">537</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-538"><a href="#Supplier.ReceiveConfirmationOrDenial-538"><span class="linenos">538</span></a><span class="sd">            Message Received: warehouse-deny &quot;100 electronics&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-539"><a href="#Supplier.ReceiveConfirmationOrDenial-539"><span class="linenos">539</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-540"><a href="#Supplier.ReceiveConfirmationOrDenial-540"><span class="linenos">540</span></a><span class="sd">                - Print: &quot;Denial received! Warehouse chose another supplier.&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-541"><a href="#Supplier.ReceiveConfirmationOrDenial-541"><span class="linenos">541</span></a><span class="sd">                - No state changes (infinite stock)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-542"><a href="#Supplier.ReceiveConfirmationOrDenial-542"><span class="linenos">542</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-543"><a href="#Supplier.ReceiveConfirmationOrDenial-543"><span class="linenos">543</span></a><span class="sd">            </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-544"><a href="#Supplier.ReceiveConfirmationOrDenial-544"><span class="linenos">544</span></a><span class="sd">            **Scenario 3: Timeout**</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-545"><a href="#Supplier.ReceiveConfirmationOrDenial-545"><span class="linenos">545</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-546"><a href="#Supplier.ReceiveConfirmationOrDenial-546"><span class="linenos">546</span></a><span class="sd">            Proposed: 100 electronics</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-547"><a href="#Supplier.ReceiveConfirmationOrDenial-547"><span class="linenos">547</span></a><span class="sd">            Message Received: None (10 second timeout)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-548"><a href="#Supplier.ReceiveConfirmationOrDenial-548"><span class="linenos">548</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-549"><a href="#Supplier.ReceiveConfirmationOrDenial-549"><span class="linenos">549</span></a><span class="sd">                - Print: &quot;Timeout: No confirmation or denial received&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-550"><a href="#Supplier.ReceiveConfirmationOrDenial-550"><span class="linenos">550</span></a><span class="sd">                - Print: &quot;Order not confirmed for electronics x100&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-551"><a href="#Supplier.ReceiveConfirmationOrDenial-551"><span class="linenos">551</span></a><span class="sd">                - No state changes (infinite stock)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-552"><a href="#Supplier.ReceiveConfirmationOrDenial-552"><span class="linenos">552</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-553"><a href="#Supplier.ReceiveConfirmationOrDenial-553"><span class="linenos">553</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-554"><a href="#Supplier.ReceiveConfirmationOrDenial-554"><span class="linenos">554</span></a><span class="sd">        Difference from Warehouse Behaviour:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-555"><a href="#Supplier.ReceiveConfirmationOrDenial-555"><span class="linenos">555</span></a><span class="sd">            Unlike warehouse ReceiveConfirmationOrDenial:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-556"><a href="#Supplier.ReceiveConfirmationOrDenial-556"><span class="linenos">556</span></a><span class="sd">            - No stock unlocking needed (infinite inventory)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-557"><a href="#Supplier.ReceiveConfirmationOrDenial-557"><span class="linenos">557</span></a><span class="sd">            - No capacity adjustments required</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-558"><a href="#Supplier.ReceiveConfirmationOrDenial-558"><span class="linenos">558</span></a><span class="sd">            - Simpler state management</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-559"><a href="#Supplier.ReceiveConfirmationOrDenial-559"><span class="linenos">559</span></a><span class="sd">            - Only tracks confirmed orders in pending_deliveries</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-560"><a href="#Supplier.ReceiveConfirmationOrDenial-560"><span class="linenos">560</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-561"><a href="#Supplier.ReceiveConfirmationOrDenial-561"><span class="linenos">561</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-562"><a href="#Supplier.ReceiveConfirmationOrDenial-562"><span class="linenos">562</span></a><span class="sd">            This behaviour is automatically filtered by template to only receive</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-563"><a href="#Supplier.ReceiveConfirmationOrDenial-563"><span class="linenos">563</span></a><span class="sd">            messages for the specific supplier, warehouse, and request_id combination.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-564"><a href="#Supplier.ReceiveConfirmationOrDenial-564"><span class="linenos">564</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-565"><a href="#Supplier.ReceiveConfirmationOrDenial-565"><span class="linenos">565</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accept_msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">sender_jid</span><span class="p">):</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-566"><a href="#Supplier.ReceiveConfirmationOrDenial-566"><span class="linenos">566</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-567"><a href="#Supplier.ReceiveConfirmationOrDenial-567"><span class="linenos">567</span></a><span class="sd">            Initialize the ReceiveConfirmationOrDenial behaviour.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-568"><a href="#Supplier.ReceiveConfirmationOrDenial-568"><span class="linenos">568</span></a><span class="sd">            </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-569"><a href="#Supplier.ReceiveConfirmationOrDenial-569"><span class="linenos">569</span></a><span class="sd">            Args:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-570"><a href="#Supplier.ReceiveConfirmationOrDenial-570"><span class="linenos">570</span></a><span class="sd">                accept_msg (Message): The supplier-accept message we sent.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-571"><a href="#Supplier.ReceiveConfirmationOrDenial-571"><span class="linenos">571</span></a><span class="sd">                    Used to extract proposal details for logging if needed.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-572"><a href="#Supplier.ReceiveConfirmationOrDenial-572"><span class="linenos">572</span></a><span class="sd">                sender_jid (str): JID of the warehouse that will send the decision.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-573"><a href="#Supplier.ReceiveConfirmationOrDenial-573"><span class="linenos">573</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-574"><a href="#Supplier.ReceiveConfirmationOrDenial-574"><span class="linenos">574</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-575"><a href="#Supplier.ReceiveConfirmationOrDenial-575"><span class="linenos">575</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">accept_msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-576"><a href="#Supplier.ReceiveConfirmationOrDenial-576"><span class="linenos">576</span></a>            <span class="n">bod</span> <span class="o">=</span> <span class="n">accept_msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-577"><a href="#Supplier.ReceiveConfirmationOrDenial-577"><span class="linenos">577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bod</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-578"><a href="#Supplier.ReceiveConfirmationOrDenial-578"><span class="linenos">578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_product</span> <span class="o">=</span> <span class="n">bod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-579"><a href="#Supplier.ReceiveConfirmationOrDenial-579"><span class="linenos">579</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sender_jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sender_jid</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-580"><a href="#Supplier.ReceiveConfirmationOrDenial-580"><span class="linenos">580</span></a>        
</span><span id="Supplier.ReceiveConfirmationOrDenial-581"><a href="#Supplier.ReceiveConfirmationOrDenial-581"><span class="linenos">581</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-582"><a href="#Supplier.ReceiveConfirmationOrDenial-582"><span class="linenos">582</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-583"><a href="#Supplier.ReceiveConfirmationOrDenial-583"><span class="linenos">583</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Waiting for warehouse confirmation or denial...&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-584"><a href="#Supplier.ReceiveConfirmationOrDenial-584"><span class="linenos">584</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-585"><a href="#Supplier.ReceiveConfirmationOrDenial-585"><span class="linenos">585</span></a>            
</span><span id="Supplier.ReceiveConfirmationOrDenial-586"><a href="#Supplier.ReceiveConfirmationOrDenial-586"><span class="linenos">586</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-587"><a href="#Supplier.ReceiveConfirmationOrDenial-587"><span class="linenos">587</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-588"><a href="#Supplier.ReceiveConfirmationOrDenial-588"><span class="linenos">588</span></a>                <span class="n">performative</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-589"><a href="#Supplier.ReceiveConfirmationOrDenial-589"><span class="linenos">589</span></a>                
</span><span id="Supplier.ReceiveConfirmationOrDenial-590"><a href="#Supplier.ReceiveConfirmationOrDenial-590"><span class="linenos">590</span></a>                <span class="c1"># Message with body format &quot;quantity product&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-591"><a href="#Supplier.ReceiveConfirmationOrDenial-591"><span class="linenos">591</span></a>                <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-592"><a href="#Supplier.ReceiveConfirmationOrDenial-592"><span class="linenos">592</span></a>                <span class="n">quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-593"><a href="#Supplier.ReceiveConfirmationOrDenial-593"><span class="linenos">593</span></a>                <span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-594"><a href="#Supplier.ReceiveConfirmationOrDenial-594"><span class="linenos">594</span></a>                
</span><span id="Supplier.ReceiveConfirmationOrDenial-595"><a href="#Supplier.ReceiveConfirmationOrDenial-595"><span class="linenos">595</span></a>                <span class="k">if</span> <span class="n">performative</span> <span class="o">==</span> <span class="s2">&quot;warehouse-confirm&quot;</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-596"><a href="#Supplier.ReceiveConfirmationOrDenial-596"><span class="linenos">596</span></a>                    <span class="c1"># Warehouse confirmed - add to pending deliveries</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-597"><a href="#Supplier.ReceiveConfirmationOrDenial-597"><span class="linenos">597</span></a>                    <span class="c1"># Create Order object from message and add to pending_deliveries</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-598"><a href="#Supplier.ReceiveConfirmationOrDenial-598"><span class="linenos">598</span></a>                    <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">message_to_order</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-599"><a href="#Supplier.ReceiveConfirmationOrDenial-599"><span class="linenos">599</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-600"><a href="#Supplier.ReceiveConfirmationOrDenial-600"><span class="linenos">600</span></a>                            
</span><span id="Supplier.ReceiveConfirmationOrDenial-601"><a href="#Supplier.ReceiveConfirmationOrDenial-601"><span class="linenos">601</span></a>                    <span class="c1"># Essential print - order confirmed</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-602"><a href="#Supplier.ReceiveConfirmationOrDenial-602"><span class="linenos">602</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> confirmed: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-603"><a href="#Supplier.ReceiveConfirmationOrDenial-603"><span class="linenos">603</span></a>
</span><span id="Supplier.ReceiveConfirmationOrDenial-604"><a href="#Supplier.ReceiveConfirmationOrDenial-604"><span class="linenos">604</span></a>                    <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">AssignVehicle</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-605"><a href="#Supplier.ReceiveConfirmationOrDenial-605"><span class="linenos">605</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-606"><a href="#Supplier.ReceiveConfirmationOrDenial-606"><span class="linenos">606</span></a>                    
</span><span id="Supplier.ReceiveConfirmationOrDenial-607"><a href="#Supplier.ReceiveConfirmationOrDenial-607"><span class="linenos">607</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-608"><a href="#Supplier.ReceiveConfirmationOrDenial-608"><span class="linenos">608</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-609"><a href="#Supplier.ReceiveConfirmationOrDenial-609"><span class="linenos">609</span></a>                    
</span><span id="Supplier.ReceiveConfirmationOrDenial-610"><a href="#Supplier.ReceiveConfirmationOrDenial-610"><span class="linenos">610</span></a>                <span class="k">elif</span> <span class="n">performative</span> <span class="o">==</span> <span class="s2">&quot;warehouse-deny&quot;</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-611"><a href="#Supplier.ReceiveConfirmationOrDenial-611"><span class="linenos">611</span></a>                    <span class="c1"># Warehouse denied (chose another supplier) - just log it</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-612"><a href="#Supplier.ReceiveConfirmationOrDenial-612"><span class="linenos">612</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-613"><a href="#Supplier.ReceiveConfirmationOrDenial-613"><span class="linenos">613</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Denial received! Warehouse chose another supplier.&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-614"><a href="#Supplier.ReceiveConfirmationOrDenial-614"><span class="linenos">614</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order not confirmed for </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-615"><a href="#Supplier.ReceiveConfirmationOrDenial-615"><span class="linenos">615</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-616"><a href="#Supplier.ReceiveConfirmationOrDenial-616"><span class="linenos">616</span></a>                    
</span><span id="Supplier.ReceiveConfirmationOrDenial-617"><a href="#Supplier.ReceiveConfirmationOrDenial-617"><span class="linenos">617</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-618"><a href="#Supplier.ReceiveConfirmationOrDenial-618"><span class="linenos">618</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-619"><a href="#Supplier.ReceiveConfirmationOrDenial-619"><span class="linenos">619</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Timeout: No confirmation or denial received in 10 seconds.&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-620"><a href="#Supplier.ReceiveConfirmationOrDenial-620"><span class="linenos">620</span></a>                    <span class="c1"># Since supplier has infinite stock, no need to rollback</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-621"><a href="#Supplier.ReceiveConfirmationOrDenial-621"><span class="linenos">621</span></a>                    <span class="c1"># Just log that order wasn&#39;t confirmed</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-622"><a href="#Supplier.ReceiveConfirmationOrDenial-622"><span class="linenos">622</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order not confirmed for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_product</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial-623"><a href="#Supplier.ReceiveConfirmationOrDenial-623"><span class="linenos">623</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Behaviour that processes warehouse's award or rejection decision (FIPA result notification).</p>

<p>This behaviour implements the result notification reception in the FIPA Contract Net
Protocol where the supplier, acting as a participant, receives the warehouse's final
decision about whether its proposal was accepted or rejected.</p>

<p>FIPA Protocol Phase: <strong>Result Notification Reception - Participant Role</strong>
    - Role: Participant (Supplier receiving Warehouse's decision)
    - Receives: warehouse-confirm (FIPA accept-proposal) or warehouse-deny (FIPA reject-proposal)
    - Actions:
        - If confirm: Add order to pending_deliveries, assign vehicle
        - If deny: Log rejection (no rollback needed - infinite stock)
        - If timeout: Log timeout (warehouse chose another supplier)</p>

<h6 id="order-state-transitions">Order State Transitions:</h6>

<blockquote>
  <p><strong>On warehouse-confirm (Award)</strong>:
      1. Convert message to Order object
      2. pending_deliveries[order_id] = order
      3. Launch AssignVehicle behaviour
      4. Print confirmation message</p>
  
  <p><strong>On warehouse-deny or timeout (Rejection/Timeout)</strong>:
      1. Log rejection/timeout (if verbose)
      2. No state changes needed (infinite stock)
      3. No further action required</p>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>accepted_id (int):</strong>  Request ID for which we sent proposal.</li>
<li><strong>accepted_quantity (int):</strong>  Quantity that was proposed.</li>
<li><strong>accepted_product (str):</strong>  Product that was proposed.</li>
<li><strong>sender_jid (str):</strong>  Warehouse JID that will send decision.</li>
</ul>

<h6 id="timeout-mechanism">Timeout Mechanism:</h6>

<blockquote>
  <ul>
  <li>Wait time: 10 seconds</li>
  <li>Interpretation: Warehouse chose another supplier (implicit rejection)</li>
  <li>Action: Log only (no stock to unlock)</li>
  </ul>
</blockquote>

<h6 id="example-execution">Example Execution:</h6>

<blockquote>
  <p><strong>Scenario 1: Warehouse Confirms</strong></p>

<pre><code>Proposed: 100 electronics
Message Received: warehouse-confirm "100 electronics"
Actions:
    - Create Order object
    - pending_deliveries[301000000] = Order(...)
    - Launch AssignVehicle(301000000)
    - Print: "Order 301000000 confirmed: 100 xelectronics for warehouse1"
</code></pre>
  
  <p><strong>Scenario 2: Warehouse Denies</strong></p>

<pre><code>Proposed: 100 electronics
Message Received: warehouse-deny "100 electronics"
Actions:
    - Print: "Denial received! Warehouse chose another supplier."
    - No state changes (infinite stock)
</code></pre>
  
  <p><strong>Scenario 3: Timeout</strong></p>

<pre><code>Proposed: 100 electronics
Message Received: None (10 second timeout)
Actions:
    - Print: "Timeout: No confirmation or denial received"
    - Print: "Order not confirmed for electronics x100"
    - No state changes (infinite stock)
</code></pre>
</blockquote>

<h6 id="difference-from-warehouse-behaviour">Difference from Warehouse Behaviour:</h6>

<blockquote>
  <p>Unlike warehouse ReceiveConfirmationOrDenial:</p>
  
  <ul>
  <li>No stock unlocking needed (infinite inventory)</li>
  <li>No capacity adjustments required</li>
  <li>Simpler state management</li>
  <li>Only tracks confirmed orders in pending_deliveries</li>
  </ul>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>This behaviour is automatically filtered by template to only receive
  messages for the specific supplier, warehouse, and request_id combination.</p>
</blockquote>
</div>


                            <div id="Supplier.ReceiveConfirmationOrDenial.__init__" class="classattr">
                                        <input id="Supplier.ReceiveConfirmationOrDenial.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Supplier.ReceiveConfirmationOrDenial</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">accept_msg</span><span class="p">:</span> <span class="n">spade</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>, </span><span class="param"><span class="n">sender_jid</span></span>)</span>

                <label class="view-source-button" for="Supplier.ReceiveConfirmationOrDenial.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveConfirmationOrDenial.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-565"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-565"><span class="linenos">565</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accept_msg</span> <span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">sender_jid</span><span class="p">):</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-566"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-566"><span class="linenos">566</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-567"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-567"><span class="linenos">567</span></a><span class="sd">            Initialize the ReceiveConfirmationOrDenial behaviour.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-568"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-568"><span class="linenos">568</span></a><span class="sd">            </span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-569"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-569"><span class="linenos">569</span></a><span class="sd">            Args:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-570"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-570"><span class="linenos">570</span></a><span class="sd">                accept_msg (Message): The supplier-accept message we sent.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-571"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-571"><span class="linenos">571</span></a><span class="sd">                    Used to extract proposal details for logging if needed.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-572"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-572"><span class="linenos">572</span></a><span class="sd">                sender_jid (str): JID of the warehouse that will send the decision.</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-573"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-573"><span class="linenos">573</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-574"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-574"><span class="linenos">574</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-575"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-575"><span class="linenos">575</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">accept_msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">))</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-576"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-576"><span class="linenos">576</span></a>            <span class="n">bod</span> <span class="o">=</span> <span class="n">accept_msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-577"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-577"><span class="linenos">577</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bod</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-578"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-578"><span class="linenos">578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accepted_product</span> <span class="o">=</span> <span class="n">bod</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.__init__-579"><a href="#Supplier.ReceiveConfirmationOrDenial.__init__-579"><span class="linenos">579</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sender_jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sender_jid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the ReceiveConfirmationOrDenial behaviour.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>accept_msg (Message):</strong>  The supplier-accept message we sent.
Used to extract proposal details for logging if needed.</li>
<li><strong>sender_jid (str):</strong>  JID of the warehouse that will send the decision.</li>
</ul>
</div>


                            </div>
                            <div id="Supplier.ReceiveConfirmationOrDenial.accepted_id" class="classattr">
                                <div class="attr variable">
            <span class="name">accepted_id</span>

        
    </div>
    <a class="headerlink" href="#Supplier.ReceiveConfirmationOrDenial.accepted_id"></a>
    
    

                            </div>
                            <div id="Supplier.ReceiveConfirmationOrDenial.accepted_quantity" class="classattr">
                                <div class="attr variable">
            <span class="name">accepted_quantity</span>

        
    </div>
    <a class="headerlink" href="#Supplier.ReceiveConfirmationOrDenial.accepted_quantity"></a>
    
    

                            </div>
                            <div id="Supplier.ReceiveConfirmationOrDenial.accepted_product" class="classattr">
                                <div class="attr variable">
            <span class="name">accepted_product</span>

        
    </div>
    <a class="headerlink" href="#Supplier.ReceiveConfirmationOrDenial.accepted_product"></a>
    
    

                            </div>
                            <div id="Supplier.ReceiveConfirmationOrDenial.sender_jid" class="classattr">
                                <div class="attr variable">
            <span class="name">sender_jid</span>

        
    </div>
    <a class="headerlink" href="#Supplier.ReceiveConfirmationOrDenial.sender_jid"></a>
    
    

                            </div>
                            <div id="Supplier.ReceiveConfirmationOrDenial.run" class="classattr">
                                        <input id="Supplier.ReceiveConfirmationOrDenial.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.ReceiveConfirmationOrDenial.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveConfirmationOrDenial.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveConfirmationOrDenial.run-581"><a href="#Supplier.ReceiveConfirmationOrDenial.run-581"><span class="linenos">581</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-582"><a href="#Supplier.ReceiveConfirmationOrDenial.run-582"><span class="linenos">582</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-583"><a href="#Supplier.ReceiveConfirmationOrDenial.run-583"><span class="linenos">583</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Waiting for warehouse confirmation or denial...&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-584"><a href="#Supplier.ReceiveConfirmationOrDenial.run-584"><span class="linenos">584</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-585"><a href="#Supplier.ReceiveConfirmationOrDenial.run-585"><span class="linenos">585</span></a>            
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-586"><a href="#Supplier.ReceiveConfirmationOrDenial.run-586"><span class="linenos">586</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-587"><a href="#Supplier.ReceiveConfirmationOrDenial.run-587"><span class="linenos">587</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-588"><a href="#Supplier.ReceiveConfirmationOrDenial.run-588"><span class="linenos">588</span></a>                <span class="n">performative</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-589"><a href="#Supplier.ReceiveConfirmationOrDenial.run-589"><span class="linenos">589</span></a>                
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-590"><a href="#Supplier.ReceiveConfirmationOrDenial.run-590"><span class="linenos">590</span></a>                <span class="c1"># Message with body format &quot;quantity product&quot;</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-591"><a href="#Supplier.ReceiveConfirmationOrDenial.run-591"><span class="linenos">591</span></a>                <span class="n">request</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-592"><a href="#Supplier.ReceiveConfirmationOrDenial.run-592"><span class="linenos">592</span></a>                <span class="n">quantity</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-593"><a href="#Supplier.ReceiveConfirmationOrDenial.run-593"><span class="linenos">593</span></a>                <span class="n">product</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-594"><a href="#Supplier.ReceiveConfirmationOrDenial.run-594"><span class="linenos">594</span></a>                
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-595"><a href="#Supplier.ReceiveConfirmationOrDenial.run-595"><span class="linenos">595</span></a>                <span class="k">if</span> <span class="n">performative</span> <span class="o">==</span> <span class="s2">&quot;warehouse-confirm&quot;</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-596"><a href="#Supplier.ReceiveConfirmationOrDenial.run-596"><span class="linenos">596</span></a>                    <span class="c1"># Warehouse confirmed - add to pending deliveries</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-597"><a href="#Supplier.ReceiveConfirmationOrDenial.run-597"><span class="linenos">597</span></a>                    <span class="c1"># Create Order object from message and add to pending_deliveries</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-598"><a href="#Supplier.ReceiveConfirmationOrDenial.run-598"><span class="linenos">598</span></a>                    <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">message_to_order</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-599"><a href="#Supplier.ReceiveConfirmationOrDenial.run-599"><span class="linenos">599</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-600"><a href="#Supplier.ReceiveConfirmationOrDenial.run-600"><span class="linenos">600</span></a>                            
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-601"><a href="#Supplier.ReceiveConfirmationOrDenial.run-601"><span class="linenos">601</span></a>                    <span class="c1"># Essential print - order confirmed</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-602"><a href="#Supplier.ReceiveConfirmationOrDenial.run-602"><span class="linenos">602</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> confirmed: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-603"><a href="#Supplier.ReceiveConfirmationOrDenial.run-603"><span class="linenos">603</span></a>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-604"><a href="#Supplier.ReceiveConfirmationOrDenial.run-604"><span class="linenos">604</span></a>                    <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">AssignVehicle</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-605"><a href="#Supplier.ReceiveConfirmationOrDenial.run-605"><span class="linenos">605</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-606"><a href="#Supplier.ReceiveConfirmationOrDenial.run-606"><span class="linenos">606</span></a>                    
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-607"><a href="#Supplier.ReceiveConfirmationOrDenial.run-607"><span class="linenos">607</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-608"><a href="#Supplier.ReceiveConfirmationOrDenial.run-608"><span class="linenos">608</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-609"><a href="#Supplier.ReceiveConfirmationOrDenial.run-609"><span class="linenos">609</span></a>                    
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-610"><a href="#Supplier.ReceiveConfirmationOrDenial.run-610"><span class="linenos">610</span></a>                <span class="k">elif</span> <span class="n">performative</span> <span class="o">==</span> <span class="s2">&quot;warehouse-deny&quot;</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-611"><a href="#Supplier.ReceiveConfirmationOrDenial.run-611"><span class="linenos">611</span></a>                    <span class="c1"># Warehouse denied (chose another supplier) - just log it</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-612"><a href="#Supplier.ReceiveConfirmationOrDenial.run-612"><span class="linenos">612</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-613"><a href="#Supplier.ReceiveConfirmationOrDenial.run-613"><span class="linenos">613</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Denial received! Warehouse chose another supplier.&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-614"><a href="#Supplier.ReceiveConfirmationOrDenial.run-614"><span class="linenos">614</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order not confirmed for </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-615"><a href="#Supplier.ReceiveConfirmationOrDenial.run-615"><span class="linenos">615</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-616"><a href="#Supplier.ReceiveConfirmationOrDenial.run-616"><span class="linenos">616</span></a>                    
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-617"><a href="#Supplier.ReceiveConfirmationOrDenial.run-617"><span class="linenos">617</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-618"><a href="#Supplier.ReceiveConfirmationOrDenial.run-618"><span class="linenos">618</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-619"><a href="#Supplier.ReceiveConfirmationOrDenial.run-619"><span class="linenos">619</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Timeout: No confirmation or denial received in 10 seconds.&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-620"><a href="#Supplier.ReceiveConfirmationOrDenial.run-620"><span class="linenos">620</span></a>                    <span class="c1"># Since supplier has infinite stock, no need to rollback</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-621"><a href="#Supplier.ReceiveConfirmationOrDenial.run-621"><span class="linenos">621</span></a>                    <span class="c1"># Just log that order wasn&#39;t confirmed</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-622"><a href="#Supplier.ReceiveConfirmationOrDenial.run-622"><span class="linenos">622</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Order not confirmed for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_product</span><span class="si">}</span><span class="s2"> x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_quantity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveConfirmationOrDenial.run-623"><a href="#Supplier.ReceiveConfirmationOrDenial.run-623"><span class="linenos">623</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
                <section id="Supplier.ReceiveVehicleArrival">
                            <input id="Supplier.ReceiveVehicleArrival-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.ReceiveVehicleArrival</span><wbr>(<span class="base">spade.behaviour.CyclicBehaviour</span>):

                <label class="view-source-button" for="Supplier.ReceiveVehicleArrival-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveVehicleArrival"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveVehicleArrival-625"><a href="#Supplier.ReceiveVehicleArrival-625"><span class="linenos">625</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveVehicleArrival</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="Supplier.ReceiveVehicleArrival-626"><a href="#Supplier.ReceiveVehicleArrival-626"><span class="linenos">626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveVehicleArrival-627"><a href="#Supplier.ReceiveVehicleArrival-627"><span class="linenos">627</span></a><span class="sd">        Cyclic behaviour that processes vehicle pickup notifications.</span>
</span><span id="Supplier.ReceiveVehicleArrival-628"><a href="#Supplier.ReceiveVehicleArrival-628"><span class="linenos">628</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleArrival-629"><a href="#Supplier.ReceiveVehicleArrival-629"><span class="linenos">629</span></a><span class="sd">        Handles vehicle-pickup messages when vehicles arrive to collect confirmed</span>
</span><span id="Supplier.ReceiveVehicleArrival-630"><a href="#Supplier.ReceiveVehicleArrival-630"><span class="linenos">630</span></a><span class="sd">        orders from the supplier, removes order from pending_deliveries, and sends</span>
</span><span id="Supplier.ReceiveVehicleArrival-631"><a href="#Supplier.ReceiveVehicleArrival-631"><span class="linenos">631</span></a><span class="sd">        pickup confirmation back to vehicle.</span>
</span><span id="Supplier.ReceiveVehicleArrival-632"><a href="#Supplier.ReceiveVehicleArrival-632"><span class="linenos">632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveVehicleArrival-633"><a href="#Supplier.ReceiveVehicleArrival-633"><span class="linenos">633</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival-634"><a href="#Supplier.ReceiveVehicleArrival-634"><span class="linenos">634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier.ReceiveVehicleArrival-635"><a href="#Supplier.ReceiveVehicleArrival-635"><span class="linenos">635</span></a>            
</span><span id="Supplier.ReceiveVehicleArrival-636"><a href="#Supplier.ReceiveVehicleArrival-636"><span class="linenos">636</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">r_msg</span>
</span><span id="Supplier.ReceiveVehicleArrival-637"><a href="#Supplier.ReceiveVehicleArrival-637"><span class="linenos">637</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;pickup-confirm&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-638"><a href="#Supplier.ReceiveVehicleArrival-638"><span class="linenos">638</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier.ReceiveVehicleArrival-639"><a href="#Supplier.ReceiveVehicleArrival-639"><span class="linenos">639</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier.ReceiveVehicleArrival-640"><a href="#Supplier.ReceiveVehicleArrival-640"><span class="linenos">640</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="Supplier.ReceiveVehicleArrival-641"><a href="#Supplier.ReceiveVehicleArrival-641"><span class="linenos">641</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">))</span>
</span><span id="Supplier.ReceiveVehicleArrival-642"><a href="#Supplier.ReceiveVehicleArrival-642"><span class="linenos">642</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-643"><a href="#Supplier.ReceiveVehicleArrival-643"><span class="linenos">643</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="Supplier.ReceiveVehicleArrival-644"><a href="#Supplier.ReceiveVehicleArrival-644"><span class="linenos">644</span></a>        
</span><span id="Supplier.ReceiveVehicleArrival-645"><a href="#Supplier.ReceiveVehicleArrival-645"><span class="linenos">645</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveVehicleArrival-646"><a href="#Supplier.ReceiveVehicleArrival-646"><span class="linenos">646</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceiveVehicleArrival-647"><a href="#Supplier.ReceiveVehicleArrival-647"><span class="linenos">647</span></a>            
</span><span id="Supplier.ReceiveVehicleArrival-648"><a href="#Supplier.ReceiveVehicleArrival-648"><span class="linenos">648</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span>  <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-649"><a href="#Supplier.ReceiveVehicleArrival-649"><span class="linenos">649</span></a>            
</span><span id="Supplier.ReceiveVehicleArrival-650"><a href="#Supplier.ReceiveVehicleArrival-650"><span class="linenos">650</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival-651"><a href="#Supplier.ReceiveVehicleArrival-651"><span class="linenos">651</span></a>                <span class="c1"># Parse message body</span>
</span><span id="Supplier.ReceiveVehicleArrival-652"><a href="#Supplier.ReceiveVehicleArrival-652"><span class="linenos">652</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival-653"><a href="#Supplier.ReceiveVehicleArrival-653"><span class="linenos">653</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-654"><a href="#Supplier.ReceiveVehicleArrival-654"><span class="linenos">654</span></a>                    <span class="n">order</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">dict_to_order</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-655"><a href="#Supplier.ReceiveVehicleArrival-655"><span class="linenos">655</span></a>                <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival-656"><a href="#Supplier.ReceiveVehicleArrival-656"><span class="linenos">656</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; ERROR: Failed to parse vehicle message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-657"><a href="#Supplier.ReceiveVehicleArrival-657"><span class="linenos">657</span></a>                    <span class="k">return</span>
</span><span id="Supplier.ReceiveVehicleArrival-658"><a href="#Supplier.ReceiveVehicleArrival-658"><span class="linenos">658</span></a>                
</span><span id="Supplier.ReceiveVehicleArrival-659"><a href="#Supplier.ReceiveVehicleArrival-659"><span class="linenos">659</span></a>                <span class="c1"># Vehicle is picking up an order to deliver to warehouse</span>
</span><span id="Supplier.ReceiveVehicleArrival-660"><a href="#Supplier.ReceiveVehicleArrival-660"><span class="linenos">660</span></a>                <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival-661"><a href="#Supplier.ReceiveVehicleArrival-661"><span class="linenos">661</span></a>                    <span class="k">del</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">]</span>
</span><span id="Supplier.ReceiveVehicleArrival-662"><a href="#Supplier.ReceiveVehicleArrival-662"><span class="linenos">662</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> picked up order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier.ReceiveVehicleArrival-663"><a href="#Supplier.ReceiveVehicleArrival-663"><span class="linenos">663</span></a>                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-664"><a href="#Supplier.ReceiveVehicleArrival-664"><span class="linenos">664</span></a>                    
</span><span id="Supplier.ReceiveVehicleArrival-665"><a href="#Supplier.ReceiveVehicleArrival-665"><span class="linenos">665</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-666"><a href="#Supplier.ReceiveVehicleArrival-666"><span class="linenos">666</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-667"><a href="#Supplier.ReceiveVehicleArrival-667"><span class="linenos">667</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival-668"><a href="#Supplier.ReceiveVehicleArrival-668"><span class="linenos">668</span></a>                    
</span><span id="Supplier.ReceiveVehicleArrival-669"><a href="#Supplier.ReceiveVehicleArrival-669"><span class="linenos">669</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival-670"><a href="#Supplier.ReceiveVehicleArrival-670"><span class="linenos">670</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; ERROR: Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> not found in pending orders!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cyclic behaviour that processes vehicle pickup notifications.</p>

<p>Handles vehicle-pickup messages when vehicles arrive to collect confirmed
orders from the supplier, removes order from pending_deliveries, and sends
pickup confirmation back to vehicle.</p>
</div>


                            <div id="Supplier.ReceiveVehicleArrival.add_metadata" class="classattr">
                                        <input id="Supplier.ReceiveVehicleArrival.add_metadata-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_metadata</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">r_msg</span><span class="p">:</span> <span class="n">spade</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n">veiculos</span><span class="o">.</span><span class="n">veiculos</span><span class="o">.</span><span class="n">Order</span></span><span class="return-annotation">) -> <span class="n">spade</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>:</span></span>

                <label class="view-source-button" for="Supplier.ReceiveVehicleArrival.add_metadata-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveVehicleArrival.add_metadata"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveVehicleArrival.add_metadata-633"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-633"><span class="linenos">633</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">,</span> <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-634"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-634"><span class="linenos">634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-635"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-635"><span class="linenos">635</span></a>            
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-636"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-636"><span class="linenos">636</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">r_msg</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-637"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-637"><span class="linenos">637</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;pickup-confirm&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-638"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-638"><span class="linenos">638</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;supplier_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">))</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-639"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-639"><span class="linenos">639</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;warehouse_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="p">))</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-640"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-640"><span class="linenos">640</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;node_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">node_id</span><span class="p">))</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-641"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-641"><span class="linenos">641</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;request_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">))</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-642"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-642"><span class="linenos">642</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.add_metadata-643"><a href="#Supplier.ReceiveVehicleArrival.add_metadata-643"><span class="linenos">643</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span></pre></div>


    

                            </div>
                            <div id="Supplier.ReceiveVehicleArrival.run" class="classattr">
                                        <input id="Supplier.ReceiveVehicleArrival.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.ReceiveVehicleArrival.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveVehicleArrival.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveVehicleArrival.run-645"><a href="#Supplier.ReceiveVehicleArrival.run-645"><span class="linenos">645</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-646"><a href="#Supplier.ReceiveVehicleArrival.run-646"><span class="linenos">646</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-647"><a href="#Supplier.ReceiveVehicleArrival.run-647"><span class="linenos">647</span></a>            
</span><span id="Supplier.ReceiveVehicleArrival.run-648"><a href="#Supplier.ReceiveVehicleArrival.run-648"><span class="linenos">648</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span>  <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-649"><a href="#Supplier.ReceiveVehicleArrival.run-649"><span class="linenos">649</span></a>            
</span><span id="Supplier.ReceiveVehicleArrival.run-650"><a href="#Supplier.ReceiveVehicleArrival.run-650"><span class="linenos">650</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-651"><a href="#Supplier.ReceiveVehicleArrival.run-651"><span class="linenos">651</span></a>                <span class="c1"># Parse message body</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-652"><a href="#Supplier.ReceiveVehicleArrival.run-652"><span class="linenos">652</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-653"><a href="#Supplier.ReceiveVehicleArrival.run-653"><span class="linenos">653</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-654"><a href="#Supplier.ReceiveVehicleArrival.run-654"><span class="linenos">654</span></a>                    <span class="n">order</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">dict_to_order</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-655"><a href="#Supplier.ReceiveVehicleArrival.run-655"><span class="linenos">655</span></a>                <span class="k">except</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-656"><a href="#Supplier.ReceiveVehicleArrival.run-656"><span class="linenos">656</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; ERROR: Failed to parse vehicle message: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-657"><a href="#Supplier.ReceiveVehicleArrival.run-657"><span class="linenos">657</span></a>                    <span class="k">return</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-658"><a href="#Supplier.ReceiveVehicleArrival.run-658"><span class="linenos">658</span></a>                
</span><span id="Supplier.ReceiveVehicleArrival.run-659"><a href="#Supplier.ReceiveVehicleArrival.run-659"><span class="linenos">659</span></a>                <span class="c1"># Vehicle is picking up an order to deliver to warehouse</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-660"><a href="#Supplier.ReceiveVehicleArrival.run-660"><span class="linenos">660</span></a>                <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-661"><a href="#Supplier.ReceiveVehicleArrival.run-661"><span class="linenos">661</span></a>                    <span class="k">del</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">]</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-662"><a href="#Supplier.ReceiveVehicleArrival.run-662"><span class="linenos">662</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2"> picked up order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-663"><a href="#Supplier.ReceiveVehicleArrival.run-663"><span class="linenos">663</span></a>                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-664"><a href="#Supplier.ReceiveVehicleArrival.run-664"><span class="linenos">664</span></a>                    
</span><span id="Supplier.ReceiveVehicleArrival.run-665"><a href="#Supplier.ReceiveVehicleArrival.run-665"><span class="linenos">665</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-666"><a href="#Supplier.ReceiveVehicleArrival.run-666"><span class="linenos">666</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_metadata</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-667"><a href="#Supplier.ReceiveVehicleArrival.run-667"><span class="linenos">667</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-668"><a href="#Supplier.ReceiveVehicleArrival.run-668"><span class="linenos">668</span></a>                    
</span><span id="Supplier.ReceiveVehicleArrival.run-669"><a href="#Supplier.ReceiveVehicleArrival.run-669"><span class="linenos">669</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleArrival.run-670"><a href="#Supplier.ReceiveVehicleArrival.run-670"><span class="linenos">670</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; ERROR: Order </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="si">}</span><span class="s2"> not found in pending orders!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
                <section id="Supplier.AssignVehicle">
                            <input id="Supplier.AssignVehicle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.AssignVehicle</span><wbr>(<span class="base">spade.behaviour.OneShotBehaviour</span>):

                <label class="view-source-button" for="Supplier.AssignVehicle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AssignVehicle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AssignVehicle-673"><a href="#Supplier.AssignVehicle-673"><span class="linenos">673</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">AssignVehicle</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier.AssignVehicle-674"><a href="#Supplier.AssignVehicle-674"><span class="linenos">674</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle-675"><a href="#Supplier.AssignVehicle-675"><span class="linenos">675</span></a><span class="sd">        Behaviour that coordinates vehicle assignment for delivery to warehouse.</span>
</span><span id="Supplier.AssignVehicle-676"><a href="#Supplier.AssignVehicle-676"><span class="linenos">676</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-677"><a href="#Supplier.AssignVehicle-677"><span class="linenos">677</span></a><span class="sd">        This behaviour implements a vehicle coordination protocol where the supplier</span>
</span><span id="Supplier.AssignVehicle-678"><a href="#Supplier.AssignVehicle-678"><span class="linenos">678</span></a><span class="sd">        requests delivery quotes from available vehicles to transport materials to</span>
</span><span id="Supplier.AssignVehicle-679"><a href="#Supplier.AssignVehicle-679"><span class="linenos">679</span></a><span class="sd">        a warehouse. This is similar to a mini FIPA Contract Net but simplified.</span>
</span><span id="Supplier.AssignVehicle-680"><a href="#Supplier.AssignVehicle-680"><span class="linenos">680</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-681"><a href="#Supplier.AssignVehicle-681"><span class="linenos">681</span></a><span class="sd">        Vehicle Selection Process:</span>
</span><span id="Supplier.AssignVehicle-682"><a href="#Supplier.AssignVehicle-682"><span class="linenos">682</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-683"><a href="#Supplier.AssignVehicle-683"><span class="linenos">683</span></a><span class="sd">            **Phase 1: Vehicle Discovery**</span>
</span><span id="Supplier.AssignVehicle-684"><a href="#Supplier.AssignVehicle-684"><span class="linenos">684</span></a><span class="sd">                - Populate vehicles list from presence contacts</span>
</span><span id="Supplier.AssignVehicle-685"><a href="#Supplier.AssignVehicle-685"><span class="linenos">685</span></a><span class="sd">                - Only vehicles subscribed to supplier are eligible</span>
</span><span id="Supplier.AssignVehicle-686"><a href="#Supplier.AssignVehicle-686"><span class="linenos">686</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-687"><a href="#Supplier.AssignVehicle-687"><span class="linenos">687</span></a><span class="sd">            **Phase 2: Presence Check**</span>
</span><span id="Supplier.AssignVehicle-688"><a href="#Supplier.AssignVehicle-688"><span class="linenos">688</span></a><span class="sd">                - Send presence-info request to each vehicle</span>
</span><span id="Supplier.AssignVehicle-689"><a href="#Supplier.AssignVehicle-689"><span class="linenos">689</span></a><span class="sd">                - Receive presence-response with availability status</span>
</span><span id="Supplier.AssignVehicle-690"><a href="#Supplier.AssignVehicle-690"><span class="linenos">690</span></a><span class="sd">                - Categorize: CHAT (available) vs AWAY (busy)</span>
</span><span id="Supplier.AssignVehicle-691"><a href="#Supplier.AssignVehicle-691"><span class="linenos">691</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-692"><a href="#Supplier.AssignVehicle-692"><span class="linenos">692</span></a><span class="sd">            **Phase 3: Proposal Requests**</span>
</span><span id="Supplier.AssignVehicle-693"><a href="#Supplier.AssignVehicle-693"><span class="linenos">693</span></a><span class="sd">                - Send order-proposal to available vehicles first</span>
</span><span id="Supplier.AssignVehicle-694"><a href="#Supplier.AssignVehicle-694"><span class="linenos">694</span></a><span class="sd">                - If no available vehicles, send to AWAY vehicles</span>
</span><span id="Supplier.AssignVehicle-695"><a href="#Supplier.AssignVehicle-695"><span class="linenos">695</span></a><span class="sd">                - Broadcast pickup/delivery details</span>
</span><span id="Supplier.AssignVehicle-696"><a href="#Supplier.AssignVehicle-696"><span class="linenos">696</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-697"><a href="#Supplier.AssignVehicle-697"><span class="linenos">697</span></a><span class="sd">            **Phase 4: Collect Proposals**</span>
</span><span id="Supplier.AssignVehicle-698"><a href="#Supplier.AssignVehicle-698"><span class="linenos">698</span></a><span class="sd">                - Launch ReceiveVehicleProposals to gather responses</span>
</span><span id="Supplier.AssignVehicle-699"><a href="#Supplier.AssignVehicle-699"><span class="linenos">699</span></a><span class="sd">                - Wait for vehicle-proposal messages with can_fit and delivery_time</span>
</span><span id="Supplier.AssignVehicle-700"><a href="#Supplier.AssignVehicle-700"><span class="linenos">700</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-701"><a href="#Supplier.AssignVehicle-701"><span class="linenos">701</span></a><span class="sd">            **Phase 5: Vehicle Selection**</span>
</span><span id="Supplier.AssignVehicle-702"><a href="#Supplier.AssignVehicle-702"><span class="linenos">702</span></a><span class="sd">                - Launch ChooseBestVehicle to evaluate proposals</span>
</span><span id="Supplier.AssignVehicle-703"><a href="#Supplier.AssignVehicle-703"><span class="linenos">703</span></a><span class="sd">                - Selection criteria: can_fit capacity, then delivery_time</span>
</span><span id="Supplier.AssignVehicle-704"><a href="#Supplier.AssignVehicle-704"><span class="linenos">704</span></a><span class="sd">                - Send order-confirmation to winner</span>
</span><span id="Supplier.AssignVehicle-705"><a href="#Supplier.AssignVehicle-705"><span class="linenos">705</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-706"><a href="#Supplier.AssignVehicle-706"><span class="linenos">706</span></a><span class="sd">        Attributes:</span>
</span><span id="Supplier.AssignVehicle-707"><a href="#Supplier.AssignVehicle-707"><span class="linenos">707</span></a><span class="sd">            request_id (int): Unique identifier for the order requiring delivery.</span>
</span><span id="Supplier.AssignVehicle-708"><a href="#Supplier.AssignVehicle-708"><span class="linenos">708</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-709"><a href="#Supplier.AssignVehicle-709"><span class="linenos">709</span></a><span class="sd">        Order Information Required:</span>
</span><span id="Supplier.AssignVehicle-710"><a href="#Supplier.AssignVehicle-710"><span class="linenos">710</span></a><span class="sd">            - pickup_node: Supplier&#39;s current graph node</span>
</span><span id="Supplier.AssignVehicle-711"><a href="#Supplier.AssignVehicle-711"><span class="linenos">711</span></a><span class="sd">            - delivery_node: Warehouse&#39;s graph node location</span>
</span><span id="Supplier.AssignVehicle-712"><a href="#Supplier.AssignVehicle-712"><span class="linenos">712</span></a><span class="sd">            - product: Product type to deliver</span>
</span><span id="Supplier.AssignVehicle-713"><a href="#Supplier.AssignVehicle-713"><span class="linenos">713</span></a><span class="sd">            - quantity: Amount to deliver</span>
</span><span id="Supplier.AssignVehicle-714"><a href="#Supplier.AssignVehicle-714"><span class="linenos">714</span></a><span class="sd">            - sender: Warehouse JID expecting delivery</span>
</span><span id="Supplier.AssignVehicle-715"><a href="#Supplier.AssignVehicle-715"><span class="linenos">715</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-716"><a href="#Supplier.AssignVehicle-716"><span class="linenos">716</span></a><span class="sd">        Message Format (order-proposal):</span>
</span><span id="Supplier.AssignVehicle-717"><a href="#Supplier.AssignVehicle-717"><span class="linenos">717</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier.AssignVehicle-718"><a href="#Supplier.AssignVehicle-718"><span class="linenos">718</span></a><span class="sd">                - performative: &quot;order-proposal&quot;</span>
</span><span id="Supplier.AssignVehicle-719"><a href="#Supplier.AssignVehicle-719"><span class="linenos">719</span></a><span class="sd">            Body (JSON):</span>
</span><span id="Supplier.AssignVehicle-720"><a href="#Supplier.AssignVehicle-720"><span class="linenos">720</span></a><span class="sd">                - orderid: Order identifier</span>
</span><span id="Supplier.AssignVehicle-721"><a href="#Supplier.AssignVehicle-721"><span class="linenos">721</span></a><span class="sd">                - product: Product type</span>
</span><span id="Supplier.AssignVehicle-722"><a href="#Supplier.AssignVehicle-722"><span class="linenos">722</span></a><span class="sd">                - quantity: Amount to deliver</span>
</span><span id="Supplier.AssignVehicle-723"><a href="#Supplier.AssignVehicle-723"><span class="linenos">723</span></a><span class="sd">                - sender: Warehouse JID (delivery destination)</span>
</span><span id="Supplier.AssignVehicle-724"><a href="#Supplier.AssignVehicle-724"><span class="linenos">724</span></a><span class="sd">                - receiver: Supplier JID (pickup location)</span>
</span><span id="Supplier.AssignVehicle-725"><a href="#Supplier.AssignVehicle-725"><span class="linenos">725</span></a><span class="sd">                - sender_location: Warehouse node</span>
</span><span id="Supplier.AssignVehicle-726"><a href="#Supplier.AssignVehicle-726"><span class="linenos">726</span></a><span class="sd">                - receiver_location: Supplier node</span>
</span><span id="Supplier.AssignVehicle-727"><a href="#Supplier.AssignVehicle-727"><span class="linenos">727</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-728"><a href="#Supplier.AssignVehicle-728"><span class="linenos">728</span></a><span class="sd">        Presence Status Handling:</span>
</span><span id="Supplier.AssignVehicle-729"><a href="#Supplier.AssignVehicle-729"><span class="linenos">729</span></a><span class="sd">            - **PresenceShow.CHAT**: Vehicle available, prioritize for proposals</span>
</span><span id="Supplier.AssignVehicle-730"><a href="#Supplier.AssignVehicle-730"><span class="linenos">730</span></a><span class="sd">            - **PresenceShow.AWAY**: Vehicle busy, use only if no available vehicles</span>
</span><span id="Supplier.AssignVehicle-731"><a href="#Supplier.AssignVehicle-731"><span class="linenos">731</span></a><span class="sd">            - Strategy: Try available first, fallback to busy if necessary</span>
</span><span id="Supplier.AssignVehicle-732"><a href="#Supplier.AssignVehicle-732"><span class="linenos">732</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-733"><a href="#Supplier.AssignVehicle-733"><span class="linenos">733</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier.AssignVehicle-734"><a href="#Supplier.AssignVehicle-734"><span class="linenos">734</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-735"><a href="#Supplier.AssignVehicle-735"><span class="linenos">735</span></a><span class="sd">            **Scenario: Normal Vehicle Assignment**</span>
</span><span id="Supplier.AssignVehicle-736"><a href="#Supplier.AssignVehicle-736"><span class="linenos">736</span></a><span class="sd">            ```</span>
</span><span id="Supplier.AssignVehicle-737"><a href="#Supplier.AssignVehicle-737"><span class="linenos">737</span></a><span class="sd">            Order ID: 301000000</span>
</span><span id="Supplier.AssignVehicle-738"><a href="#Supplier.AssignVehicle-738"><span class="linenos">738</span></a><span class="sd">            Pickup: Node 20 (Supplier location)</span>
</span><span id="Supplier.AssignVehicle-739"><a href="#Supplier.AssignVehicle-739"><span class="linenos">739</span></a><span class="sd">            Delivery: Node 10 (Warehouse location)</span>
</span><span id="Supplier.AssignVehicle-740"><a href="#Supplier.AssignVehicle-740"><span class="linenos">740</span></a><span class="sd">            Product: electronics</span>
</span><span id="Supplier.AssignVehicle-741"><a href="#Supplier.AssignVehicle-741"><span class="linenos">741</span></a><span class="sd">            Quantity: 100</span>
</span><span id="Supplier.AssignVehicle-742"><a href="#Supplier.AssignVehicle-742"><span class="linenos">742</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-743"><a href="#Supplier.AssignVehicle-743"><span class="linenos">743</span></a><span class="sd">            Step 1: Discover vehicles</span>
</span><span id="Supplier.AssignVehicle-744"><a href="#Supplier.AssignVehicle-744"><span class="linenos">744</span></a><span class="sd">                Found: [vehicle-1, vehicle-2, vehicle-3]</span>
</span><span id="Supplier.AssignVehicle-745"><a href="#Supplier.AssignVehicle-745"><span class="linenos">745</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-746"><a href="#Supplier.AssignVehicle-746"><span class="linenos">746</span></a><span class="sd">            Step 2: Check presence</span>
</span><span id="Supplier.AssignVehicle-747"><a href="#Supplier.AssignVehicle-747"><span class="linenos">747</span></a><span class="sd">                vehicle-1: CHAT (available)</span>
</span><span id="Supplier.AssignVehicle-748"><a href="#Supplier.AssignVehicle-748"><span class="linenos">748</span></a><span class="sd">                vehicle-2: AWAY (busy)</span>
</span><span id="Supplier.AssignVehicle-749"><a href="#Supplier.AssignVehicle-749"><span class="linenos">749</span></a><span class="sd">                vehicle-3: CHAT (available)</span>
</span><span id="Supplier.AssignVehicle-750"><a href="#Supplier.AssignVehicle-750"><span class="linenos">750</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-751"><a href="#Supplier.AssignVehicle-751"><span class="linenos">751</span></a><span class="sd">            Step 3: Send proposals</span>
</span><span id="Supplier.AssignVehicle-752"><a href="#Supplier.AssignVehicle-752"><span class="linenos">752</span></a><span class="sd">                Sent to: vehicle-1, vehicle-3 (2 available)</span>
</span><span id="Supplier.AssignVehicle-753"><a href="#Supplier.AssignVehicle-753"><span class="linenos">753</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-754"><a href="#Supplier.AssignVehicle-754"><span class="linenos">754</span></a><span class="sd">            Step 4: Collect proposals</span>
</span><span id="Supplier.AssignVehicle-755"><a href="#Supplier.AssignVehicle-755"><span class="linenos">755</span></a><span class="sd">                vehicle-1: can_fit=True, time=120s</span>
</span><span id="Supplier.AssignVehicle-756"><a href="#Supplier.AssignVehicle-756"><span class="linenos">756</span></a><span class="sd">                vehicle-3: can_fit=True, time=85s</span>
</span><span id="Supplier.AssignVehicle-757"><a href="#Supplier.AssignVehicle-757"><span class="linenos">757</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-758"><a href="#Supplier.AssignVehicle-758"><span class="linenos">758</span></a><span class="sd">            Step 5: Choose best</span>
</span><span id="Supplier.AssignVehicle-759"><a href="#Supplier.AssignVehicle-759"><span class="linenos">759</span></a><span class="sd">                Winner: vehicle-3 (lower delivery time)</span>
</span><span id="Supplier.AssignVehicle-760"><a href="#Supplier.AssignVehicle-760"><span class="linenos">760</span></a><span class="sd">                Send order-confirmation to vehicle-3</span>
</span><span id="Supplier.AssignVehicle-761"><a href="#Supplier.AssignVehicle-761"><span class="linenos">761</span></a><span class="sd">            ```</span>
</span><span id="Supplier.AssignVehicle-762"><a href="#Supplier.AssignVehicle-762"><span class="linenos">762</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-763"><a href="#Supplier.AssignVehicle-763"><span class="linenos">763</span></a><span class="sd">            **Scenario: No Available Vehicles**</span>
</span><span id="Supplier.AssignVehicle-764"><a href="#Supplier.AssignVehicle-764"><span class="linenos">764</span></a><span class="sd">            ```</span>
</span><span id="Supplier.AssignVehicle-765"><a href="#Supplier.AssignVehicle-765"><span class="linenos">765</span></a><span class="sd">            All vehicles: AWAY (busy)</span>
</span><span id="Supplier.AssignVehicle-766"><a href="#Supplier.AssignVehicle-766"><span class="linenos">766</span></a><span class="sd">            Action: Send proposals to all AWAY vehicles anyway</span>
</span><span id="Supplier.AssignVehicle-767"><a href="#Supplier.AssignVehicle-767"><span class="linenos">767</span></a><span class="sd">            Result: Best vehicle will accept when capacity available</span>
</span><span id="Supplier.AssignVehicle-768"><a href="#Supplier.AssignVehicle-768"><span class="linenos">768</span></a><span class="sd">            ```</span>
</span><span id="Supplier.AssignVehicle-769"><a href="#Supplier.AssignVehicle-769"><span class="linenos">769</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-770"><a href="#Supplier.AssignVehicle-770"><span class="linenos">770</span></a><span class="sd">        Error Handling:</span>
</span><span id="Supplier.AssignVehicle-771"><a href="#Supplier.AssignVehicle-771"><span class="linenos">771</span></a><span class="sd">            - If no vehicles found in contacts:</span>
</span><span id="Supplier.AssignVehicle-772"><a href="#Supplier.AssignVehicle-772"><span class="linenos">772</span></a><span class="sd">                - Print error message</span>
</span><span id="Supplier.AssignVehicle-773"><a href="#Supplier.AssignVehicle-773"><span class="linenos">773</span></a><span class="sd">                - Return without sending proposals</span>
</span><span id="Supplier.AssignVehicle-774"><a href="#Supplier.AssignVehicle-774"><span class="linenos">774</span></a><span class="sd">                - Order stays in pending_deliveries for retry</span>
</span><span id="Supplier.AssignVehicle-775"><a href="#Supplier.AssignVehicle-775"><span class="linenos">775</span></a><span class="sd">        </span>
</span><span id="Supplier.AssignVehicle-776"><a href="#Supplier.AssignVehicle-776"><span class="linenos">776</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.AssignVehicle-777"><a href="#Supplier.AssignVehicle-777"><span class="linenos">777</span></a><span class="sd">            This behaviour launches two child behaviours (ReceiveVehicleProposals</span>
</span><span id="Supplier.AssignVehicle-778"><a href="#Supplier.AssignVehicle-778"><span class="linenos">778</span></a><span class="sd">            and ChooseBestVehicle) that implement the proposal collection and</span>
</span><span id="Supplier.AssignVehicle-779"><a href="#Supplier.AssignVehicle-779"><span class="linenos">779</span></a><span class="sd">            selection logic.</span>
</span><span id="Supplier.AssignVehicle-780"><a href="#Supplier.AssignVehicle-780"><span class="linenos">780</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle-781"><a href="#Supplier.AssignVehicle-781"><span class="linenos">781</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">):</span>
</span><span id="Supplier.AssignVehicle-782"><a href="#Supplier.AssignVehicle-782"><span class="linenos">782</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle-783"><a href="#Supplier.AssignVehicle-783"><span class="linenos">783</span></a><span class="sd">            Initialize the AssignVehicle behaviour.</span>
</span><span id="Supplier.AssignVehicle-784"><a href="#Supplier.AssignVehicle-784"><span class="linenos">784</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle-785"><a href="#Supplier.AssignVehicle-785"><span class="linenos">785</span></a><span class="sd">            Args:</span>
</span><span id="Supplier.AssignVehicle-786"><a href="#Supplier.AssignVehicle-786"><span class="linenos">786</span></a><span class="sd">                request_id (int): Unique identifier for the order requiring vehicle assignment.</span>
</span><span id="Supplier.AssignVehicle-787"><a href="#Supplier.AssignVehicle-787"><span class="linenos">787</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle-788"><a href="#Supplier.AssignVehicle-788"><span class="linenos">788</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle-789"><a href="#Supplier.AssignVehicle-789"><span class="linenos">789</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="Supplier.AssignVehicle-790"><a href="#Supplier.AssignVehicle-790"><span class="linenos">790</span></a>        
</span><span id="Supplier.AssignVehicle-791"><a href="#Supplier.AssignVehicle-791"><span class="linenos">791</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">populate_vehicles_from_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.AssignVehicle-792"><a href="#Supplier.AssignVehicle-792"><span class="linenos">792</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Populate vehicles list from presence contacts if empty&quot;&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle-793"><a href="#Supplier.AssignVehicle-793"><span class="linenos">793</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.AssignVehicle-794"><a href="#Supplier.AssignVehicle-794"><span class="linenos">794</span></a>            
</span><span id="Supplier.AssignVehicle-795"><a href="#Supplier.AssignVehicle-795"><span class="linenos">795</span></a>            <span class="c1"># Get all vehicles from presence contacts</span>
</span><span id="Supplier.AssignVehicle-796"><a href="#Supplier.AssignVehicle-796"><span class="linenos">796</span></a>            <span class="n">vehicles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;vehicle&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)]</span>
</span><span id="Supplier.AssignVehicle-797"><a href="#Supplier.AssignVehicle-797"><span class="linenos">797</span></a>            
</span><span id="Supplier.AssignVehicle-798"><a href="#Supplier.AssignVehicle-798"><span class="linenos">798</span></a>            <span class="k">if</span> <span class="n">vehicles</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-799"><a href="#Supplier.AssignVehicle-799"><span class="linenos">799</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span> <span class="o">=</span> <span class="n">vehicles</span>
</span><span id="Supplier.AssignVehicle-800"><a href="#Supplier.AssignVehicle-800"><span class="linenos">800</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-801"><a href="#Supplier.AssignVehicle-801"><span class="linenos">801</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Discovered </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> vehicle(s) from presence: </span><span class="si">{</span><span class="n">vehicles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-802"><a href="#Supplier.AssignVehicle-802"><span class="linenos">802</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-803"><a href="#Supplier.AssignVehicle-803"><span class="linenos">803</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-804"><a href="#Supplier.AssignVehicle-804"><span class="linenos">804</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No vehicles found in presence contacts yet!&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-805"><a href="#Supplier.AssignVehicle-805"><span class="linenos">805</span></a>            
</span><span id="Supplier.AssignVehicle-806"><a href="#Supplier.AssignVehicle-806"><span class="linenos">806</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">vehicles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Supplier.AssignVehicle-807"><a href="#Supplier.AssignVehicle-807"><span class="linenos">807</span></a>        
</span><span id="Supplier.AssignVehicle-808"><a href="#Supplier.AssignVehicle-808"><span class="linenos">808</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_presence_info_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-809"><a href="#Supplier.AssignVehicle-809"><span class="linenos">809</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier.AssignVehicle-810"><a href="#Supplier.AssignVehicle-810"><span class="linenos">810</span></a>            
</span><span id="Supplier.AssignVehicle-811"><a href="#Supplier.AssignVehicle-811"><span class="linenos">811</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-812"><a href="#Supplier.AssignVehicle-812"><span class="linenos">812</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;presence-info&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-813"><a href="#Supplier.AssignVehicle-813"><span class="linenos">813</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle-814"><a href="#Supplier.AssignVehicle-814"><span class="linenos">814</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="Supplier.AssignVehicle-815"><a href="#Supplier.AssignVehicle-815"><span class="linenos">815</span></a>            
</span><span id="Supplier.AssignVehicle-816"><a href="#Supplier.AssignVehicle-816"><span class="linenos">816</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_call_for_proposal_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-817"><a href="#Supplier.AssignVehicle-817"><span class="linenos">817</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier.AssignVehicle-818"><a href="#Supplier.AssignVehicle-818"><span class="linenos">818</span></a>            
</span><span id="Supplier.AssignVehicle-819"><a href="#Supplier.AssignVehicle-819"><span class="linenos">819</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-820"><a href="#Supplier.AssignVehicle-820"><span class="linenos">820</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-proposal&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-821"><a href="#Supplier.AssignVehicle-821"><span class="linenos">821</span></a>            
</span><span id="Supplier.AssignVehicle-822"><a href="#Supplier.AssignVehicle-822"><span class="linenos">822</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">]</span>
</span><span id="Supplier.AssignVehicle-823"><a href="#Supplier.AssignVehicle-823"><span class="linenos">823</span></a>
</span><span id="Supplier.AssignVehicle-824"><a href="#Supplier.AssignVehicle-824"><span class="linenos">824</span></a>            <span class="n">new_body</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier.AssignVehicle-825"><a href="#Supplier.AssignVehicle-825"><span class="linenos">825</span></a>                <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle-826"><a href="#Supplier.AssignVehicle-826"><span class="linenos">826</span></a>                <span class="s2">&quot;product&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle-827"><a href="#Supplier.AssignVehicle-827"><span class="linenos">827</span></a>                <span class="s2">&quot;quantity&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle-828"><a href="#Supplier.AssignVehicle-828"><span class="linenos">828</span></a>                <span class="s2">&quot;sender&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">receiver</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle-829"><a href="#Supplier.AssignVehicle-829"><span class="linenos">829</span></a>                <span class="s2">&quot;receiver&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle-830"><a href="#Supplier.AssignVehicle-830"><span class="linenos">830</span></a>                <span class="s2">&quot;sender_location&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle-831"><a href="#Supplier.AssignVehicle-831"><span class="linenos">831</span></a>                <span class="s2">&quot;receiver_location&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span>
</span><span id="Supplier.AssignVehicle-832"><a href="#Supplier.AssignVehicle-832"><span class="linenos">832</span></a>            <span class="p">}</span>
</span><span id="Supplier.AssignVehicle-833"><a href="#Supplier.AssignVehicle-833"><span class="linenos">833</span></a>            
</span><span id="Supplier.AssignVehicle-834"><a href="#Supplier.AssignVehicle-834"><span class="linenos">834</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_body</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-835"><a href="#Supplier.AssignVehicle-835"><span class="linenos">835</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span><span id="Supplier.AssignVehicle-836"><a href="#Supplier.AssignVehicle-836"><span class="linenos">836</span></a>        
</span><span id="Supplier.AssignVehicle-837"><a href="#Supplier.AssignVehicle-837"><span class="linenos">837</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.AssignVehicle-838"><a href="#Supplier.AssignVehicle-838"><span class="linenos">838</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.AssignVehicle-839"><a href="#Supplier.AssignVehicle-839"><span class="linenos">839</span></a>            
</span><span id="Supplier.AssignVehicle-840"><a href="#Supplier.AssignVehicle-840"><span class="linenos">840</span></a>            <span class="c1"># Populate vehicles from contacts</span>
</span><span id="Supplier.AssignVehicle-841"><a href="#Supplier.AssignVehicle-841"><span class="linenos">841</span></a>            <span class="n">has_vehicles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_vehicles_from_contacts</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle-842"><a href="#Supplier.AssignVehicle-842"><span class="linenos">842</span></a>            
</span><span id="Supplier.AssignVehicle-843"><a href="#Supplier.AssignVehicle-843"><span class="linenos">843</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_vehicles</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-844"><a href="#Supplier.AssignVehicle-844"><span class="linenos">844</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  ERROR: No vehicles found in contacts!&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-845"><a href="#Supplier.AssignVehicle-845"><span class="linenos">845</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Make sure vehicles are started and have subscribed to this supplier.&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-846"><a href="#Supplier.AssignVehicle-846"><span class="linenos">846</span></a>                <span class="k">return</span>
</span><span id="Supplier.AssignVehicle-847"><a href="#Supplier.AssignVehicle-847"><span class="linenos">847</span></a>            
</span><span id="Supplier.AssignVehicle-848"><a href="#Supplier.AssignVehicle-848"><span class="linenos">848</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-849"><a href="#Supplier.AssignVehicle-849"><span class="linenos">849</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Requesting vehicle proposals...&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-850"><a href="#Supplier.AssignVehicle-850"><span class="linenos">850</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicles to contact: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-851"><a href="#Supplier.AssignVehicle-851"><span class="linenos">851</span></a>            
</span><span id="Supplier.AssignVehicle-852"><a href="#Supplier.AssignVehicle-852"><span class="linenos">852</span></a>            <span class="c1"># Enviar mensagens de proposal a todos os veculos</span>
</span><span id="Supplier.AssignVehicle-853"><a href="#Supplier.AssignVehicle-853"><span class="linenos">853</span></a>            <span class="c1"># No verificamos presena - deixamos cada veculo decidir se pode aceitar</span>
</span><span id="Supplier.AssignVehicle-854"><a href="#Supplier.AssignVehicle-854"><span class="linenos">854</span></a>            <span class="n">n_available_vehicles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Supplier.AssignVehicle-855"><a href="#Supplier.AssignVehicle-855"><span class="linenos">855</span></a>            <span class="n">away_vehicles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Supplier.AssignVehicle-856"><a href="#Supplier.AssignVehicle-856"><span class="linenos">856</span></a>            <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-857"><a href="#Supplier.AssignVehicle-857"><span class="linenos">857</span></a>                
</span><span id="Supplier.AssignVehicle-858"><a href="#Supplier.AssignVehicle-858"><span class="linenos">858</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_presence_info_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-859"><a href="#Supplier.AssignVehicle-859"><span class="linenos">859</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-860"><a href="#Supplier.AssignVehicle-860"><span class="linenos">860</span></a>                
</span><span id="Supplier.AssignVehicle-861"><a href="#Supplier.AssignVehicle-861"><span class="linenos">861</span></a>                <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">ReceivePresenceInfo</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle-862"><a href="#Supplier.AssignVehicle-862"><span class="linenos">862</span></a>                <span class="n">temp</span> <span class="p">:</span> <span class="n">Template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle-863"><a href="#Supplier.AssignVehicle-863"><span class="linenos">863</span></a>                <span class="n">temp</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;presence-response&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-864"><a href="#Supplier.AssignVehicle-864"><span class="linenos">864</span></a>                <span class="n">temp</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;vehicle_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">))</span>
</span><span id="Supplier.AssignVehicle-865"><a href="#Supplier.AssignVehicle-865"><span class="linenos">865</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-866"><a href="#Supplier.AssignVehicle-866"><span class="linenos">866</span></a>                
</span><span id="Supplier.AssignVehicle-867"><a href="#Supplier.AssignVehicle-867"><span class="linenos">867</span></a>                <span class="k">await</span> <span class="n">behav</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle-868"><a href="#Supplier.AssignVehicle-868"><span class="linenos">868</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-869"><a href="#Supplier.AssignVehicle-869"><span class="linenos">869</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Presence info from </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-870"><a href="#Supplier.AssignVehicle-870"><span class="linenos">870</span></a>                
</span><span id="Supplier.AssignVehicle-871"><a href="#Supplier.AssignVehicle-871"><span class="linenos">871</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">vehicle_jid</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PresenceShow.CHAT&quot;</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-872"><a href="#Supplier.AssignVehicle-872"><span class="linenos">872</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_call_for_proposal_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-873"><a href="#Supplier.AssignVehicle-873"><span class="linenos">873</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-874"><a href="#Supplier.AssignVehicle-874"><span class="linenos">874</span></a>                    <span class="n">n_available_vehicles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Supplier.AssignVehicle-875"><a href="#Supplier.AssignVehicle-875"><span class="linenos">875</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent order proposal to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-876"><a href="#Supplier.AssignVehicle-876"><span class="linenos">876</span></a>                
</span><span id="Supplier.AssignVehicle-877"><a href="#Supplier.AssignVehicle-877"><span class="linenos">877</span></a>                <span class="k">elif</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">vehicle_jid</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PresenceShow.AWAY&quot;</span> <span class="ow">and</span> <span class="n">n_available_vehicles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-878"><a href="#Supplier.AssignVehicle-878"><span class="linenos">878</span></a>                    <span class="n">away_vehicles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-879"><a href="#Supplier.AssignVehicle-879"><span class="linenos">879</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-880"><a href="#Supplier.AssignVehicle-880"><span class="linenos">880</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Vehicle </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2"> is away.&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-881"><a href="#Supplier.AssignVehicle-881"><span class="linenos">881</span></a>                    
</span><span id="Supplier.AssignVehicle-882"><a href="#Supplier.AssignVehicle-882"><span class="linenos">882</span></a>            <span class="k">if</span> <span class="n">n_available_vehicles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-883"><a href="#Supplier.AssignVehicle-883"><span class="linenos">883</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-884"><a href="#Supplier.AssignVehicle-884"><span class="linenos">884</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No AVAILABLE vehicles found. All vehicles are AWAY.&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-885"><a href="#Supplier.AssignVehicle-885"><span class="linenos">885</span></a>                <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">away_vehicles</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-886"><a href="#Supplier.AssignVehicle-886"><span class="linenos">886</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_call_for_proposal_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-887"><a href="#Supplier.AssignVehicle-887"><span class="linenos">887</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-888"><a href="#Supplier.AssignVehicle-888"><span class="linenos">888</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent order proposal to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-889"><a href="#Supplier.AssignVehicle-889"><span class="linenos">889</span></a>            
</span><span id="Supplier.AssignVehicle-890"><a href="#Supplier.AssignVehicle-890"><span class="linenos">890</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle-891"><a href="#Supplier.AssignVehicle-891"><span class="linenos">891</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent proposals to </span><span class="si">{</span><span class="n">n_available_vehicles</span><span class="si">}</span><span class="s2"> vehicle(s)&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-892"><a href="#Supplier.AssignVehicle-892"><span class="linenos">892</span></a>                    
</span><span id="Supplier.AssignVehicle-893"><a href="#Supplier.AssignVehicle-893"><span class="linenos">893</span></a>            <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">ChooseBestVehicle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-894"><a href="#Supplier.AssignVehicle-894"><span class="linenos">894</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle-895"><a href="#Supplier.AssignVehicle-895"><span class="linenos">895</span></a>            
</span><span id="Supplier.AssignVehicle-896"><a href="#Supplier.AssignVehicle-896"><span class="linenos">896</span></a>            <span class="c1"># Waits for all vehicle proposals to be received</span>
</span><span id="Supplier.AssignVehicle-897"><a href="#Supplier.AssignVehicle-897"><span class="linenos">897</span></a>            <span class="k">await</span> <span class="n">behav</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Behaviour that coordinates vehicle assignment for delivery to warehouse.</p>

<p>This behaviour implements a vehicle coordination protocol where the supplier
requests delivery quotes from available vehicles to transport materials to
a warehouse. This is similar to a mini FIPA Contract Net but simplified.</p>

<h6 id="vehicle-selection-process">Vehicle Selection Process:</h6>

<blockquote>
  <p><strong>Phase 1: Vehicle Discovery</strong>
      - Populate vehicles list from presence contacts
      - Only vehicles subscribed to supplier are eligible</p>
  
  <p><strong>Phase 2: Presence Check</strong>
      - Send presence-info request to each vehicle
      - Receive presence-response with availability status
      - Categorize: CHAT (available) vs AWAY (busy)</p>
  
  <p><strong>Phase 3: Proposal Requests</strong>
      - Send order-proposal to available vehicles first
      - If no available vehicles, send to AWAY vehicles
      - Broadcast pickup/delivery details</p>
  
  <p><strong>Phase 4: Collect Proposals</strong>
      - Launch ReceiveVehicleProposals to gather responses
      - Wait for vehicle-proposal messages with can_fit and delivery_time</p>
  
  <p><strong>Phase 5: Vehicle Selection</strong>
      - Launch ChooseBestVehicle to evaluate proposals
      - Selection criteria: can_fit capacity, then delivery_time
      - Send order-confirmation to winner</p>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>request_id (int):</strong>  Unique identifier for the order requiring delivery.</li>
</ul>

<h6 id="order-information-required">Order Information Required:</h6>

<blockquote>
  <ul>
  <li>pickup_node: Supplier's current graph node</li>
  <li>delivery_node: Warehouse's graph node location</li>
  <li>product: Product type to deliver</li>
  <li>quantity: Amount to deliver</li>
  <li>sender: Warehouse JID expecting delivery</li>
  </ul>
</blockquote>

<p>Message Format (order-proposal):
    Metadata:
        - performative: "order-proposal"
    Body (JSON):
        - orderid: Order identifier
        - product: Product type
        - quantity: Amount to deliver
        - sender: Warehouse JID (delivery destination)
        - receiver: Supplier JID (pickup location)
        - sender_location: Warehouse node
        - receiver_location: Supplier node</p>

<h6 id="presence-status-handling">Presence Status Handling:</h6>

<blockquote>
  <ul>
  <li><strong>PresenceShow.CHAT</strong>: Vehicle available, prioritize for proposals</li>
  <li><strong>PresenceShow.AWAY</strong>: Vehicle busy, use only if no available vehicles</li>
  <li>Strategy: Try available first, fallback to busy if necessary</li>
  </ul>
</blockquote>

<h6 id="example-execution">Example Execution:</h6>

<blockquote>
  <p><strong>Scenario: Normal Vehicle Assignment</strong></p>

<pre><code>Order ID: 301000000
Pickup: Node 20 (Supplier location)
Delivery: Node 10 (Warehouse location)
Product: electronics
Quantity: 100

Step 1: Discover vehicles
    Found: [vehicle-1, vehicle-2, vehicle-3]

Step 2: Check presence
    vehicle-1: CHAT (available)
    vehicle-2: AWAY (busy)
    vehicle-3: CHAT (available)

Step 3: Send proposals
    Sent to: vehicle-1, vehicle-3 (2 available)

Step 4: Collect proposals
    vehicle-1: can_fit=True, time=120s
    vehicle-3: can_fit=True, time=85s

Step 5: Choose best
    Winner: vehicle-3 (lower delivery time)
    Send order-confirmation to vehicle-3
</code></pre>
  
  <p><strong>Scenario: No Available Vehicles</strong></p>

<pre><code>All vehicles: AWAY (busy)
Action: Send proposals to all AWAY vehicles anyway
Result: Best vehicle will accept when capacity available
</code></pre>
</blockquote>

<h6 id="error-handling">Error Handling:</h6>

<blockquote>
  <ul>
  <li>If no vehicles found in contacts:
  <ul>
  <li>Print error message</li>
  <li>Return without sending proposals</li>
  <li>Order stays in pending_deliveries for retry</li>
  </ul></li>
  </ul>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>This behaviour launches two child behaviours (ReceiveVehicleProposals
  and ChooseBestVehicle) that implement the proposal collection and
  selection logic.</p>
</blockquote>
</div>


                            <div id="Supplier.AssignVehicle.__init__" class="classattr">
                                        <input id="Supplier.AssignVehicle.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Supplier.AssignVehicle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">request_id</span></span>)</span>

                <label class="view-source-button" for="Supplier.AssignVehicle.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AssignVehicle.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AssignVehicle.__init__-781"><a href="#Supplier.AssignVehicle.__init__-781"><span class="linenos">781</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">):</span>
</span><span id="Supplier.AssignVehicle.__init__-782"><a href="#Supplier.AssignVehicle.__init__-782"><span class="linenos">782</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle.__init__-783"><a href="#Supplier.AssignVehicle.__init__-783"><span class="linenos">783</span></a><span class="sd">            Initialize the AssignVehicle behaviour.</span>
</span><span id="Supplier.AssignVehicle.__init__-784"><a href="#Supplier.AssignVehicle.__init__-784"><span class="linenos">784</span></a><span class="sd">            </span>
</span><span id="Supplier.AssignVehicle.__init__-785"><a href="#Supplier.AssignVehicle.__init__-785"><span class="linenos">785</span></a><span class="sd">            Args:</span>
</span><span id="Supplier.AssignVehicle.__init__-786"><a href="#Supplier.AssignVehicle.__init__-786"><span class="linenos">786</span></a><span class="sd">                request_id (int): Unique identifier for the order requiring vehicle assignment.</span>
</span><span id="Supplier.AssignVehicle.__init__-787"><a href="#Supplier.AssignVehicle.__init__-787"><span class="linenos">787</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle.__init__-788"><a href="#Supplier.AssignVehicle.__init__-788"><span class="linenos">788</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle.__init__-789"><a href="#Supplier.AssignVehicle.__init__-789"><span class="linenos">789</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the AssignVehicle behaviour.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>request_id (int):</strong>  Unique identifier for the order requiring vehicle assignment.</li>
</ul>
</div>


                            </div>
                            <div id="Supplier.AssignVehicle.request_id" class="classattr">
                                <div class="attr variable">
            <span class="name">request_id</span>

        
    </div>
    <a class="headerlink" href="#Supplier.AssignVehicle.request_id"></a>
    
    

                            </div>
                            <div id="Supplier.AssignVehicle.populate_vehicles_from_contacts" class="classattr">
                                        <input id="Supplier.AssignVehicle.populate_vehicles_from_contacts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">populate_vehicles_from_contacts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.AssignVehicle.populate_vehicles_from_contacts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AssignVehicle.populate_vehicles_from_contacts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-791"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-791"><span class="linenos">791</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">populate_vehicles_from_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-792"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-792"><span class="linenos">792</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Populate vehicles list from presence contacts if empty&quot;&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-793"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-793"><span class="linenos">793</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-794"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-794"><span class="linenos">794</span></a>            
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-795"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-795"><span class="linenos">795</span></a>            <span class="c1"># Get all vehicles from presence contacts</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-796"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-796"><span class="linenos">796</span></a>            <span class="n">vehicles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s2">&quot;vehicle&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">jid</span><span class="p">)]</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-797"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-797"><span class="linenos">797</span></a>            
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-798"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-798"><span class="linenos">798</span></a>            <span class="k">if</span> <span class="n">vehicles</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-799"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-799"><span class="linenos">799</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span> <span class="o">=</span> <span class="n">vehicles</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-800"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-800"><span class="linenos">800</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-801"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-801"><span class="linenos">801</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Discovered </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> vehicle(s) from presence: </span><span class="si">{</span><span class="n">vehicles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-802"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-802"><span class="linenos">802</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-803"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-803"><span class="linenos">803</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-804"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-804"><span class="linenos">804</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No vehicles found in presence contacts yet!&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-805"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-805"><span class="linenos">805</span></a>            
</span><span id="Supplier.AssignVehicle.populate_vehicles_from_contacts-806"><a href="#Supplier.AssignVehicle.populate_vehicles_from_contacts-806"><span class="linenos">806</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">vehicles</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Populate vehicles list from presence contacts if empty</p>
</div>


                            </div>
                            <div id="Supplier.AssignVehicle.create_presence_info_message" class="classattr">
                                        <input id="Supplier.AssignVehicle.create_presence_info_message-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_presence_info_message</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">to</span></span><span class="return-annotation">) -> <span class="n">spade</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>:</span></span>

                <label class="view-source-button" for="Supplier.AssignVehicle.create_presence_info_message-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AssignVehicle.create_presence_info_message"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AssignVehicle.create_presence_info_message-808"><a href="#Supplier.AssignVehicle.create_presence_info_message-808"><span class="linenos">808</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_presence_info_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.create_presence_info_message-809"><a href="#Supplier.AssignVehicle.create_presence_info_message-809"><span class="linenos">809</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier.AssignVehicle.create_presence_info_message-810"><a href="#Supplier.AssignVehicle.create_presence_info_message-810"><span class="linenos">810</span></a>            
</span><span id="Supplier.AssignVehicle.create_presence_info_message-811"><a href="#Supplier.AssignVehicle.create_presence_info_message-811"><span class="linenos">811</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.create_presence_info_message-812"><a href="#Supplier.AssignVehicle.create_presence_info_message-812"><span class="linenos">812</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;presence-info&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.create_presence_info_message-813"><a href="#Supplier.AssignVehicle.create_presence_info_message-813"><span class="linenos">813</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Supplier.AssignVehicle.create_presence_info_message-814"><a href="#Supplier.AssignVehicle.create_presence_info_message-814"><span class="linenos">814</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span></pre></div>


    

                            </div>
                            <div id="Supplier.AssignVehicle.create_call_for_proposal_message" class="classattr">
                                        <input id="Supplier.AssignVehicle.create_call_for_proposal_message-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_call_for_proposal_message</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">to</span></span><span class="return-annotation">) -> <span class="n">spade</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span>:</span></span>

                <label class="view-source-button" for="Supplier.AssignVehicle.create_call_for_proposal_message-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AssignVehicle.create_call_for_proposal_message"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-816"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-816"><span class="linenos">816</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_call_for_proposal_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-817"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-817"><span class="linenos">817</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-818"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-818"><span class="linenos">818</span></a>            
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-819"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-819"><span class="linenos">819</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">to</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-820"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-820"><span class="linenos">820</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-proposal&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-821"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-821"><span class="linenos">821</span></a>            
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-822"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-822"><span class="linenos">822</span></a>            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">]</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-823"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-823"><span class="linenos">823</span></a>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-824"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-824"><span class="linenos">824</span></a>            <span class="n">new_body</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-825"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-825"><span class="linenos">825</span></a>                <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-826"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-826"><span class="linenos">826</span></a>                <span class="s2">&quot;product&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">product</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-827"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-827"><span class="linenos">827</span></a>                <span class="s2">&quot;quantity&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-828"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-828"><span class="linenos">828</span></a>                <span class="s2">&quot;sender&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">receiver</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-829"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-829"><span class="linenos">829</span></a>                <span class="s2">&quot;receiver&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-830"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-830"><span class="linenos">830</span></a>                <span class="s2">&quot;sender_location&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">receiver_location</span><span class="p">,</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-831"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-831"><span class="linenos">831</span></a>                <span class="s2">&quot;receiver_location&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">sender_location</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-832"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-832"><span class="linenos">832</span></a>            <span class="p">}</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-833"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-833"><span class="linenos">833</span></a>            
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-834"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-834"><span class="linenos">834</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">new_body</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.create_call_for_proposal_message-835"><a href="#Supplier.AssignVehicle.create_call_for_proposal_message-835"><span class="linenos">835</span></a>            <span class="k">return</span> <span class="n">msg</span>
</span></pre></div>


    

                            </div>
                            <div id="Supplier.AssignVehicle.run" class="classattr">
                                        <input id="Supplier.AssignVehicle.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.AssignVehicle.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.AssignVehicle.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.AssignVehicle.run-837"><a href="#Supplier.AssignVehicle.run-837"><span class="linenos">837</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.AssignVehicle.run-838"><a href="#Supplier.AssignVehicle.run-838"><span class="linenos">838</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.AssignVehicle.run-839"><a href="#Supplier.AssignVehicle.run-839"><span class="linenos">839</span></a>            
</span><span id="Supplier.AssignVehicle.run-840"><a href="#Supplier.AssignVehicle.run-840"><span class="linenos">840</span></a>            <span class="c1"># Populate vehicles from contacts</span>
</span><span id="Supplier.AssignVehicle.run-841"><a href="#Supplier.AssignVehicle.run-841"><span class="linenos">841</span></a>            <span class="n">has_vehicles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_vehicles_from_contacts</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle.run-842"><a href="#Supplier.AssignVehicle.run-842"><span class="linenos">842</span></a>            
</span><span id="Supplier.AssignVehicle.run-843"><a href="#Supplier.AssignVehicle.run-843"><span class="linenos">843</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">has_vehicles</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-844"><a href="#Supplier.AssignVehicle.run-844"><span class="linenos">844</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  ERROR: No vehicles found in contacts!&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-845"><a href="#Supplier.AssignVehicle.run-845"><span class="linenos">845</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Make sure vehicles are started and have subscribed to this supplier.&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-846"><a href="#Supplier.AssignVehicle.run-846"><span class="linenos">846</span></a>                <span class="k">return</span>
</span><span id="Supplier.AssignVehicle.run-847"><a href="#Supplier.AssignVehicle.run-847"><span class="linenos">847</span></a>            
</span><span id="Supplier.AssignVehicle.run-848"><a href="#Supplier.AssignVehicle.run-848"><span class="linenos">848</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-849"><a href="#Supplier.AssignVehicle.run-849"><span class="linenos">849</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Requesting vehicle proposals...&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-850"><a href="#Supplier.AssignVehicle.run-850"><span class="linenos">850</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicles to contact: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-851"><a href="#Supplier.AssignVehicle.run-851"><span class="linenos">851</span></a>            
</span><span id="Supplier.AssignVehicle.run-852"><a href="#Supplier.AssignVehicle.run-852"><span class="linenos">852</span></a>            <span class="c1"># Enviar mensagens de proposal a todos os veculos</span>
</span><span id="Supplier.AssignVehicle.run-853"><a href="#Supplier.AssignVehicle.run-853"><span class="linenos">853</span></a>            <span class="c1"># No verificamos presena - deixamos cada veculo decidir se pode aceitar</span>
</span><span id="Supplier.AssignVehicle.run-854"><a href="#Supplier.AssignVehicle.run-854"><span class="linenos">854</span></a>            <span class="n">n_available_vehicles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Supplier.AssignVehicle.run-855"><a href="#Supplier.AssignVehicle.run-855"><span class="linenos">855</span></a>            <span class="n">away_vehicles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Supplier.AssignVehicle.run-856"><a href="#Supplier.AssignVehicle.run-856"><span class="linenos">856</span></a>            <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicles</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-857"><a href="#Supplier.AssignVehicle.run-857"><span class="linenos">857</span></a>                
</span><span id="Supplier.AssignVehicle.run-858"><a href="#Supplier.AssignVehicle.run-858"><span class="linenos">858</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_presence_info_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-859"><a href="#Supplier.AssignVehicle.run-859"><span class="linenos">859</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-860"><a href="#Supplier.AssignVehicle.run-860"><span class="linenos">860</span></a>                
</span><span id="Supplier.AssignVehicle.run-861"><a href="#Supplier.AssignVehicle.run-861"><span class="linenos">861</span></a>                <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">ReceivePresenceInfo</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle.run-862"><a href="#Supplier.AssignVehicle.run-862"><span class="linenos">862</span></a>                <span class="n">temp</span> <span class="p">:</span> <span class="n">Template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle.run-863"><a href="#Supplier.AssignVehicle.run-863"><span class="linenos">863</span></a>                <span class="n">temp</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;presence-response&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-864"><a href="#Supplier.AssignVehicle.run-864"><span class="linenos">864</span></a>                <span class="n">temp</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;vehicle_id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">))</span>
</span><span id="Supplier.AssignVehicle.run-865"><a href="#Supplier.AssignVehicle.run-865"><span class="linenos">865</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-866"><a href="#Supplier.AssignVehicle.run-866"><span class="linenos">866</span></a>                
</span><span id="Supplier.AssignVehicle.run-867"><a href="#Supplier.AssignVehicle.run-867"><span class="linenos">867</span></a>                <span class="k">await</span> <span class="n">behav</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="Supplier.AssignVehicle.run-868"><a href="#Supplier.AssignVehicle.run-868"><span class="linenos">868</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-869"><a href="#Supplier.AssignVehicle.run-869"><span class="linenos">869</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Presence info from </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-870"><a href="#Supplier.AssignVehicle.run-870"><span class="linenos">870</span></a>                
</span><span id="Supplier.AssignVehicle.run-871"><a href="#Supplier.AssignVehicle.run-871"><span class="linenos">871</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">vehicle_jid</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PresenceShow.CHAT&quot;</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-872"><a href="#Supplier.AssignVehicle.run-872"><span class="linenos">872</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_call_for_proposal_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-873"><a href="#Supplier.AssignVehicle.run-873"><span class="linenos">873</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-874"><a href="#Supplier.AssignVehicle.run-874"><span class="linenos">874</span></a>                    <span class="n">n_available_vehicles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Supplier.AssignVehicle.run-875"><a href="#Supplier.AssignVehicle.run-875"><span class="linenos">875</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent order proposal to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-876"><a href="#Supplier.AssignVehicle.run-876"><span class="linenos">876</span></a>                
</span><span id="Supplier.AssignVehicle.run-877"><a href="#Supplier.AssignVehicle.run-877"><span class="linenos">877</span></a>                <span class="k">elif</span> <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">vehicle_jid</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PresenceShow.AWAY&quot;</span> <span class="ow">and</span> <span class="n">n_available_vehicles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-878"><a href="#Supplier.AssignVehicle.run-878"><span class="linenos">878</span></a>                    <span class="n">away_vehicles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-879"><a href="#Supplier.AssignVehicle.run-879"><span class="linenos">879</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-880"><a href="#Supplier.AssignVehicle.run-880"><span class="linenos">880</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Vehicle </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2"> is away.&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-881"><a href="#Supplier.AssignVehicle.run-881"><span class="linenos">881</span></a>                    
</span><span id="Supplier.AssignVehicle.run-882"><a href="#Supplier.AssignVehicle.run-882"><span class="linenos">882</span></a>            <span class="k">if</span> <span class="n">n_available_vehicles</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-883"><a href="#Supplier.AssignVehicle.run-883"><span class="linenos">883</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-884"><a href="#Supplier.AssignVehicle.run-884"><span class="linenos">884</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No AVAILABLE vehicles found. All vehicles are AWAY.&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-885"><a href="#Supplier.AssignVehicle.run-885"><span class="linenos">885</span></a>                <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">away_vehicles</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-886"><a href="#Supplier.AssignVehicle.run-886"><span class="linenos">886</span></a>                    <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_call_for_proposal_message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-887"><a href="#Supplier.AssignVehicle.run-887"><span class="linenos">887</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-888"><a href="#Supplier.AssignVehicle.run-888"><span class="linenos">888</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent order proposal to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-889"><a href="#Supplier.AssignVehicle.run-889"><span class="linenos">889</span></a>            
</span><span id="Supplier.AssignVehicle.run-890"><a href="#Supplier.AssignVehicle.run-890"><span class="linenos">890</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.AssignVehicle.run-891"><a href="#Supplier.AssignVehicle.run-891"><span class="linenos">891</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Sent proposals to </span><span class="si">{</span><span class="n">n_available_vehicles</span><span class="si">}</span><span class="s2"> vehicle(s)&quot;</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-892"><a href="#Supplier.AssignVehicle.run-892"><span class="linenos">892</span></a>                    
</span><span id="Supplier.AssignVehicle.run-893"><a href="#Supplier.AssignVehicle.run-893"><span class="linenos">893</span></a>            <span class="n">behav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">ChooseBestVehicle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-894"><a href="#Supplier.AssignVehicle.run-894"><span class="linenos">894</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">behav</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
</span><span id="Supplier.AssignVehicle.run-895"><a href="#Supplier.AssignVehicle.run-895"><span class="linenos">895</span></a>            
</span><span id="Supplier.AssignVehicle.run-896"><a href="#Supplier.AssignVehicle.run-896"><span class="linenos">896</span></a>            <span class="c1"># Waits for all vehicle proposals to be received</span>
</span><span id="Supplier.AssignVehicle.run-897"><a href="#Supplier.AssignVehicle.run-897"><span class="linenos">897</span></a>            <span class="k">await</span> <span class="n">behav</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
                <section id="Supplier.ReceivePresenceInfo">
                            <input id="Supplier.ReceivePresenceInfo-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.ReceivePresenceInfo</span><wbr>(<span class="base">spade.behaviour.OneShotBehaviour</span>):

                <label class="view-source-button" for="Supplier.ReceivePresenceInfo-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceivePresenceInfo"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceivePresenceInfo-899"><a href="#Supplier.ReceivePresenceInfo-899"><span class="linenos">899</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceivePresenceInfo</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier.ReceivePresenceInfo-900"><a href="#Supplier.ReceivePresenceInfo-900"><span class="linenos">900</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceivePresenceInfo-901"><a href="#Supplier.ReceivePresenceInfo-901"><span class="linenos">901</span></a><span class="sd">        Behaviour to receive presence information from vehicle agents.</span>
</span><span id="Supplier.ReceivePresenceInfo-902"><a href="#Supplier.ReceivePresenceInfo-902"><span class="linenos">902</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceivePresenceInfo-903"><a href="#Supplier.ReceivePresenceInfo-903"><span class="linenos">903</span></a><span class="sd">        This behaviour requests and collects availability status from vehicle agents,</span>
</span><span id="Supplier.ReceivePresenceInfo-904"><a href="#Supplier.ReceivePresenceInfo-904"><span class="linenos">904</span></a><span class="sd">        which is used to determine which vehicles are available for delivery tasks</span>
</span><span id="Supplier.ReceivePresenceInfo-905"><a href="#Supplier.ReceivePresenceInfo-905"><span class="linenos">905</span></a><span class="sd">        from the supplier to warehouses.</span>
</span><span id="Supplier.ReceivePresenceInfo-906"><a href="#Supplier.ReceivePresenceInfo-906"><span class="linenos">906</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceivePresenceInfo-907"><a href="#Supplier.ReceivePresenceInfo-907"><span class="linenos">907</span></a><span class="sd">        The presence information indicates whether a vehicle is busy, available, or</span>
</span><span id="Supplier.ReceivePresenceInfo-908"><a href="#Supplier.ReceivePresenceInfo-908"><span class="linenos">908</span></a><span class="sd">        in another state. This helps the supplier make intelligent vehicle assignment</span>
</span><span id="Supplier.ReceivePresenceInfo-909"><a href="#Supplier.ReceivePresenceInfo-909"><span class="linenos">909</span></a><span class="sd">        decisions based on current vehicle availability.</span>
</span><span id="Supplier.ReceivePresenceInfo-910"><a href="#Supplier.ReceivePresenceInfo-910"><span class="linenos">910</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceivePresenceInfo-911"><a href="#Supplier.ReceivePresenceInfo-911"><span class="linenos">911</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier.ReceivePresenceInfo-912"><a href="#Supplier.ReceivePresenceInfo-912"><span class="linenos">912</span></a><span class="sd">            1. **Receive Message**: Wait up to 10 seconds for presence response</span>
</span><span id="Supplier.ReceivePresenceInfo-913"><a href="#Supplier.ReceivePresenceInfo-913"><span class="linenos">913</span></a><span class="sd">            2. **Parse JSON**: Extract presence_show status from message body</span>
</span><span id="Supplier.ReceivePresenceInfo-914"><a href="#Supplier.ReceivePresenceInfo-914"><span class="linenos">914</span></a><span class="sd">            3. **Store Information**: Save presence info indexed by vehicle_id</span>
</span><span id="Supplier.ReceivePresenceInfo-915"><a href="#Supplier.ReceivePresenceInfo-915"><span class="linenos">915</span></a><span class="sd">            4. **Handle Timeout**: Print warning if no response received</span>
</span><span id="Supplier.ReceivePresenceInfo-916"><a href="#Supplier.ReceivePresenceInfo-916"><span class="linenos">916</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceivePresenceInfo-917"><a href="#Supplier.ReceivePresenceInfo-917"><span class="linenos">917</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier.ReceivePresenceInfo-918"><a href="#Supplier.ReceivePresenceInfo-918"><span class="linenos">918</span></a><span class="sd">            - Updates agent.presence_infos dictionary with vehicle status</span>
</span><span id="Supplier.ReceivePresenceInfo-919"><a href="#Supplier.ReceivePresenceInfo-919"><span class="linenos">919</span></a><span class="sd">            - Prints presence information if verbose mode enabled</span>
</span><span id="Supplier.ReceivePresenceInfo-920"><a href="#Supplier.ReceivePresenceInfo-920"><span class="linenos">920</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceivePresenceInfo-921"><a href="#Supplier.ReceivePresenceInfo-921"><span class="linenos">921</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier.ReceivePresenceInfo-922"><a href="#Supplier.ReceivePresenceInfo-922"><span class="linenos">922</span></a><span class="sd">            None. Completes after receiving one presence message or timing out.</span>
</span><span id="Supplier.ReceivePresenceInfo-923"><a href="#Supplier.ReceivePresenceInfo-923"><span class="linenos">923</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceivePresenceInfo-924"><a href="#Supplier.ReceivePresenceInfo-924"><span class="linenos">924</span></a><span class="sd">        Example:</span>
</span><span id="Supplier.ReceivePresenceInfo-925"><a href="#Supplier.ReceivePresenceInfo-925"><span class="linenos">925</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceivePresenceInfo-926"><a href="#Supplier.ReceivePresenceInfo-926"><span class="linenos">926</span></a><span class="sd">            Message Received:</span>
</span><span id="Supplier.ReceivePresenceInfo-927"><a href="#Supplier.ReceivePresenceInfo-927"><span class="linenos">927</span></a><span class="sd">                Metadata: vehicle_id = &quot;vehicle2@localhost&quot;</span>
</span><span id="Supplier.ReceivePresenceInfo-928"><a href="#Supplier.ReceivePresenceInfo-928"><span class="linenos">928</span></a><span class="sd">                Body: {&quot;presence_show&quot;: &quot;available&quot;}</span>
</span><span id="Supplier.ReceivePresenceInfo-929"><a href="#Supplier.ReceivePresenceInfo-929"><span class="linenos">929</span></a><span class="sd">            Processing:</span>
</span><span id="Supplier.ReceivePresenceInfo-930"><a href="#Supplier.ReceivePresenceInfo-930"><span class="linenos">930</span></a><span class="sd">                - presence_infos[&quot;vehicle2@localhost&quot;] = &quot;available&quot;</span>
</span><span id="Supplier.ReceivePresenceInfo-931"><a href="#Supplier.ReceivePresenceInfo-931"><span class="linenos">931</span></a><span class="sd">            Output:</span>
</span><span id="Supplier.ReceivePresenceInfo-932"><a href="#Supplier.ReceivePresenceInfo-932"><span class="linenos">932</span></a><span class="sd">                - Print: &quot;Received presence info response from vehicle2: available&quot;</span>
</span><span id="Supplier.ReceivePresenceInfo-933"><a href="#Supplier.ReceivePresenceInfo-933"><span class="linenos">933</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceivePresenceInfo-934"><a href="#Supplier.ReceivePresenceInfo-934"><span class="linenos">934</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceivePresenceInfo-935"><a href="#Supplier.ReceivePresenceInfo-935"><span class="linenos">935</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.ReceivePresenceInfo-936"><a href="#Supplier.ReceivePresenceInfo-936"><span class="linenos">936</span></a><span class="sd">            The 10-second timeout prevents indefinite blocking if a vehicle agent</span>
</span><span id="Supplier.ReceivePresenceInfo-937"><a href="#Supplier.ReceivePresenceInfo-937"><span class="linenos">937</span></a><span class="sd">            is offline or unresponsive.</span>
</span><span id="Supplier.ReceivePresenceInfo-938"><a href="#Supplier.ReceivePresenceInfo-938"><span class="linenos">938</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceivePresenceInfo-939"><a href="#Supplier.ReceivePresenceInfo-939"><span class="linenos">939</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceivePresenceInfo-940"><a href="#Supplier.ReceivePresenceInfo-940"><span class="linenos">940</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceivePresenceInfo-941"><a href="#Supplier.ReceivePresenceInfo-941"><span class="linenos">941</span></a>            
</span><span id="Supplier.ReceivePresenceInfo-942"><a href="#Supplier.ReceivePresenceInfo-942"><span class="linenos">942</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Supplier.ReceivePresenceInfo-943"><a href="#Supplier.ReceivePresenceInfo-943"><span class="linenos">943</span></a>            
</span><span id="Supplier.ReceivePresenceInfo-944"><a href="#Supplier.ReceivePresenceInfo-944"><span class="linenos">944</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier.ReceivePresenceInfo-945"><a href="#Supplier.ReceivePresenceInfo-945"><span class="linenos">945</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier.ReceivePresenceInfo-946"><a href="#Supplier.ReceivePresenceInfo-946"><span class="linenos">946</span></a>                <span class="n">presence_info</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;presence_show&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceivePresenceInfo-947"><a href="#Supplier.ReceivePresenceInfo-947"><span class="linenos">947</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceivePresenceInfo-948"><a href="#Supplier.ReceivePresenceInfo-948"><span class="linenos">948</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Received presence info response from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="Supplier.ReceivePresenceInfo-949"><a href="#Supplier.ReceivePresenceInfo-949"><span class="linenos">949</span></a>                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">presence_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceivePresenceInfo-950"><a href="#Supplier.ReceivePresenceInfo-950"><span class="linenos">950</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;vehicle_id&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">presence_info</span>
</span><span id="Supplier.ReceivePresenceInfo-951"><a href="#Supplier.ReceivePresenceInfo-951"><span class="linenos">951</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceivePresenceInfo-952"><a href="#Supplier.ReceivePresenceInfo-952"><span class="linenos">952</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceivePresenceInfo-953"><a href="#Supplier.ReceivePresenceInfo-953"><span class="linenos">953</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; No presence info response received from vehicle.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Behaviour to receive presence information from vehicle agents.</p>

<p>This behaviour requests and collects availability status from vehicle agents,
which is used to determine which vehicles are available for delivery tasks
from the supplier to warehouses.</p>

<p>The presence information indicates whether a vehicle is busy, available, or
in another state. This helps the supplier make intelligent vehicle assignment
decisions based on current vehicle availability.</p>

<h6 id="workflow">Workflow:</h6>

<blockquote>
  <ol>
  <li><strong>Receive Message</strong>: Wait up to 10 seconds for presence response</li>
  <li><strong>Parse JSON</strong>: Extract presence_show status from message body</li>
  <li><strong>Store Information</strong>: Save presence info indexed by vehicle_id</li>
  <li><strong>Handle Timeout</strong>: Print warning if no response received</li>
  </ol>
</blockquote>

<h6 id="side-effects">Side Effects:</h6>

<blockquote>
  <ul>
  <li>Updates agent.presence_infos dictionary with vehicle status</li>
  <li>Prints presence information if verbose mode enabled</li>
  </ul>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None. Completes after receiving one presence message or timing out.</p>
</blockquote>

<h6 id="example">Example:</h6>

<blockquote>
<pre><code>Message Received:
    Metadata: vehicle_id = "vehicle2@localhost"
    Body: {"presence_show": "available"}
Processing:
    - presence_infos["vehicle2@localhost"] = "available"
Output:
    - Print: "Received presence info response from vehicle2: available"
</code></pre>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The 10-second timeout prevents indefinite blocking if a vehicle agent
  is offline or unresponsive.</p>
</blockquote>
</div>


                            <div id="Supplier.ReceivePresenceInfo.run" class="classattr">
                                        <input id="Supplier.ReceivePresenceInfo.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.ReceivePresenceInfo.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceivePresenceInfo.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceivePresenceInfo.run-939"><a href="#Supplier.ReceivePresenceInfo.run-939"><span class="linenos">939</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceivePresenceInfo.run-940"><a href="#Supplier.ReceivePresenceInfo.run-940"><span class="linenos">940</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceivePresenceInfo.run-941"><a href="#Supplier.ReceivePresenceInfo.run-941"><span class="linenos">941</span></a>            
</span><span id="Supplier.ReceivePresenceInfo.run-942"><a href="#Supplier.ReceivePresenceInfo.run-942"><span class="linenos">942</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="Supplier.ReceivePresenceInfo.run-943"><a href="#Supplier.ReceivePresenceInfo.run-943"><span class="linenos">943</span></a>            
</span><span id="Supplier.ReceivePresenceInfo.run-944"><a href="#Supplier.ReceivePresenceInfo.run-944"><span class="linenos">944</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier.ReceivePresenceInfo.run-945"><a href="#Supplier.ReceivePresenceInfo.run-945"><span class="linenos">945</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier.ReceivePresenceInfo.run-946"><a href="#Supplier.ReceivePresenceInfo.run-946"><span class="linenos">946</span></a>                <span class="n">presence_info</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;presence_show&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceivePresenceInfo.run-947"><a href="#Supplier.ReceivePresenceInfo.run-947"><span class="linenos">947</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceivePresenceInfo.run-948"><a href="#Supplier.ReceivePresenceInfo.run-948"><span class="linenos">948</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Received presence info response from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="Supplier.ReceivePresenceInfo.run-949"><a href="#Supplier.ReceivePresenceInfo.run-949"><span class="linenos">949</span></a>                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">presence_info</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceivePresenceInfo.run-950"><a href="#Supplier.ReceivePresenceInfo.run-950"><span class="linenos">950</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">presence_infos</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;vehicle_id&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">presence_info</span>
</span><span id="Supplier.ReceivePresenceInfo.run-951"><a href="#Supplier.ReceivePresenceInfo.run-951"><span class="linenos">951</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ReceivePresenceInfo.run-952"><a href="#Supplier.ReceivePresenceInfo.run-952"><span class="linenos">952</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceivePresenceInfo.run-953"><a href="#Supplier.ReceivePresenceInfo.run-953"><span class="linenos">953</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; No presence info response received from vehicle.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
                <section id="Supplier.ReceiveVehicleProposals">
                            <input id="Supplier.ReceiveVehicleProposals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.ReceiveVehicleProposals</span><wbr>(<span class="base">spade.behaviour.CyclicBehaviour</span>):

                <label class="view-source-button" for="Supplier.ReceiveVehicleProposals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveVehicleProposals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveVehicleProposals-955"><a href="#Supplier.ReceiveVehicleProposals-955"><span class="linenos"> 955</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveVehicleProposals</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="Supplier.ReceiveVehicleProposals-956"><a href="#Supplier.ReceiveVehicleProposals-956"><span class="linenos"> 956</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveVehicleProposals-957"><a href="#Supplier.ReceiveVehicleProposals-957"><span class="linenos"> 957</span></a><span class="sd">        Cyclic behaviour that collects vehicle delivery proposals for supplier orders.</span>
</span><span id="Supplier.ReceiveVehicleProposals-958"><a href="#Supplier.ReceiveVehicleProposals-958"><span class="linenos"> 958</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-959"><a href="#Supplier.ReceiveVehicleProposals-959"><span class="linenos"> 959</span></a><span class="sd">        This behaviour implements the proposal collection phase of vehicle selection</span>
</span><span id="Supplier.ReceiveVehicleProposals-960"><a href="#Supplier.ReceiveVehicleProposals-960"><span class="linenos"> 960</span></a><span class="sd">        for deliveries from supplier to warehouses. After the supplier sends delivery</span>
</span><span id="Supplier.ReceiveVehicleProposals-961"><a href="#Supplier.ReceiveVehicleProposals-961"><span class="linenos"> 961</span></a><span class="sd">        requests to vehicles, this behaviour continuously receives and stores vehicle</span>
</span><span id="Supplier.ReceiveVehicleProposals-962"><a href="#Supplier.ReceiveVehicleProposals-962"><span class="linenos"> 962</span></a><span class="sd">        proposals containing delivery capacity and estimated delivery time information.</span>
</span><span id="Supplier.ReceiveVehicleProposals-963"><a href="#Supplier.ReceiveVehicleProposals-963"><span class="linenos"> 963</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-964"><a href="#Supplier.ReceiveVehicleProposals-964"><span class="linenos"> 964</span></a><span class="sd">        The behaviour runs in an infinite loop within each execution, collecting all</span>
</span><span id="Supplier.ReceiveVehicleProposals-965"><a href="#Supplier.ReceiveVehicleProposals-965"><span class="linenos"> 965</span></a><span class="sd">        available proposals until a timeout occurs (no more proposals arriving). Each</span>
</span><span id="Supplier.ReceiveVehicleProposals-966"><a href="#Supplier.ReceiveVehicleProposals-966"><span class="linenos"> 966</span></a><span class="sd">        proposal is indexed by order_id and vehicle_jid for later evaluation by</span>
</span><span id="Supplier.ReceiveVehicleProposals-967"><a href="#Supplier.ReceiveVehicleProposals-967"><span class="linenos"> 967</span></a><span class="sd">        ChooseBestVehicle behaviour.</span>
</span><span id="Supplier.ReceiveVehicleProposals-968"><a href="#Supplier.ReceiveVehicleProposals-968"><span class="linenos"> 968</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-969"><a href="#Supplier.ReceiveVehicleProposals-969"><span class="linenos"> 969</span></a><span class="sd">        Proposal Data Structure:</span>
</span><span id="Supplier.ReceiveVehicleProposals-970"><a href="#Supplier.ReceiveVehicleProposals-970"><span class="linenos"> 970</span></a><span class="sd">            ```python</span>
</span><span id="Supplier.ReceiveVehicleProposals-971"><a href="#Supplier.ReceiveVehicleProposals-971"><span class="linenos"> 971</span></a><span class="sd">            vehicle_proposals = {</span>
</span><span id="Supplier.ReceiveVehicleProposals-972"><a href="#Supplier.ReceiveVehicleProposals-972"><span class="linenos"> 972</span></a><span class="sd">                order_id: {</span>
</span><span id="Supplier.ReceiveVehicleProposals-973"><a href="#Supplier.ReceiveVehicleProposals-973"><span class="linenos"> 973</span></a><span class="sd">                    &quot;vehicle1@localhost&quot;: (can_fit: bool, delivery_time: int),</span>
</span><span id="Supplier.ReceiveVehicleProposals-974"><a href="#Supplier.ReceiveVehicleProposals-974"><span class="linenos"> 974</span></a><span class="sd">                    &quot;vehicle2@localhost&quot;: (can_fit: bool, delivery_time: int),</span>
</span><span id="Supplier.ReceiveVehicleProposals-975"><a href="#Supplier.ReceiveVehicleProposals-975"><span class="linenos"> 975</span></a><span class="sd">                    ...</span>
</span><span id="Supplier.ReceiveVehicleProposals-976"><a href="#Supplier.ReceiveVehicleProposals-976"><span class="linenos"> 976</span></a><span class="sd">                }</span>
</span><span id="Supplier.ReceiveVehicleProposals-977"><a href="#Supplier.ReceiveVehicleProposals-977"><span class="linenos"> 977</span></a><span class="sd">            }</span>
</span><span id="Supplier.ReceiveVehicleProposals-978"><a href="#Supplier.ReceiveVehicleProposals-978"><span class="linenos"> 978</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveVehicleProposals-979"><a href="#Supplier.ReceiveVehicleProposals-979"><span class="linenos"> 979</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-980"><a href="#Supplier.ReceiveVehicleProposals-980"><span class="linenos"> 980</span></a><span class="sd">        Message Format:</span>
</span><span id="Supplier.ReceiveVehicleProposals-981"><a href="#Supplier.ReceiveVehicleProposals-981"><span class="linenos"> 981</span></a><span class="sd">            Body (JSON):</span>
</span><span id="Supplier.ReceiveVehicleProposals-982"><a href="#Supplier.ReceiveVehicleProposals-982"><span class="linenos"> 982</span></a><span class="sd">                ```json</span>
</span><span id="Supplier.ReceiveVehicleProposals-983"><a href="#Supplier.ReceiveVehicleProposals-983"><span class="linenos"> 983</span></a><span class="sd">                {</span>
</span><span id="Supplier.ReceiveVehicleProposals-984"><a href="#Supplier.ReceiveVehicleProposals-984"><span class="linenos"> 984</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="Supplier.ReceiveVehicleProposals-985"><a href="#Supplier.ReceiveVehicleProposals-985"><span class="linenos"> 985</span></a><span class="sd">                    &quot;can_fit&quot;: true,</span>
</span><span id="Supplier.ReceiveVehicleProposals-986"><a href="#Supplier.ReceiveVehicleProposals-986"><span class="linenos"> 986</span></a><span class="sd">                    &quot;delivery_time&quot;: 180</span>
</span><span id="Supplier.ReceiveVehicleProposals-987"><a href="#Supplier.ReceiveVehicleProposals-987"><span class="linenos"> 987</span></a><span class="sd">                }</span>
</span><span id="Supplier.ReceiveVehicleProposals-988"><a href="#Supplier.ReceiveVehicleProposals-988"><span class="linenos"> 988</span></a><span class="sd">                ```</span>
</span><span id="Supplier.ReceiveVehicleProposals-989"><a href="#Supplier.ReceiveVehicleProposals-989"><span class="linenos"> 989</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-990"><a href="#Supplier.ReceiveVehicleProposals-990"><span class="linenos"> 990</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier.ReceiveVehicleProposals-991"><a href="#Supplier.ReceiveVehicleProposals-991"><span class="linenos"> 991</span></a><span class="sd">            1. **Receive Message**: Wait up to 5 seconds for vehicle proposal</span>
</span><span id="Supplier.ReceiveVehicleProposals-992"><a href="#Supplier.ReceiveVehicleProposals-992"><span class="linenos"> 992</span></a><span class="sd">            2. **Parse Proposal**: Extract orderid, can_fit, delivery_time</span>
</span><span id="Supplier.ReceiveVehicleProposals-993"><a href="#Supplier.ReceiveVehicleProposals-993"><span class="linenos"> 993</span></a><span class="sd">            3. **Initialize Storage**: Create order_id entry if doesn&#39;t exist</span>
</span><span id="Supplier.ReceiveVehicleProposals-994"><a href="#Supplier.ReceiveVehicleProposals-994"><span class="linenos"> 994</span></a><span class="sd">            4. **Store Proposal**: Add vehicle proposal to vehicle_proposals dict</span>
</span><span id="Supplier.ReceiveVehicleProposals-995"><a href="#Supplier.ReceiveVehicleProposals-995"><span class="linenos"> 995</span></a><span class="sd">            5. **Continue Loop**: Repeat until timeout (no more proposals)</span>
</span><span id="Supplier.ReceiveVehicleProposals-996"><a href="#Supplier.ReceiveVehicleProposals-996"><span class="linenos"> 996</span></a><span class="sd">            6. **Exit**: Break loop when timeout indicates all proposals received</span>
</span><span id="Supplier.ReceiveVehicleProposals-997"><a href="#Supplier.ReceiveVehicleProposals-997"><span class="linenos"> 997</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-998"><a href="#Supplier.ReceiveVehicleProposals-998"><span class="linenos"> 998</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier.ReceiveVehicleProposals-999"><a href="#Supplier.ReceiveVehicleProposals-999"><span class="linenos"> 999</span></a><span class="sd">            - Updates agent.vehicle_proposals dictionary with new proposals</span>
</span><span id="Supplier.ReceiveVehicleProposals-1000"><a href="#Supplier.ReceiveVehicleProposals-1000"><span class="linenos">1000</span></a><span class="sd">            - Prints proposal details if verbose mode enabled</span>
</span><span id="Supplier.ReceiveVehicleProposals-1001"><a href="#Supplier.ReceiveVehicleProposals-1001"><span class="linenos">1001</span></a><span class="sd">            - Breaks loop after 5-second timeout</span>
</span><span id="Supplier.ReceiveVehicleProposals-1002"><a href="#Supplier.ReceiveVehicleProposals-1002"><span class="linenos">1002</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-1003"><a href="#Supplier.ReceiveVehicleProposals-1003"><span class="linenos">1003</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1004"><a href="#Supplier.ReceiveVehicleProposals-1004"><span class="linenos">1004</span></a><span class="sd">            None. Exits after collecting all available proposals.</span>
</span><span id="Supplier.ReceiveVehicleProposals-1005"><a href="#Supplier.ReceiveVehicleProposals-1005"><span class="linenos">1005</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-1006"><a href="#Supplier.ReceiveVehicleProposals-1006"><span class="linenos">1006</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1007"><a href="#Supplier.ReceiveVehicleProposals-1007"><span class="linenos">1007</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveVehicleProposals-1008"><a href="#Supplier.ReceiveVehicleProposals-1008"><span class="linenos">1008</span></a><span class="sd">            Loop Iteration 1:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1009"><a href="#Supplier.ReceiveVehicleProposals-1009"><span class="linenos">1009</span></a><span class="sd">                - Receive from vehicle1: can_fit=True, time=150</span>
</span><span id="Supplier.ReceiveVehicleProposals-1010"><a href="#Supplier.ReceiveVehicleProposals-1010"><span class="linenos">1010</span></a><span class="sd">                - Store: vehicle_proposals[3001000000][&quot;vehicle1&quot;] = (True, 150)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1011"><a href="#Supplier.ReceiveVehicleProposals-1011"><span class="linenos">1011</span></a><span class="sd">            Loop Iteration 2:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1012"><a href="#Supplier.ReceiveVehicleProposals-1012"><span class="linenos">1012</span></a><span class="sd">                - Receive from vehicle2: can_fit=True, time=130</span>
</span><span id="Supplier.ReceiveVehicleProposals-1013"><a href="#Supplier.ReceiveVehicleProposals-1013"><span class="linenos">1013</span></a><span class="sd">                - Store: vehicle_proposals[3001000000][&quot;vehicle2&quot;] = (True, 130)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1014"><a href="#Supplier.ReceiveVehicleProposals-1014"><span class="linenos">1014</span></a><span class="sd">            Loop Iteration 3:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1015"><a href="#Supplier.ReceiveVehicleProposals-1015"><span class="linenos">1015</span></a><span class="sd">                - Timeout after 5 seconds</span>
</span><span id="Supplier.ReceiveVehicleProposals-1016"><a href="#Supplier.ReceiveVehicleProposals-1016"><span class="linenos">1016</span></a><span class="sd">                - Break loop, all proposals collected</span>
</span><span id="Supplier.ReceiveVehicleProposals-1017"><a href="#Supplier.ReceiveVehicleProposals-1017"><span class="linenos">1017</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ReceiveVehicleProposals-1018"><a href="#Supplier.ReceiveVehicleProposals-1018"><span class="linenos">1018</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveVehicleProposals-1019"><a href="#Supplier.ReceiveVehicleProposals-1019"><span class="linenos">1019</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1020"><a href="#Supplier.ReceiveVehicleProposals-1020"><span class="linenos">1020</span></a><span class="sd">            The 5-second timeout is optimized to collect multiple proposals quickly</span>
</span><span id="Supplier.ReceiveVehicleProposals-1021"><a href="#Supplier.ReceiveVehicleProposals-1021"><span class="linenos">1021</span></a><span class="sd">            while not waiting too long for vehicles that won&#39;t respond.</span>
</span><span id="Supplier.ReceiveVehicleProposals-1022"><a href="#Supplier.ReceiveVehicleProposals-1022"><span class="linenos">1022</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveVehicleProposals-1023"><a href="#Supplier.ReceiveVehicleProposals-1023"><span class="linenos">1023</span></a>        
</span><span id="Supplier.ReceiveVehicleProposals-1024"><a href="#Supplier.ReceiveVehicleProposals-1024"><span class="linenos">1024</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveVehicleProposals-1025"><a href="#Supplier.ReceiveVehicleProposals-1025"><span class="linenos">1025</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceiveVehicleProposals-1026"><a href="#Supplier.ReceiveVehicleProposals-1026"><span class="linenos">1026</span></a>            
</span><span id="Supplier.ReceiveVehicleProposals-1027"><a href="#Supplier.ReceiveVehicleProposals-1027"><span class="linenos">1027</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1028"><a href="#Supplier.ReceiveVehicleProposals-1028"><span class="linenos">1028</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1029"><a href="#Supplier.ReceiveVehicleProposals-1029"><span class="linenos">1029</span></a>                
</span><span id="Supplier.ReceiveVehicleProposals-1030"><a href="#Supplier.ReceiveVehicleProposals-1030"><span class="linenos">1030</span></a>                <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1031"><a href="#Supplier.ReceiveVehicleProposals-1031"><span class="linenos">1031</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1032"><a href="#Supplier.ReceiveVehicleProposals-1032"><span class="linenos">1032</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Received vehicle proposal from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1033"><a href="#Supplier.ReceiveVehicleProposals-1033"><span class="linenos">1033</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1034"><a href="#Supplier.ReceiveVehicleProposals-1034"><span class="linenos">1034</span></a>                    
</span><span id="Supplier.ReceiveVehicleProposals-1035"><a href="#Supplier.ReceiveVehicleProposals-1035"><span class="linenos">1035</span></a>                    <span class="c1"># A proposta do veculo no  uma Order, so apenas dados da proposta</span>
</span><span id="Supplier.ReceiveVehicleProposals-1036"><a href="#Supplier.ReceiveVehicleProposals-1036"><span class="linenos">1036</span></a>                    <span class="n">order_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orderid&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveVehicleProposals-1037"><a href="#Supplier.ReceiveVehicleProposals-1037"><span class="linenos">1037</span></a>                    <span class="n">sender_jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1038"><a href="#Supplier.ReceiveVehicleProposals-1038"><span class="linenos">1038</span></a>                    <span class="n">can_fit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;can_fit&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveVehicleProposals-1039"><a href="#Supplier.ReceiveVehicleProposals-1039"><span class="linenos">1039</span></a>                    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveVehicleProposals-1040"><a href="#Supplier.ReceiveVehicleProposals-1040"><span class="linenos">1040</span></a>                    
</span><span id="Supplier.ReceiveVehicleProposals-1041"><a href="#Supplier.ReceiveVehicleProposals-1041"><span class="linenos">1041</span></a>                    <span class="c1"># Verificar se a entrada para este order_id existe, se no criar</span>
</span><span id="Supplier.ReceiveVehicleProposals-1042"><a href="#Supplier.ReceiveVehicleProposals-1042"><span class="linenos">1042</span></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1043"><a href="#Supplier.ReceiveVehicleProposals-1043"><span class="linenos">1043</span></a>                        <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier.ReceiveVehicleProposals-1044"><a href="#Supplier.ReceiveVehicleProposals-1044"><span class="linenos">1044</span></a>                    
</span><span id="Supplier.ReceiveVehicleProposals-1045"><a href="#Supplier.ReceiveVehicleProposals-1045"><span class="linenos">1045</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)][</span><span class="n">sender_jid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">can_fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1046"><a href="#Supplier.ReceiveVehicleProposals-1046"><span class="linenos">1046</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1047"><a href="#Supplier.ReceiveVehicleProposals-1047"><span class="linenos">1047</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle </span><span class="si">{</span><span class="n">sender_jid</span><span class="si">}</span><span class="s2"> proposal: can_fit=</span><span class="si">{</span><span class="n">can_fit</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1048"><a href="#Supplier.ReceiveVehicleProposals-1048"><span class="linenos">1048</span></a>  
</span><span id="Supplier.ReceiveVehicleProposals-1049"><a href="#Supplier.ReceiveVehicleProposals-1049"><span class="linenos">1049</span></a>                <span class="k">else</span><span class="p">:</span> 
</span><span id="Supplier.ReceiveVehicleProposals-1050"><a href="#Supplier.ReceiveVehicleProposals-1050"><span class="linenos">1050</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals-1051"><a href="#Supplier.ReceiveVehicleProposals-1051"><span class="linenos">1051</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Timeout - no more proposals received&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals-1052"><a href="#Supplier.ReceiveVehicleProposals-1052"><span class="linenos">1052</span></a>                    <span class="k">break</span>
</span></pre></div>


            <div class="docstring"><p>Cyclic behaviour that collects vehicle delivery proposals for supplier orders.</p>

<p>This behaviour implements the proposal collection phase of vehicle selection
for deliveries from supplier to warehouses. After the supplier sends delivery
requests to vehicles, this behaviour continuously receives and stores vehicle
proposals containing delivery capacity and estimated delivery time information.</p>

<p>The behaviour runs in an infinite loop within each execution, collecting all
available proposals until a timeout occurs (no more proposals arriving). Each
proposal is indexed by order_id and vehicle_jid for later evaluation by
ChooseBestVehicle behaviour.</p>

<h6 id="proposal-data-structure">Proposal Data Structure:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">vehicle_proposals</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">order_id</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;vehicle1@localhost&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">can_fit</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">delivery_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">),</span>
        <span class="s2">&quot;vehicle2@localhost&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">can_fit</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">delivery_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">),</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
  </div>
</blockquote>

<h6 id="message-format">Message Format:</h6>

<blockquote>
  <p>Body (JSON):</p>
  
  <p><div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;orderid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3001000000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;can_fit&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;delivery_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">180</span>
<span class="p">}</span>
</code></pre>
</div></p>
</blockquote>

<h6 id="workflow">Workflow:</h6>

<blockquote>
  <ol>
  <li><strong>Receive Message</strong>: Wait up to 5 seconds for vehicle proposal</li>
  <li><strong>Parse Proposal</strong>: Extract orderid, can_fit, delivery_time</li>
  <li><strong>Initialize Storage</strong>: Create order_id entry if doesn't exist</li>
  <li><strong>Store Proposal</strong>: Add vehicle proposal to vehicle_proposals dict</li>
  <li><strong>Continue Loop</strong>: Repeat until timeout (no more proposals)</li>
  <li><strong>Exit</strong>: Break loop when timeout indicates all proposals received</li>
  </ol>
</blockquote>

<h6 id="side-effects">Side Effects:</h6>

<blockquote>
  <ul>
  <li>Updates agent.vehicle_proposals dictionary with new proposals</li>
  <li>Prints proposal details if verbose mode enabled</li>
  <li>Breaks loop after 5-second timeout</li>
  </ul>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None. Exits after collecting all available proposals.</p>
</blockquote>

<h6 id="example-execution">Example Execution:</h6>

<blockquote>
<pre><code>Loop Iteration 1:
    - Receive from vehicle1: can_fit=True, time=150
    - Store: vehicle_proposals[3001000000]["vehicle1"] = (True, 150)
Loop Iteration 2:
    - Receive from vehicle2: can_fit=True, time=130
    - Store: vehicle_proposals[3001000000]["vehicle2"] = (True, 130)
Loop Iteration 3:
    - Timeout after 5 seconds
    - Break loop, all proposals collected
</code></pre>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The 5-second timeout is optimized to collect multiple proposals quickly
  while not waiting too long for vehicles that won't respond.</p>
</blockquote>
</div>


                            <div id="Supplier.ReceiveVehicleProposals.run" class="classattr">
                                        <input id="Supplier.ReceiveVehicleProposals.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.ReceiveVehicleProposals.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveVehicleProposals.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveVehicleProposals.run-1024"><a href="#Supplier.ReceiveVehicleProposals.run-1024"><span class="linenos">1024</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1025"><a href="#Supplier.ReceiveVehicleProposals.run-1025"><span class="linenos">1025</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1026"><a href="#Supplier.ReceiveVehicleProposals.run-1026"><span class="linenos">1026</span></a>            
</span><span id="Supplier.ReceiveVehicleProposals.run-1027"><a href="#Supplier.ReceiveVehicleProposals.run-1027"><span class="linenos">1027</span></a>            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1028"><a href="#Supplier.ReceiveVehicleProposals.run-1028"><span class="linenos">1028</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1029"><a href="#Supplier.ReceiveVehicleProposals.run-1029"><span class="linenos">1029</span></a>                
</span><span id="Supplier.ReceiveVehicleProposals.run-1030"><a href="#Supplier.ReceiveVehicleProposals.run-1030"><span class="linenos">1030</span></a>                <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1031"><a href="#Supplier.ReceiveVehicleProposals.run-1031"><span class="linenos">1031</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1032"><a href="#Supplier.ReceiveVehicleProposals.run-1032"><span class="linenos">1032</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Received vehicle proposal from </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1033"><a href="#Supplier.ReceiveVehicleProposals.run-1033"><span class="linenos">1033</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1034"><a href="#Supplier.ReceiveVehicleProposals.run-1034"><span class="linenos">1034</span></a>                    
</span><span id="Supplier.ReceiveVehicleProposals.run-1035"><a href="#Supplier.ReceiveVehicleProposals.run-1035"><span class="linenos">1035</span></a>                    <span class="c1"># A proposta do veculo no  uma Order, so apenas dados da proposta</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1036"><a href="#Supplier.ReceiveVehicleProposals.run-1036"><span class="linenos">1036</span></a>                    <span class="n">order_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orderid&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1037"><a href="#Supplier.ReceiveVehicleProposals.run-1037"><span class="linenos">1037</span></a>                    <span class="n">sender_jid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1038"><a href="#Supplier.ReceiveVehicleProposals.run-1038"><span class="linenos">1038</span></a>                    <span class="n">can_fit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;can_fit&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1039"><a href="#Supplier.ReceiveVehicleProposals.run-1039"><span class="linenos">1039</span></a>                    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;delivery_time&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1040"><a href="#Supplier.ReceiveVehicleProposals.run-1040"><span class="linenos">1040</span></a>                    
</span><span id="Supplier.ReceiveVehicleProposals.run-1041"><a href="#Supplier.ReceiveVehicleProposals.run-1041"><span class="linenos">1041</span></a>                    <span class="c1"># Verificar se a entrada para este order_id existe, se no criar</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1042"><a href="#Supplier.ReceiveVehicleProposals.run-1042"><span class="linenos">1042</span></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1043"><a href="#Supplier.ReceiveVehicleProposals.run-1043"><span class="linenos">1043</span></a>                        <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1044"><a href="#Supplier.ReceiveVehicleProposals.run-1044"><span class="linenos">1044</span></a>                    
</span><span id="Supplier.ReceiveVehicleProposals.run-1045"><a href="#Supplier.ReceiveVehicleProposals.run-1045"><span class="linenos">1045</span></a>                    <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order_id</span><span class="p">)][</span><span class="n">sender_jid</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">can_fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1046"><a href="#Supplier.ReceiveVehicleProposals.run-1046"><span class="linenos">1046</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1047"><a href="#Supplier.ReceiveVehicleProposals.run-1047"><span class="linenos">1047</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle </span><span class="si">{</span><span class="n">sender_jid</span><span class="si">}</span><span class="s2"> proposal: can_fit=</span><span class="si">{</span><span class="n">can_fit</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1048"><a href="#Supplier.ReceiveVehicleProposals.run-1048"><span class="linenos">1048</span></a>  
</span><span id="Supplier.ReceiveVehicleProposals.run-1049"><a href="#Supplier.ReceiveVehicleProposals.run-1049"><span class="linenos">1049</span></a>                <span class="k">else</span><span class="p">:</span> 
</span><span id="Supplier.ReceiveVehicleProposals.run-1050"><a href="#Supplier.ReceiveVehicleProposals.run-1050"><span class="linenos">1050</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1051"><a href="#Supplier.ReceiveVehicleProposals.run-1051"><span class="linenos">1051</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Timeout - no more proposals received&quot;</span><span class="p">)</span>
</span><span id="Supplier.ReceiveVehicleProposals.run-1052"><a href="#Supplier.ReceiveVehicleProposals.run-1052"><span class="linenos">1052</span></a>                    <span class="k">break</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
                <section id="Supplier.ChooseBestVehicle">
                            <input id="Supplier.ChooseBestVehicle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.ChooseBestVehicle</span><wbr>(<span class="base">spade.behaviour.OneShotBehaviour</span>):

                <label class="view-source-button" for="Supplier.ChooseBestVehicle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ChooseBestVehicle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ChooseBestVehicle-1054"><a href="#Supplier.ChooseBestVehicle-1054"><span class="linenos">1054</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ChooseBestVehicle</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="Supplier.ChooseBestVehicle-1055"><a href="#Supplier.ChooseBestVehicle-1055"><span class="linenos">1055</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ChooseBestVehicle-1056"><a href="#Supplier.ChooseBestVehicle-1056"><span class="linenos">1056</span></a><span class="sd">        Behaviour that evaluates vehicle proposals and selects optimal vehicle for supplier delivery.</span>
</span><span id="Supplier.ChooseBestVehicle-1057"><a href="#Supplier.ChooseBestVehicle-1057"><span class="linenos">1057</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1058"><a href="#Supplier.ChooseBestVehicle-1058"><span class="linenos">1058</span></a><span class="sd">        This behaviour implements the proposal evaluation and winner selection phase of</span>
</span><span id="Supplier.ChooseBestVehicle-1059"><a href="#Supplier.ChooseBestVehicle-1059"><span class="linenos">1059</span></a><span class="sd">        vehicle assignment for supplier-to-warehouse deliveries. After collecting all</span>
</span><span id="Supplier.ChooseBestVehicle-1060"><a href="#Supplier.ChooseBestVehicle-1060"><span class="linenos">1060</span></a><span class="sd">        vehicle proposals via ReceiveVehicleProposals, this behaviour compares them based</span>
</span><span id="Supplier.ChooseBestVehicle-1061"><a href="#Supplier.ChooseBestVehicle-1061"><span class="linenos">1061</span></a><span class="sd">        on capacity and delivery time, then notifies the selected vehicle and rejects all others.</span>
</span><span id="Supplier.ChooseBestVehicle-1062"><a href="#Supplier.ChooseBestVehicle-1062"><span class="linenos">1062</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1063"><a href="#Supplier.ChooseBestVehicle-1063"><span class="linenos">1063</span></a><span class="sd">        Selection Algorithm:</span>
</span><span id="Supplier.ChooseBestVehicle-1064"><a href="#Supplier.ChooseBestVehicle-1064"><span class="linenos">1064</span></a><span class="sd">            1. **Priority 1**: Filter vehicles that can fit the order (can_fit=True)</span>
</span><span id="Supplier.ChooseBestVehicle-1065"><a href="#Supplier.ChooseBestVehicle-1065"><span class="linenos">1065</span></a><span class="sd">            2. **Priority 2**: Among fitting vehicles, select one with minimum delivery_time</span>
</span><span id="Supplier.ChooseBestVehicle-1066"><a href="#Supplier.ChooseBestVehicle-1066"><span class="linenos">1066</span></a><span class="sd">            3. **Fallback**: If no vehicles can fit, select vehicle with minimum delivery_time anyway</span>
</span><span id="Supplier.ChooseBestVehicle-1067"><a href="#Supplier.ChooseBestVehicle-1067"><span class="linenos">1067</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1068"><a href="#Supplier.ChooseBestVehicle-1068"><span class="linenos">1068</span></a><span class="sd">        Attributes:</span>
</span><span id="Supplier.ChooseBestVehicle-1069"><a href="#Supplier.ChooseBestVehicle-1069"><span class="linenos">1069</span></a><span class="sd">            request_id (int): Unique order identifier to find proposals.</span>
</span><span id="Supplier.ChooseBestVehicle-1070"><a href="#Supplier.ChooseBestVehicle-1070"><span class="linenos">1070</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1071"><a href="#Supplier.ChooseBestVehicle-1071"><span class="linenos">1071</span></a><span class="sd">        Workflow:</span>
</span><span id="Supplier.ChooseBestVehicle-1072"><a href="#Supplier.ChooseBestVehicle-1072"><span class="linenos">1072</span></a><span class="sd">            1. **Retrieve Proposals**: Get all proposals for this request_id</span>
</span><span id="Supplier.ChooseBestVehicle-1073"><a href="#Supplier.ChooseBestVehicle-1073"><span class="linenos">1073</span></a><span class="sd">            2. **Evaluate Proposals**: Call get_best_vehicle() to select winner</span>
</span><span id="Supplier.ChooseBestVehicle-1074"><a href="#Supplier.ChooseBestVehicle-1074"><span class="linenos">1074</span></a><span class="sd">            3. **Send Confirmation**: Notify selected vehicle with order-confirmation</span>
</span><span id="Supplier.ChooseBestVehicle-1075"><a href="#Supplier.ChooseBestVehicle-1075"><span class="linenos">1075</span></a><span class="sd">            4. **Send Rejections**: Notify all other vehicles they were not selected</span>
</span><span id="Supplier.ChooseBestVehicle-1076"><a href="#Supplier.ChooseBestVehicle-1076"><span class="linenos">1076</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1077"><a href="#Supplier.ChooseBestVehicle-1077"><span class="linenos">1077</span></a><span class="sd">        Message Format (Confirmation):</span>
</span><span id="Supplier.ChooseBestVehicle-1078"><a href="#Supplier.ChooseBestVehicle-1078"><span class="linenos">1078</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier.ChooseBestVehicle-1079"><a href="#Supplier.ChooseBestVehicle-1079"><span class="linenos">1079</span></a><span class="sd">                - performative: &quot;order-confirmation&quot;</span>
</span><span id="Supplier.ChooseBestVehicle-1080"><a href="#Supplier.ChooseBestVehicle-1080"><span class="linenos">1080</span></a><span class="sd">            Body (JSON):</span>
</span><span id="Supplier.ChooseBestVehicle-1081"><a href="#Supplier.ChooseBestVehicle-1081"><span class="linenos">1081</span></a><span class="sd">                ```json</span>
</span><span id="Supplier.ChooseBestVehicle-1082"><a href="#Supplier.ChooseBestVehicle-1082"><span class="linenos">1082</span></a><span class="sd">                {</span>
</span><span id="Supplier.ChooseBestVehicle-1083"><a href="#Supplier.ChooseBestVehicle-1083"><span class="linenos">1083</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="Supplier.ChooseBestVehicle-1084"><a href="#Supplier.ChooseBestVehicle-1084"><span class="linenos">1084</span></a><span class="sd">                    &quot;confirmed&quot;: true</span>
</span><span id="Supplier.ChooseBestVehicle-1085"><a href="#Supplier.ChooseBestVehicle-1085"><span class="linenos">1085</span></a><span class="sd">                }</span>
</span><span id="Supplier.ChooseBestVehicle-1086"><a href="#Supplier.ChooseBestVehicle-1086"><span class="linenos">1086</span></a><span class="sd">                ```</span>
</span><span id="Supplier.ChooseBestVehicle-1087"><a href="#Supplier.ChooseBestVehicle-1087"><span class="linenos">1087</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1088"><a href="#Supplier.ChooseBestVehicle-1088"><span class="linenos">1088</span></a><span class="sd">        Message Format (Rejection):</span>
</span><span id="Supplier.ChooseBestVehicle-1089"><a href="#Supplier.ChooseBestVehicle-1089"><span class="linenos">1089</span></a><span class="sd">            Metadata:</span>
</span><span id="Supplier.ChooseBestVehicle-1090"><a href="#Supplier.ChooseBestVehicle-1090"><span class="linenos">1090</span></a><span class="sd">                - performative: &quot;order-confirmation&quot;</span>
</span><span id="Supplier.ChooseBestVehicle-1091"><a href="#Supplier.ChooseBestVehicle-1091"><span class="linenos">1091</span></a><span class="sd">            Body (JSON):</span>
</span><span id="Supplier.ChooseBestVehicle-1092"><a href="#Supplier.ChooseBestVehicle-1092"><span class="linenos">1092</span></a><span class="sd">                ```json</span>
</span><span id="Supplier.ChooseBestVehicle-1093"><a href="#Supplier.ChooseBestVehicle-1093"><span class="linenos">1093</span></a><span class="sd">                {</span>
</span><span id="Supplier.ChooseBestVehicle-1094"><a href="#Supplier.ChooseBestVehicle-1094"><span class="linenos">1094</span></a><span class="sd">                    &quot;orderid&quot;: 3001000000,</span>
</span><span id="Supplier.ChooseBestVehicle-1095"><a href="#Supplier.ChooseBestVehicle-1095"><span class="linenos">1095</span></a><span class="sd">                    &quot;confirmed&quot;: false</span>
</span><span id="Supplier.ChooseBestVehicle-1096"><a href="#Supplier.ChooseBestVehicle-1096"><span class="linenos">1096</span></a><span class="sd">                }</span>
</span><span id="Supplier.ChooseBestVehicle-1097"><a href="#Supplier.ChooseBestVehicle-1097"><span class="linenos">1097</span></a><span class="sd">                ```</span>
</span><span id="Supplier.ChooseBestVehicle-1098"><a href="#Supplier.ChooseBestVehicle-1098"><span class="linenos">1098</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1099"><a href="#Supplier.ChooseBestVehicle-1099"><span class="linenos">1099</span></a><span class="sd">        Side Effects:</span>
</span><span id="Supplier.ChooseBestVehicle-1100"><a href="#Supplier.ChooseBestVehicle-1100"><span class="linenos">1100</span></a><span class="sd">            - Reads from agent.vehicle_proposals dictionary</span>
</span><span id="Supplier.ChooseBestVehicle-1101"><a href="#Supplier.ChooseBestVehicle-1101"><span class="linenos">1101</span></a><span class="sd">            - Reads from agent.pending_deliveries for Order object</span>
</span><span id="Supplier.ChooseBestVehicle-1102"><a href="#Supplier.ChooseBestVehicle-1102"><span class="linenos">1102</span></a><span class="sd">            - Sends confirmation message to selected vehicle</span>
</span><span id="Supplier.ChooseBestVehicle-1103"><a href="#Supplier.ChooseBestVehicle-1103"><span class="linenos">1103</span></a><span class="sd">            - Sends rejection messages to non-selected vehicles</span>
</span><span id="Supplier.ChooseBestVehicle-1104"><a href="#Supplier.ChooseBestVehicle-1104"><span class="linenos">1104</span></a><span class="sd">            - Prints selection decision if verbose mode enabled</span>
</span><span id="Supplier.ChooseBestVehicle-1105"><a href="#Supplier.ChooseBestVehicle-1105"><span class="linenos">1105</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1106"><a href="#Supplier.ChooseBestVehicle-1106"><span class="linenos">1106</span></a><span class="sd">        Returns:</span>
</span><span id="Supplier.ChooseBestVehicle-1107"><a href="#Supplier.ChooseBestVehicle-1107"><span class="linenos">1107</span></a><span class="sd">            None. Completes after sending all confirmation/rejection messages.</span>
</span><span id="Supplier.ChooseBestVehicle-1108"><a href="#Supplier.ChooseBestVehicle-1108"><span class="linenos">1108</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1109"><a href="#Supplier.ChooseBestVehicle-1109"><span class="linenos">1109</span></a><span class="sd">        Example Execution:</span>
</span><span id="Supplier.ChooseBestVehicle-1110"><a href="#Supplier.ChooseBestVehicle-1110"><span class="linenos">1110</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ChooseBestVehicle-1111"><a href="#Supplier.ChooseBestVehicle-1111"><span class="linenos">1111</span></a><span class="sd">            Proposals Received:</span>
</span><span id="Supplier.ChooseBestVehicle-1112"><a href="#Supplier.ChooseBestVehicle-1112"><span class="linenos">1112</span></a><span class="sd">                - vehicle1: (can_fit=True, time=150)</span>
</span><span id="Supplier.ChooseBestVehicle-1113"><a href="#Supplier.ChooseBestVehicle-1113"><span class="linenos">1113</span></a><span class="sd">                - vehicle2: (can_fit=True, time=130)</span>
</span><span id="Supplier.ChooseBestVehicle-1114"><a href="#Supplier.ChooseBestVehicle-1114"><span class="linenos">1114</span></a><span class="sd">                - vehicle3: (can_fit=False, time=120)</span>
</span><span id="Supplier.ChooseBestVehicle-1115"><a href="#Supplier.ChooseBestVehicle-1115"><span class="linenos">1115</span></a><span class="sd">            </span>
</span><span id="Supplier.ChooseBestVehicle-1116"><a href="#Supplier.ChooseBestVehicle-1116"><span class="linenos">1116</span></a><span class="sd">            Evaluation:</span>
</span><span id="Supplier.ChooseBestVehicle-1117"><a href="#Supplier.ChooseBestVehicle-1117"><span class="linenos">1117</span></a><span class="sd">                - Filter: vehicle1, vehicle2 (can fit)</span>
</span><span id="Supplier.ChooseBestVehicle-1118"><a href="#Supplier.ChooseBestVehicle-1118"><span class="linenos">1118</span></a><span class="sd">                - Compare times: 130 &lt; 150</span>
</span><span id="Supplier.ChooseBestVehicle-1119"><a href="#Supplier.ChooseBestVehicle-1119"><span class="linenos">1119</span></a><span class="sd">                - Winner: vehicle2</span>
</span><span id="Supplier.ChooseBestVehicle-1120"><a href="#Supplier.ChooseBestVehicle-1120"><span class="linenos">1120</span></a><span class="sd">            </span>
</span><span id="Supplier.ChooseBestVehicle-1121"><a href="#Supplier.ChooseBestVehicle-1121"><span class="linenos">1121</span></a><span class="sd">            Actions:</span>
</span><span id="Supplier.ChooseBestVehicle-1122"><a href="#Supplier.ChooseBestVehicle-1122"><span class="linenos">1122</span></a><span class="sd">                - Send confirmation to vehicle2 (confirmed=true)</span>
</span><span id="Supplier.ChooseBestVehicle-1123"><a href="#Supplier.ChooseBestVehicle-1123"><span class="linenos">1123</span></a><span class="sd">                - Send rejection to vehicle1 (confirmed=false)</span>
</span><span id="Supplier.ChooseBestVehicle-1124"><a href="#Supplier.ChooseBestVehicle-1124"><span class="linenos">1124</span></a><span class="sd">                - Send rejection to vehicle3 (confirmed=false)</span>
</span><span id="Supplier.ChooseBestVehicle-1125"><a href="#Supplier.ChooseBestVehicle-1125"><span class="linenos">1125</span></a><span class="sd">            </span>
</span><span id="Supplier.ChooseBestVehicle-1126"><a href="#Supplier.ChooseBestVehicle-1126"><span class="linenos">1126</span></a><span class="sd">            Output:</span>
</span><span id="Supplier.ChooseBestVehicle-1127"><a href="#Supplier.ChooseBestVehicle-1127"><span class="linenos">1127</span></a><span class="sd">                - Print: &quot;Best vehicle selected: vehicle2@localhost&quot;</span>
</span><span id="Supplier.ChooseBestVehicle-1128"><a href="#Supplier.ChooseBestVehicle-1128"><span class="linenos">1128</span></a><span class="sd">            ```</span>
</span><span id="Supplier.ChooseBestVehicle-1129"><a href="#Supplier.ChooseBestVehicle-1129"><span class="linenos">1129</span></a><span class="sd">        </span>
</span><span id="Supplier.ChooseBestVehicle-1130"><a href="#Supplier.ChooseBestVehicle-1130"><span class="linenos">1130</span></a><span class="sd">        Note:</span>
</span><span id="Supplier.ChooseBestVehicle-1131"><a href="#Supplier.ChooseBestVehicle-1131"><span class="linenos">1131</span></a><span class="sd">            Unlike warehouse&#39;s version, this behaviour doesn&#39;t wait for proposals</span>
</span><span id="Supplier.ChooseBestVehicle-1132"><a href="#Supplier.ChooseBestVehicle-1132"><span class="linenos">1132</span></a><span class="sd">            as they are already collected by ReceiveVehicleProposals before this</span>
</span><span id="Supplier.ChooseBestVehicle-1133"><a href="#Supplier.ChooseBestVehicle-1133"><span class="linenos">1133</span></a><span class="sd">            behaviour is invoked.</span>
</span><span id="Supplier.ChooseBestVehicle-1134"><a href="#Supplier.ChooseBestVehicle-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.ChooseBestVehicle-1135"><a href="#Supplier.ChooseBestVehicle-1135"><span class="linenos">1135</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">):</span>
</span><span id="Supplier.ChooseBestVehicle-1136"><a href="#Supplier.ChooseBestVehicle-1136"><span class="linenos">1136</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier.ChooseBestVehicle-1137"><a href="#Supplier.ChooseBestVehicle-1137"><span class="linenos">1137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>
</span><span id="Supplier.ChooseBestVehicle-1138"><a href="#Supplier.ChooseBestVehicle-1138"><span class="linenos">1138</span></a>        
</span><span id="Supplier.ChooseBestVehicle-1139"><a href="#Supplier.ChooseBestVehicle-1139"><span class="linenos">1139</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_best_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposals</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1140"><a href="#Supplier.ChooseBestVehicle-1140"><span class="linenos">1140</span></a>            <span class="c1"># First filter vehicles that can fit the order</span>
</span><span id="Supplier.ChooseBestVehicle-1141"><a href="#Supplier.ChooseBestVehicle-1141"><span class="linenos">1141</span></a>            <span class="n">can_fit_vehicles</span> <span class="o">=</span> <span class="p">{</span><span class="n">jid</span><span class="p">:</span> <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="ow">in</span> <span class="n">proposals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">fit</span><span class="p">}</span>
</span><span id="Supplier.ChooseBestVehicle-1142"><a href="#Supplier.ChooseBestVehicle-1142"><span class="linenos">1142</span></a>
</span><span id="Supplier.ChooseBestVehicle-1143"><a href="#Supplier.ChooseBestVehicle-1143"><span class="linenos">1143</span></a>            <span class="k">if</span> <span class="n">can_fit_vehicles</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1144"><a href="#Supplier.ChooseBestVehicle-1144"><span class="linenos">1144</span></a>                <span class="c1"># If there are vehicles that can fit, choose the one with lowest delivery time</span>
</span><span id="Supplier.ChooseBestVehicle-1145"><a href="#Supplier.ChooseBestVehicle-1145"><span class="linenos">1145</span></a>                <span class="n">best_vehicle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">can_fit_vehicles</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Supplier.ChooseBestVehicle-1146"><a href="#Supplier.ChooseBestVehicle-1146"><span class="linenos">1146</span></a>                <span class="k">return</span> <span class="n">best_vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Supplier.ChooseBestVehicle-1147"><a href="#Supplier.ChooseBestVehicle-1147"><span class="linenos">1147</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1148"><a href="#Supplier.ChooseBestVehicle-1148"><span class="linenos">1148</span></a>                <span class="c1"># If no vehicles can fit, choose the one with lowest delivery time anyway</span>
</span><span id="Supplier.ChooseBestVehicle-1149"><a href="#Supplier.ChooseBestVehicle-1149"><span class="linenos">1149</span></a>                <span class="k">if</span> <span class="n">proposals</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1150"><a href="#Supplier.ChooseBestVehicle-1150"><span class="linenos">1150</span></a>                    <span class="n">best_vehicle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">proposals</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Supplier.ChooseBestVehicle-1151"><a href="#Supplier.ChooseBestVehicle-1151"><span class="linenos">1151</span></a>                    <span class="k">return</span> <span class="n">best_vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Supplier.ChooseBestVehicle-1152"><a href="#Supplier.ChooseBestVehicle-1152"><span class="linenos">1152</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Supplier.ChooseBestVehicle-1153"><a href="#Supplier.ChooseBestVehicle-1153"><span class="linenos">1153</span></a>        
</span><span id="Supplier.ChooseBestVehicle-1154"><a href="#Supplier.ChooseBestVehicle-1154"><span class="linenos">1154</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ChooseBestVehicle-1155"><a href="#Supplier.ChooseBestVehicle-1155"><span class="linenos">1155</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ChooseBestVehicle-1156"><a href="#Supplier.ChooseBestVehicle-1156"><span class="linenos">1156</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1157"><a href="#Supplier.ChooseBestVehicle-1157"><span class="linenos">1157</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Comparing vehicle proposals...&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1158"><a href="#Supplier.ChooseBestVehicle-1158"><span class="linenos">1158</span></a>            
</span><span id="Supplier.ChooseBestVehicle-1159"><a href="#Supplier.ChooseBestVehicle-1159"><span class="linenos">1159</span></a>            <span class="c1"># Verificar se a entrada para este order_id existe, se no criar</span>
</span><span id="Supplier.ChooseBestVehicle-1160"><a href="#Supplier.ChooseBestVehicle-1160"><span class="linenos">1160</span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1161"><a href="#Supplier.ChooseBestVehicle-1161"><span class="linenos">1161</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier.ChooseBestVehicle-1162"><a href="#Supplier.ChooseBestVehicle-1162"><span class="linenos">1162</span></a>            
</span><span id="Supplier.ChooseBestVehicle-1163"><a href="#Supplier.ChooseBestVehicle-1163"><span class="linenos">1163</span></a>            <span class="n">order_proposals</span> <span class="o">=</span>  <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span>
</span><span id="Supplier.ChooseBestVehicle-1164"><a href="#Supplier.ChooseBestVehicle-1164"><span class="linenos">1164</span></a>            <span class="n">proposals</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span> <span class="c1"># vehicle_jid : (can_fit, time)</span>
</span><span id="Supplier.ChooseBestVehicle-1165"><a href="#Supplier.ChooseBestVehicle-1165"><span class="linenos">1165</span></a>            
</span><span id="Supplier.ChooseBestVehicle-1166"><a href="#Supplier.ChooseBestVehicle-1166"><span class="linenos">1166</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1167"><a href="#Supplier.ChooseBestVehicle-1167"><span class="linenos">1167</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Total proposals received: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">proposals</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1168"><a href="#Supplier.ChooseBestVehicle-1168"><span class="linenos">1168</span></a>            <span class="n">best_vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_vehicle</span><span class="p">(</span><span class="n">proposals</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1169"><a href="#Supplier.ChooseBestVehicle-1169"><span class="linenos">1169</span></a>            
</span><span id="Supplier.ChooseBestVehicle-1170"><a href="#Supplier.ChooseBestVehicle-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="n">best_vehicle</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1171"><a href="#Supplier.ChooseBestVehicle-1171"><span class="linenos">1171</span></a>                <span class="c1"># Essential print - vehicle assigned</span>
</span><span id="Supplier.ChooseBestVehicle-1172"><a href="#Supplier.ChooseBestVehicle-1172"><span class="linenos">1172</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle assigned: </span><span class="si">{</span><span class="n">best_vehicle</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1173"><a href="#Supplier.ChooseBestVehicle-1173"><span class="linenos">1173</span></a>                
</span><span id="Supplier.ChooseBestVehicle-1174"><a href="#Supplier.ChooseBestVehicle-1174"><span class="linenos">1174</span></a>                <span class="c1"># Send confirmation to the selected vehicle</span>
</span><span id="Supplier.ChooseBestVehicle-1175"><a href="#Supplier.ChooseBestVehicle-1175"><span class="linenos">1175</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">best_vehicle</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1176"><a href="#Supplier.ChooseBestVehicle-1176"><span class="linenos">1176</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-confirmation&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1177"><a href="#Supplier.ChooseBestVehicle-1177"><span class="linenos">1177</span></a>                
</span><span id="Supplier.ChooseBestVehicle-1178"><a href="#Supplier.ChooseBestVehicle-1178"><span class="linenos">1178</span></a>                <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">]</span>
</span><span id="Supplier.ChooseBestVehicle-1179"><a href="#Supplier.ChooseBestVehicle-1179"><span class="linenos">1179</span></a>                <span class="n">order_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier.ChooseBestVehicle-1180"><a href="#Supplier.ChooseBestVehicle-1180"><span class="linenos">1180</span></a>                    <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">,</span>
</span><span id="Supplier.ChooseBestVehicle-1181"><a href="#Supplier.ChooseBestVehicle-1181"><span class="linenos">1181</span></a>                    <span class="s2">&quot;confirmed&quot;</span> <span class="p">:</span> <span class="kc">True</span>
</span><span id="Supplier.ChooseBestVehicle-1182"><a href="#Supplier.ChooseBestVehicle-1182"><span class="linenos">1182</span></a>                <span class="p">}</span>
</span><span id="Supplier.ChooseBestVehicle-1183"><a href="#Supplier.ChooseBestVehicle-1183"><span class="linenos">1183</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order_data</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1184"><a href="#Supplier.ChooseBestVehicle-1184"><span class="linenos">1184</span></a>                
</span><span id="Supplier.ChooseBestVehicle-1185"><a href="#Supplier.ChooseBestVehicle-1185"><span class="linenos">1185</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1186"><a href="#Supplier.ChooseBestVehicle-1186"><span class="linenos">1186</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1187"><a href="#Supplier.ChooseBestVehicle-1187"><span class="linenos">1187</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Confirmation sent to </span><span class="si">{</span><span class="n">best_vehicle</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1188"><a href="#Supplier.ChooseBestVehicle-1188"><span class="linenos">1188</span></a>                
</span><span id="Supplier.ChooseBestVehicle-1189"><a href="#Supplier.ChooseBestVehicle-1189"><span class="linenos">1189</span></a>                <span class="c1"># Send rejection to all other vehicles</span>
</span><span id="Supplier.ChooseBestVehicle-1190"><a href="#Supplier.ChooseBestVehicle-1190"><span class="linenos">1190</span></a>                <span class="n">rejected_vehicles</span> <span class="o">=</span> <span class="p">[</span><span class="n">jid</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">proposals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">jid</span> <span class="o">!=</span> <span class="n">best_vehicle</span><span class="p">]</span>
</span><span id="Supplier.ChooseBestVehicle-1191"><a href="#Supplier.ChooseBestVehicle-1191"><span class="linenos">1191</span></a>                <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">rejected_vehicles</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1192"><a href="#Supplier.ChooseBestVehicle-1192"><span class="linenos">1192</span></a>                    <span class="n">reject_msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1193"><a href="#Supplier.ChooseBestVehicle-1193"><span class="linenos">1193</span></a>                    <span class="n">reject_msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-confirmation&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1194"><a href="#Supplier.ChooseBestVehicle-1194"><span class="linenos">1194</span></a>                    
</span><span id="Supplier.ChooseBestVehicle-1195"><a href="#Supplier.ChooseBestVehicle-1195"><span class="linenos">1195</span></a>                    <span class="n">reject_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier.ChooseBestVehicle-1196"><a href="#Supplier.ChooseBestVehicle-1196"><span class="linenos">1196</span></a>                    <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">,</span>
</span><span id="Supplier.ChooseBestVehicle-1197"><a href="#Supplier.ChooseBestVehicle-1197"><span class="linenos">1197</span></a>                    <span class="s2">&quot;confirmed&quot;</span> <span class="p">:</span> <span class="kc">False</span>
</span><span id="Supplier.ChooseBestVehicle-1198"><a href="#Supplier.ChooseBestVehicle-1198"><span class="linenos">1198</span></a>                    <span class="p">}</span>
</span><span id="Supplier.ChooseBestVehicle-1199"><a href="#Supplier.ChooseBestVehicle-1199"><span class="linenos">1199</span></a>                    
</span><span id="Supplier.ChooseBestVehicle-1200"><a href="#Supplier.ChooseBestVehicle-1200"><span class="linenos">1200</span></a>                    <span class="n">reject_msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">reject_data</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1201"><a href="#Supplier.ChooseBestVehicle-1201"><span class="linenos">1201</span></a>                    
</span><span id="Supplier.ChooseBestVehicle-1202"><a href="#Supplier.ChooseBestVehicle-1202"><span class="linenos">1202</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">reject_msg</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1203"><a href="#Supplier.ChooseBestVehicle-1203"><span class="linenos">1203</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1204"><a href="#Supplier.ChooseBestVehicle-1204"><span class="linenos">1204</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Rejection sent to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle-1205"><a href="#Supplier.ChooseBestVehicle-1205"><span class="linenos">1205</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle-1206"><a href="#Supplier.ChooseBestVehicle-1206"><span class="linenos">1206</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No vehicles available to assign!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Behaviour that evaluates vehicle proposals and selects optimal vehicle for supplier delivery.</p>

<p>This behaviour implements the proposal evaluation and winner selection phase of
vehicle assignment for supplier-to-warehouse deliveries. After collecting all
vehicle proposals via ReceiveVehicleProposals, this behaviour compares them based
on capacity and delivery time, then notifies the selected vehicle and rejects all others.</p>

<h6 id="selection-algorithm">Selection Algorithm:</h6>

<blockquote>
  <ol>
  <li><strong>Priority 1</strong>: Filter vehicles that can fit the order (can_fit=True)</li>
  <li><strong>Priority 2</strong>: Among fitting vehicles, select one with minimum delivery_time</li>
  <li><strong>Fallback</strong>: If no vehicles can fit, select vehicle with minimum delivery_time anyway</li>
  </ol>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>request_id (int):</strong>  Unique order identifier to find proposals.</li>
</ul>

<h6 id="workflow">Workflow:</h6>

<blockquote>
  <ol>
  <li><strong>Retrieve Proposals</strong>: Get all proposals for this request_id</li>
  <li><strong>Evaluate Proposals</strong>: Call get_best_vehicle() to select winner</li>
  <li><strong>Send Confirmation</strong>: Notify selected vehicle with order-confirmation</li>
  <li><strong>Send Rejections</strong>: Notify all other vehicles they were not selected</li>
  </ol>
</blockquote>

<p>Message Format (Confirmation):
    Metadata:
        - performative: "order-confirmation"
    Body (JSON):</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;orderid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3001000000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;confirmed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="p">}</span>
</code></pre>
</div>
</code></pre>

<p>Message Format (Rejection):
    Metadata:
        - performative: "order-confirmation"
    Body (JSON):</p>

<pre><code>    <div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;orderid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3001000000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;confirmed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre>
</div>
</code></pre>

<h6 id="side-effects">Side Effects:</h6>

<blockquote>
  <ul>
  <li>Reads from agent.vehicle_proposals dictionary</li>
  <li>Reads from agent.pending_deliveries for Order object</li>
  <li>Sends confirmation message to selected vehicle</li>
  <li>Sends rejection messages to non-selected vehicles</li>
  <li>Prints selection decision if verbose mode enabled</li>
  </ul>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None. Completes after sending all confirmation/rejection messages.</p>
</blockquote>

<h6 id="example-execution">Example Execution:</h6>

<blockquote>
<pre><code>Proposals Received:
    - vehicle1: (can_fit=True, time=150)
    - vehicle2: (can_fit=True, time=130)
    - vehicle3: (can_fit=False, time=120)

Evaluation:
    - Filter: vehicle1, vehicle2 (can fit)
    - Compare times: 130 &lt; 150
    - Winner: vehicle2

Actions:
    - Send confirmation to vehicle2 (confirmed=true)
    - Send rejection to vehicle1 (confirmed=false)
    - Send rejection to vehicle3 (confirmed=false)

Output:
    - Print: "Best vehicle selected: vehicle2@localhost"
</code></pre>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Unlike warehouse's version, this behaviour doesn't wait for proposals
  as they are already collected by ReceiveVehicleProposals before this
  behaviour is invoked.</p>
</blockquote>
</div>


                            <div id="Supplier.ChooseBestVehicle.__init__" class="classattr">
                                        <input id="Supplier.ChooseBestVehicle.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Supplier.ChooseBestVehicle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">request_id</span></span>)</span>

                <label class="view-source-button" for="Supplier.ChooseBestVehicle.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ChooseBestVehicle.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ChooseBestVehicle.__init__-1135"><a href="#Supplier.ChooseBestVehicle.__init__-1135"><span class="linenos">1135</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">):</span>
</span><span id="Supplier.ChooseBestVehicle.__init__-1136"><a href="#Supplier.ChooseBestVehicle.__init__-1136"><span class="linenos">1136</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="Supplier.ChooseBestVehicle.__init__-1137"><a href="#Supplier.ChooseBestVehicle.__init__-1137"><span class="linenos">1137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">=</span> <span class="n">request_id</span>
</span></pre></div>


    

                            </div>
                            <div id="Supplier.ChooseBestVehicle.request_id" class="classattr">
                                <div class="attr variable">
            <span class="name">request_id</span>

        
    </div>
    <a class="headerlink" href="#Supplier.ChooseBestVehicle.request_id"></a>
    
    

                            </div>
                            <div id="Supplier.ChooseBestVehicle.get_best_vehicle" class="classattr">
                                        <input id="Supplier.ChooseBestVehicle.get_best_vehicle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_best_vehicle</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">proposals</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Supplier.ChooseBestVehicle.get_best_vehicle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ChooseBestVehicle.get_best_vehicle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1139"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1139"><span class="linenos">1139</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">get_best_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proposals</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1140"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1140"><span class="linenos">1140</span></a>            <span class="c1"># First filter vehicles that can fit the order</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1141"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1141"><span class="linenos">1141</span></a>            <span class="n">can_fit_vehicles</span> <span class="o">=</span> <span class="p">{</span><span class="n">jid</span><span class="p">:</span> <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="k">for</span> <span class="n">jid</span><span class="p">,</span> <span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span> <span class="ow">in</span> <span class="n">proposals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">fit</span><span class="p">}</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1142"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1142"><span class="linenos">1142</span></a>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1143"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1143"><span class="linenos">1143</span></a>            <span class="k">if</span> <span class="n">can_fit_vehicles</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1144"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1144"><span class="linenos">1144</span></a>                <span class="c1"># If there are vehicles that can fit, choose the one with lowest delivery time</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1145"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1145"><span class="linenos">1145</span></a>                <span class="n">best_vehicle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">can_fit_vehicles</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1146"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1146"><span class="linenos">1146</span></a>                <span class="k">return</span> <span class="n">best_vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1147"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1147"><span class="linenos">1147</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1148"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1148"><span class="linenos">1148</span></a>                <span class="c1"># If no vehicles can fit, choose the one with lowest delivery time anyway</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1149"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1149"><span class="linenos">1149</span></a>                <span class="k">if</span> <span class="n">proposals</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1150"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1150"><span class="linenos">1150</span></a>                    <span class="n">best_vehicle</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">proposals</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1151"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1151"><span class="linenos">1151</span></a>                    <span class="k">return</span> <span class="n">best_vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Supplier.ChooseBestVehicle.get_best_vehicle-1152"><a href="#Supplier.ChooseBestVehicle.get_best_vehicle-1152"><span class="linenos">1152</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


    

                            </div>
                            <div id="Supplier.ChooseBestVehicle.run" class="classattr">
                                        <input id="Supplier.ChooseBestVehicle.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.ChooseBestVehicle.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ChooseBestVehicle.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ChooseBestVehicle.run-1154"><a href="#Supplier.ChooseBestVehicle.run-1154"><span class="linenos">1154</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ChooseBestVehicle.run-1155"><a href="#Supplier.ChooseBestVehicle.run-1155"><span class="linenos">1155</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ChooseBestVehicle.run-1156"><a href="#Supplier.ChooseBestVehicle.run-1156"><span class="linenos">1156</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.run-1157"><a href="#Supplier.ChooseBestVehicle.run-1157"><span class="linenos">1157</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Comparing vehicle proposals...&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1158"><a href="#Supplier.ChooseBestVehicle.run-1158"><span class="linenos">1158</span></a>            
</span><span id="Supplier.ChooseBestVehicle.run-1159"><a href="#Supplier.ChooseBestVehicle.run-1159"><span class="linenos">1159</span></a>            <span class="c1"># Verificar se a entrada para este order_id existe, se no criar</span>
</span><span id="Supplier.ChooseBestVehicle.run-1160"><a href="#Supplier.ChooseBestVehicle.run-1160"><span class="linenos">1160</span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.run-1161"><a href="#Supplier.ChooseBestVehicle.run-1161"><span class="linenos">1161</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Supplier.ChooseBestVehicle.run-1162"><a href="#Supplier.ChooseBestVehicle.run-1162"><span class="linenos">1162</span></a>            
</span><span id="Supplier.ChooseBestVehicle.run-1163"><a href="#Supplier.ChooseBestVehicle.run-1163"><span class="linenos">1163</span></a>            <span class="n">order_proposals</span> <span class="o">=</span>  <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span>
</span><span id="Supplier.ChooseBestVehicle.run-1164"><a href="#Supplier.ChooseBestVehicle.run-1164"><span class="linenos">1164</span></a>            <span class="n">proposals</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">vehicle_proposals</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">)]</span> <span class="c1"># vehicle_jid : (can_fit, time)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1165"><a href="#Supplier.ChooseBestVehicle.run-1165"><span class="linenos">1165</span></a>            
</span><span id="Supplier.ChooseBestVehicle.run-1166"><a href="#Supplier.ChooseBestVehicle.run-1166"><span class="linenos">1166</span></a>            <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.run-1167"><a href="#Supplier.ChooseBestVehicle.run-1167"><span class="linenos">1167</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Total proposals received: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">proposals</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1168"><a href="#Supplier.ChooseBestVehicle.run-1168"><span class="linenos">1168</span></a>            <span class="n">best_vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_vehicle</span><span class="p">(</span><span class="n">proposals</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1169"><a href="#Supplier.ChooseBestVehicle.run-1169"><span class="linenos">1169</span></a>            
</span><span id="Supplier.ChooseBestVehicle.run-1170"><a href="#Supplier.ChooseBestVehicle.run-1170"><span class="linenos">1170</span></a>            <span class="k">if</span> <span class="n">best_vehicle</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.run-1171"><a href="#Supplier.ChooseBestVehicle.run-1171"><span class="linenos">1171</span></a>                <span class="c1"># Essential print - vehicle assigned</span>
</span><span id="Supplier.ChooseBestVehicle.run-1172"><a href="#Supplier.ChooseBestVehicle.run-1172"><span class="linenos">1172</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt; Vehicle assigned: </span><span class="si">{</span><span class="n">best_vehicle</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1173"><a href="#Supplier.ChooseBestVehicle.run-1173"><span class="linenos">1173</span></a>                
</span><span id="Supplier.ChooseBestVehicle.run-1174"><a href="#Supplier.ChooseBestVehicle.run-1174"><span class="linenos">1174</span></a>                <span class="c1"># Send confirmation to the selected vehicle</span>
</span><span id="Supplier.ChooseBestVehicle.run-1175"><a href="#Supplier.ChooseBestVehicle.run-1175"><span class="linenos">1175</span></a>                <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">best_vehicle</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1176"><a href="#Supplier.ChooseBestVehicle.run-1176"><span class="linenos">1176</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-confirmation&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1177"><a href="#Supplier.ChooseBestVehicle.run-1177"><span class="linenos">1177</span></a>                
</span><span id="Supplier.ChooseBestVehicle.run-1178"><a href="#Supplier.ChooseBestVehicle.run-1178"><span class="linenos">1178</span></a>                <span class="n">order</span> <span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">pending_deliveries</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="p">]</span>
</span><span id="Supplier.ChooseBestVehicle.run-1179"><a href="#Supplier.ChooseBestVehicle.run-1179"><span class="linenos">1179</span></a>                <span class="n">order_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier.ChooseBestVehicle.run-1180"><a href="#Supplier.ChooseBestVehicle.run-1180"><span class="linenos">1180</span></a>                    <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">,</span>
</span><span id="Supplier.ChooseBestVehicle.run-1181"><a href="#Supplier.ChooseBestVehicle.run-1181"><span class="linenos">1181</span></a>                    <span class="s2">&quot;confirmed&quot;</span> <span class="p">:</span> <span class="kc">True</span>
</span><span id="Supplier.ChooseBestVehicle.run-1182"><a href="#Supplier.ChooseBestVehicle.run-1182"><span class="linenos">1182</span></a>                <span class="p">}</span>
</span><span id="Supplier.ChooseBestVehicle.run-1183"><a href="#Supplier.ChooseBestVehicle.run-1183"><span class="linenos">1183</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order_data</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1184"><a href="#Supplier.ChooseBestVehicle.run-1184"><span class="linenos">1184</span></a>                
</span><span id="Supplier.ChooseBestVehicle.run-1185"><a href="#Supplier.ChooseBestVehicle.run-1185"><span class="linenos">1185</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1186"><a href="#Supplier.ChooseBestVehicle.run-1186"><span class="linenos">1186</span></a>                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.run-1187"><a href="#Supplier.ChooseBestVehicle.run-1187"><span class="linenos">1187</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Confirmation sent to </span><span class="si">{</span><span class="n">best_vehicle</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1188"><a href="#Supplier.ChooseBestVehicle.run-1188"><span class="linenos">1188</span></a>                
</span><span id="Supplier.ChooseBestVehicle.run-1189"><a href="#Supplier.ChooseBestVehicle.run-1189"><span class="linenos">1189</span></a>                <span class="c1"># Send rejection to all other vehicles</span>
</span><span id="Supplier.ChooseBestVehicle.run-1190"><a href="#Supplier.ChooseBestVehicle.run-1190"><span class="linenos">1190</span></a>                <span class="n">rejected_vehicles</span> <span class="o">=</span> <span class="p">[</span><span class="n">jid</span> <span class="k">for</span> <span class="n">jid</span> <span class="ow">in</span> <span class="n">proposals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">jid</span> <span class="o">!=</span> <span class="n">best_vehicle</span><span class="p">]</span>
</span><span id="Supplier.ChooseBestVehicle.run-1191"><a href="#Supplier.ChooseBestVehicle.run-1191"><span class="linenos">1191</span></a>                <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="n">rejected_vehicles</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.run-1192"><a href="#Supplier.ChooseBestVehicle.run-1192"><span class="linenos">1192</span></a>                    <span class="n">reject_msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1193"><a href="#Supplier.ChooseBestVehicle.run-1193"><span class="linenos">1193</span></a>                    <span class="n">reject_msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;order-confirmation&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1194"><a href="#Supplier.ChooseBestVehicle.run-1194"><span class="linenos">1194</span></a>                    
</span><span id="Supplier.ChooseBestVehicle.run-1195"><a href="#Supplier.ChooseBestVehicle.run-1195"><span class="linenos">1195</span></a>                    <span class="n">reject_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Supplier.ChooseBestVehicle.run-1196"><a href="#Supplier.ChooseBestVehicle.run-1196"><span class="linenos">1196</span></a>                    <span class="s2">&quot;orderid&quot;</span> <span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">orderid</span><span class="p">,</span>
</span><span id="Supplier.ChooseBestVehicle.run-1197"><a href="#Supplier.ChooseBestVehicle.run-1197"><span class="linenos">1197</span></a>                    <span class="s2">&quot;confirmed&quot;</span> <span class="p">:</span> <span class="kc">False</span>
</span><span id="Supplier.ChooseBestVehicle.run-1198"><a href="#Supplier.ChooseBestVehicle.run-1198"><span class="linenos">1198</span></a>                    <span class="p">}</span>
</span><span id="Supplier.ChooseBestVehicle.run-1199"><a href="#Supplier.ChooseBestVehicle.run-1199"><span class="linenos">1199</span></a>                    
</span><span id="Supplier.ChooseBestVehicle.run-1200"><a href="#Supplier.ChooseBestVehicle.run-1200"><span class="linenos">1200</span></a>                    <span class="n">reject_msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">reject_data</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1201"><a href="#Supplier.ChooseBestVehicle.run-1201"><span class="linenos">1201</span></a>                    
</span><span id="Supplier.ChooseBestVehicle.run-1202"><a href="#Supplier.ChooseBestVehicle.run-1202"><span class="linenos">1202</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">reject_msg</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1203"><a href="#Supplier.ChooseBestVehicle.run-1203"><span class="linenos">1203</span></a>                    <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.run-1204"><a href="#Supplier.ChooseBestVehicle.run-1204"><span class="linenos">1204</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  Rejection sent to </span><span class="si">{</span><span class="n">vehicle_jid</span><span class="si">}</span><span class="s2"> for order </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">request_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Supplier.ChooseBestVehicle.run-1205"><a href="#Supplier.ChooseBestVehicle.run-1205"><span class="linenos">1205</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Supplier.ChooseBestVehicle.run-1206"><a href="#Supplier.ChooseBestVehicle.run-1206"><span class="linenos">1206</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="si">}</span><span class="s2">&gt;  No vehicles available to assign!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
                <section id="Supplier.ReceiveTimeDelta">
                            <input id="Supplier.ReceiveTimeDelta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Supplier.ReceiveTimeDelta</span><wbr>(<span class="base">spade.behaviour.CyclicBehaviour</span>):

                <label class="view-source-button" for="Supplier.ReceiveTimeDelta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveTimeDelta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveTimeDelta-1208"><a href="#Supplier.ReceiveTimeDelta-1208"><span class="linenos">1208</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveTimeDelta</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="Supplier.ReceiveTimeDelta-1209"><a href="#Supplier.ReceiveTimeDelta-1209"><span class="linenos">1209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveTimeDelta-1210"><a href="#Supplier.ReceiveTimeDelta-1210"><span class="linenos">1210</span></a><span class="sd">        Cyclic behaviour that synchronizes simulation time and applies traffic updates.</span>
</span><span id="Supplier.ReceiveTimeDelta-1211"><a href="#Supplier.ReceiveTimeDelta-1211"><span class="linenos">1211</span></a><span class="sd">        </span>
</span><span id="Supplier.ReceiveTimeDelta-1212"><a href="#Supplier.ReceiveTimeDelta-1212"><span class="linenos">1212</span></a><span class="sd">        Receives time delta messages from world agent, updates current_tick, and</span>
</span><span id="Supplier.ReceiveTimeDelta-1213"><a href="#Supplier.ReceiveTimeDelta-1213"><span class="linenos">1213</span></a><span class="sd">        applies dynamic graph edge weight changes for traffic simulation.</span>
</span><span id="Supplier.ReceiveTimeDelta-1214"><a href="#Supplier.ReceiveTimeDelta-1214"><span class="linenos">1214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Supplier.ReceiveTimeDelta-1215"><a href="#Supplier.ReceiveTimeDelta-1215"><span class="linenos">1215</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveTimeDelta-1216"><a href="#Supplier.ReceiveTimeDelta-1216"><span class="linenos">1216</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceiveTimeDelta-1217"><a href="#Supplier.ReceiveTimeDelta-1217"><span class="linenos">1217</span></a>            
</span><span id="Supplier.ReceiveTimeDelta-1218"><a href="#Supplier.ReceiveTimeDelta-1218"><span class="linenos">1218</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier.ReceiveTimeDelta-1219"><a href="#Supplier.ReceiveTimeDelta-1219"><span class="linenos">1219</span></a>            
</span><span id="Supplier.ReceiveTimeDelta-1220"><a href="#Supplier.ReceiveTimeDelta-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier.ReceiveTimeDelta-1221"><a href="#Supplier.ReceiveTimeDelta-1221"><span class="linenos">1221</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier.ReceiveTimeDelta-1222"><a href="#Supplier.ReceiveTimeDelta-1222"><span class="linenos">1222</span></a>                
</span><span id="Supplier.ReceiveTimeDelta-1223"><a href="#Supplier.ReceiveTimeDelta-1223"><span class="linenos">1223</span></a>                <span class="nb">type</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveTimeDelta-1224"><a href="#Supplier.ReceiveTimeDelta-1224"><span class="linenos">1224</span></a>                <span class="n">delta</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveTimeDelta-1225"><a href="#Supplier.ReceiveTimeDelta-1225"><span class="linenos">1225</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">current_tick</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="Supplier.ReceiveTimeDelta-1226"><a href="#Supplier.ReceiveTimeDelta-1226"><span class="linenos">1226</span></a>                
</span><span id="Supplier.ReceiveTimeDelta-1227"><a href="#Supplier.ReceiveTimeDelta-1227"><span class="linenos">1227</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="Supplier.ReceiveTimeDelta-1228"><a href="#Supplier.ReceiveTimeDelta-1228"><span class="linenos">1228</span></a>                    <span class="n">map_updates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> 
</span><span id="Supplier.ReceiveTimeDelta-1229"><a href="#Supplier.ReceiveTimeDelta-1229"><span class="linenos">1229</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update_graph</span><span class="p">(</span><span class="n">map_updates</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cyclic behaviour that synchronizes simulation time and applies traffic updates.</p>

<p>Receives time delta messages from world agent, updates current_tick, and
applies dynamic graph edge weight changes for traffic simulation.</p>
</div>


                            <div id="Supplier.ReceiveTimeDelta.run" class="classattr">
                                        <input id="Supplier.ReceiveTimeDelta.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Supplier.ReceiveTimeDelta.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Supplier.ReceiveTimeDelta.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Supplier.ReceiveTimeDelta.run-1215"><a href="#Supplier.ReceiveTimeDelta.run-1215"><span class="linenos">1215</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1216"><a href="#Supplier.ReceiveTimeDelta.run-1216"><span class="linenos">1216</span></a>            <span class="n">agent</span> <span class="p">:</span> <span class="n">Supplier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1217"><a href="#Supplier.ReceiveTimeDelta.run-1217"><span class="linenos">1217</span></a>            
</span><span id="Supplier.ReceiveTimeDelta.run-1218"><a href="#Supplier.ReceiveTimeDelta.run-1218"><span class="linenos">1218</span></a>            <span class="n">msg</span> <span class="p">:</span> <span class="n">Message</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1219"><a href="#Supplier.ReceiveTimeDelta.run-1219"><span class="linenos">1219</span></a>            
</span><span id="Supplier.ReceiveTimeDelta.run-1220"><a href="#Supplier.ReceiveTimeDelta.run-1220"><span class="linenos">1220</span></a>            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1221"><a href="#Supplier.ReceiveTimeDelta.run-1221"><span class="linenos">1221</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1222"><a href="#Supplier.ReceiveTimeDelta.run-1222"><span class="linenos">1222</span></a>                
</span><span id="Supplier.ReceiveTimeDelta.run-1223"><a href="#Supplier.ReceiveTimeDelta.run-1223"><span class="linenos">1223</span></a>                <span class="nb">type</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1224"><a href="#Supplier.ReceiveTimeDelta.run-1224"><span class="linenos">1224</span></a>                <span class="n">delta</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1225"><a href="#Supplier.ReceiveTimeDelta.run-1225"><span class="linenos">1225</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">current_tick</span> <span class="o">+=</span> <span class="n">delta</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1226"><a href="#Supplier.ReceiveTimeDelta.run-1226"><span class="linenos">1226</span></a>                
</span><span id="Supplier.ReceiveTimeDelta.run-1227"><a href="#Supplier.ReceiveTimeDelta.run-1227"><span class="linenos">1227</span></a>                <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="Supplier.ReceiveTimeDelta.run-1228"><a href="#Supplier.ReceiveTimeDelta.run-1228"><span class="linenos">1228</span></a>                    <span class="n">map_updates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> 
</span><span id="Supplier.ReceiveTimeDelta.run-1229"><a href="#Supplier.ReceiveTimeDelta.run-1229"><span class="linenos">1229</span></a>                <span class="n">agent</span><span class="o">.</span><span class="n">update_graph</span><span class="p">(</span><span class="n">map_updates</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Body of the behaviour.
To be implemented by user.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>