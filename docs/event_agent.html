<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>event_agent API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Event">Event</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Event.__init__">Event</a>
                        </li>
                        <li>
                                <a class="variable" href="#Event.event_type">event_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#Event.time">time</a>
                        </li>
                        <li>
                                <a class="variable" href="#Event.data">data</a>
                        </li>
                        <li>
                                <a class="variable" href="#Event.sender">sender</a>
                        </li>
                        <li>
                                <a class="function" href="#Event.to_dict">to_dict</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#EventDrivenAgent">EventDrivenAgent</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EventDrivenAgent.__init__">EventDrivenAgent</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.event_heap">event_heap</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.transit_events">transit_events</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.arrival_events">arrival_events</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.simulation_interval">simulation_interval</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.registered_vehicles">registered_vehicles</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.registered_warehouses">registered_warehouses</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.registered_stores">registered_stores</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.registered_suppliers">registered_suppliers</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.world_agent">world_agent</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.world_simulation_time">world_simulation_time</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.event_count">event_count</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.processed_count">processed_count</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.last_simulation_time">last_simulation_time</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.time_simulated">time_simulated</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.verbose">verbose</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.first_arrival_received">first_arrival_received</a>
                        </li>
                        <li>
                                <a class="variable" href="#EventDrivenAgent.initial_signal_behaviour">initial_signal_behaviour</a>
                        </li>
                        <li>
                                <a class="function" href="#EventDrivenAgent.setup">setup</a>
                        </li>
                        <li>
                                <a class="class" href="#EventDrivenAgent.RegisterTransitBehaviour">EventDrivenAgent.RegisterTransitBehaviour</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#EventDrivenAgent.RegisterTransitBehaviour.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#EventDrivenAgent.SendInitialSignalBehaviour">EventDrivenAgent.SendInitialSignalBehaviour</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#EventDrivenAgent.SendInitialSignalBehaviour.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#EventDrivenAgent.ReceiveEventsBehaviour">EventDrivenAgent.ReceiveEventsBehaviour</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#EventDrivenAgent.ReceiveEventsBehaviour.run">run</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#EventDrivenAgent.ProcessEventsBehaviour">EventDrivenAgent.ProcessEventsBehaviour</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#EventDrivenAgent.ProcessEventsBehaviour.run">run</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events">notify_events</a>
                                    </li>
                            </ul>

                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
event_agent    </h1>

                        <div class="docstring"><p>Event-driven agent system for supply chain simulation.</p>

<p>This module implements an event management system based on temporal priorities,
using a min heap data structure to efficiently order and process events.
The agent is responsible for receiving, storing, and distributing events related to
supply chain simulation, including vehicle arrival events, traffic changes, and other
temporal occurrences.</p>

<p>The system follows FIPA (Foundation for Intelligent Physical Agents) standards for
agent communication, utilizing XMPP as the transport protocol and ACL (Agent Communication
Language) performatives for message semantics.</p>

<h6 id="classes">Classes:</h6>

<blockquote>
  <p>Event: Represents an individual event with type, time, and associated data.
  EventDrivenAgent: SPADE agent that manages the event heap and processes periodically.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <ul>
  <li>Uses FIPA ACL performatives (inform, request) in message metadata</li>
  <li>Follows FIPA interaction protocols for agent communication</li>
  <li>Implements presence-based subscription model for agent discovery</li>
  <li>Uses XMPP (Extensible Messaging and Presence Protocol) as transport layer</li>
  </ul>
</blockquote>

<h6 id="dependencies">Dependencies:</h6>

<blockquote>
  <ul>
  <li>asyncio: Asynchronous I/O operations</li>
  <li>heapq: Heap data structure for efficient ordering</li>
  <li>json: Message serialization</li>
  <li>typing: Type annotations</li>
  <li>spade: Multi-agent system framework</li>
  </ul>
</blockquote>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create and start an event-driven agent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">event_agent</span> <span class="o">=</span> <span class="n">EventDrivenAgent</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;event_agent@localhost&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">simulation_interval</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">registered_vehicles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;vehicle1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_warehouses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;warehouse1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_stores</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;store1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_suppliers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;supplier1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">world_agent</span><span class="o">=</span><span class="s2">&quot;world@localhost&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">world_simulation_time</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">await</span> <span class="n">event_agent</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>This module requires a running XMPP server (e.g., Openfire, Prosody, ejabberd)
  and properly registered agent accounts for communication.</p>
</blockquote>

<h6 id="version">Version:</h6>

<blockquote>
  <p>1.0.0</p>
</blockquote>

<h6 id="author">Author:</h6>

<blockquote>
  <p>Supply Chain Optimization Team</p>
</blockquote>
</div>

                        <input id="mod-event_agent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-event_agent-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;Event-driven agent system for supply chain simulation.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">This module implements an event management system based on temporal priorities,</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">using a min heap data structure to efficiently order and process events.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">The agent is responsible for receiving, storing, and distributing events related to</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">supply chain simulation, including vehicle arrival events, traffic changes, and other</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">temporal occurrences.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">The system follows FIPA (Foundation for Intelligent Physical Agents) standards for</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">agent communication, utilizing XMPP as the transport protocol and ACL (Agent Communication</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">Language) performatives for message semantics.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">Classes:</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="sd">    Event: Represents an individual event with type, time, and associated data.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">    EventDrivenAgent: SPADE agent that manages the event heap and processes periodically.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">FIPA Compliance:</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">    - Uses FIPA ACL performatives (inform, request) in message metadata</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">    - Follows FIPA interaction protocols for agent communication</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">    - Implements presence-based subscription model for agent discovery</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">    - Uses XMPP (Extensible Messaging and Presence Protocol) as transport layer</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">Dependencies:</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">    - asyncio: Asynchronous I/O operations</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">    - heapq: Heap data structure for efficient ordering</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">    - json: Message serialization</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">    - typing: Type annotations</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">    - spade: Multi-agent system framework</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">Examples:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    &gt;&gt;&gt; # Create and start an event-driven agent</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">    &gt;&gt;&gt; event_agent = EventDrivenAgent(</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    ...     jid=&quot;event_agent@localhost&quot;,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">    ...     password=&quot;password&quot;,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    ...     simulation_interval=5.0,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">    ...     registered_vehicles=[&quot;vehicle1@localhost&quot;],</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">    ...     registered_warehouses=[&quot;warehouse1@localhost&quot;],</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">    ...     registered_stores=[&quot;store1@localhost&quot;],</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">    ...     registered_suppliers=[&quot;supplier1@localhost&quot;],</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">    ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">    ...     world_simulation_time=10.0,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">    ...     verbose=True</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    ... )</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">    &gt;&gt;&gt; await event_agent.start()</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">Note:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    This module requires a running XMPP server (e.g., Openfire, Prosody, ejabberd)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">    and properly registered agent accounts for communication.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">Version:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    1.0.0</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">Author:</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">    Supply Chain Optimization Team</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">heapq</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.behaviour</span><span class="w"> </span><span class="kn">import</span> <span class="n">CyclicBehaviour</span><span class="p">,</span> <span class="n">PeriodicBehaviour</span><span class="p">,</span> <span class="n">OneShotBehaviour</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">spade.presence</span><span class="w"> </span><span class="kn">import</span> <span class="n">PresenceType</span><span class="p">,</span> <span class="n">PresenceShow</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Event</span><span class="p">:</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Temporal event representation for supply chain simulation.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">    </span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">    This class encapsulates information about events that occur at specific moments</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">    during the simulation. Events are comparable and orderable by time, allowing</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">    their use in a min heap structure for chronological processing.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    </span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">    The event system supports various event types representing different occurrences</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">    in the supply chain:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">        - **arrival**: Vehicle arrival at a node (warehouse, store, gas station)</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">        - **transit**: Traffic condition changes on a graph edge</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">        - **updatesimulation**: Request for traffic simulation update</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">        - Custom types as needed by the simulation</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">    </span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">    Comparison operations are based solely on the `time` attribute, implementing</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">    a total ordering for heap-based priority queue operations.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">    </span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">    Attributes:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        event_type (str): Type of event (e.g., &quot;arrival&quot;, &quot;transit&quot;, &quot;updatesimulation&quot;).</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">            Defines the processing behavior and data structure expected.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">        time (float): Event occurrence time in simulation seconds. Used for</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">            heap ordering - lower values have higher priority.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">        data (Dict[str, Any]): Event-specific data dictionary. Structure varies by type:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">            - arrival: {&quot;location&quot;: str, &quot;vehicle&quot;: str}</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">            - transit: {&quot;edges&quot;: List[Dict], &quot;node1&quot;: int, &quot;node2&quot;: int, &quot;weight&quot;: float}</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">            - updatesimulation: {&quot;action&quot;: str}</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">        sender (str, optional): Full JID of the sending agent (format: &quot;name@server&quot;).</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">            None for internal or system-generated events.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">    Examples:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">        &gt;&gt;&gt; # Create vehicle arrival event</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">        &gt;&gt;&gt; arrival_event = Event(</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">        ...     event_type=&quot;arrival&quot;,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">        ...     time=15.5,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">        ...     data={&quot;location&quot;: &quot;warehouse_1&quot;},</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">        ...     sender=&quot;vehicle1@localhost&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">        ... )</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">        &gt;&gt;&gt; # Create traffic change event</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">        &gt;&gt;&gt; transit_event = Event(</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">        ...     event_type=&quot;transit&quot;,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">        ...     time=20.0,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">        ...     data={</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">        ...         &quot;edges&quot;: [{</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">        ...             &quot;node1&quot;: 5,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">        ...             &quot;node2&quot;: 8,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">        ...             &quot;weight&quot;: 12.3,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">        ...             &quot;fuel_consumption&quot;: 2.5</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">        ...         }]</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">        ...     }</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">        ... )</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">        &gt;&gt;&gt; # Compare events by time</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">        &gt;&gt;&gt; arrival_event &lt; transit_event</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">        True</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">        &gt;&gt;&gt; # Use in heap</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">        &gt;&gt;&gt; import heapq</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        &gt;&gt;&gt; heap = []</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        &gt;&gt;&gt; heapq.heappush(heap, transit_event)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        &gt;&gt;&gt; heapq.heappush(heap, arrival_event)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">        &gt;&gt;&gt; next_event = heapq.heappop(heap)  # Returns arrival_event (earlier time)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">    </span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">    Note:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        Event comparison is performed exclusively based on the `time` attribute.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        Events with the same time are considered equal for ordering purposes,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        but may have different types and data content.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">        </span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">        This design follows the principle of temporal consistency in discrete</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        event simulation systems.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>    
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>                 <span class="n">sender</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new event instance.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        </span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">        Creates an event object with specified type, temporal occurrence, associated data,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        and optional sender identification. This constructor performs no validation,</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        relying on the caller to provide semantically correct values.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        </span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">        Args:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">            event_type (str): Event type identifier. Common values include &quot;arrival&quot;,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">                &quot;transit&quot;, &quot;updatesimulation&quot;. Determines event processing behavior</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">                and expected data structure.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">            time (float): Event occurrence time in simulation seconds. Used for</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">                heap ordering - lower values indicate higher priority and earlier</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">                processing. Must be non-negative.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">            data (Dict[str, Any]): Event-specific data dictionary. Structure varies</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">                by event type:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">                - **arrival**: {&quot;location&quot;: str, &quot;vehicle&quot;: str} - Location and vehicle ID</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">                - **transit**: {&quot;edges&quot;: List[Dict], &quot;node1&quot;: int, &quot;node2&quot;: int, </span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">                  &quot;weight&quot;: float, &quot;fuel_consumption&quot;: float} - Graph edge updates</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">                - **updatesimulation**: {&quot;action&quot;: str, &quot;requester&quot;: str} - Simulation requests</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">            sender (str, optional): Full JID of sending agent in format &quot;name@server&quot;.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">                None indicates internal/system-generated event. Defaults to None.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        </span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">        Examples:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">            &gt;&gt;&gt; # Simple arrival event</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">            &gt;&gt;&gt; event = Event(&quot;arrival&quot;, 10.5, {&quot;vehicle&quot;: &quot;v1&quot;}, &quot;vehicle1@localhost&quot;)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">            &gt;&gt;&gt; event.time</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">            10.5</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">            &gt;&gt;&gt; event.event_type</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">            &#39;arrival&#39;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">            &gt;&gt;&gt; </span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">            &gt;&gt;&gt; # Transit event without sender (system-generated)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">            &gt;&gt;&gt; transit = Event(&quot;transit&quot;, 5.0, {&quot;edges&quot;: [...]})</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">            &gt;&gt;&gt; transit.sender is None</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">            True</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">        </span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        Note:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">            The constructor does not validate event_type values or data structure.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">            Validation should be performed by event processors based on type.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">=</span> <span class="n">event_type</span>  <span class="c1"># Event type: &quot;arrival&quot;, &quot;transit&quot;, etc.</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>  <span class="c1"># Event occurrence time</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1"># Event-specific data payload</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">sender</span>  <span class="c1"># Originating agent JID</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>    
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Less-than comparison operator for min heap ordering.</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">        </span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        Implements the less-than comparison required by Python&#39;s heapq module</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">        for maintaining min heap invariant. Events with earlier times have</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        higher priority and are processed first.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">        </span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        Args:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        </span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">        Returns:</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">            bool: True if this event has earlier time (higher priority),</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">                False otherwise.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">        </span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">        Examples:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">            &gt;&gt;&gt; early = Event(&quot;arrival&quot;, 5.0, {})</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">            &gt;&gt;&gt; late = Event(&quot;transit&quot;, 10.0, {})</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">            &gt;&gt;&gt; early &lt; late</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">            True</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">            &gt;&gt;&gt; late &lt; early</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">            False</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">        </span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">        Note:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">            This method is essential for heapq module functionality.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">            Events with lower time values are processed first (min heap property).</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">            Only the time attribute is compared; other attributes are ignored.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>    
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Less-than-or-equal comparison operator.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">        </span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        Compares events based on their temporal occurrence, supporting</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">        sorting and filtering operations.</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        </span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        Args:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        </span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">        Returns:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">            bool: True if this event occurs at or before the other event.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        </span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        Examples:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">            &gt;&gt;&gt; e1 = Event(&quot;arrival&quot;, 5.0, {})</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">            &gt;&gt;&gt; e2 = Event(&quot;transit&quot;, 5.0, {})</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">            &gt;&gt;&gt; e1 &lt;= e2</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">            True</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Greater-than comparison operator.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        </span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">        Compares events based on temporal occurrence for reverse ordering</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">        and filtering operations.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        </span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">        Args:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        </span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        Returns:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">            bool: True if this event occurs after the other event.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        </span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        Examples:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">            &gt;&gt;&gt; late = Event(&quot;arrival&quot;, 10.0, {})</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">            &gt;&gt;&gt; early = Event(&quot;transit&quot;, 5.0, {})</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">            &gt;&gt;&gt; late &gt; early</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">            True</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>    
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Greater-than-or-equal comparison operator.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">        </span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">        Compares events based on temporal occurrence, supporting</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        sorting and filtering in descending order.</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        </span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">        Args:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">        </span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">        Returns:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">            bool: True if this event occurs at or after the other event.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        </span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        Examples:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">            &gt;&gt;&gt; e1 = Event(&quot;arrival&quot;, 5.0, {})</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">            &gt;&gt;&gt; e2 = Event(&quot;transit&quot;, 5.0, {})</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">            &gt;&gt;&gt; e1 &gt;= e2</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">            True</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>    
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Equality comparison operator.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">        </span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">        Determines if two events occur at the same simulation time.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        Note that events are considered equal for ordering purposes even</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">        if they have different types or data content.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        </span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">        Args:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">        </span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">        Returns:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">            bool: True if events have identical occurrence time.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">        </span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">        Examples:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">            &gt;&gt;&gt; e1 = Event(&quot;arrival&quot;, 5.0, {&quot;a&quot;: 1})</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">            &gt;&gt;&gt; e2 = Event(&quot;transit&quot;, 5.0, {&quot;b&quot;: 2})</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">            &gt;&gt;&gt; e1 == e2</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">            True</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">        </span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">        Note:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">            Only the time attribute is compared. Events with same time but</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">            different types are considered equal for ordering purposes.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">            This design enables simultaneous processing of concurrent events.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>    
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return string representation of event for debugging.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">        </span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">        Provides a human-readable representation including event type,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        occurrence time, and sender information. Useful for logging,</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">        debugging, and interactive inspection.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">        </span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">        Returns:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">            str: Formatted string with key event information in format:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">                &quot;Event(type=&lt;type&gt;, time=&lt;time&gt;, sender=&lt;sender&gt;)&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">                Time is formatted to 2 decimal places.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">        </span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">        Examples:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">            &gt;&gt;&gt; event = Event(&quot;arrival&quot;, 15.5, {}, &quot;vehicle1@localhost&quot;)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">            &gt;&gt;&gt; repr(event)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">            &#39;Event(type=arrival, time=15.50, sender=vehicle1@localhost)&#39;</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">            &gt;&gt;&gt; </span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">            &gt;&gt;&gt; print(event)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">            Event(type=arrival, time=15.50, sender=vehicle1@localhost)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a><span class="sd">        </span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">        Note:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">            The data attribute is not included in the representation to</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">            keep output concise. Use event.data for full details.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Event(type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sender=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>    
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert event to dictionary format for XMPP message transmission.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">        </span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">        Serializes the event into a format suitable for sending through the SPADE</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">        messaging system. The dictionary structure varies by event type to optimize</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">        data transmission and maintain FIPA ACL compliance.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">        </span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">        This method follows FIPA principles by creating a structured content format</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">        that can be embedded in FIPA ACL message bodies.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">        </span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">        Returns:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">            Dict[str, Any]: Dictionary with fields appropriate to event type:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">                - **arrival**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;vehicle&quot;: str}</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">                  Vehicle name extracted from sender JID (before &#39;@&#39;).</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">                - **transit**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;data&quot;: Dict}</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">                  Complete data payload including edge updates.</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">                - **other types**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;data&quot;: Dict}</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">                  Generic structure with full data content.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">        </span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">        Examples:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">            &gt;&gt;&gt; # Arrival event serialization</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">            &gt;&gt;&gt; arrival_event = Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle1@localhost&quot;)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">            &gt;&gt;&gt; arrival_event.to_dict()</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">            {&#39;type&#39;: &#39;arrival&#39;, &#39;time&#39;: 10.5, &#39;vehicle&#39;: &#39;vehicle1&#39;}</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">            &gt;&gt;&gt; # Transit event serialization</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">            &gt;&gt;&gt; transit_event = Event(&quot;transit&quot;, 5.0, {&quot;edges&quot;: [...]})</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">            &gt;&gt;&gt; transit_event.to_dict()</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">            {&#39;type&#39;: &#39;transit&#39;, &#39;time&#39;: 5.0, &#39;data&#39;: {&#39;edges&#39;: [...]}}</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">            &gt;&gt;&gt; # Custom event serialization</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">            &gt;&gt;&gt; custom_event = Event(&quot;custom&quot;, 3.0, {&quot;key&quot;: &quot;value&quot;})</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">            &gt;&gt;&gt; custom_event.to_dict()</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">            {&#39;type&#39;: &#39;custom&#39;, &#39;time&#39;: 3.0, &#39;data&#39;: {&#39;key&#39;: &#39;value&#39;}}</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">        </span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">        Note:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">            For arrival events, the vehicle name is extracted from the sender JID</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">            (portion before &#39;@&#39;). For transit events, all data is included.</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">            This serialization format is designed for JSON encoding and XMPP</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">            message transmission.</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">        </span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">            The returned dictionary serves as the content of FIPA ACL messages,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">            providing structured semantic information that agents can interpret</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">            according to the event type.</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>                <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>            <span class="p">}</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="p">}</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>            <span class="p">}</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EventDrivenAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Event-driven agent managing temporal simulation with heap-based priority queue.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">    </span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">    This agent serves as the core of the event management system for supply chain simulation.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">    It uses a min heap data structure to maintain events ordered by time and processes them</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">    periodically at configurable intervals. The agent coordinates communications between</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">    vehicles, warehouses, stores, suppliers, and the world agent, ensuring all participants</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">    receive relevant event notifications.</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">    </span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">    The agent implements FIPA (Foundation for Intelligent Physical Agents) standards for</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">    multi-agent communication, using XMPP as transport protocol and ACL performatives</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">    for semantic message exchange.</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">    </span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">    Architecture:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">        - **Min Heap**: Stores general events ordered by time (O(log n) operations)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">        - **Transit Events List**: Separate list for traffic change events with temporal decay</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">        - **Arrival Events Buffer**: Temporary buffer for vehicle arrival grouping</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        - **Behaviours**: Set of asynchronous behaviours executing different functionalities:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">            * ReceiveEventsBehaviour: Continuous message reception (CyclicBehaviour)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">            * ProcessEventsBehaviour: Periodic event processing (PeriodicBehaviour)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">            * SendInitialSignalBehaviour: Initial system activation (PeriodicBehaviour)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">            * RegisterTransitBehaviour: Initial traffic simulation request (OneShotBehaviour)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">    </span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">    Workflow:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        1. **Initialization**: Subscribe all registered agents and send initial signal</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">        2. **Continuous Reception**: Cyclic behaviour receives events from all agents</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">        3. **Periodic Processing**: At each interval, process events from heap</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">        4. **Notification**: Distribute processed events to appropriate agents</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        5. **Resimulation**: Request new traffic simulation when needed</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">    </span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">    Attributes:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        event_heap (List[Event]): Min heap of general events ordered by time.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">        transit_events (List[Event]): Separate list for active traffic events with time decay.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">        arrival_events (List[Event]): Temporary buffer for vehicle arrival events.</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        simulation_interval (float): Interval in seconds between processing cycles.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        registered_vehicles (List[str]): JIDs of vehicles registered in the system.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">        registered_warehouses (List[str]): JIDs of registered warehouses.</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">        registered_stores (List[str]): JIDs of registered stores.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">        registered_suppliers (List[str]): JIDs of registered suppliers.</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        world_agent (str): JID of the world agent for traffic simulation.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        world_simulation_time (float): Duration in seconds of each traffic simulation.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">        event_count (int): Total counter of events received.</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        processed_count (int): Total counter of events processed.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">        last_simulation_time (float): Timestamp of last processed simulation.</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        time_simulated (float): Total accumulated simulation time.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        verbose (bool): Flag to enable detailed logging.</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">        first_arrival_received (bool): Flag indicating if first arrival has been received.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">        initial_signal_behaviour (PeriodicBehaviour): Reference to initial signal behaviour.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">    </span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">    Behaviours:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        SendInitialSignalBehaviour: Sends initial signal to vehicles (PeriodicBehaviour).</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">        RegisterTransitBehaviour: Requests initial traffic simulation (OneShotBehaviour).</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">        ReceiveEventsBehaviour: Receives events continuously (CyclicBehaviour).</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        ProcessEventsBehaviour: Processes events periodically (PeriodicBehaviour).</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">    </span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">    Examples:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">        &gt;&gt;&gt; # Create event agent with basic configuration</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">        &gt;&gt;&gt; event_agent = EventDrivenAgent(</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">        ...     jid=&quot;event_agent@localhost&quot;,</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">        ...     password=&quot;password123&quot;,</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">        ...     simulation_interval=5.0,</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a><span class="sd">        ...     registered_vehicles=[&quot;vehicle1@localhost&quot;, &quot;vehicle2@localhost&quot;],</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">        ...     registered_warehouses=[&quot;warehouse1@localhost&quot;],</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">        ...     registered_stores=[&quot;store1@localhost&quot;],</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">        ...     registered_suppliers=[&quot;supplier1@localhost&quot;],</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">        ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">        ...     world_simulation_time=10.0,</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">        ...     verbose=True</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">        ... )</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">        &gt;&gt;&gt; # Start the agent</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">        &gt;&gt;&gt; await event_agent.start()</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">        &gt;&gt;&gt; # The agent will:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="sd">        &gt;&gt;&gt; # 1. Subscribe all registered agents</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="sd">        &gt;&gt;&gt; # 2. Send initial signal to vehicles</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">        &gt;&gt;&gt; # 3. Request traffic simulation from world agent</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">        &gt;&gt;&gt; # 4. Receive and process events continuously</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="sd">    </span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="sd">    Note:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">        The agent uses a hybrid processing strategy:</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">        - Transit events are kept separate with time decremented each cycle</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">        - Arrival events are grouped before processing for efficiency</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">        - General events are processed in strict temporal order</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">        </span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">        Only events with the same time as the first event in heap are processed</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">        in each cycle, ensuring correct temporal synchronization.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">    </span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="sd">    FIPA Compliance:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">        - Uses FIPA ACL performatives in message metadata (&quot;inform&quot;, &quot;request&quot;)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">        - Follows FIPA interaction protocols for agent coordination</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">        - Implements presence-based subscription for agent discovery (XMPP)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        - Content is encoded as JSON for interoperability</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        - Sender and receiver identification through JIDs (Jabber IDs)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">    </span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">    Warning:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        The agent requires a running XMPP server before initialization.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">        All registered JIDs must exist and be accessible for communication.</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">    </span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">simulation_interval</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">registered_vehicles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>                 <span class="n">registered_warehouses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">registered_stores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="p">,</span><span class="n">registered_suppliers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                 <span class="n">world_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">world_simulation_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize EventDrivenAgent with simulation settings and registered agents.</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">        </span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a><span class="sd">        Creates an event-driven agent instance configured for supply chain simulation</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">        with specified processing interval and registered agent participants. This</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">        constructor initializes all data structures but does not start behaviours or</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">        subscribe agents - those actions occur in the setup() method.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="sd">        </span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">        Args:</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">            jid (str): Complete Jabber ID of the agent (format: &quot;name@server&quot;).</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">                Must be registered on the XMPP server before use.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">            password (str): Password for XMPP server authentication.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">            simulation_interval (float): Interval in seconds between event processing</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">                cycles. Typical values: 1.0 to 10.0 seconds. Determines temporal</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">                granularity of the simulation.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">            registered_vehicles (List[str]): List of vehicle JIDs participating in</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a><span class="sd">                simulation. These agents will receive event notifications and</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">                traffic updates.</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="sd">            registered_warehouses (List[str]): List of registered warehouse JIDs.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="sd">                Warehouses receive transit events for route optimization.</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">            registered_stores (List[str]): List of registered store JIDs.</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">                Stores receive traffic updates for delivery planning.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">            registered_suppliers (List[str]): List of registered supplier JIDs.</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">                Suppliers receive event notifications for supply coordination.</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">            world_agent (str): JID of the world agent responsible for traffic simulation.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="sd">                If None, traffic simulation features are disabled.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">            world_simulation_time (float): Duration in seconds of each traffic simulation</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">                requested from world agent. Determines temporal forecasting horizon.</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">            verbose (bool): If True, enable detailed logs for debugging and monitoring.</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">                If False, only essential messages are displayed.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">        </span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">        Examples:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">            &gt;&gt;&gt; # Small simulation configuration with 2 vehicles</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">            &gt;&gt;&gt; agent = EventDrivenAgent(</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">            ...     jid=&quot;events@localhost&quot;,</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="sd">            ...     password=&quot;pass123&quot;,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">            ...     simulation_interval=5.0,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">            ...     registered_vehicles=[&quot;v1@localhost&quot;, &quot;v2@localhost&quot;],</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">            ...     registered_warehouses=[&quot;w1@localhost&quot;],</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">            ...     registered_stores=[&quot;s1@localhost&quot;, &quot;s2@localhost&quot;],</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">            ...     registered_suppliers=[&quot;sup1@localhost&quot;],</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">            ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">            ...     world_simulation_time=15.0,</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">            ...     verbose=False</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">            ... )</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">            &gt;&gt;&gt; </span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">            &gt;&gt;&gt; # Large simulation configuration with detailed logging</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">            &gt;&gt;&gt; agent_verbose = EventDrivenAgent(</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">            ...     jid=&quot;events@localhost&quot;,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">            ...     password=&quot;pass123&quot;,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">            ...     simulation_interval=2.0,</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">            ...     registered_vehicles=[f&quot;vehicle{i}@localhost&quot; for i in range(10)],</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">            ...     registered_warehouses=[f&quot;warehouse{i}@localhost&quot; for i in range(5)],</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">            ...     registered_stores=[f&quot;store{i}@localhost&quot; for i in range(20)],</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">            ...     registered_suppliers=[f&quot;supplier{i}@localhost&quot; for i in range(3)],</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">            ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">            ...     world_simulation_time=30.0,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">            ...     verbose=True</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">            ... )</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        </span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        Note:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">            The constructor only initializes data structures. Agent subscription</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">            and behaviour initialization occur in the setup() method, which is</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">            called automatically by SPADE framework when start() is invoked.</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_heap</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Min heap of events (non-transit)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transit_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Separate list for transit events</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Separate list for arrival events</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span> <span class="o">=</span> <span class="n">simulation_interval</span>  <span class="c1"># Simulation interval (e.g., 5s)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">=</span> <span class="n">registered_vehicles</span>  <span class="c1"># Registered vehicles</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_warehouses</span> <span class="o">=</span> <span class="n">registered_warehouses</span>  <span class="c1"># Registered warehouses</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_stores</span> <span class="o">=</span> <span class="n">registered_stores</span>  <span class="c1"># Registered stores</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_suppliers</span> <span class="o">=</span> <span class="n">registered_suppliers</span>  <span class="c1"># Registered suppliers</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span> <span class="o">=</span> <span class="n">world_agent</span>  <span class="c1"># World agent JID</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">world_simulation_time</span> <span class="o">=</span> <span class="n">world_simulation_time</span>  <span class="c1"># World simulation duration</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Counter of events received</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Counter of events processed</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_simulation_time</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Last simulation timestamp</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time_simulated</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Total simulated time</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>  <span class="c1"># Verbose mode flag</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_arrival_received</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag for first arrival received</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Reference to initial signal behaviour</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure and initialize all behaviours and agent subscriptions.</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">        </span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">        This method is called automatically by the SPADE framework when the agent</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">        is started. It configures XMPP presence, subscribes all registered agents,</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">        and adds the necessary behaviours for system operation.</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">        </span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        Initialization Sequence:</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">            1. Set presence as available (AVAILABLE/CHAT) following XMPP protocol</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">            2. Automatically approve all subscription requests (trust model)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">            3. Subscribe vehicles, warehouses, stores, suppliers, and world agent</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">            4. Add ReceiveEventsBehaviour for continuous message reception</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">            5. Add SendInitialSignalBehaviour (periodic until first arrival)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">            6. Add RegisterTransitBehaviour to request initial traffic simulation</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">            7. Add ProcessEventsBehaviour for periodic event processing</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">        </span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">            Uses XMPP presence mechanism for agent discovery and availability,</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">            which aligns with FIPA&#39;s agent management specifications.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">        </span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">        Raises:</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">            SPADEException: If there are problems with XMPP connection or subscription.</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">        </span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">        Note:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">            The order of behaviour addition is important. The initial signal and</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">            traffic simulation request should execute before processing begins.</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">            </span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">            The agent sets presence.approve_all = True to automatically accept</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">            all subscription requests, implementing a trust-based agent society.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Event-Driven Agent started&quot;</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Simulation interval: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] World simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Event-Driven Agent started&quot;</span><span class="p">)</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">approve_all</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="c1"># Subscribe each agent individually</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">all_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_warehouses</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>            <span class="n">all_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="k">for</span> <span class="n">agent_jid</span> <span class="ow">in</span> <span class="n">all_agents</span><span class="p">:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">agent_jid</span><span class="p">)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">set_presence</span><span class="p">(</span><span class="n">PresenceType</span><span class="o">.</span><span class="n">AVAILABLE</span><span class="p">,</span> <span class="n">PresenceShow</span><span class="o">.</span><span class="n">CHAT</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="c1"># Behaviour to continuously receive events (must be active from the start)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="n">receive_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveEventsBehaviour</span><span class="p">()</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">receive_behaviour</span><span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="c1"># Behaviour to send initial signal periodically (until first arrival received)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendInitialSignalBehaviour</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Send every 10s</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span><span class="p">)</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>        <span class="c1"># Behaviour to register transit (request initial traffic simulation)</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="n">transit_registration_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RegisterTransitBehaviour</span><span class="p">()</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">transit_registration_behaviour</span><span class="p">)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>        
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="c1"># Periodic behaviour to process events (every X seconds)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="c1"># Will start only after receiving first arrival</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        <span class="n">process_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessEventsBehaviour</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span><span class="p">)</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">process_behaviour</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>    
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">RegisterTransitBehaviour</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;One-shot behaviour requesting initial traffic simulation.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        </span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        This behaviour executes only once during EventDrivenAgent initialization,</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        sending a request to the world agent to simulate traffic conditions for a</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        specified period. The initial simulation is crucial for having transit data</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        available before event processing begins.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">        </span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">        The behaviour follows FIPA Request interaction protocol, where this agent</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        acts as the initiator sending a REQUEST performative to the world agent</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">        (participant), which will respond with traffic event data.</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        </span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="sd">        Workflow:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd">            1. Wait for agent to be fully initialized</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">            2. Create request message with performative &quot;request&quot;</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">            3. Set action as &quot;simulate_traffic&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">            4. Send simulation time and requester JID</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">            5. World agent responds with transit events</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">        </span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">        Attributes:</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">            Inherits attributes from OneShotBehaviour (no own attributes).</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        </span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">        Message Format (FIPA ACL compliant):</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">            Metadata:</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">                performative: &quot;request&quot;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">                action: &quot;simulate_traffic&quot;</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">            Body (JSON):</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">                {</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">                    &quot;simulation_time&quot;: float,  # Simulation duration in seconds</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">                    &quot;requester&quot;: str           # Event agent JID</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">                }</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">        </span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">            Implements FIPA Request Interaction Protocol:</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">            - Initiator: EventDrivenAgent (this behaviour)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">            - Participant: WorldAgent</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">            - Performative: REQUEST</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">            - Expected response: INFORM with traffic events</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">        </span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">        Note:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">            The world agent response is processed by ReceiveEventsBehaviour,</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">            which adds transit events to the transit_events list.</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute traffic simulation request to world agent.</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">            </span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">            Sends an XMPP message to the world agent requesting traffic condition</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">            simulation. The world agent will process the request and respond with</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">            a list of transit events that will be received by ReceiveEventsBehaviour.</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">            </span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a><span class="sd">            This method implements the REQUEST performative of FIPA ACL, initiating</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">            a request-response interaction pattern.</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="sd">            </span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">            Raises:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a><span class="sd">                SPADEException: If message sending fails.</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">            </span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">            Note:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">                This method executes only once. Subsequent simulation requests</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">                are managed by &quot;updatesimulation&quot; type events in the heap.</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">                </span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">                Sends REQUEST performative with structured content following</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">                FIPA ACL semantics for service requests.</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  REQUESTING TRAFFIC SIMULATION FROM WORLD AGENT&quot;</span><span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recipient: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  REQUESTING TRAFFIC SIMULATION FROM WORLD AGENT&quot;</span><span class="p">)</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>            <span class="c1"># Create simulation request message</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="p">}</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>            
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Traffic simulation request sent to world agent&quot;</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">SendInitialSignalBehaviour</span><span class="p">(</span><span class="n">PeriodicBehaviour</span><span class="p">):</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Periodic behaviour for vehicle activation through initial signaling.</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        </span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        This behaviour executes periodically (every 10 seconds) during initialization,</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        sending fictitious &quot;arrival&quot; messages to all registered vehicles until the</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        first real arrival event is received. The goal is to ensure vehicles are</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">        active and ready to respond to actual events.</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">        </span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">        This pattern implements a &quot;heartbeat&quot; or &quot;keep-alive&quot; mechanism to bootstrap</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">        the simulation, following distributed systems principles for node activation.</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        </span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">        Initialization Strategy:</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">            - Uses fictitious vehicle name (&quot;vehicle_init_signal_999&quot;)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">            - Event time is 0.1 (near-zero, initial moment)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">            - Sends periodically until first real arrival received</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">            - Terminates automatically when first_arrival_received = True</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">            - Vehicles ignore the fictitious event but notify event agent</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        </span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        Attributes:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">            Inherits attributes from PeriodicBehaviour (period set to 10 seconds).</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">        </span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">        Message Format (FIPA ACL INFORM):</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">            Metadata:</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">                performative: \&quot;inform\&quot;</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">            Body (JSON):</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">                {</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">                    \&quot;type\&quot;: \&quot;arrival\&quot;,</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">                    \&quot;vehicle\&quot;: \&quot;vehicle_init_signal_999\&quot;,  # Fictitious name</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">                    \&quot;time\&quot;: 0.1</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">                }</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">        </span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">        Examples:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">            &gt;&gt;&gt; # Automatically added in setup() with 10s period</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">            &gt;&gt;&gt; initial_signal = self.SendInitialSignalBehaviour(period=10.0)</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(initial_signal)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">        </span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">        Note:</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">            This mechanism ensures all vehicles are ready to receive events</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">            before the simulation effectively begins. The behaviour stops</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">            automatically when the first real arrival is received.</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a><span class="sd">        </span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">            Uses INFORM performative to notify vehicles of (fictitious) events,</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">            implementing a broadcast notification pattern.</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">        </span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">        Warning:</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a><span class="sd">            If registered_vehicles is empty, behaviour terminates without action</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="sd">            and emits a warning in the log.</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Send initialization signal to all registered vehicles periodically.</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="sd">            </span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="sd">            Iterates over the list of registered vehicles and sends each one a</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a><span class="sd">            fictitious arrival message. Continues sending until the first real</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="sd">            arrival is received.</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="sd">            </span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">            The method implements a broadcast INFORM pattern, notifying all vehicles</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="sd">            to activate their event reception behaviours.</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">            </span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">            Returns:</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">                None: Executes side effects (message sending).</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">            </span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">            Note:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">                The behaviour checks the first_arrival_received flag and terminates</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">                when it is True. The fictitious name &quot;vehicle_init_signal_999&quot;</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">                is intentional and should not correspond to any real vehicle.</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">                </span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">                Sends INFORM performatives to all vehicles in a broadcast pattern.</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="c1"># Check if first arrival already received</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  First arrival received. Stopping initial signal sending.&quot;</span><span class="p">)</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  First arrival received.&quot;</span><span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Stop this behaviour</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                <span class="k">return</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>            
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  No registered vehicles to send initial signal&quot;</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                <span class="k">return</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>            <span class="c1"># Use fictitious name that doesn&#39;t correspond to any real vehicle</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>            <span class="n">fictitious_vehicle_name</span> <span class="o">=</span> <span class="s2">&quot;vehicle_init_signal_999&quot;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>            
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>            <span class="c1"># Send message to ALL registered vehicles</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SENDING INITIAL SIGNAL (periodic)&quot;</span><span class="p">)</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recipients: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> vehicles&quot;</span><span class="p">)</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Vehicle (fictitious): </span><span class="si">{</span><span class="n">fictitious_vehicle_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type: arrival&quot;</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time: 0.1&quot;</span><span class="p">)</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SENDING INITIAL SIGNAL (waiting for real arrival...)&quot;</span><span class="p">)</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>                <span class="c1"># Create initial arrival message with near-zero time</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>                    <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="n">fictitious_vehicle_name</span><span class="p">,</span>  <span class="c1"># Fictitious name</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>                <span class="p">}</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>                
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>                
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                <span class="n">vehicle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sent to: </span><span class="si">{</span><span class="n">vehicle_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>            
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>    
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveEventsBehaviour</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cyclic behaviour for continuous event reception from multiple sources.</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">        </span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">        This behaviour remains permanently active, receiving XMPP messages from</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        all registered agents (vehicles, warehouses, stores, suppliers, world agent)</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">        and classifying them into different event categories. Reception is</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">        non-blocking with 1-second timeout to allow interruptions.</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">        </span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        The behaviour implements a message router pattern, directing different</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">        event types to appropriate data structures for later processing.</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">        </span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">        Event Types Processed:</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">            - **Traffic Events**: Transit events from world agent (complete list)</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">            - **Transit**: Manual traffic condition change events</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="sd">            - **Arrival**: Vehicle arrival events at nodes</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a><span class="sd">            - **UpdateSimulation**: Traffic resimulation requests</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">            - **Other**: Generic events added to main heap</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="sd">        </span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">        Storage Strategy:</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">            - Transit events  transit_events (separate list)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">            - Arrival events (time &gt; 0)  arrival_events (temporary buffer)</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">            - Arrival events (time = 0)  discarded (initial signal)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">            - Other events  event_heap (min heap)</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">        </span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">        Attributes:</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">            Inherits attributes from CyclicBehaviour.</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">        </span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">        Message Formats:</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">            Traffic Events (from world agent):</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">                Metadata:</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">                    performative: \&quot;inform\&quot;</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">                    action: \&quot;traffic_events\&quot;</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">                Body (JSON):</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">                    {</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">                        \&quot;events\&quot;: [</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">                            {</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">                                \&quot;instant\&quot;: float,</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">                                \&quot;node1_id\&quot;: int,</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">                                \&quot;node2_id\&quot;: int,</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">                                \&quot;new_time\&quot;: float,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">                                \&quot;new_fuel_consumption\&quot;: float,</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">                            },</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">                            ...</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">                        ]</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a><span class="sd">                    }</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">            </span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">            Generic Events:</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">                Metadata:</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">                    performative: \&quot;inform\&quot;</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">                Body (JSON):</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">                    {</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">                        \&quot;type\&quot;: str,</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">                        \&quot;time\&quot;: float,</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">                        \&quot;data\&quot;: Dict[str, Any],</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">                    }</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">        </span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">        Examples:</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">            &gt;&gt;&gt; # Behaviour executes continuously after addition</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">            &gt;&gt;&gt; receive_behaviour = self.ReceiveEventsBehaviour()</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(receive_behaviour)</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">        </span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a><span class="sd">        Note:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">            The 1-second timeout allows the behaviour to periodically check</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">            if it should terminate (e.g., when agent is stopped). Received</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">            messages are immediately processed and classified.</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        </span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">            Processes FIPA ACL messages with INFORM performative, acting as</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">            a receiver in multiple interaction protocols initiated by other agents.</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">        </span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">        Warning:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">            JSON parsing errors are caught and logged, but do not interrupt</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">            the behaviour. Malformed events are discarded.</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">        </span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">        See Also:</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">            ProcessEventsBehaviour: Processes stored events.</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">            Event: Data structure for representing events.</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Cycle of event message reception and classification.</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">            </span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">            This method executes continuously, awaiting messages with 1-second</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">            timeout. When a message is received, it identifies the event type</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">            and stores it in the appropriate data structure.</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">            </span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">            Processing Flow:</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">                1. Await message with 1s timeout</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">                2. Check if it&#39;s traffic events response from world agent</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">                3. If yes, process complete list of transit events</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">                4. If no, identify individual event type</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">                5. Store in transit_events, arrival_events, or event_heap</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">                6. Increment received events counter</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">            </span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">            Returns:</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">                None: Executes continuously until behaviour is removed.</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">            </span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">            Raises:</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">                Exception: Catches and logs parsing errors without interrupting.</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">            </span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">            Note:</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">                For transit events from world agent, also creates an automatic</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">                resimulation event after world_simulation_time.</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">                </span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">                Receives and processes INFORM performatives from multiple agents,</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">                implementing receiver role in FIPA interaction protocols.</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                    <span class="c1"># Verificar se  resposta do world agent com eventos de trnsito</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;inform&quot;</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;traffic_events&quot;</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                        <span class="c1"># Mensagem do world agent com eventos de trnsito</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                        <span class="n">events</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>                        
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  EVENTOS DE TRNSITO DO WORLD AGENT RECEBIDOS&quot;</span><span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total de eventos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  EVENTOS DE TRNSITO DO WORLD AGENT RECEBIDOS&quot;</span><span class="p">)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                        
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                        <span class="c1"># Processar cada evento de trnsito</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                        <span class="k">for</span> <span class="n">event_data</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                            <span class="c1"># Criar evento de trnsito</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                            <span class="n">transit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>                                <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>                                <span class="n">time</span><span class="o">=</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instant&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                                <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                                    <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[{</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>                                        <span class="s2">&quot;node1&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node1_id&quot;</span><span class="p">),</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                                        <span class="s2">&quot;node2&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node2_id&quot;</span><span class="p">),</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                                        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_time&quot;</span><span class="p">),</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                                        <span class="s2">&quot;fuel_consumption&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_fuel_consumption&quot;</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                                    <span class="p">}]</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                                <span class="p">},</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                                <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">),</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                            <span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>                            
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                            <span class="c1"># Adicionar  lista de eventos de trnsito</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transit_event</span><span class="p">)</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Transit event added: Edge (</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node1_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node2_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">), time=</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_time&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, instant=</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instant&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                        
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Total transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                        
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>                        <span class="c1"># Criar evento para solicitar nova simulao aps world_simulation_time</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                        <span class="n">resimulation_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                            <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;updatesimulation&quot;</span><span class="p">,</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                            <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;request_new_simulation&quot;</span><span class="p">},</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                            <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">),</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                        <span class="p">)</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">resimulation_event</span><span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Resimulation event added to heap: </span><span class="si">{</span><span class="n">resimulation_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>                        
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>                        <span class="k">return</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                    
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>                    <span class="c1"># Processar outros eventos normalmente</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                    <span class="n">event_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>                    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>                    <span class="n">event_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>                    
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                    <span class="c1"># Debug: mostrar dados recebidos</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Mensagem recebida:&quot;</span><span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sender: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Type: </span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Time: </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Data: </span><span class="si">{</span><span class="n">event_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Mensagem recebida de </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                    
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                    <span class="c1"># Criar evento</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                    <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                        <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                        <span class="n">data</span><span class="o">=</span><span class="n">event_data</span><span class="p">,</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                        <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">),</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                    <span class="p">)</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                    
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                    <span class="c1"># Verificar se  evento de trnsito manual (no do world agent)</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                    <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                        <span class="c1"># Adicionar  lista de trnsito</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Manual transit event received: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                    <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PRIMEIRO ARRIVAL RECEBIDO! Iniciando processamento da heap.&quot;</span><span class="p">)</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PRIMEIRO ARRIVAL RECEBIDO!&quot;</span><span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>                            
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento ARRIVAL adicionado  lista: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos de arrival: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>                        <span class="c1"># Adicionar  heap outros tipos de eventos</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento recebido: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento recebido: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Erro ao processar mensagem: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>    
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ProcessEventsBehaviour</span><span class="p">(</span><span class="n">PeriodicBehaviour</span><span class="p">):</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Periodic behaviour responsible for temporal event processing.</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">        </span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a><span class="sd">        This behaviour is the core of the temporal simulation system, executing at</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">        regular intervals (defined by simulation_interval) to process events that</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">        occur at the same temporal instant. It implements a sophisticated time</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="sd">        management strategy, ensuring correct synchronization between all events</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">        and agents.</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">        </span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">        The behaviour implements a discrete event simulation (DES) approach, where</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">        time advances in discrete steps and all events at each time step are</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">        processed simultaneously.</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">        </span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">        Processing Strategy:</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">            1. **Arrival Transfer**: Move arrival events from buffer to heap</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">            2. **Transit Integration**: Reinsert transit events into heap</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">            3. **Time Selection**: Extract first event (smallest time)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">            4. **Grouping**: Collect all events with same time</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">            5. **Processing**: Notify relevant agents about events</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a><span class="sd">            6. **Transit Update**: Decrement time of remaining transit events</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="sd">            7. **Cleanup**: Empty heap (discard future events until next cycle)</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="sd">            8. **Resimulation**: Request new simulation if needed</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a><span class="sd">        </span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">        Time Management:</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">            - Only events with time equal to first event are processed</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a><span class="sd">            - Transit events have time decremented continuously</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">            - First event of each type has real time, subsequent ones time 0</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">            - Avoids duplicate simulation of same temporal interval</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">        </span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        Attributes:</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">            period (float): Interval in seconds between executions (inherited from PeriodicBehaviour).</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">        </span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">        Notification Flow:</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">            - Arrival events  All vehicles (grouped message)</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">            - Transit events  Vehicles + Warehouses + Stores</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">            - UpdateSimulation events  World agent</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">        </span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">        Examples:</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">            &gt;&gt;&gt; # Automatically created in setup() with configurable period</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">            &gt;&gt;&gt; process_behaviour = self.ProcessEventsBehaviour(period=5.0)</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(process_behaviour)</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">        </span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">        Note:</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">            Emptying the heap after processing is intentional. It ensures only</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">            events from the next temporal instant are considered in the next cycle,</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">            avoiding temporal inconsistencies.</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">        </span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">            Implements FIPA Inform protocol when notifying agents of processed</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">            events, acting as initiator in broadcast notification patterns.</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">        </span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">        Warning:</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">            If the heap is empty, the cycle is skipped. This is normal when there</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">            are no pending events.</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        </span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">        See Also:</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">            notify_events: Internal method to distribute processed events.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">            Event: Event data structure.</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>        
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute one cycle of event processing.</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">            </span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">            This method is called periodically by SPADE framework at the interval</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">            defined by simulation_interval. It coordinates all processing steps,</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">            from heap preparation to agent notification.</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">            </span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">            Detailed Steps:</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">                1. **Heap Preparation**:</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">                   - Transfer arrival_events to event_heap</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">                   - Reinsert transit_events into heap</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">                   - Empty temporary buffers</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">                </span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">                2. **Event Verification**:</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">                   - If heap empty, terminate cycle</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">                   - Log state for monitoring</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">                </span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">                3. **Event Extraction**:</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">                   - Remove first event (smallest time)</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">                   - Collect subsequent events with same time</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">                   - Create list of events to process</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">                </span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">                4. **Transit Management**:</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">                   - Remove transit events from separate list</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">                   - Detect if last transit event was processed</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">                   - Update time of remaining events</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">                </span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">                5. **Notification**:</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">                   - Call notify_events() to distribute to agents</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">                   - Await send confirmations</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="sd">                </span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">                6. **Resimulation**:</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">                   - If last transit event processed</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">                   - Send new simulation request to world agent</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">                </span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">                7. **Statistics**:</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">                   - Update counters</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">                   - Generate detailed logs if verbose=True</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">                </span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">                8. **Cleanup**:</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">                   - Empty event_heap</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">                   - Prepare for next cycle</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">            </span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">            Returns:</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">                None: Executes side effects (notifications and state updates).</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">            </span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">            Note:</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">                Decrementing transit event time ensures remaining time always</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">                reflects interval until next processing. Processing only begins</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">                after receiving first real arrival.</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">            </span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">            Examples:</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">                &gt;&gt;&gt; # Example verbose log during execution</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">                [event_agent]  PROCESSING EVENTS</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">                [event_agent] Simulation time: 5.0s</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="sd">                [event_agent] Events in heap: 3</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">                [event_agent] Transit events: 5</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="sd">                </span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a><span class="sd">                [event_agent]  Next event: Event(type=arrival, time=10.50, sender=vehicle1@localhost)</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">                [event_agent]  Total events with time 10.50s: 2</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">                </span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">                [event_agent]  Notifying grouped ARRIVAL event to 3 vehicles</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="sd">                   Arrived vehicles: [&#39;vehicle1&#39;, &#39;vehicle2&#39;]</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">            </span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">                Sends INFORM performatives to notify agents of processed events,</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">                implementing broadcast notification pattern.</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>            <span class="c1"># Check if first arrival received before processing</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Waiting for first arrival before processing heap...&quot;</span><span class="p">)</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>                <span class="k">return</span>  <span class="c1"># Don&#39;t process until first arrival received</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>            
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>            <span class="c1"># Adicionar eventos de arrival  heap e esvaziar a lista</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>            <span class="k">for</span> <span class="n">arrival_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">arrival_event</span><span class="p">)</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Adicionados </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span><span class="si">}</span><span class="s2"> eventos de arrival  heap&quot;</span><span class="p">)</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Esvaziar a lista</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="c1"># Recolocar eventos de trnsito na heap no incio</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>            <span class="k">for</span> <span class="n">transit_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">transit_event</span><span class="p">)</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>            
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PROCESSANDO EVENTOS&quot;</span><span class="p">)</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">simulation_interval</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Eventos na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>            
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">:</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Nenhum evento para processar</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>                <span class="k">return</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>            
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>            <span class="c1"># Tirar o primeiro evento da heap (menor tempo)</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>            <span class="n">first_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>            <span class="n">event_time</span> <span class="o">=</span> <span class="n">first_event</span><span class="o">.</span><span class="n">time</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>            <span class="n">events_to_process</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_event</span><span class="p">]</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>            
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Next event: </span><span class="si">{</span><span class="n">first_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>            
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>            <span class="c1"># Continuar a dar pop enquanto houver eventos com o mesmo tempo</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">event_time</span><span class="p">:</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>                <span class="n">next_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>                <span class="n">events_to_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_event</span><span class="p">)</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento adicional (mesmo tempo): </span><span class="si">{</span><span class="n">next_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>            
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Total de eventos com tempo </span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>            
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>            <span class="c1"># Processar remoo de eventos de trnsito da lista</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>            <span class="n">was_last_transit_event</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events_to_process</span><span class="p">:</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>                    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Transit event removed from list: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>            
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>            <span class="c1"># Verificar se era o ltimo evento de trnsito</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                <span class="c1"># Verificar se algum dos eventos processados era de trnsito</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events_to_process</span><span class="p">:</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                        <span class="n">was_last_transit_event</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   LTIMO EVENTO DE TRNSITO REMOVIDO!&quot;</span><span class="p">)</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                        <span class="k">break</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>            
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>            <span class="c1"># Atualizar tempo de todos os eventos de trnsito restantes</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>            <span class="n">updated_transit_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>            <span class="k">for</span> <span class="n">transit_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>                <span class="n">transit_event</span><span class="o">.</span><span class="n">time</span> <span class="o">-=</span> <span class="n">event_time</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                <span class="n">updated_transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transit_event</span><span class="p">)</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Trnsito atualizado: </span><span class="si">{</span><span class="n">transit_event</span><span class="si">}</span><span class="s2"> (tempo restante: </span><span class="si">{</span><span class="n">transit_event</span><span class="o">.</span><span class="n">time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>            
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>            <span class="c1"># Atualizar lista de eventos de trnsito</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span> <span class="o">=</span> <span class="n">updated_transit_events</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>            
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>            <span class="c1"># Notificar todos os veculos sobre os eventos processados (sequencialmente)</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_events</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>            
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>            
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>            <span class="c1"># Se foi o ltimo evento de trnsito, solicitar nova simulao</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>            <span class="k">if</span> <span class="n">was_last_transit_event</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SOLICITANDO NOVA SIMULAO DE TRNSITO&quot;</span><span class="p">)</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Motivo: ltimo evento de trnsito processado&quot;</span><span class="p">)</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Destinatrio: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SOLICITANDO NOVA SIMULAO DE TRNSITO&quot;</span><span class="p">)</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>                
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>                <span class="c1"># Enviar pedido de nova simulao</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>                
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>                    <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>                    <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>                <span class="p">}</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>                
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Pedido de nova simulao enviado</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Estatsticas:&quot;</span><span class="p">)</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos processados: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tipos: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">event_type</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">events_to_process</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tempo dos eventos: </span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Trnsitos ativos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total recebido: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total processado: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">processed_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>                    
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>                <span class="c1"># Imprimir estado completo da heap restante</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  ESTADO DA HEAP RESTANTE:&quot;</span><span class="p">)</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Heap vazia (sem eventos)&quot;</span><span class="p">)</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>                    <span class="c1"># Mostrar eventos normais na heap</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos normais na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos normais na heap: 0&quot;</span><span class="p">)</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>                    
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>                    <span class="c1"># Mostrar eventos de trnsito</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos de trnsito: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos de trnsito: 0&quot;</span><span class="p">)</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>                
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>            <span class="c1"># Esvaziar a heap (descartar outros eventos)</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>            <span class="n">discarded_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>            
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>            <span class="k">if</span> <span class="n">discarded_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Heap esvaziada: </span><span class="si">{</span><span class="n">discarded_count</span><span class="si">}</span><span class="s2"> eventos descartados&quot;</span><span class="p">)</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>        
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">notify_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]):</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">            Notifica agentes apropriados sobre eventos processados com agrupamento inteligente.</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="sd">            </span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">            Este mtodo distribui eventos aos agentes relevantes, implementando estratgias</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">            de optimizao diferentes para cada tipo de evento. O agrupamento de arrivals</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">            e o ajuste temporal de trnsito garantem eficincia e consistncia temporal.</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">            </span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">            Estratgias por Tipo:</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">                1. **Arrival Events**:</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a><span class="sd">                   - Agrupados numa nica mensagem por veculo</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a><span class="sd">                   - Lista de todos os veculos que chegaram includa</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a><span class="sd">                   - Enviada a TODOS os veculos registados</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a><span class="sd">                   - Apenas o tempo do primeiro arrival  usado</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a><span class="sd">                </span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a><span class="sd">                2. **Transit Events**:</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="sd">                   - Enviados individualmente mas sequencialmente</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="sd">                   - Primeiro evento tem tempo real</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="sd">                   - Eventos subsequentes tm tempo 0 (evita resimulao)</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">                   - Enviados a veculos, armazns e lojas</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">                </span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="sd">                3. **UpdateSimulation Events**:</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">                   - Enviados apenas ao world agent</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">                   - Solicita nova simulao de trfego</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a><span class="sd">                   - Usa tempo configurado em world_simulation_time</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">            </span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">            Args:</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">                events (List[Event]): Lista de eventos a notificar. Podem ser de tipos</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">                    mistos. O mtodo classifica e processa cada tipo adequadamente.</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">            </span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a><span class="sd">            Returns:</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">                None: Executa efeitos colaterais (envio de mensagens XMPP).</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">            </span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">            Message Formats:</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">                Arrival (agrupado):</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">                    {</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">                        &quot;type&quot;: &quot;arrival&quot;,</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">                        &quot;time&quot;: float,              # Tempo do primeiro arrival</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a><span class="sd">                        &quot;vehicles&quot;: List[str]       # Lista de nomes de veculos</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">                    }</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">                </span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">                Transit (individual):</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">                    {</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a><span class="sd">                        &quot;type&quot;: &quot;Transit&quot;,</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">                        &quot;time&quot;: float,              # Real para primeiro, 0 para restantes</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="sd">                        &quot;data&quot;: {</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a><span class="sd">                            &quot;edges&quot;: [</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a><span class="sd">                                {</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a><span class="sd">                                    &quot;node1&quot;: int,</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a><span class="sd">                                    &quot;node2&quot;: int,</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a><span class="sd">                                    &quot;weight&quot;: float,</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a><span class="sd">                                    &quot;fuel_consumption&quot;: float</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a><span class="sd">                                }</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a><span class="sd">                            ]</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a><span class="sd">                        }</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a><span class="sd">                    }</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a><span class="sd">                </span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a><span class="sd">                UpdateSimulation:</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="sd">                    {</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="sd">                        &quot;simulation_time&quot;: float,</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">                        &quot;requester&quot;: str            # JID do event agent</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">                    }</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="sd">            </span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="sd">            Examples:</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a><span class="sd">                &gt;&gt;&gt; # Processar lista mista de eventos</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="sd">                &gt;&gt;&gt; events = [</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">                ...     Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle1@localhost&quot;),</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">                ...     Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle2@localhost&quot;),</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="sd">                ...     Event(&quot;transit&quot;, 10.5, {&quot;edges&quot;: [...]})</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">                ... ]</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">                &gt;&gt;&gt; await self.notify_events(events)</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">                </span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">                # Resultado:</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">                # - 1 mensagem de arrival para cada veculo registado (lista agrupada)</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a><span class="sd">                # - 1 mensagem de transit para veculos + armazns + lojas</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a><span class="sd">            </span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a><span class="sd">            Note:</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a><span class="sd">                O ajuste de tempo para 0 em eventos subsequentes  crucial para evitar</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a><span class="sd">                que mltiplos eventos causem simulaes repetidas do mesmo intervalo</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="sd">                temporal nos agentes receptores.</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">            </span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">            Warning:</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">                Se world_agent no estiver configurado, eventos de updatesimulation</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">                so ignorados silenciosamente com log de aviso.</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">            </span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">            See Also:</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">                Event.to_dict(): Serializao de eventos para mensagens.</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">                ProcessEventsBehaviour.run(): Mtodo que invoca notify_events.</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>            <span class="c1"># Agrupar eventos por tipo</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>            <span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>            <span class="n">transit_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>            <span class="n">other_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>            
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>                    <span class="n">arrival_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>                    <span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>                    <span class="n">other_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>            
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>            <span class="c1"># Processar eventos de arrival agrupados</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>            <span class="k">if</span> <span class="n">arrival_events</span><span class="p">:</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>                <span class="c1"># Coletar todos os nomes de veculos</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>                <span class="n">vehicle_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">arrival_events</span><span class="p">]</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>                <span class="c1"># Tempo  do primeiro evento</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>                <span class="n">event_time</span> <span class="o">=</span> <span class="n">arrival_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>                
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento ARRIVAL agrupado para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> veculos&quot;</span><span class="p">)</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Veculos que chegaram: </span><span class="si">{</span><span class="n">vehicle_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento ARRIVAL agrupado para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> veculos&quot;</span><span class="p">)</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>                <span class="c1"># Enviar uma nica mensagem para todos os veculos registrados</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>                <span class="n">recipients</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> 
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>                            <span class="p">)</span> <span class="c1"># TODO + self.agent.registered_warehouses + self.agent.registered_suppliers</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>                <span class="k">for</span> <span class="n">recipient_jid</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">recipient_jid</span><span class="p">)</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arrival&quot;</span><span class="p">)</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>                    
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>                    <span class="c1"># Criar mensagem com lista de veculos</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>                    <span class="n">event_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">event_time</span><span class="p">,</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>                        <span class="s2">&quot;vehicles&quot;</span><span class="p">:</span> <span class="n">vehicle_names</span>  <span class="c1"># Lista de veculos</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>                    <span class="p">}</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>                    
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>                    
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>                    <span class="n">recipient_name</span> <span class="o">=</span> <span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>                    
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    </span><span class="si">{</span><span class="n">recipient_name</span><span class="si">}</span><span class="s2">: arrival (vehicles=</span><span class="si">{</span><span class="n">vehicle_names</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>            
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>            <span class="c1"># Processar eventos de trnsito</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transit_events</span><span class="p">):</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>                <span class="n">recipients</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> 
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>                            <span class="p">)</span> <span class="c1"># TODO + self.agent.registered_warehouses + self.agent.registered_suppliers</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento TRANSIT para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">recipients</span><span class="p">)</span><span class="si">}</span><span class="s2"> agentes&quot;</span><span class="p">)</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>                
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>                <span class="k">for</span> <span class="n">recipient_jid</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">recipient_jid</span><span class="p">)</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit&quot;</span><span class="p">)</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>                    
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>                    <span class="n">event_dict</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>                    
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>                    <span class="c1"># Apenas o primeiro evento tem o tempo real</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>                    <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>                        <span class="n">original_time</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>                        <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Ajustando tempo do evento Transit para 0 (original=</span><span class="si">{</span><span class="n">original_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s) para </span><span class="si">{</span><span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>                    
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>                    
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>                    <span class="n">recipient_name</span> <span class="o">=</span> <span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    </span><span class="si">{</span><span class="n">recipient_name</span><span class="si">}</span><span class="s2">: Transit (time=</span><span class="si">{</span><span class="n">event_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>            
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>            <span class="c1"># Processar outros eventos (updatesimulation, etc)</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">other_events</span><span class="p">:</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;updatesimulation&quot;</span><span class="p">:</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Processando evento UPDATESIMULATION - Solicitando nova simulao&quot;</span><span class="p">)</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>                        
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>                        
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>                            <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>                            <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>                        <span class="p">}</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>                        
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    Pedido de re-simulao enviado ao world agent&quot;</span><span class="p">)</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Agente do mundo no registrado, evento ignorado&quot;</span><span class="p">)</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>    
</span></pre></div>


            </section>
                <section id="Event">
                            <input id="Event-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Event</span>:

                <label class="view-source-button" for="Event-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Event"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Event-69"><a href="#Event-69"><span class="linenos"> 69</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Event</span><span class="p">:</span>
</span><span id="Event-70"><a href="#Event-70"><span class="linenos"> 70</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Temporal event representation for supply chain simulation.</span>
</span><span id="Event-71"><a href="#Event-71"><span class="linenos"> 71</span></a><span class="sd">    </span>
</span><span id="Event-72"><a href="#Event-72"><span class="linenos"> 72</span></a><span class="sd">    This class encapsulates information about events that occur at specific moments</span>
</span><span id="Event-73"><a href="#Event-73"><span class="linenos"> 73</span></a><span class="sd">    during the simulation. Events are comparable and orderable by time, allowing</span>
</span><span id="Event-74"><a href="#Event-74"><span class="linenos"> 74</span></a><span class="sd">    their use in a min heap structure for chronological processing.</span>
</span><span id="Event-75"><a href="#Event-75"><span class="linenos"> 75</span></a><span class="sd">    </span>
</span><span id="Event-76"><a href="#Event-76"><span class="linenos"> 76</span></a><span class="sd">    The event system supports various event types representing different occurrences</span>
</span><span id="Event-77"><a href="#Event-77"><span class="linenos"> 77</span></a><span class="sd">    in the supply chain:</span>
</span><span id="Event-78"><a href="#Event-78"><span class="linenos"> 78</span></a><span class="sd">        - **arrival**: Vehicle arrival at a node (warehouse, store, gas station)</span>
</span><span id="Event-79"><a href="#Event-79"><span class="linenos"> 79</span></a><span class="sd">        - **transit**: Traffic condition changes on a graph edge</span>
</span><span id="Event-80"><a href="#Event-80"><span class="linenos"> 80</span></a><span class="sd">        - **updatesimulation**: Request for traffic simulation update</span>
</span><span id="Event-81"><a href="#Event-81"><span class="linenos"> 81</span></a><span class="sd">        - Custom types as needed by the simulation</span>
</span><span id="Event-82"><a href="#Event-82"><span class="linenos"> 82</span></a><span class="sd">    </span>
</span><span id="Event-83"><a href="#Event-83"><span class="linenos"> 83</span></a><span class="sd">    Comparison operations are based solely on the `time` attribute, implementing</span>
</span><span id="Event-84"><a href="#Event-84"><span class="linenos"> 84</span></a><span class="sd">    a total ordering for heap-based priority queue operations.</span>
</span><span id="Event-85"><a href="#Event-85"><span class="linenos"> 85</span></a><span class="sd">    </span>
</span><span id="Event-86"><a href="#Event-86"><span class="linenos"> 86</span></a><span class="sd">    Attributes:</span>
</span><span id="Event-87"><a href="#Event-87"><span class="linenos"> 87</span></a><span class="sd">        event_type (str): Type of event (e.g., &quot;arrival&quot;, &quot;transit&quot;, &quot;updatesimulation&quot;).</span>
</span><span id="Event-88"><a href="#Event-88"><span class="linenos"> 88</span></a><span class="sd">            Defines the processing behavior and data structure expected.</span>
</span><span id="Event-89"><a href="#Event-89"><span class="linenos"> 89</span></a><span class="sd">        time (float): Event occurrence time in simulation seconds. Used for</span>
</span><span id="Event-90"><a href="#Event-90"><span class="linenos"> 90</span></a><span class="sd">            heap ordering - lower values have higher priority.</span>
</span><span id="Event-91"><a href="#Event-91"><span class="linenos"> 91</span></a><span class="sd">        data (Dict[str, Any]): Event-specific data dictionary. Structure varies by type:</span>
</span><span id="Event-92"><a href="#Event-92"><span class="linenos"> 92</span></a><span class="sd">            - arrival: {&quot;location&quot;: str, &quot;vehicle&quot;: str}</span>
</span><span id="Event-93"><a href="#Event-93"><span class="linenos"> 93</span></a><span class="sd">            - transit: {&quot;edges&quot;: List[Dict], &quot;node1&quot;: int, &quot;node2&quot;: int, &quot;weight&quot;: float}</span>
</span><span id="Event-94"><a href="#Event-94"><span class="linenos"> 94</span></a><span class="sd">            - updatesimulation: {&quot;action&quot;: str}</span>
</span><span id="Event-95"><a href="#Event-95"><span class="linenos"> 95</span></a><span class="sd">        sender (str, optional): Full JID of the sending agent (format: &quot;name@server&quot;).</span>
</span><span id="Event-96"><a href="#Event-96"><span class="linenos"> 96</span></a><span class="sd">            None for internal or system-generated events.</span>
</span><span id="Event-97"><a href="#Event-97"><span class="linenos"> 97</span></a>
</span><span id="Event-98"><a href="#Event-98"><span class="linenos"> 98</span></a><span class="sd">    Examples:</span>
</span><span id="Event-99"><a href="#Event-99"><span class="linenos"> 99</span></a><span class="sd">        &gt;&gt;&gt; # Create vehicle arrival event</span>
</span><span id="Event-100"><a href="#Event-100"><span class="linenos">100</span></a><span class="sd">        &gt;&gt;&gt; arrival_event = Event(</span>
</span><span id="Event-101"><a href="#Event-101"><span class="linenos">101</span></a><span class="sd">        ...     event_type=&quot;arrival&quot;,</span>
</span><span id="Event-102"><a href="#Event-102"><span class="linenos">102</span></a><span class="sd">        ...     time=15.5,</span>
</span><span id="Event-103"><a href="#Event-103"><span class="linenos">103</span></a><span class="sd">        ...     data={&quot;location&quot;: &quot;warehouse_1&quot;},</span>
</span><span id="Event-104"><a href="#Event-104"><span class="linenos">104</span></a><span class="sd">        ...     sender=&quot;vehicle1@localhost&quot;</span>
</span><span id="Event-105"><a href="#Event-105"><span class="linenos">105</span></a><span class="sd">        ... )</span>
</span><span id="Event-106"><a href="#Event-106"><span class="linenos">106</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="Event-107"><a href="#Event-107"><span class="linenos">107</span></a><span class="sd">        &gt;&gt;&gt; # Create traffic change event</span>
</span><span id="Event-108"><a href="#Event-108"><span class="linenos">108</span></a><span class="sd">        &gt;&gt;&gt; transit_event = Event(</span>
</span><span id="Event-109"><a href="#Event-109"><span class="linenos">109</span></a><span class="sd">        ...     event_type=&quot;transit&quot;,</span>
</span><span id="Event-110"><a href="#Event-110"><span class="linenos">110</span></a><span class="sd">        ...     time=20.0,</span>
</span><span id="Event-111"><a href="#Event-111"><span class="linenos">111</span></a><span class="sd">        ...     data={</span>
</span><span id="Event-112"><a href="#Event-112"><span class="linenos">112</span></a><span class="sd">        ...         &quot;edges&quot;: [{</span>
</span><span id="Event-113"><a href="#Event-113"><span class="linenos">113</span></a><span class="sd">        ...             &quot;node1&quot;: 5,</span>
</span><span id="Event-114"><a href="#Event-114"><span class="linenos">114</span></a><span class="sd">        ...             &quot;node2&quot;: 8,</span>
</span><span id="Event-115"><a href="#Event-115"><span class="linenos">115</span></a><span class="sd">        ...             &quot;weight&quot;: 12.3,</span>
</span><span id="Event-116"><a href="#Event-116"><span class="linenos">116</span></a><span class="sd">        ...             &quot;fuel_consumption&quot;: 2.5</span>
</span><span id="Event-117"><a href="#Event-117"><span class="linenos">117</span></a><span class="sd">        ...         }]</span>
</span><span id="Event-118"><a href="#Event-118"><span class="linenos">118</span></a><span class="sd">        ...     }</span>
</span><span id="Event-119"><a href="#Event-119"><span class="linenos">119</span></a><span class="sd">        ... )</span>
</span><span id="Event-120"><a href="#Event-120"><span class="linenos">120</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="Event-121"><a href="#Event-121"><span class="linenos">121</span></a><span class="sd">        &gt;&gt;&gt; # Compare events by time</span>
</span><span id="Event-122"><a href="#Event-122"><span class="linenos">122</span></a><span class="sd">        &gt;&gt;&gt; arrival_event &lt; transit_event</span>
</span><span id="Event-123"><a href="#Event-123"><span class="linenos">123</span></a><span class="sd">        True</span>
</span><span id="Event-124"><a href="#Event-124"><span class="linenos">124</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="Event-125"><a href="#Event-125"><span class="linenos">125</span></a><span class="sd">        &gt;&gt;&gt; # Use in heap</span>
</span><span id="Event-126"><a href="#Event-126"><span class="linenos">126</span></a><span class="sd">        &gt;&gt;&gt; import heapq</span>
</span><span id="Event-127"><a href="#Event-127"><span class="linenos">127</span></a><span class="sd">        &gt;&gt;&gt; heap = []</span>
</span><span id="Event-128"><a href="#Event-128"><span class="linenos">128</span></a><span class="sd">        &gt;&gt;&gt; heapq.heappush(heap, transit_event)</span>
</span><span id="Event-129"><a href="#Event-129"><span class="linenos">129</span></a><span class="sd">        &gt;&gt;&gt; heapq.heappush(heap, arrival_event)</span>
</span><span id="Event-130"><a href="#Event-130"><span class="linenos">130</span></a><span class="sd">        &gt;&gt;&gt; next_event = heapq.heappop(heap)  # Returns arrival_event (earlier time)</span>
</span><span id="Event-131"><a href="#Event-131"><span class="linenos">131</span></a><span class="sd">    </span>
</span><span id="Event-132"><a href="#Event-132"><span class="linenos">132</span></a><span class="sd">    Note:</span>
</span><span id="Event-133"><a href="#Event-133"><span class="linenos">133</span></a><span class="sd">        Event comparison is performed exclusively based on the `time` attribute.</span>
</span><span id="Event-134"><a href="#Event-134"><span class="linenos">134</span></a><span class="sd">        Events with the same time are considered equal for ordering purposes,</span>
</span><span id="Event-135"><a href="#Event-135"><span class="linenos">135</span></a><span class="sd">        but may have different types and data content.</span>
</span><span id="Event-136"><a href="#Event-136"><span class="linenos">136</span></a><span class="sd">        </span>
</span><span id="Event-137"><a href="#Event-137"><span class="linenos">137</span></a><span class="sd">        This design follows the principle of temporal consistency in discrete</span>
</span><span id="Event-138"><a href="#Event-138"><span class="linenos">138</span></a><span class="sd">        event simulation systems.</span>
</span><span id="Event-139"><a href="#Event-139"><span class="linenos">139</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Event-140"><a href="#Event-140"><span class="linenos">140</span></a>    
</span><span id="Event-141"><a href="#Event-141"><span class="linenos">141</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
</span><span id="Event-142"><a href="#Event-142"><span class="linenos">142</span></a>                 <span class="n">sender</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Event-143"><a href="#Event-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new event instance.</span>
</span><span id="Event-144"><a href="#Event-144"><span class="linenos">144</span></a><span class="sd">        </span>
</span><span id="Event-145"><a href="#Event-145"><span class="linenos">145</span></a><span class="sd">        Creates an event object with specified type, temporal occurrence, associated data,</span>
</span><span id="Event-146"><a href="#Event-146"><span class="linenos">146</span></a><span class="sd">        and optional sender identification. This constructor performs no validation,</span>
</span><span id="Event-147"><a href="#Event-147"><span class="linenos">147</span></a><span class="sd">        relying on the caller to provide semantically correct values.</span>
</span><span id="Event-148"><a href="#Event-148"><span class="linenos">148</span></a><span class="sd">        </span>
</span><span id="Event-149"><a href="#Event-149"><span class="linenos">149</span></a><span class="sd">        Args:</span>
</span><span id="Event-150"><a href="#Event-150"><span class="linenos">150</span></a><span class="sd">            event_type (str): Event type identifier. Common values include &quot;arrival&quot;,</span>
</span><span id="Event-151"><a href="#Event-151"><span class="linenos">151</span></a><span class="sd">                &quot;transit&quot;, &quot;updatesimulation&quot;. Determines event processing behavior</span>
</span><span id="Event-152"><a href="#Event-152"><span class="linenos">152</span></a><span class="sd">                and expected data structure.</span>
</span><span id="Event-153"><a href="#Event-153"><span class="linenos">153</span></a><span class="sd">            time (float): Event occurrence time in simulation seconds. Used for</span>
</span><span id="Event-154"><a href="#Event-154"><span class="linenos">154</span></a><span class="sd">                heap ordering - lower values indicate higher priority and earlier</span>
</span><span id="Event-155"><a href="#Event-155"><span class="linenos">155</span></a><span class="sd">                processing. Must be non-negative.</span>
</span><span id="Event-156"><a href="#Event-156"><span class="linenos">156</span></a><span class="sd">            data (Dict[str, Any]): Event-specific data dictionary. Structure varies</span>
</span><span id="Event-157"><a href="#Event-157"><span class="linenos">157</span></a><span class="sd">                by event type:</span>
</span><span id="Event-158"><a href="#Event-158"><span class="linenos">158</span></a><span class="sd">                - **arrival**: {&quot;location&quot;: str, &quot;vehicle&quot;: str} - Location and vehicle ID</span>
</span><span id="Event-159"><a href="#Event-159"><span class="linenos">159</span></a><span class="sd">                - **transit**: {&quot;edges&quot;: List[Dict], &quot;node1&quot;: int, &quot;node2&quot;: int, </span>
</span><span id="Event-160"><a href="#Event-160"><span class="linenos">160</span></a><span class="sd">                  &quot;weight&quot;: float, &quot;fuel_consumption&quot;: float} - Graph edge updates</span>
</span><span id="Event-161"><a href="#Event-161"><span class="linenos">161</span></a><span class="sd">                - **updatesimulation**: {&quot;action&quot;: str, &quot;requester&quot;: str} - Simulation requests</span>
</span><span id="Event-162"><a href="#Event-162"><span class="linenos">162</span></a><span class="sd">            sender (str, optional): Full JID of sending agent in format &quot;name@server&quot;.</span>
</span><span id="Event-163"><a href="#Event-163"><span class="linenos">163</span></a><span class="sd">                None indicates internal/system-generated event. Defaults to None.</span>
</span><span id="Event-164"><a href="#Event-164"><span class="linenos">164</span></a><span class="sd">        </span>
</span><span id="Event-165"><a href="#Event-165"><span class="linenos">165</span></a><span class="sd">        Examples:</span>
</span><span id="Event-166"><a href="#Event-166"><span class="linenos">166</span></a><span class="sd">            &gt;&gt;&gt; # Simple arrival event</span>
</span><span id="Event-167"><a href="#Event-167"><span class="linenos">167</span></a><span class="sd">            &gt;&gt;&gt; event = Event(&quot;arrival&quot;, 10.5, {&quot;vehicle&quot;: &quot;v1&quot;}, &quot;vehicle1@localhost&quot;)</span>
</span><span id="Event-168"><a href="#Event-168"><span class="linenos">168</span></a><span class="sd">            &gt;&gt;&gt; event.time</span>
</span><span id="Event-169"><a href="#Event-169"><span class="linenos">169</span></a><span class="sd">            10.5</span>
</span><span id="Event-170"><a href="#Event-170"><span class="linenos">170</span></a><span class="sd">            &gt;&gt;&gt; event.event_type</span>
</span><span id="Event-171"><a href="#Event-171"><span class="linenos">171</span></a><span class="sd">            &#39;arrival&#39;</span>
</span><span id="Event-172"><a href="#Event-172"><span class="linenos">172</span></a><span class="sd">            &gt;&gt;&gt; </span>
</span><span id="Event-173"><a href="#Event-173"><span class="linenos">173</span></a><span class="sd">            &gt;&gt;&gt; # Transit event without sender (system-generated)</span>
</span><span id="Event-174"><a href="#Event-174"><span class="linenos">174</span></a><span class="sd">            &gt;&gt;&gt; transit = Event(&quot;transit&quot;, 5.0, {&quot;edges&quot;: [...]})</span>
</span><span id="Event-175"><a href="#Event-175"><span class="linenos">175</span></a><span class="sd">            &gt;&gt;&gt; transit.sender is None</span>
</span><span id="Event-176"><a href="#Event-176"><span class="linenos">176</span></a><span class="sd">            True</span>
</span><span id="Event-177"><a href="#Event-177"><span class="linenos">177</span></a><span class="sd">        </span>
</span><span id="Event-178"><a href="#Event-178"><span class="linenos">178</span></a><span class="sd">        Note:</span>
</span><span id="Event-179"><a href="#Event-179"><span class="linenos">179</span></a><span class="sd">            The constructor does not validate event_type values or data structure.</span>
</span><span id="Event-180"><a href="#Event-180"><span class="linenos">180</span></a><span class="sd">            Validation should be performed by event processors based on type.</span>
</span><span id="Event-181"><a href="#Event-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event-182"><a href="#Event-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">=</span> <span class="n">event_type</span>  <span class="c1"># Event type: &quot;arrival&quot;, &quot;transit&quot;, etc.</span>
</span><span id="Event-183"><a href="#Event-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>  <span class="c1"># Event occurrence time</span>
</span><span id="Event-184"><a href="#Event-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1"># Event-specific data payload</span>
</span><span id="Event-185"><a href="#Event-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">sender</span>  <span class="c1"># Originating agent JID</span>
</span><span id="Event-186"><a href="#Event-186"><span class="linenos">186</span></a>    
</span><span id="Event-187"><a href="#Event-187"><span class="linenos">187</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Event-188"><a href="#Event-188"><span class="linenos">188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Less-than comparison operator for min heap ordering.</span>
</span><span id="Event-189"><a href="#Event-189"><span class="linenos">189</span></a><span class="sd">        </span>
</span><span id="Event-190"><a href="#Event-190"><span class="linenos">190</span></a><span class="sd">        Implements the less-than comparison required by Python&#39;s heapq module</span>
</span><span id="Event-191"><a href="#Event-191"><span class="linenos">191</span></a><span class="sd">        for maintaining min heap invariant. Events with earlier times have</span>
</span><span id="Event-192"><a href="#Event-192"><span class="linenos">192</span></a><span class="sd">        higher priority and are processed first.</span>
</span><span id="Event-193"><a href="#Event-193"><span class="linenos">193</span></a><span class="sd">        </span>
</span><span id="Event-194"><a href="#Event-194"><span class="linenos">194</span></a><span class="sd">        Args:</span>
</span><span id="Event-195"><a href="#Event-195"><span class="linenos">195</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="Event-196"><a href="#Event-196"><span class="linenos">196</span></a><span class="sd">        </span>
</span><span id="Event-197"><a href="#Event-197"><span class="linenos">197</span></a><span class="sd">        Returns:</span>
</span><span id="Event-198"><a href="#Event-198"><span class="linenos">198</span></a><span class="sd">            bool: True if this event has earlier time (higher priority),</span>
</span><span id="Event-199"><a href="#Event-199"><span class="linenos">199</span></a><span class="sd">                False otherwise.</span>
</span><span id="Event-200"><a href="#Event-200"><span class="linenos">200</span></a><span class="sd">        </span>
</span><span id="Event-201"><a href="#Event-201"><span class="linenos">201</span></a><span class="sd">        Examples:</span>
</span><span id="Event-202"><a href="#Event-202"><span class="linenos">202</span></a><span class="sd">            &gt;&gt;&gt; early = Event(&quot;arrival&quot;, 5.0, {})</span>
</span><span id="Event-203"><a href="#Event-203"><span class="linenos">203</span></a><span class="sd">            &gt;&gt;&gt; late = Event(&quot;transit&quot;, 10.0, {})</span>
</span><span id="Event-204"><a href="#Event-204"><span class="linenos">204</span></a><span class="sd">            &gt;&gt;&gt; early &lt; late</span>
</span><span id="Event-205"><a href="#Event-205"><span class="linenos">205</span></a><span class="sd">            True</span>
</span><span id="Event-206"><a href="#Event-206"><span class="linenos">206</span></a><span class="sd">            &gt;&gt;&gt; late &lt; early</span>
</span><span id="Event-207"><a href="#Event-207"><span class="linenos">207</span></a><span class="sd">            False</span>
</span><span id="Event-208"><a href="#Event-208"><span class="linenos">208</span></a><span class="sd">        </span>
</span><span id="Event-209"><a href="#Event-209"><span class="linenos">209</span></a><span class="sd">        Note:</span>
</span><span id="Event-210"><a href="#Event-210"><span class="linenos">210</span></a><span class="sd">            This method is essential for heapq module functionality.</span>
</span><span id="Event-211"><a href="#Event-211"><span class="linenos">211</span></a><span class="sd">            Events with lower time values are processed first (min heap property).</span>
</span><span id="Event-212"><a href="#Event-212"><span class="linenos">212</span></a><span class="sd">            Only the time attribute is compared; other attributes are ignored.</span>
</span><span id="Event-213"><a href="#Event-213"><span class="linenos">213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event-214"><a href="#Event-214"><span class="linenos">214</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="Event-215"><a href="#Event-215"><span class="linenos">215</span></a>    
</span><span id="Event-216"><a href="#Event-216"><span class="linenos">216</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Event-217"><a href="#Event-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Less-than-or-equal comparison operator.</span>
</span><span id="Event-218"><a href="#Event-218"><span class="linenos">218</span></a><span class="sd">        </span>
</span><span id="Event-219"><a href="#Event-219"><span class="linenos">219</span></a><span class="sd">        Compares events based on their temporal occurrence, supporting</span>
</span><span id="Event-220"><a href="#Event-220"><span class="linenos">220</span></a><span class="sd">        sorting and filtering operations.</span>
</span><span id="Event-221"><a href="#Event-221"><span class="linenos">221</span></a><span class="sd">        </span>
</span><span id="Event-222"><a href="#Event-222"><span class="linenos">222</span></a><span class="sd">        Args:</span>
</span><span id="Event-223"><a href="#Event-223"><span class="linenos">223</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="Event-224"><a href="#Event-224"><span class="linenos">224</span></a><span class="sd">        </span>
</span><span id="Event-225"><a href="#Event-225"><span class="linenos">225</span></a><span class="sd">        Returns:</span>
</span><span id="Event-226"><a href="#Event-226"><span class="linenos">226</span></a><span class="sd">            bool: True if this event occurs at or before the other event.</span>
</span><span id="Event-227"><a href="#Event-227"><span class="linenos">227</span></a><span class="sd">        </span>
</span><span id="Event-228"><a href="#Event-228"><span class="linenos">228</span></a><span class="sd">        Examples:</span>
</span><span id="Event-229"><a href="#Event-229"><span class="linenos">229</span></a><span class="sd">            &gt;&gt;&gt; e1 = Event(&quot;arrival&quot;, 5.0, {})</span>
</span><span id="Event-230"><a href="#Event-230"><span class="linenos">230</span></a><span class="sd">            &gt;&gt;&gt; e2 = Event(&quot;transit&quot;, 5.0, {})</span>
</span><span id="Event-231"><a href="#Event-231"><span class="linenos">231</span></a><span class="sd">            &gt;&gt;&gt; e1 &lt;= e2</span>
</span><span id="Event-232"><a href="#Event-232"><span class="linenos">232</span></a><span class="sd">            True</span>
</span><span id="Event-233"><a href="#Event-233"><span class="linenos">233</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event-234"><a href="#Event-234"><span class="linenos">234</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="Event-235"><a href="#Event-235"><span class="linenos">235</span></a>    
</span><span id="Event-236"><a href="#Event-236"><span class="linenos">236</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Event-237"><a href="#Event-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Greater-than comparison operator.</span>
</span><span id="Event-238"><a href="#Event-238"><span class="linenos">238</span></a><span class="sd">        </span>
</span><span id="Event-239"><a href="#Event-239"><span class="linenos">239</span></a><span class="sd">        Compares events based on temporal occurrence for reverse ordering</span>
</span><span id="Event-240"><a href="#Event-240"><span class="linenos">240</span></a><span class="sd">        and filtering operations.</span>
</span><span id="Event-241"><a href="#Event-241"><span class="linenos">241</span></a><span class="sd">        </span>
</span><span id="Event-242"><a href="#Event-242"><span class="linenos">242</span></a><span class="sd">        Args:</span>
</span><span id="Event-243"><a href="#Event-243"><span class="linenos">243</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="Event-244"><a href="#Event-244"><span class="linenos">244</span></a><span class="sd">        </span>
</span><span id="Event-245"><a href="#Event-245"><span class="linenos">245</span></a><span class="sd">        Returns:</span>
</span><span id="Event-246"><a href="#Event-246"><span class="linenos">246</span></a><span class="sd">            bool: True if this event occurs after the other event.</span>
</span><span id="Event-247"><a href="#Event-247"><span class="linenos">247</span></a><span class="sd">        </span>
</span><span id="Event-248"><a href="#Event-248"><span class="linenos">248</span></a><span class="sd">        Examples:</span>
</span><span id="Event-249"><a href="#Event-249"><span class="linenos">249</span></a><span class="sd">            &gt;&gt;&gt; late = Event(&quot;arrival&quot;, 10.0, {})</span>
</span><span id="Event-250"><a href="#Event-250"><span class="linenos">250</span></a><span class="sd">            &gt;&gt;&gt; early = Event(&quot;transit&quot;, 5.0, {})</span>
</span><span id="Event-251"><a href="#Event-251"><span class="linenos">251</span></a><span class="sd">            &gt;&gt;&gt; late &gt; early</span>
</span><span id="Event-252"><a href="#Event-252"><span class="linenos">252</span></a><span class="sd">            True</span>
</span><span id="Event-253"><a href="#Event-253"><span class="linenos">253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event-254"><a href="#Event-254"><span class="linenos">254</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="Event-255"><a href="#Event-255"><span class="linenos">255</span></a>    
</span><span id="Event-256"><a href="#Event-256"><span class="linenos">256</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Event-257"><a href="#Event-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Greater-than-or-equal comparison operator.</span>
</span><span id="Event-258"><a href="#Event-258"><span class="linenos">258</span></a><span class="sd">        </span>
</span><span id="Event-259"><a href="#Event-259"><span class="linenos">259</span></a><span class="sd">        Compares events based on temporal occurrence, supporting</span>
</span><span id="Event-260"><a href="#Event-260"><span class="linenos">260</span></a><span class="sd">        sorting and filtering in descending order.</span>
</span><span id="Event-261"><a href="#Event-261"><span class="linenos">261</span></a><span class="sd">        </span>
</span><span id="Event-262"><a href="#Event-262"><span class="linenos">262</span></a><span class="sd">        Args:</span>
</span><span id="Event-263"><a href="#Event-263"><span class="linenos">263</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="Event-264"><a href="#Event-264"><span class="linenos">264</span></a><span class="sd">        </span>
</span><span id="Event-265"><a href="#Event-265"><span class="linenos">265</span></a><span class="sd">        Returns:</span>
</span><span id="Event-266"><a href="#Event-266"><span class="linenos">266</span></a><span class="sd">            bool: True if this event occurs at or after the other event.</span>
</span><span id="Event-267"><a href="#Event-267"><span class="linenos">267</span></a><span class="sd">        </span>
</span><span id="Event-268"><a href="#Event-268"><span class="linenos">268</span></a><span class="sd">        Examples:</span>
</span><span id="Event-269"><a href="#Event-269"><span class="linenos">269</span></a><span class="sd">            &gt;&gt;&gt; e1 = Event(&quot;arrival&quot;, 5.0, {})</span>
</span><span id="Event-270"><a href="#Event-270"><span class="linenos">270</span></a><span class="sd">            &gt;&gt;&gt; e2 = Event(&quot;transit&quot;, 5.0, {})</span>
</span><span id="Event-271"><a href="#Event-271"><span class="linenos">271</span></a><span class="sd">            &gt;&gt;&gt; e1 &gt;= e2</span>
</span><span id="Event-272"><a href="#Event-272"><span class="linenos">272</span></a><span class="sd">            True</span>
</span><span id="Event-273"><a href="#Event-273"><span class="linenos">273</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event-274"><a href="#Event-274"><span class="linenos">274</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="Event-275"><a href="#Event-275"><span class="linenos">275</span></a>    
</span><span id="Event-276"><a href="#Event-276"><span class="linenos">276</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Event-277"><a href="#Event-277"><span class="linenos">277</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Equality comparison operator.</span>
</span><span id="Event-278"><a href="#Event-278"><span class="linenos">278</span></a><span class="sd">        </span>
</span><span id="Event-279"><a href="#Event-279"><span class="linenos">279</span></a><span class="sd">        Determines if two events occur at the same simulation time.</span>
</span><span id="Event-280"><a href="#Event-280"><span class="linenos">280</span></a><span class="sd">        Note that events are considered equal for ordering purposes even</span>
</span><span id="Event-281"><a href="#Event-281"><span class="linenos">281</span></a><span class="sd">        if they have different types or data content.</span>
</span><span id="Event-282"><a href="#Event-282"><span class="linenos">282</span></a><span class="sd">        </span>
</span><span id="Event-283"><a href="#Event-283"><span class="linenos">283</span></a><span class="sd">        Args:</span>
</span><span id="Event-284"><a href="#Event-284"><span class="linenos">284</span></a><span class="sd">            other (Event): Another event instance for comparison.</span>
</span><span id="Event-285"><a href="#Event-285"><span class="linenos">285</span></a><span class="sd">        </span>
</span><span id="Event-286"><a href="#Event-286"><span class="linenos">286</span></a><span class="sd">        Returns:</span>
</span><span id="Event-287"><a href="#Event-287"><span class="linenos">287</span></a><span class="sd">            bool: True if events have identical occurrence time.</span>
</span><span id="Event-288"><a href="#Event-288"><span class="linenos">288</span></a><span class="sd">        </span>
</span><span id="Event-289"><a href="#Event-289"><span class="linenos">289</span></a><span class="sd">        Examples:</span>
</span><span id="Event-290"><a href="#Event-290"><span class="linenos">290</span></a><span class="sd">            &gt;&gt;&gt; e1 = Event(&quot;arrival&quot;, 5.0, {&quot;a&quot;: 1})</span>
</span><span id="Event-291"><a href="#Event-291"><span class="linenos">291</span></a><span class="sd">            &gt;&gt;&gt; e2 = Event(&quot;transit&quot;, 5.0, {&quot;b&quot;: 2})</span>
</span><span id="Event-292"><a href="#Event-292"><span class="linenos">292</span></a><span class="sd">            &gt;&gt;&gt; e1 == e2</span>
</span><span id="Event-293"><a href="#Event-293"><span class="linenos">293</span></a><span class="sd">            True</span>
</span><span id="Event-294"><a href="#Event-294"><span class="linenos">294</span></a><span class="sd">        </span>
</span><span id="Event-295"><a href="#Event-295"><span class="linenos">295</span></a><span class="sd">        Note:</span>
</span><span id="Event-296"><a href="#Event-296"><span class="linenos">296</span></a><span class="sd">            Only the time attribute is compared. Events with same time but</span>
</span><span id="Event-297"><a href="#Event-297"><span class="linenos">297</span></a><span class="sd">            different types are considered equal for ordering purposes.</span>
</span><span id="Event-298"><a href="#Event-298"><span class="linenos">298</span></a><span class="sd">            This design enables simultaneous processing of concurrent events.</span>
</span><span id="Event-299"><a href="#Event-299"><span class="linenos">299</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event-300"><a href="#Event-300"><span class="linenos">300</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
</span><span id="Event-301"><a href="#Event-301"><span class="linenos">301</span></a>    
</span><span id="Event-302"><a href="#Event-302"><span class="linenos">302</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Event-303"><a href="#Event-303"><span class="linenos">303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return string representation of event for debugging.</span>
</span><span id="Event-304"><a href="#Event-304"><span class="linenos">304</span></a><span class="sd">        </span>
</span><span id="Event-305"><a href="#Event-305"><span class="linenos">305</span></a><span class="sd">        Provides a human-readable representation including event type,</span>
</span><span id="Event-306"><a href="#Event-306"><span class="linenos">306</span></a><span class="sd">        occurrence time, and sender information. Useful for logging,</span>
</span><span id="Event-307"><a href="#Event-307"><span class="linenos">307</span></a><span class="sd">        debugging, and interactive inspection.</span>
</span><span id="Event-308"><a href="#Event-308"><span class="linenos">308</span></a><span class="sd">        </span>
</span><span id="Event-309"><a href="#Event-309"><span class="linenos">309</span></a><span class="sd">        Returns:</span>
</span><span id="Event-310"><a href="#Event-310"><span class="linenos">310</span></a><span class="sd">            str: Formatted string with key event information in format:</span>
</span><span id="Event-311"><a href="#Event-311"><span class="linenos">311</span></a><span class="sd">                &quot;Event(type=&lt;type&gt;, time=&lt;time&gt;, sender=&lt;sender&gt;)&quot;</span>
</span><span id="Event-312"><a href="#Event-312"><span class="linenos">312</span></a><span class="sd">                Time is formatted to 2 decimal places.</span>
</span><span id="Event-313"><a href="#Event-313"><span class="linenos">313</span></a><span class="sd">        </span>
</span><span id="Event-314"><a href="#Event-314"><span class="linenos">314</span></a><span class="sd">        Examples:</span>
</span><span id="Event-315"><a href="#Event-315"><span class="linenos">315</span></a><span class="sd">            &gt;&gt;&gt; event = Event(&quot;arrival&quot;, 15.5, {}, &quot;vehicle1@localhost&quot;)</span>
</span><span id="Event-316"><a href="#Event-316"><span class="linenos">316</span></a><span class="sd">            &gt;&gt;&gt; repr(event)</span>
</span><span id="Event-317"><a href="#Event-317"><span class="linenos">317</span></a><span class="sd">            &#39;Event(type=arrival, time=15.50, sender=vehicle1@localhost)&#39;</span>
</span><span id="Event-318"><a href="#Event-318"><span class="linenos">318</span></a><span class="sd">            &gt;&gt;&gt; </span>
</span><span id="Event-319"><a href="#Event-319"><span class="linenos">319</span></a><span class="sd">            &gt;&gt;&gt; print(event)</span>
</span><span id="Event-320"><a href="#Event-320"><span class="linenos">320</span></a><span class="sd">            Event(type=arrival, time=15.50, sender=vehicle1@localhost)</span>
</span><span id="Event-321"><a href="#Event-321"><span class="linenos">321</span></a><span class="sd">        </span>
</span><span id="Event-322"><a href="#Event-322"><span class="linenos">322</span></a><span class="sd">        Note:</span>
</span><span id="Event-323"><a href="#Event-323"><span class="linenos">323</span></a><span class="sd">            The data attribute is not included in the representation to</span>
</span><span id="Event-324"><a href="#Event-324"><span class="linenos">324</span></a><span class="sd">            keep output concise. Use event.data for full details.</span>
</span><span id="Event-325"><a href="#Event-325"><span class="linenos">325</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event-326"><a href="#Event-326"><span class="linenos">326</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Event(type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sender=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="Event-327"><a href="#Event-327"><span class="linenos">327</span></a>    
</span><span id="Event-328"><a href="#Event-328"><span class="linenos">328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="Event-329"><a href="#Event-329"><span class="linenos">329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert event to dictionary format for XMPP message transmission.</span>
</span><span id="Event-330"><a href="#Event-330"><span class="linenos">330</span></a><span class="sd">        </span>
</span><span id="Event-331"><a href="#Event-331"><span class="linenos">331</span></a><span class="sd">        Serializes the event into a format suitable for sending through the SPADE</span>
</span><span id="Event-332"><a href="#Event-332"><span class="linenos">332</span></a><span class="sd">        messaging system. The dictionary structure varies by event type to optimize</span>
</span><span id="Event-333"><a href="#Event-333"><span class="linenos">333</span></a><span class="sd">        data transmission and maintain FIPA ACL compliance.</span>
</span><span id="Event-334"><a href="#Event-334"><span class="linenos">334</span></a><span class="sd">        </span>
</span><span id="Event-335"><a href="#Event-335"><span class="linenos">335</span></a><span class="sd">        This method follows FIPA principles by creating a structured content format</span>
</span><span id="Event-336"><a href="#Event-336"><span class="linenos">336</span></a><span class="sd">        that can be embedded in FIPA ACL message bodies.</span>
</span><span id="Event-337"><a href="#Event-337"><span class="linenos">337</span></a><span class="sd">        </span>
</span><span id="Event-338"><a href="#Event-338"><span class="linenos">338</span></a><span class="sd">        Returns:</span>
</span><span id="Event-339"><a href="#Event-339"><span class="linenos">339</span></a><span class="sd">            Dict[str, Any]: Dictionary with fields appropriate to event type:</span>
</span><span id="Event-340"><a href="#Event-340"><span class="linenos">340</span></a><span class="sd">                - **arrival**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;vehicle&quot;: str}</span>
</span><span id="Event-341"><a href="#Event-341"><span class="linenos">341</span></a><span class="sd">                  Vehicle name extracted from sender JID (before &#39;@&#39;).</span>
</span><span id="Event-342"><a href="#Event-342"><span class="linenos">342</span></a><span class="sd">                - **transit**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;data&quot;: Dict}</span>
</span><span id="Event-343"><a href="#Event-343"><span class="linenos">343</span></a><span class="sd">                  Complete data payload including edge updates.</span>
</span><span id="Event-344"><a href="#Event-344"><span class="linenos">344</span></a><span class="sd">                - **other types**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;data&quot;: Dict}</span>
</span><span id="Event-345"><a href="#Event-345"><span class="linenos">345</span></a><span class="sd">                  Generic structure with full data content.</span>
</span><span id="Event-346"><a href="#Event-346"><span class="linenos">346</span></a><span class="sd">        </span>
</span><span id="Event-347"><a href="#Event-347"><span class="linenos">347</span></a><span class="sd">        Examples:</span>
</span><span id="Event-348"><a href="#Event-348"><span class="linenos">348</span></a><span class="sd">            &gt;&gt;&gt; # Arrival event serialization</span>
</span><span id="Event-349"><a href="#Event-349"><span class="linenos">349</span></a><span class="sd">            &gt;&gt;&gt; arrival_event = Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle1@localhost&quot;)</span>
</span><span id="Event-350"><a href="#Event-350"><span class="linenos">350</span></a><span class="sd">            &gt;&gt;&gt; arrival_event.to_dict()</span>
</span><span id="Event-351"><a href="#Event-351"><span class="linenos">351</span></a><span class="sd">            {&#39;type&#39;: &#39;arrival&#39;, &#39;time&#39;: 10.5, &#39;vehicle&#39;: &#39;vehicle1&#39;}</span>
</span><span id="Event-352"><a href="#Event-352"><span class="linenos">352</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Event-353"><a href="#Event-353"><span class="linenos">353</span></a><span class="sd">            &gt;&gt;&gt; # Transit event serialization</span>
</span><span id="Event-354"><a href="#Event-354"><span class="linenos">354</span></a><span class="sd">            &gt;&gt;&gt; transit_event = Event(&quot;transit&quot;, 5.0, {&quot;edges&quot;: [...]})</span>
</span><span id="Event-355"><a href="#Event-355"><span class="linenos">355</span></a><span class="sd">            &gt;&gt;&gt; transit_event.to_dict()</span>
</span><span id="Event-356"><a href="#Event-356"><span class="linenos">356</span></a><span class="sd">            {&#39;type&#39;: &#39;transit&#39;, &#39;time&#39;: 5.0, &#39;data&#39;: {&#39;edges&#39;: [...]}}</span>
</span><span id="Event-357"><a href="#Event-357"><span class="linenos">357</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Event-358"><a href="#Event-358"><span class="linenos">358</span></a><span class="sd">            &gt;&gt;&gt; # Custom event serialization</span>
</span><span id="Event-359"><a href="#Event-359"><span class="linenos">359</span></a><span class="sd">            &gt;&gt;&gt; custom_event = Event(&quot;custom&quot;, 3.0, {&quot;key&quot;: &quot;value&quot;})</span>
</span><span id="Event-360"><a href="#Event-360"><span class="linenos">360</span></a><span class="sd">            &gt;&gt;&gt; custom_event.to_dict()</span>
</span><span id="Event-361"><a href="#Event-361"><span class="linenos">361</span></a><span class="sd">            {&#39;type&#39;: &#39;custom&#39;, &#39;time&#39;: 3.0, &#39;data&#39;: {&#39;key&#39;: &#39;value&#39;}}</span>
</span><span id="Event-362"><a href="#Event-362"><span class="linenos">362</span></a><span class="sd">        </span>
</span><span id="Event-363"><a href="#Event-363"><span class="linenos">363</span></a><span class="sd">        Note:</span>
</span><span id="Event-364"><a href="#Event-364"><span class="linenos">364</span></a><span class="sd">            For arrival events, the vehicle name is extracted from the sender JID</span>
</span><span id="Event-365"><a href="#Event-365"><span class="linenos">365</span></a><span class="sd">            (portion before &#39;@&#39;). For transit events, all data is included.</span>
</span><span id="Event-366"><a href="#Event-366"><span class="linenos">366</span></a><span class="sd">            This serialization format is designed for JSON encoding and XMPP</span>
</span><span id="Event-367"><a href="#Event-367"><span class="linenos">367</span></a><span class="sd">            message transmission.</span>
</span><span id="Event-368"><a href="#Event-368"><span class="linenos">368</span></a><span class="sd">        </span>
</span><span id="Event-369"><a href="#Event-369"><span class="linenos">369</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="Event-370"><a href="#Event-370"><span class="linenos">370</span></a><span class="sd">            The returned dictionary serves as the content of FIPA ACL messages,</span>
</span><span id="Event-371"><a href="#Event-371"><span class="linenos">371</span></a><span class="sd">            providing structured semantic information that agents can interpret</span>
</span><span id="Event-372"><a href="#Event-372"><span class="linenos">372</span></a><span class="sd">            according to the event type.</span>
</span><span id="Event-373"><a href="#Event-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event-374"><a href="#Event-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="Event-375"><a href="#Event-375"><span class="linenos">375</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Event-376"><a href="#Event-376"><span class="linenos">376</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="Event-377"><a href="#Event-377"><span class="linenos">377</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="Event-378"><a href="#Event-378"><span class="linenos">378</span></a>                <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Event-379"><a href="#Event-379"><span class="linenos">379</span></a>            <span class="p">}</span>
</span><span id="Event-380"><a href="#Event-380"><span class="linenos">380</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span><span class="p">:</span>
</span><span id="Event-381"><a href="#Event-381"><span class="linenos">381</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Event-382"><a href="#Event-382"><span class="linenos">382</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="Event-383"><a href="#Event-383"><span class="linenos">383</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="Event-384"><a href="#Event-384"><span class="linenos">384</span></a>                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="Event-385"><a href="#Event-385"><span class="linenos">385</span></a>            <span class="p">}</span>
</span><span id="Event-386"><a href="#Event-386"><span class="linenos">386</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Event-387"><a href="#Event-387"><span class="linenos">387</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Event-388"><a href="#Event-388"><span class="linenos">388</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="Event-389"><a href="#Event-389"><span class="linenos">389</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="Event-390"><a href="#Event-390"><span class="linenos">390</span></a>                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="Event-391"><a href="#Event-391"><span class="linenos">391</span></a>            <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Temporal event representation for supply chain simulation.</p>

<p>This class encapsulates information about events that occur at specific moments
during the simulation. Events are comparable and orderable by time, allowing
their use in a min heap structure for chronological processing.</p>

<p>The event system supports various event types representing different occurrences
in the supply chain:
    - <strong>arrival</strong>: Vehicle arrival at a node (warehouse, store, gas station)
    - <strong>transit</strong>: Traffic condition changes on a graph edge
    - <strong>updatesimulation</strong>: Request for traffic simulation update
    - Custom types as needed by the simulation</p>

<p>Comparison operations are based solely on the <code><a href="#Event.time">time</a></code> attribute, implementing
a total ordering for heap-based priority queue operations.</p>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>event_type (str):</strong>  Type of event (e.g., "arrival", "transit", "updatesimulation").
Defines the processing behavior and data structure expected.</li>
<li><strong>time (float):</strong>  Event occurrence time in simulation seconds. Used for
heap ordering - lower values have higher priority.</li>
<li><strong>data (Dict[str, Any]):</strong>  Event-specific data dictionary. Structure varies by type:
<ul>
<li>arrival: {"location": str, "vehicle": str}</li>
<li>transit: {"edges": List[Dict], "node1": int, "node2": int, "weight": float}</li>
<li>updatesimulation: {"action": str}</li>
</ul></li>
<li><strong>sender (str, optional):</strong>  Full JID of the sending agent (format: "name@server").
None for internal or system-generated events.</li>
</ul>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create vehicle arrival event</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arrival_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">time</span><span class="o">=</span><span class="mf">15.5</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;warehouse_1&quot;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">sender</span><span class="o">=</span><span class="s2">&quot;vehicle1@localhost&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create traffic change event</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;transit&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">time</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>        <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[{</span>
<span class="gp">... </span>            <span class="s2">&quot;node1&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;node2&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="mf">12.3</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;fuel_consumption&quot;</span><span class="p">:</span> <span class="mf">2.5</span>
<span class="gp">... </span>        <span class="p">}]</span>
<span class="gp">... </span>    <span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compare events by time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arrival_event</span> <span class="o">&lt;</span> <span class="n">transit_event</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use in heap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">heapq</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heap</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="n">transit_event</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="n">arrival_event</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">next_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">heap</span><span class="p">)</span>  <span class="c1"># Returns arrival_event (earlier time)</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Event comparison is performed exclusively based on the <code><a href="#Event.time">time</a></code> attribute.
  Events with the same time are considered equal for ordering purposes,
  but may have different types and data content.</p>
  
  <p>This design follows the principle of temporal consistency in discrete
  event simulation systems.</p>
</blockquote>
</div>


                            <div id="Event.__init__" class="classattr">
                                        <input id="Event.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Event</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">time</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">sender</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Event.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Event.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Event.__init__-141"><a href="#Event.__init__-141"><span class="linenos">141</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
</span><span id="Event.__init__-142"><a href="#Event.__init__-142"><span class="linenos">142</span></a>                 <span class="n">sender</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Event.__init__-143"><a href="#Event.__init__-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new event instance.</span>
</span><span id="Event.__init__-144"><a href="#Event.__init__-144"><span class="linenos">144</span></a><span class="sd">        </span>
</span><span id="Event.__init__-145"><a href="#Event.__init__-145"><span class="linenos">145</span></a><span class="sd">        Creates an event object with specified type, temporal occurrence, associated data,</span>
</span><span id="Event.__init__-146"><a href="#Event.__init__-146"><span class="linenos">146</span></a><span class="sd">        and optional sender identification. This constructor performs no validation,</span>
</span><span id="Event.__init__-147"><a href="#Event.__init__-147"><span class="linenos">147</span></a><span class="sd">        relying on the caller to provide semantically correct values.</span>
</span><span id="Event.__init__-148"><a href="#Event.__init__-148"><span class="linenos">148</span></a><span class="sd">        </span>
</span><span id="Event.__init__-149"><a href="#Event.__init__-149"><span class="linenos">149</span></a><span class="sd">        Args:</span>
</span><span id="Event.__init__-150"><a href="#Event.__init__-150"><span class="linenos">150</span></a><span class="sd">            event_type (str): Event type identifier. Common values include &quot;arrival&quot;,</span>
</span><span id="Event.__init__-151"><a href="#Event.__init__-151"><span class="linenos">151</span></a><span class="sd">                &quot;transit&quot;, &quot;updatesimulation&quot;. Determines event processing behavior</span>
</span><span id="Event.__init__-152"><a href="#Event.__init__-152"><span class="linenos">152</span></a><span class="sd">                and expected data structure.</span>
</span><span id="Event.__init__-153"><a href="#Event.__init__-153"><span class="linenos">153</span></a><span class="sd">            time (float): Event occurrence time in simulation seconds. Used for</span>
</span><span id="Event.__init__-154"><a href="#Event.__init__-154"><span class="linenos">154</span></a><span class="sd">                heap ordering - lower values indicate higher priority and earlier</span>
</span><span id="Event.__init__-155"><a href="#Event.__init__-155"><span class="linenos">155</span></a><span class="sd">                processing. Must be non-negative.</span>
</span><span id="Event.__init__-156"><a href="#Event.__init__-156"><span class="linenos">156</span></a><span class="sd">            data (Dict[str, Any]): Event-specific data dictionary. Structure varies</span>
</span><span id="Event.__init__-157"><a href="#Event.__init__-157"><span class="linenos">157</span></a><span class="sd">                by event type:</span>
</span><span id="Event.__init__-158"><a href="#Event.__init__-158"><span class="linenos">158</span></a><span class="sd">                - **arrival**: {&quot;location&quot;: str, &quot;vehicle&quot;: str} - Location and vehicle ID</span>
</span><span id="Event.__init__-159"><a href="#Event.__init__-159"><span class="linenos">159</span></a><span class="sd">                - **transit**: {&quot;edges&quot;: List[Dict], &quot;node1&quot;: int, &quot;node2&quot;: int, </span>
</span><span id="Event.__init__-160"><a href="#Event.__init__-160"><span class="linenos">160</span></a><span class="sd">                  &quot;weight&quot;: float, &quot;fuel_consumption&quot;: float} - Graph edge updates</span>
</span><span id="Event.__init__-161"><a href="#Event.__init__-161"><span class="linenos">161</span></a><span class="sd">                - **updatesimulation**: {&quot;action&quot;: str, &quot;requester&quot;: str} - Simulation requests</span>
</span><span id="Event.__init__-162"><a href="#Event.__init__-162"><span class="linenos">162</span></a><span class="sd">            sender (str, optional): Full JID of sending agent in format &quot;name@server&quot;.</span>
</span><span id="Event.__init__-163"><a href="#Event.__init__-163"><span class="linenos">163</span></a><span class="sd">                None indicates internal/system-generated event. Defaults to None.</span>
</span><span id="Event.__init__-164"><a href="#Event.__init__-164"><span class="linenos">164</span></a><span class="sd">        </span>
</span><span id="Event.__init__-165"><a href="#Event.__init__-165"><span class="linenos">165</span></a><span class="sd">        Examples:</span>
</span><span id="Event.__init__-166"><a href="#Event.__init__-166"><span class="linenos">166</span></a><span class="sd">            &gt;&gt;&gt; # Simple arrival event</span>
</span><span id="Event.__init__-167"><a href="#Event.__init__-167"><span class="linenos">167</span></a><span class="sd">            &gt;&gt;&gt; event = Event(&quot;arrival&quot;, 10.5, {&quot;vehicle&quot;: &quot;v1&quot;}, &quot;vehicle1@localhost&quot;)</span>
</span><span id="Event.__init__-168"><a href="#Event.__init__-168"><span class="linenos">168</span></a><span class="sd">            &gt;&gt;&gt; event.time</span>
</span><span id="Event.__init__-169"><a href="#Event.__init__-169"><span class="linenos">169</span></a><span class="sd">            10.5</span>
</span><span id="Event.__init__-170"><a href="#Event.__init__-170"><span class="linenos">170</span></a><span class="sd">            &gt;&gt;&gt; event.event_type</span>
</span><span id="Event.__init__-171"><a href="#Event.__init__-171"><span class="linenos">171</span></a><span class="sd">            &#39;arrival&#39;</span>
</span><span id="Event.__init__-172"><a href="#Event.__init__-172"><span class="linenos">172</span></a><span class="sd">            &gt;&gt;&gt; </span>
</span><span id="Event.__init__-173"><a href="#Event.__init__-173"><span class="linenos">173</span></a><span class="sd">            &gt;&gt;&gt; # Transit event without sender (system-generated)</span>
</span><span id="Event.__init__-174"><a href="#Event.__init__-174"><span class="linenos">174</span></a><span class="sd">            &gt;&gt;&gt; transit = Event(&quot;transit&quot;, 5.0, {&quot;edges&quot;: [...]})</span>
</span><span id="Event.__init__-175"><a href="#Event.__init__-175"><span class="linenos">175</span></a><span class="sd">            &gt;&gt;&gt; transit.sender is None</span>
</span><span id="Event.__init__-176"><a href="#Event.__init__-176"><span class="linenos">176</span></a><span class="sd">            True</span>
</span><span id="Event.__init__-177"><a href="#Event.__init__-177"><span class="linenos">177</span></a><span class="sd">        </span>
</span><span id="Event.__init__-178"><a href="#Event.__init__-178"><span class="linenos">178</span></a><span class="sd">        Note:</span>
</span><span id="Event.__init__-179"><a href="#Event.__init__-179"><span class="linenos">179</span></a><span class="sd">            The constructor does not validate event_type values or data structure.</span>
</span><span id="Event.__init__-180"><a href="#Event.__init__-180"><span class="linenos">180</span></a><span class="sd">            Validation should be performed by event processors based on type.</span>
</span><span id="Event.__init__-181"><a href="#Event.__init__-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event.__init__-182"><a href="#Event.__init__-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">=</span> <span class="n">event_type</span>  <span class="c1"># Event type: &quot;arrival&quot;, &quot;transit&quot;, etc.</span>
</span><span id="Event.__init__-183"><a href="#Event.__init__-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>  <span class="c1"># Event occurrence time</span>
</span><span id="Event.__init__-184"><a href="#Event.__init__-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>  <span class="c1"># Event-specific data payload</span>
</span><span id="Event.__init__-185"><a href="#Event.__init__-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sender</span> <span class="o">=</span> <span class="n">sender</span>  <span class="c1"># Originating agent JID</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new event instance.</p>

<p>Creates an event object with specified type, temporal occurrence, associated data,
and optional sender identification. This constructor performs no validation,
relying on the caller to provide semantically correct values.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>event_type (str):</strong>  Event type identifier. Common values include "arrival",
"transit", "updatesimulation". Determines event processing behavior
and expected data structure.</li>
<li><strong>time (float):</strong>  Event occurrence time in simulation seconds. Used for
heap ordering - lower values indicate higher priority and earlier
processing. Must be non-negative.</li>
<li><strong>data (Dict[str, Any]):</strong>  Event-specific data dictionary. Structure varies
by event type:
<ul>
<li><strong>arrival</strong>: {"location": str, "vehicle": str} - Location and vehicle ID</li>
<li><strong>transit</strong>: {"edges": List[Dict], "node1": int, "node2": int, 
"weight": float, "fuel_consumption": float} - Graph edge updates</li>
<li><strong>updatesimulation</strong>: {"action": str, "requester": str} - Simulation requests</li>
</ul></li>
<li><strong>sender (str, optional):</strong>  Full JID of sending agent in format "name@server".
None indicates internal/system-generated event. Defaults to None.</li>
</ul>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Simple arrival event</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;arrival&quot;</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="s2">&quot;v1&quot;</span><span class="p">},</span> <span class="s2">&quot;vehicle1@localhost&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">event</span><span class="o">.</span><span class="n">time</span>
<span class="go">10.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">event</span><span class="o">.</span><span class="n">event_type</span>
<span class="go">&#39;arrival&#39;</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Transit event without sender (system-generated)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transit</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transit</span><span class="o">.</span><span class="n">sender</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The constructor does not validate event_type values or data structure.
  Validation should be performed by event processors based on type.</p>
</blockquote>
</div>


                            </div>
                            <div id="Event.event_type" class="classattr">
                                <div class="attr variable">
            <span class="name">event_type</span>

        
    </div>
    <a class="headerlink" href="#Event.event_type"></a>
    
    

                            </div>
                            <div id="Event.time" class="classattr">
                                <div class="attr variable">
            <span class="name">time</span>

        
    </div>
    <a class="headerlink" href="#Event.time"></a>
    
    

                            </div>
                            <div id="Event.data" class="classattr">
                                <div class="attr variable">
            <span class="name">data</span>

        
    </div>
    <a class="headerlink" href="#Event.data"></a>
    
    

                            </div>
                            <div id="Event.sender" class="classattr">
                                <div class="attr variable">
            <span class="name">sender</span>

        
    </div>
    <a class="headerlink" href="#Event.sender"></a>
    
    

                            </div>
                            <div id="Event.to_dict" class="classattr">
                                        <input id="Event.to_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Event.to_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Event.to_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Event.to_dict-328"><a href="#Event.to_dict-328"><span class="linenos">328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="Event.to_dict-329"><a href="#Event.to_dict-329"><span class="linenos">329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert event to dictionary format for XMPP message transmission.</span>
</span><span id="Event.to_dict-330"><a href="#Event.to_dict-330"><span class="linenos">330</span></a><span class="sd">        </span>
</span><span id="Event.to_dict-331"><a href="#Event.to_dict-331"><span class="linenos">331</span></a><span class="sd">        Serializes the event into a format suitable for sending through the SPADE</span>
</span><span id="Event.to_dict-332"><a href="#Event.to_dict-332"><span class="linenos">332</span></a><span class="sd">        messaging system. The dictionary structure varies by event type to optimize</span>
</span><span id="Event.to_dict-333"><a href="#Event.to_dict-333"><span class="linenos">333</span></a><span class="sd">        data transmission and maintain FIPA ACL compliance.</span>
</span><span id="Event.to_dict-334"><a href="#Event.to_dict-334"><span class="linenos">334</span></a><span class="sd">        </span>
</span><span id="Event.to_dict-335"><a href="#Event.to_dict-335"><span class="linenos">335</span></a><span class="sd">        This method follows FIPA principles by creating a structured content format</span>
</span><span id="Event.to_dict-336"><a href="#Event.to_dict-336"><span class="linenos">336</span></a><span class="sd">        that can be embedded in FIPA ACL message bodies.</span>
</span><span id="Event.to_dict-337"><a href="#Event.to_dict-337"><span class="linenos">337</span></a><span class="sd">        </span>
</span><span id="Event.to_dict-338"><a href="#Event.to_dict-338"><span class="linenos">338</span></a><span class="sd">        Returns:</span>
</span><span id="Event.to_dict-339"><a href="#Event.to_dict-339"><span class="linenos">339</span></a><span class="sd">            Dict[str, Any]: Dictionary with fields appropriate to event type:</span>
</span><span id="Event.to_dict-340"><a href="#Event.to_dict-340"><span class="linenos">340</span></a><span class="sd">                - **arrival**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;vehicle&quot;: str}</span>
</span><span id="Event.to_dict-341"><a href="#Event.to_dict-341"><span class="linenos">341</span></a><span class="sd">                  Vehicle name extracted from sender JID (before &#39;@&#39;).</span>
</span><span id="Event.to_dict-342"><a href="#Event.to_dict-342"><span class="linenos">342</span></a><span class="sd">                - **transit**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;data&quot;: Dict}</span>
</span><span id="Event.to_dict-343"><a href="#Event.to_dict-343"><span class="linenos">343</span></a><span class="sd">                  Complete data payload including edge updates.</span>
</span><span id="Event.to_dict-344"><a href="#Event.to_dict-344"><span class="linenos">344</span></a><span class="sd">                - **other types**: {&quot;type&quot;: str, &quot;time&quot;: float, &quot;data&quot;: Dict}</span>
</span><span id="Event.to_dict-345"><a href="#Event.to_dict-345"><span class="linenos">345</span></a><span class="sd">                  Generic structure with full data content.</span>
</span><span id="Event.to_dict-346"><a href="#Event.to_dict-346"><span class="linenos">346</span></a><span class="sd">        </span>
</span><span id="Event.to_dict-347"><a href="#Event.to_dict-347"><span class="linenos">347</span></a><span class="sd">        Examples:</span>
</span><span id="Event.to_dict-348"><a href="#Event.to_dict-348"><span class="linenos">348</span></a><span class="sd">            &gt;&gt;&gt; # Arrival event serialization</span>
</span><span id="Event.to_dict-349"><a href="#Event.to_dict-349"><span class="linenos">349</span></a><span class="sd">            &gt;&gt;&gt; arrival_event = Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle1@localhost&quot;)</span>
</span><span id="Event.to_dict-350"><a href="#Event.to_dict-350"><span class="linenos">350</span></a><span class="sd">            &gt;&gt;&gt; arrival_event.to_dict()</span>
</span><span id="Event.to_dict-351"><a href="#Event.to_dict-351"><span class="linenos">351</span></a><span class="sd">            {&#39;type&#39;: &#39;arrival&#39;, &#39;time&#39;: 10.5, &#39;vehicle&#39;: &#39;vehicle1&#39;}</span>
</span><span id="Event.to_dict-352"><a href="#Event.to_dict-352"><span class="linenos">352</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Event.to_dict-353"><a href="#Event.to_dict-353"><span class="linenos">353</span></a><span class="sd">            &gt;&gt;&gt; # Transit event serialization</span>
</span><span id="Event.to_dict-354"><a href="#Event.to_dict-354"><span class="linenos">354</span></a><span class="sd">            &gt;&gt;&gt; transit_event = Event(&quot;transit&quot;, 5.0, {&quot;edges&quot;: [...]})</span>
</span><span id="Event.to_dict-355"><a href="#Event.to_dict-355"><span class="linenos">355</span></a><span class="sd">            &gt;&gt;&gt; transit_event.to_dict()</span>
</span><span id="Event.to_dict-356"><a href="#Event.to_dict-356"><span class="linenos">356</span></a><span class="sd">            {&#39;type&#39;: &#39;transit&#39;, &#39;time&#39;: 5.0, &#39;data&#39;: {&#39;edges&#39;: [...]}}</span>
</span><span id="Event.to_dict-357"><a href="#Event.to_dict-357"><span class="linenos">357</span></a><span class="sd">            &gt;&gt;&gt;</span>
</span><span id="Event.to_dict-358"><a href="#Event.to_dict-358"><span class="linenos">358</span></a><span class="sd">            &gt;&gt;&gt; # Custom event serialization</span>
</span><span id="Event.to_dict-359"><a href="#Event.to_dict-359"><span class="linenos">359</span></a><span class="sd">            &gt;&gt;&gt; custom_event = Event(&quot;custom&quot;, 3.0, {&quot;key&quot;: &quot;value&quot;})</span>
</span><span id="Event.to_dict-360"><a href="#Event.to_dict-360"><span class="linenos">360</span></a><span class="sd">            &gt;&gt;&gt; custom_event.to_dict()</span>
</span><span id="Event.to_dict-361"><a href="#Event.to_dict-361"><span class="linenos">361</span></a><span class="sd">            {&#39;type&#39;: &#39;custom&#39;, &#39;time&#39;: 3.0, &#39;data&#39;: {&#39;key&#39;: &#39;value&#39;}}</span>
</span><span id="Event.to_dict-362"><a href="#Event.to_dict-362"><span class="linenos">362</span></a><span class="sd">        </span>
</span><span id="Event.to_dict-363"><a href="#Event.to_dict-363"><span class="linenos">363</span></a><span class="sd">        Note:</span>
</span><span id="Event.to_dict-364"><a href="#Event.to_dict-364"><span class="linenos">364</span></a><span class="sd">            For arrival events, the vehicle name is extracted from the sender JID</span>
</span><span id="Event.to_dict-365"><a href="#Event.to_dict-365"><span class="linenos">365</span></a><span class="sd">            (portion before &#39;@&#39;). For transit events, all data is included.</span>
</span><span id="Event.to_dict-366"><a href="#Event.to_dict-366"><span class="linenos">366</span></a><span class="sd">            This serialization format is designed for JSON encoding and XMPP</span>
</span><span id="Event.to_dict-367"><a href="#Event.to_dict-367"><span class="linenos">367</span></a><span class="sd">            message transmission.</span>
</span><span id="Event.to_dict-368"><a href="#Event.to_dict-368"><span class="linenos">368</span></a><span class="sd">        </span>
</span><span id="Event.to_dict-369"><a href="#Event.to_dict-369"><span class="linenos">369</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="Event.to_dict-370"><a href="#Event.to_dict-370"><span class="linenos">370</span></a><span class="sd">            The returned dictionary serves as the content of FIPA ACL messages,</span>
</span><span id="Event.to_dict-371"><a href="#Event.to_dict-371"><span class="linenos">371</span></a><span class="sd">            providing structured semantic information that agents can interpret</span>
</span><span id="Event.to_dict-372"><a href="#Event.to_dict-372"><span class="linenos">372</span></a><span class="sd">            according to the event type.</span>
</span><span id="Event.to_dict-373"><a href="#Event.to_dict-373"><span class="linenos">373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Event.to_dict-374"><a href="#Event.to_dict-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="Event.to_dict-375"><a href="#Event.to_dict-375"><span class="linenos">375</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Event.to_dict-376"><a href="#Event.to_dict-376"><span class="linenos">376</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="Event.to_dict-377"><a href="#Event.to_dict-377"><span class="linenos">377</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="Event.to_dict-378"><a href="#Event.to_dict-378"><span class="linenos">378</span></a>                <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Event.to_dict-379"><a href="#Event.to_dict-379"><span class="linenos">379</span></a>            <span class="p">}</span>
</span><span id="Event.to_dict-380"><a href="#Event.to_dict-380"><span class="linenos">380</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span><span class="p">:</span>
</span><span id="Event.to_dict-381"><a href="#Event.to_dict-381"><span class="linenos">381</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Event.to_dict-382"><a href="#Event.to_dict-382"><span class="linenos">382</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="Event.to_dict-383"><a href="#Event.to_dict-383"><span class="linenos">383</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="Event.to_dict-384"><a href="#Event.to_dict-384"><span class="linenos">384</span></a>                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="Event.to_dict-385"><a href="#Event.to_dict-385"><span class="linenos">385</span></a>            <span class="p">}</span>
</span><span id="Event.to_dict-386"><a href="#Event.to_dict-386"><span class="linenos">386</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Event.to_dict-387"><a href="#Event.to_dict-387"><span class="linenos">387</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Event.to_dict-388"><a href="#Event.to_dict-388"><span class="linenos">388</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="Event.to_dict-389"><a href="#Event.to_dict-389"><span class="linenos">389</span></a>                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
</span><span id="Event.to_dict-390"><a href="#Event.to_dict-390"><span class="linenos">390</span></a>                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
</span><span id="Event.to_dict-391"><a href="#Event.to_dict-391"><span class="linenos">391</span></a>            <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Convert event to dictionary format for XMPP message transmission.</p>

<p>Serializes the event into a format suitable for sending through the SPADE
messaging system. The dictionary structure varies by event type to optimize
data transmission and maintain FIPA ACL compliance.</p>

<p>This method follows FIPA principles by creating a structured content format
that can be embedded in FIPA ACL message bodies.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Dict[str, Any]: Dictionary with fields appropriate to event type:
      - <strong>arrival</strong>: {"type": str, "time": float, "vehicle": str}
        Vehicle name extracted from sender JID (before '@').
      - <strong>transit</strong>: {"type": str, "time": float, "data": Dict}
        Complete data payload including edge updates.
      - <strong>other types</strong>: {"type": str, "time": float, "data": Dict}
        Generic structure with full data content.</p>
</blockquote>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Arrival event serialization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arrival_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;arrival&quot;</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">&quot;vehicle1@localhost&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">arrival_event</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;type&#39;: &#39;arrival&#39;, &#39;time&#39;: 10.5, &#39;vehicle&#39;: &#39;vehicle1&#39;}</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Transit event serialization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transit_event</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;type&#39;: &#39;transit&#39;, &#39;time&#39;: 5.0, &#39;data&#39;: {&#39;edges&#39;: [...]}}</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Custom event serialization</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">custom_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">custom_event</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="go">{&#39;type&#39;: &#39;custom&#39;, &#39;time&#39;: 3.0, &#39;data&#39;: {&#39;key&#39;: &#39;value&#39;}}</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>For arrival events, the vehicle name is extracted from the sender JID
  (portion before '@'). For transit events, all data is included.
  This serialization format is designed for JSON encoding and XMPP
  message transmission.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>The returned dictionary serves as the content of FIPA ACL messages,
  providing structured semantic information that agents can interpret
  according to the event type.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="EventDrivenAgent">
                            <input id="EventDrivenAgent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EventDrivenAgent</span><wbr>(<span class="base">spade.agent.Agent</span>):

                <label class="view-source-button" for="EventDrivenAgent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent-394"><a href="#EventDrivenAgent-394"><span class="linenos"> 394</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EventDrivenAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
</span><span id="EventDrivenAgent-395"><a href="#EventDrivenAgent-395"><span class="linenos"> 395</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Event-driven agent managing temporal simulation with heap-based priority queue.</span>
</span><span id="EventDrivenAgent-396"><a href="#EventDrivenAgent-396"><span class="linenos"> 396</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-397"><a href="#EventDrivenAgent-397"><span class="linenos"> 397</span></a><span class="sd">    This agent serves as the core of the event management system for supply chain simulation.</span>
</span><span id="EventDrivenAgent-398"><a href="#EventDrivenAgent-398"><span class="linenos"> 398</span></a><span class="sd">    It uses a min heap data structure to maintain events ordered by time and processes them</span>
</span><span id="EventDrivenAgent-399"><a href="#EventDrivenAgent-399"><span class="linenos"> 399</span></a><span class="sd">    periodically at configurable intervals. The agent coordinates communications between</span>
</span><span id="EventDrivenAgent-400"><a href="#EventDrivenAgent-400"><span class="linenos"> 400</span></a><span class="sd">    vehicles, warehouses, stores, suppliers, and the world agent, ensuring all participants</span>
</span><span id="EventDrivenAgent-401"><a href="#EventDrivenAgent-401"><span class="linenos"> 401</span></a><span class="sd">    receive relevant event notifications.</span>
</span><span id="EventDrivenAgent-402"><a href="#EventDrivenAgent-402"><span class="linenos"> 402</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-403"><a href="#EventDrivenAgent-403"><span class="linenos"> 403</span></a><span class="sd">    The agent implements FIPA (Foundation for Intelligent Physical Agents) standards for</span>
</span><span id="EventDrivenAgent-404"><a href="#EventDrivenAgent-404"><span class="linenos"> 404</span></a><span class="sd">    multi-agent communication, using XMPP as transport protocol and ACL performatives</span>
</span><span id="EventDrivenAgent-405"><a href="#EventDrivenAgent-405"><span class="linenos"> 405</span></a><span class="sd">    for semantic message exchange.</span>
</span><span id="EventDrivenAgent-406"><a href="#EventDrivenAgent-406"><span class="linenos"> 406</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-407"><a href="#EventDrivenAgent-407"><span class="linenos"> 407</span></a><span class="sd">    Architecture:</span>
</span><span id="EventDrivenAgent-408"><a href="#EventDrivenAgent-408"><span class="linenos"> 408</span></a><span class="sd">        - **Min Heap**: Stores general events ordered by time (O(log n) operations)</span>
</span><span id="EventDrivenAgent-409"><a href="#EventDrivenAgent-409"><span class="linenos"> 409</span></a><span class="sd">        - **Transit Events List**: Separate list for traffic change events with temporal decay</span>
</span><span id="EventDrivenAgent-410"><a href="#EventDrivenAgent-410"><span class="linenos"> 410</span></a><span class="sd">        - **Arrival Events Buffer**: Temporary buffer for vehicle arrival grouping</span>
</span><span id="EventDrivenAgent-411"><a href="#EventDrivenAgent-411"><span class="linenos"> 411</span></a><span class="sd">        - **Behaviours**: Set of asynchronous behaviours executing different functionalities:</span>
</span><span id="EventDrivenAgent-412"><a href="#EventDrivenAgent-412"><span class="linenos"> 412</span></a><span class="sd">            * ReceiveEventsBehaviour: Continuous message reception (CyclicBehaviour)</span>
</span><span id="EventDrivenAgent-413"><a href="#EventDrivenAgent-413"><span class="linenos"> 413</span></a><span class="sd">            * ProcessEventsBehaviour: Periodic event processing (PeriodicBehaviour)</span>
</span><span id="EventDrivenAgent-414"><a href="#EventDrivenAgent-414"><span class="linenos"> 414</span></a><span class="sd">            * SendInitialSignalBehaviour: Initial system activation (PeriodicBehaviour)</span>
</span><span id="EventDrivenAgent-415"><a href="#EventDrivenAgent-415"><span class="linenos"> 415</span></a><span class="sd">            * RegisterTransitBehaviour: Initial traffic simulation request (OneShotBehaviour)</span>
</span><span id="EventDrivenAgent-416"><a href="#EventDrivenAgent-416"><span class="linenos"> 416</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-417"><a href="#EventDrivenAgent-417"><span class="linenos"> 417</span></a><span class="sd">    Workflow:</span>
</span><span id="EventDrivenAgent-418"><a href="#EventDrivenAgent-418"><span class="linenos"> 418</span></a><span class="sd">        1. **Initialization**: Subscribe all registered agents and send initial signal</span>
</span><span id="EventDrivenAgent-419"><a href="#EventDrivenAgent-419"><span class="linenos"> 419</span></a><span class="sd">        2. **Continuous Reception**: Cyclic behaviour receives events from all agents</span>
</span><span id="EventDrivenAgent-420"><a href="#EventDrivenAgent-420"><span class="linenos"> 420</span></a><span class="sd">        3. **Periodic Processing**: At each interval, process events from heap</span>
</span><span id="EventDrivenAgent-421"><a href="#EventDrivenAgent-421"><span class="linenos"> 421</span></a><span class="sd">        4. **Notification**: Distribute processed events to appropriate agents</span>
</span><span id="EventDrivenAgent-422"><a href="#EventDrivenAgent-422"><span class="linenos"> 422</span></a><span class="sd">        5. **Resimulation**: Request new traffic simulation when needed</span>
</span><span id="EventDrivenAgent-423"><a href="#EventDrivenAgent-423"><span class="linenos"> 423</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-424"><a href="#EventDrivenAgent-424"><span class="linenos"> 424</span></a><span class="sd">    Attributes:</span>
</span><span id="EventDrivenAgent-425"><a href="#EventDrivenAgent-425"><span class="linenos"> 425</span></a><span class="sd">        event_heap (List[Event]): Min heap of general events ordered by time.</span>
</span><span id="EventDrivenAgent-426"><a href="#EventDrivenAgent-426"><span class="linenos"> 426</span></a><span class="sd">        transit_events (List[Event]): Separate list for active traffic events with time decay.</span>
</span><span id="EventDrivenAgent-427"><a href="#EventDrivenAgent-427"><span class="linenos"> 427</span></a><span class="sd">        arrival_events (List[Event]): Temporary buffer for vehicle arrival events.</span>
</span><span id="EventDrivenAgent-428"><a href="#EventDrivenAgent-428"><span class="linenos"> 428</span></a><span class="sd">        simulation_interval (float): Interval in seconds between processing cycles.</span>
</span><span id="EventDrivenAgent-429"><a href="#EventDrivenAgent-429"><span class="linenos"> 429</span></a><span class="sd">        registered_vehicles (List[str]): JIDs of vehicles registered in the system.</span>
</span><span id="EventDrivenAgent-430"><a href="#EventDrivenAgent-430"><span class="linenos"> 430</span></a><span class="sd">        registered_warehouses (List[str]): JIDs of registered warehouses.</span>
</span><span id="EventDrivenAgent-431"><a href="#EventDrivenAgent-431"><span class="linenos"> 431</span></a><span class="sd">        registered_stores (List[str]): JIDs of registered stores.</span>
</span><span id="EventDrivenAgent-432"><a href="#EventDrivenAgent-432"><span class="linenos"> 432</span></a><span class="sd">        registered_suppliers (List[str]): JIDs of registered suppliers.</span>
</span><span id="EventDrivenAgent-433"><a href="#EventDrivenAgent-433"><span class="linenos"> 433</span></a><span class="sd">        world_agent (str): JID of the world agent for traffic simulation.</span>
</span><span id="EventDrivenAgent-434"><a href="#EventDrivenAgent-434"><span class="linenos"> 434</span></a><span class="sd">        world_simulation_time (float): Duration in seconds of each traffic simulation.</span>
</span><span id="EventDrivenAgent-435"><a href="#EventDrivenAgent-435"><span class="linenos"> 435</span></a><span class="sd">        event_count (int): Total counter of events received.</span>
</span><span id="EventDrivenAgent-436"><a href="#EventDrivenAgent-436"><span class="linenos"> 436</span></a><span class="sd">        processed_count (int): Total counter of events processed.</span>
</span><span id="EventDrivenAgent-437"><a href="#EventDrivenAgent-437"><span class="linenos"> 437</span></a><span class="sd">        last_simulation_time (float): Timestamp of last processed simulation.</span>
</span><span id="EventDrivenAgent-438"><a href="#EventDrivenAgent-438"><span class="linenos"> 438</span></a><span class="sd">        time_simulated (float): Total accumulated simulation time.</span>
</span><span id="EventDrivenAgent-439"><a href="#EventDrivenAgent-439"><span class="linenos"> 439</span></a><span class="sd">        verbose (bool): Flag to enable detailed logging.</span>
</span><span id="EventDrivenAgent-440"><a href="#EventDrivenAgent-440"><span class="linenos"> 440</span></a><span class="sd">        first_arrival_received (bool): Flag indicating if first arrival has been received.</span>
</span><span id="EventDrivenAgent-441"><a href="#EventDrivenAgent-441"><span class="linenos"> 441</span></a><span class="sd">        initial_signal_behaviour (PeriodicBehaviour): Reference to initial signal behaviour.</span>
</span><span id="EventDrivenAgent-442"><a href="#EventDrivenAgent-442"><span class="linenos"> 442</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-443"><a href="#EventDrivenAgent-443"><span class="linenos"> 443</span></a><span class="sd">    Behaviours:</span>
</span><span id="EventDrivenAgent-444"><a href="#EventDrivenAgent-444"><span class="linenos"> 444</span></a><span class="sd">        SendInitialSignalBehaviour: Sends initial signal to vehicles (PeriodicBehaviour).</span>
</span><span id="EventDrivenAgent-445"><a href="#EventDrivenAgent-445"><span class="linenos"> 445</span></a><span class="sd">        RegisterTransitBehaviour: Requests initial traffic simulation (OneShotBehaviour).</span>
</span><span id="EventDrivenAgent-446"><a href="#EventDrivenAgent-446"><span class="linenos"> 446</span></a><span class="sd">        ReceiveEventsBehaviour: Receives events continuously (CyclicBehaviour).</span>
</span><span id="EventDrivenAgent-447"><a href="#EventDrivenAgent-447"><span class="linenos"> 447</span></a><span class="sd">        ProcessEventsBehaviour: Processes events periodically (PeriodicBehaviour).</span>
</span><span id="EventDrivenAgent-448"><a href="#EventDrivenAgent-448"><span class="linenos"> 448</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-449"><a href="#EventDrivenAgent-449"><span class="linenos"> 449</span></a><span class="sd">    Examples:</span>
</span><span id="EventDrivenAgent-450"><a href="#EventDrivenAgent-450"><span class="linenos"> 450</span></a><span class="sd">        &gt;&gt;&gt; # Create event agent with basic configuration</span>
</span><span id="EventDrivenAgent-451"><a href="#EventDrivenAgent-451"><span class="linenos"> 451</span></a><span class="sd">        &gt;&gt;&gt; event_agent = EventDrivenAgent(</span>
</span><span id="EventDrivenAgent-452"><a href="#EventDrivenAgent-452"><span class="linenos"> 452</span></a><span class="sd">        ...     jid=&quot;event_agent@localhost&quot;,</span>
</span><span id="EventDrivenAgent-453"><a href="#EventDrivenAgent-453"><span class="linenos"> 453</span></a><span class="sd">        ...     password=&quot;password123&quot;,</span>
</span><span id="EventDrivenAgent-454"><a href="#EventDrivenAgent-454"><span class="linenos"> 454</span></a><span class="sd">        ...     simulation_interval=5.0,</span>
</span><span id="EventDrivenAgent-455"><a href="#EventDrivenAgent-455"><span class="linenos"> 455</span></a><span class="sd">        ...     registered_vehicles=[&quot;vehicle1@localhost&quot;, &quot;vehicle2@localhost&quot;],</span>
</span><span id="EventDrivenAgent-456"><a href="#EventDrivenAgent-456"><span class="linenos"> 456</span></a><span class="sd">        ...     registered_warehouses=[&quot;warehouse1@localhost&quot;],</span>
</span><span id="EventDrivenAgent-457"><a href="#EventDrivenAgent-457"><span class="linenos"> 457</span></a><span class="sd">        ...     registered_stores=[&quot;store1@localhost&quot;],</span>
</span><span id="EventDrivenAgent-458"><a href="#EventDrivenAgent-458"><span class="linenos"> 458</span></a><span class="sd">        ...     registered_suppliers=[&quot;supplier1@localhost&quot;],</span>
</span><span id="EventDrivenAgent-459"><a href="#EventDrivenAgent-459"><span class="linenos"> 459</span></a><span class="sd">        ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="EventDrivenAgent-460"><a href="#EventDrivenAgent-460"><span class="linenos"> 460</span></a><span class="sd">        ...     world_simulation_time=10.0,</span>
</span><span id="EventDrivenAgent-461"><a href="#EventDrivenAgent-461"><span class="linenos"> 461</span></a><span class="sd">        ...     verbose=True</span>
</span><span id="EventDrivenAgent-462"><a href="#EventDrivenAgent-462"><span class="linenos"> 462</span></a><span class="sd">        ... )</span>
</span><span id="EventDrivenAgent-463"><a href="#EventDrivenAgent-463"><span class="linenos"> 463</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="EventDrivenAgent-464"><a href="#EventDrivenAgent-464"><span class="linenos"> 464</span></a><span class="sd">        &gt;&gt;&gt; # Start the agent</span>
</span><span id="EventDrivenAgent-465"><a href="#EventDrivenAgent-465"><span class="linenos"> 465</span></a><span class="sd">        &gt;&gt;&gt; await event_agent.start()</span>
</span><span id="EventDrivenAgent-466"><a href="#EventDrivenAgent-466"><span class="linenos"> 466</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="EventDrivenAgent-467"><a href="#EventDrivenAgent-467"><span class="linenos"> 467</span></a><span class="sd">        &gt;&gt;&gt; # The agent will:</span>
</span><span id="EventDrivenAgent-468"><a href="#EventDrivenAgent-468"><span class="linenos"> 468</span></a><span class="sd">        &gt;&gt;&gt; # 1. Subscribe all registered agents</span>
</span><span id="EventDrivenAgent-469"><a href="#EventDrivenAgent-469"><span class="linenos"> 469</span></a><span class="sd">        &gt;&gt;&gt; # 2. Send initial signal to vehicles</span>
</span><span id="EventDrivenAgent-470"><a href="#EventDrivenAgent-470"><span class="linenos"> 470</span></a><span class="sd">        &gt;&gt;&gt; # 3. Request traffic simulation from world agent</span>
</span><span id="EventDrivenAgent-471"><a href="#EventDrivenAgent-471"><span class="linenos"> 471</span></a><span class="sd">        &gt;&gt;&gt; # 4. Receive and process events continuously</span>
</span><span id="EventDrivenAgent-472"><a href="#EventDrivenAgent-472"><span class="linenos"> 472</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-473"><a href="#EventDrivenAgent-473"><span class="linenos"> 473</span></a><span class="sd">    Note:</span>
</span><span id="EventDrivenAgent-474"><a href="#EventDrivenAgent-474"><span class="linenos"> 474</span></a><span class="sd">        The agent uses a hybrid processing strategy:</span>
</span><span id="EventDrivenAgent-475"><a href="#EventDrivenAgent-475"><span class="linenos"> 475</span></a><span class="sd">        - Transit events are kept separate with time decremented each cycle</span>
</span><span id="EventDrivenAgent-476"><a href="#EventDrivenAgent-476"><span class="linenos"> 476</span></a><span class="sd">        - Arrival events are grouped before processing for efficiency</span>
</span><span id="EventDrivenAgent-477"><a href="#EventDrivenAgent-477"><span class="linenos"> 477</span></a><span class="sd">        - General events are processed in strict temporal order</span>
</span><span id="EventDrivenAgent-478"><a href="#EventDrivenAgent-478"><span class="linenos"> 478</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-479"><a href="#EventDrivenAgent-479"><span class="linenos"> 479</span></a><span class="sd">        Only events with the same time as the first event in heap are processed</span>
</span><span id="EventDrivenAgent-480"><a href="#EventDrivenAgent-480"><span class="linenos"> 480</span></a><span class="sd">        in each cycle, ensuring correct temporal synchronization.</span>
</span><span id="EventDrivenAgent-481"><a href="#EventDrivenAgent-481"><span class="linenos"> 481</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-482"><a href="#EventDrivenAgent-482"><span class="linenos"> 482</span></a><span class="sd">    FIPA Compliance:</span>
</span><span id="EventDrivenAgent-483"><a href="#EventDrivenAgent-483"><span class="linenos"> 483</span></a><span class="sd">        - Uses FIPA ACL performatives in message metadata (&quot;inform&quot;, &quot;request&quot;)</span>
</span><span id="EventDrivenAgent-484"><a href="#EventDrivenAgent-484"><span class="linenos"> 484</span></a><span class="sd">        - Follows FIPA interaction protocols for agent coordination</span>
</span><span id="EventDrivenAgent-485"><a href="#EventDrivenAgent-485"><span class="linenos"> 485</span></a><span class="sd">        - Implements presence-based subscription for agent discovery (XMPP)</span>
</span><span id="EventDrivenAgent-486"><a href="#EventDrivenAgent-486"><span class="linenos"> 486</span></a><span class="sd">        - Content is encoded as JSON for interoperability</span>
</span><span id="EventDrivenAgent-487"><a href="#EventDrivenAgent-487"><span class="linenos"> 487</span></a><span class="sd">        - Sender and receiver identification through JIDs (Jabber IDs)</span>
</span><span id="EventDrivenAgent-488"><a href="#EventDrivenAgent-488"><span class="linenos"> 488</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-489"><a href="#EventDrivenAgent-489"><span class="linenos"> 489</span></a><span class="sd">    Warning:</span>
</span><span id="EventDrivenAgent-490"><a href="#EventDrivenAgent-490"><span class="linenos"> 490</span></a><span class="sd">        The agent requires a running XMPP server before initialization.</span>
</span><span id="EventDrivenAgent-491"><a href="#EventDrivenAgent-491"><span class="linenos"> 491</span></a><span class="sd">        All registered JIDs must exist and be accessible for communication.</span>
</span><span id="EventDrivenAgent-492"><a href="#EventDrivenAgent-492"><span class="linenos"> 492</span></a><span class="sd">    </span>
</span><span id="EventDrivenAgent-493"><a href="#EventDrivenAgent-493"><span class="linenos"> 493</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-494"><a href="#EventDrivenAgent-494"><span class="linenos"> 494</span></a>    
</span><span id="EventDrivenAgent-495"><a href="#EventDrivenAgent-495"><span class="linenos"> 495</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">simulation_interval</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">registered_vehicles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="EventDrivenAgent-496"><a href="#EventDrivenAgent-496"><span class="linenos"> 496</span></a>                 <span class="n">registered_warehouses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">registered_stores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="p">,</span><span class="n">registered_suppliers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="EventDrivenAgent-497"><a href="#EventDrivenAgent-497"><span class="linenos"> 497</span></a>                 <span class="n">world_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">world_simulation_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="EventDrivenAgent-498"><a href="#EventDrivenAgent-498"><span class="linenos"> 498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize EventDrivenAgent with simulation settings and registered agents.</span>
</span><span id="EventDrivenAgent-499"><a href="#EventDrivenAgent-499"><span class="linenos"> 499</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-500"><a href="#EventDrivenAgent-500"><span class="linenos"> 500</span></a><span class="sd">        Creates an event-driven agent instance configured for supply chain simulation</span>
</span><span id="EventDrivenAgent-501"><a href="#EventDrivenAgent-501"><span class="linenos"> 501</span></a><span class="sd">        with specified processing interval and registered agent participants. This</span>
</span><span id="EventDrivenAgent-502"><a href="#EventDrivenAgent-502"><span class="linenos"> 502</span></a><span class="sd">        constructor initializes all data structures but does not start behaviours or</span>
</span><span id="EventDrivenAgent-503"><a href="#EventDrivenAgent-503"><span class="linenos"> 503</span></a><span class="sd">        subscribe agents - those actions occur in the setup() method.</span>
</span><span id="EventDrivenAgent-504"><a href="#EventDrivenAgent-504"><span class="linenos"> 504</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-505"><a href="#EventDrivenAgent-505"><span class="linenos"> 505</span></a><span class="sd">        Args:</span>
</span><span id="EventDrivenAgent-506"><a href="#EventDrivenAgent-506"><span class="linenos"> 506</span></a><span class="sd">            jid (str): Complete Jabber ID of the agent (format: &quot;name@server&quot;).</span>
</span><span id="EventDrivenAgent-507"><a href="#EventDrivenAgent-507"><span class="linenos"> 507</span></a><span class="sd">                Must be registered on the XMPP server before use.</span>
</span><span id="EventDrivenAgent-508"><a href="#EventDrivenAgent-508"><span class="linenos"> 508</span></a><span class="sd">            password (str): Password for XMPP server authentication.</span>
</span><span id="EventDrivenAgent-509"><a href="#EventDrivenAgent-509"><span class="linenos"> 509</span></a><span class="sd">            simulation_interval (float): Interval in seconds between event processing</span>
</span><span id="EventDrivenAgent-510"><a href="#EventDrivenAgent-510"><span class="linenos"> 510</span></a><span class="sd">                cycles. Typical values: 1.0 to 10.0 seconds. Determines temporal</span>
</span><span id="EventDrivenAgent-511"><a href="#EventDrivenAgent-511"><span class="linenos"> 511</span></a><span class="sd">                granularity of the simulation.</span>
</span><span id="EventDrivenAgent-512"><a href="#EventDrivenAgent-512"><span class="linenos"> 512</span></a><span class="sd">            registered_vehicles (List[str]): List of vehicle JIDs participating in</span>
</span><span id="EventDrivenAgent-513"><a href="#EventDrivenAgent-513"><span class="linenos"> 513</span></a><span class="sd">                simulation. These agents will receive event notifications and</span>
</span><span id="EventDrivenAgent-514"><a href="#EventDrivenAgent-514"><span class="linenos"> 514</span></a><span class="sd">                traffic updates.</span>
</span><span id="EventDrivenAgent-515"><a href="#EventDrivenAgent-515"><span class="linenos"> 515</span></a><span class="sd">            registered_warehouses (List[str]): List of registered warehouse JIDs.</span>
</span><span id="EventDrivenAgent-516"><a href="#EventDrivenAgent-516"><span class="linenos"> 516</span></a><span class="sd">                Warehouses receive transit events for route optimization.</span>
</span><span id="EventDrivenAgent-517"><a href="#EventDrivenAgent-517"><span class="linenos"> 517</span></a><span class="sd">            registered_stores (List[str]): List of registered store JIDs.</span>
</span><span id="EventDrivenAgent-518"><a href="#EventDrivenAgent-518"><span class="linenos"> 518</span></a><span class="sd">                Stores receive traffic updates for delivery planning.</span>
</span><span id="EventDrivenAgent-519"><a href="#EventDrivenAgent-519"><span class="linenos"> 519</span></a><span class="sd">            registered_suppliers (List[str]): List of registered supplier JIDs.</span>
</span><span id="EventDrivenAgent-520"><a href="#EventDrivenAgent-520"><span class="linenos"> 520</span></a><span class="sd">                Suppliers receive event notifications for supply coordination.</span>
</span><span id="EventDrivenAgent-521"><a href="#EventDrivenAgent-521"><span class="linenos"> 521</span></a><span class="sd">            world_agent (str): JID of the world agent responsible for traffic simulation.</span>
</span><span id="EventDrivenAgent-522"><a href="#EventDrivenAgent-522"><span class="linenos"> 522</span></a><span class="sd">                If None, traffic simulation features are disabled.</span>
</span><span id="EventDrivenAgent-523"><a href="#EventDrivenAgent-523"><span class="linenos"> 523</span></a><span class="sd">            world_simulation_time (float): Duration in seconds of each traffic simulation</span>
</span><span id="EventDrivenAgent-524"><a href="#EventDrivenAgent-524"><span class="linenos"> 524</span></a><span class="sd">                requested from world agent. Determines temporal forecasting horizon.</span>
</span><span id="EventDrivenAgent-525"><a href="#EventDrivenAgent-525"><span class="linenos"> 525</span></a><span class="sd">            verbose (bool): If True, enable detailed logs for debugging and monitoring.</span>
</span><span id="EventDrivenAgent-526"><a href="#EventDrivenAgent-526"><span class="linenos"> 526</span></a><span class="sd">                If False, only essential messages are displayed.</span>
</span><span id="EventDrivenAgent-527"><a href="#EventDrivenAgent-527"><span class="linenos"> 527</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-528"><a href="#EventDrivenAgent-528"><span class="linenos"> 528</span></a><span class="sd">        Examples:</span>
</span><span id="EventDrivenAgent-529"><a href="#EventDrivenAgent-529"><span class="linenos"> 529</span></a><span class="sd">            &gt;&gt;&gt; # Small simulation configuration with 2 vehicles</span>
</span><span id="EventDrivenAgent-530"><a href="#EventDrivenAgent-530"><span class="linenos"> 530</span></a><span class="sd">            &gt;&gt;&gt; agent = EventDrivenAgent(</span>
</span><span id="EventDrivenAgent-531"><a href="#EventDrivenAgent-531"><span class="linenos"> 531</span></a><span class="sd">            ...     jid=&quot;events@localhost&quot;,</span>
</span><span id="EventDrivenAgent-532"><a href="#EventDrivenAgent-532"><span class="linenos"> 532</span></a><span class="sd">            ...     password=&quot;pass123&quot;,</span>
</span><span id="EventDrivenAgent-533"><a href="#EventDrivenAgent-533"><span class="linenos"> 533</span></a><span class="sd">            ...     simulation_interval=5.0,</span>
</span><span id="EventDrivenAgent-534"><a href="#EventDrivenAgent-534"><span class="linenos"> 534</span></a><span class="sd">            ...     registered_vehicles=[&quot;v1@localhost&quot;, &quot;v2@localhost&quot;],</span>
</span><span id="EventDrivenAgent-535"><a href="#EventDrivenAgent-535"><span class="linenos"> 535</span></a><span class="sd">            ...     registered_warehouses=[&quot;w1@localhost&quot;],</span>
</span><span id="EventDrivenAgent-536"><a href="#EventDrivenAgent-536"><span class="linenos"> 536</span></a><span class="sd">            ...     registered_stores=[&quot;s1@localhost&quot;, &quot;s2@localhost&quot;],</span>
</span><span id="EventDrivenAgent-537"><a href="#EventDrivenAgent-537"><span class="linenos"> 537</span></a><span class="sd">            ...     registered_suppliers=[&quot;sup1@localhost&quot;],</span>
</span><span id="EventDrivenAgent-538"><a href="#EventDrivenAgent-538"><span class="linenos"> 538</span></a><span class="sd">            ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="EventDrivenAgent-539"><a href="#EventDrivenAgent-539"><span class="linenos"> 539</span></a><span class="sd">            ...     world_simulation_time=15.0,</span>
</span><span id="EventDrivenAgent-540"><a href="#EventDrivenAgent-540"><span class="linenos"> 540</span></a><span class="sd">            ...     verbose=False</span>
</span><span id="EventDrivenAgent-541"><a href="#EventDrivenAgent-541"><span class="linenos"> 541</span></a><span class="sd">            ... )</span>
</span><span id="EventDrivenAgent-542"><a href="#EventDrivenAgent-542"><span class="linenos"> 542</span></a><span class="sd">            &gt;&gt;&gt; </span>
</span><span id="EventDrivenAgent-543"><a href="#EventDrivenAgent-543"><span class="linenos"> 543</span></a><span class="sd">            &gt;&gt;&gt; # Large simulation configuration with detailed logging</span>
</span><span id="EventDrivenAgent-544"><a href="#EventDrivenAgent-544"><span class="linenos"> 544</span></a><span class="sd">            &gt;&gt;&gt; agent_verbose = EventDrivenAgent(</span>
</span><span id="EventDrivenAgent-545"><a href="#EventDrivenAgent-545"><span class="linenos"> 545</span></a><span class="sd">            ...     jid=&quot;events@localhost&quot;,</span>
</span><span id="EventDrivenAgent-546"><a href="#EventDrivenAgent-546"><span class="linenos"> 546</span></a><span class="sd">            ...     password=&quot;pass123&quot;,</span>
</span><span id="EventDrivenAgent-547"><a href="#EventDrivenAgent-547"><span class="linenos"> 547</span></a><span class="sd">            ...     simulation_interval=2.0,</span>
</span><span id="EventDrivenAgent-548"><a href="#EventDrivenAgent-548"><span class="linenos"> 548</span></a><span class="sd">            ...     registered_vehicles=[f&quot;vehicle{i}@localhost&quot; for i in range(10)],</span>
</span><span id="EventDrivenAgent-549"><a href="#EventDrivenAgent-549"><span class="linenos"> 549</span></a><span class="sd">            ...     registered_warehouses=[f&quot;warehouse{i}@localhost&quot; for i in range(5)],</span>
</span><span id="EventDrivenAgent-550"><a href="#EventDrivenAgent-550"><span class="linenos"> 550</span></a><span class="sd">            ...     registered_stores=[f&quot;store{i}@localhost&quot; for i in range(20)],</span>
</span><span id="EventDrivenAgent-551"><a href="#EventDrivenAgent-551"><span class="linenos"> 551</span></a><span class="sd">            ...     registered_suppliers=[f&quot;supplier{i}@localhost&quot; for i in range(3)],</span>
</span><span id="EventDrivenAgent-552"><a href="#EventDrivenAgent-552"><span class="linenos"> 552</span></a><span class="sd">            ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="EventDrivenAgent-553"><a href="#EventDrivenAgent-553"><span class="linenos"> 553</span></a><span class="sd">            ...     world_simulation_time=30.0,</span>
</span><span id="EventDrivenAgent-554"><a href="#EventDrivenAgent-554"><span class="linenos"> 554</span></a><span class="sd">            ...     verbose=True</span>
</span><span id="EventDrivenAgent-555"><a href="#EventDrivenAgent-555"><span class="linenos"> 555</span></a><span class="sd">            ... )</span>
</span><span id="EventDrivenAgent-556"><a href="#EventDrivenAgent-556"><span class="linenos"> 556</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-557"><a href="#EventDrivenAgent-557"><span class="linenos"> 557</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent-558"><a href="#EventDrivenAgent-558"><span class="linenos"> 558</span></a><span class="sd">            The constructor only initializes data structures. Agent subscription</span>
</span><span id="EventDrivenAgent-559"><a href="#EventDrivenAgent-559"><span class="linenos"> 559</span></a><span class="sd">            and behaviour initialization occur in the setup() method, which is</span>
</span><span id="EventDrivenAgent-560"><a href="#EventDrivenAgent-560"><span class="linenos"> 560</span></a><span class="sd">            called automatically by SPADE framework when start() is invoked.</span>
</span><span id="EventDrivenAgent-561"><a href="#EventDrivenAgent-561"><span class="linenos"> 561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-562"><a href="#EventDrivenAgent-562"><span class="linenos"> 562</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span><span id="EventDrivenAgent-563"><a href="#EventDrivenAgent-563"><span class="linenos"> 563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_heap</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Min heap of events (non-transit)</span>
</span><span id="EventDrivenAgent-564"><a href="#EventDrivenAgent-564"><span class="linenos"> 564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transit_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Separate list for transit events</span>
</span><span id="EventDrivenAgent-565"><a href="#EventDrivenAgent-565"><span class="linenos"> 565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Separate list for arrival events</span>
</span><span id="EventDrivenAgent-566"><a href="#EventDrivenAgent-566"><span class="linenos"> 566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span> <span class="o">=</span> <span class="n">simulation_interval</span>  <span class="c1"># Simulation interval (e.g., 5s)</span>
</span><span id="EventDrivenAgent-567"><a href="#EventDrivenAgent-567"><span class="linenos"> 567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">=</span> <span class="n">registered_vehicles</span>  <span class="c1"># Registered vehicles</span>
</span><span id="EventDrivenAgent-568"><a href="#EventDrivenAgent-568"><span class="linenos"> 568</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_warehouses</span> <span class="o">=</span> <span class="n">registered_warehouses</span>  <span class="c1"># Registered warehouses</span>
</span><span id="EventDrivenAgent-569"><a href="#EventDrivenAgent-569"><span class="linenos"> 569</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_stores</span> <span class="o">=</span> <span class="n">registered_stores</span>  <span class="c1"># Registered stores</span>
</span><span id="EventDrivenAgent-570"><a href="#EventDrivenAgent-570"><span class="linenos"> 570</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_suppliers</span> <span class="o">=</span> <span class="n">registered_suppliers</span>  <span class="c1"># Registered suppliers</span>
</span><span id="EventDrivenAgent-571"><a href="#EventDrivenAgent-571"><span class="linenos"> 571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span> <span class="o">=</span> <span class="n">world_agent</span>  <span class="c1"># World agent JID</span>
</span><span id="EventDrivenAgent-572"><a href="#EventDrivenAgent-572"><span class="linenos"> 572</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">world_simulation_time</span> <span class="o">=</span> <span class="n">world_simulation_time</span>  <span class="c1"># World simulation duration</span>
</span><span id="EventDrivenAgent-573"><a href="#EventDrivenAgent-573"><span class="linenos"> 573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Counter of events received</span>
</span><span id="EventDrivenAgent-574"><a href="#EventDrivenAgent-574"><span class="linenos"> 574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Counter of events processed</span>
</span><span id="EventDrivenAgent-575"><a href="#EventDrivenAgent-575"><span class="linenos"> 575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_simulation_time</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Last simulation timestamp</span>
</span><span id="EventDrivenAgent-576"><a href="#EventDrivenAgent-576"><span class="linenos"> 576</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time_simulated</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Total simulated time</span>
</span><span id="EventDrivenAgent-577"><a href="#EventDrivenAgent-577"><span class="linenos"> 577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>  <span class="c1"># Verbose mode flag</span>
</span><span id="EventDrivenAgent-578"><a href="#EventDrivenAgent-578"><span class="linenos"> 578</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_arrival_received</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag for first arrival received</span>
</span><span id="EventDrivenAgent-579"><a href="#EventDrivenAgent-579"><span class="linenos"> 579</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Reference to initial signal behaviour</span>
</span><span id="EventDrivenAgent-580"><a href="#EventDrivenAgent-580"><span class="linenos"> 580</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent-581"><a href="#EventDrivenAgent-581"><span class="linenos"> 581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure and initialize all behaviours and agent subscriptions.</span>
</span><span id="EventDrivenAgent-582"><a href="#EventDrivenAgent-582"><span class="linenos"> 582</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-583"><a href="#EventDrivenAgent-583"><span class="linenos"> 583</span></a><span class="sd">        This method is called automatically by the SPADE framework when the agent</span>
</span><span id="EventDrivenAgent-584"><a href="#EventDrivenAgent-584"><span class="linenos"> 584</span></a><span class="sd">        is started. It configures XMPP presence, subscribes all registered agents,</span>
</span><span id="EventDrivenAgent-585"><a href="#EventDrivenAgent-585"><span class="linenos"> 585</span></a><span class="sd">        and adds the necessary behaviours for system operation.</span>
</span><span id="EventDrivenAgent-586"><a href="#EventDrivenAgent-586"><span class="linenos"> 586</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-587"><a href="#EventDrivenAgent-587"><span class="linenos"> 587</span></a><span class="sd">        Initialization Sequence:</span>
</span><span id="EventDrivenAgent-588"><a href="#EventDrivenAgent-588"><span class="linenos"> 588</span></a><span class="sd">            1. Set presence as available (AVAILABLE/CHAT) following XMPP protocol</span>
</span><span id="EventDrivenAgent-589"><a href="#EventDrivenAgent-589"><span class="linenos"> 589</span></a><span class="sd">            2. Automatically approve all subscription requests (trust model)</span>
</span><span id="EventDrivenAgent-590"><a href="#EventDrivenAgent-590"><span class="linenos"> 590</span></a><span class="sd">            3. Subscribe vehicles, warehouses, stores, suppliers, and world agent</span>
</span><span id="EventDrivenAgent-591"><a href="#EventDrivenAgent-591"><span class="linenos"> 591</span></a><span class="sd">            4. Add ReceiveEventsBehaviour for continuous message reception</span>
</span><span id="EventDrivenAgent-592"><a href="#EventDrivenAgent-592"><span class="linenos"> 592</span></a><span class="sd">            5. Add SendInitialSignalBehaviour (periodic until first arrival)</span>
</span><span id="EventDrivenAgent-593"><a href="#EventDrivenAgent-593"><span class="linenos"> 593</span></a><span class="sd">            6. Add RegisterTransitBehaviour to request initial traffic simulation</span>
</span><span id="EventDrivenAgent-594"><a href="#EventDrivenAgent-594"><span class="linenos"> 594</span></a><span class="sd">            7. Add ProcessEventsBehaviour for periodic event processing</span>
</span><span id="EventDrivenAgent-595"><a href="#EventDrivenAgent-595"><span class="linenos"> 595</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-596"><a href="#EventDrivenAgent-596"><span class="linenos"> 596</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent-597"><a href="#EventDrivenAgent-597"><span class="linenos"> 597</span></a><span class="sd">            Uses XMPP presence mechanism for agent discovery and availability,</span>
</span><span id="EventDrivenAgent-598"><a href="#EventDrivenAgent-598"><span class="linenos"> 598</span></a><span class="sd">            which aligns with FIPA&#39;s agent management specifications.</span>
</span><span id="EventDrivenAgent-599"><a href="#EventDrivenAgent-599"><span class="linenos"> 599</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-600"><a href="#EventDrivenAgent-600"><span class="linenos"> 600</span></a><span class="sd">        Raises:</span>
</span><span id="EventDrivenAgent-601"><a href="#EventDrivenAgent-601"><span class="linenos"> 601</span></a><span class="sd">            SPADEException: If there are problems with XMPP connection or subscription.</span>
</span><span id="EventDrivenAgent-602"><a href="#EventDrivenAgent-602"><span class="linenos"> 602</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-603"><a href="#EventDrivenAgent-603"><span class="linenos"> 603</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent-604"><a href="#EventDrivenAgent-604"><span class="linenos"> 604</span></a><span class="sd">            The order of behaviour addition is important. The initial signal and</span>
</span><span id="EventDrivenAgent-605"><a href="#EventDrivenAgent-605"><span class="linenos"> 605</span></a><span class="sd">            traffic simulation request should execute before processing begins.</span>
</span><span id="EventDrivenAgent-606"><a href="#EventDrivenAgent-606"><span class="linenos"> 606</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-607"><a href="#EventDrivenAgent-607"><span class="linenos"> 607</span></a><span class="sd">            The agent sets presence.approve_all = True to automatically accept</span>
</span><span id="EventDrivenAgent-608"><a href="#EventDrivenAgent-608"><span class="linenos"> 608</span></a><span class="sd">            all subscription requests, implementing a trust-based agent society.</span>
</span><span id="EventDrivenAgent-609"><a href="#EventDrivenAgent-609"><span class="linenos"> 609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-610"><a href="#EventDrivenAgent-610"><span class="linenos"> 610</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-611"><a href="#EventDrivenAgent-611"><span class="linenos"> 611</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-612"><a href="#EventDrivenAgent-612"><span class="linenos"> 612</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Event-Driven Agent started&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-613"><a href="#EventDrivenAgent-613"><span class="linenos"> 613</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Simulation interval: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-614"><a href="#EventDrivenAgent-614"><span class="linenos"> 614</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] World simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-615"><a href="#EventDrivenAgent-615"><span class="linenos"> 615</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-616"><a href="#EventDrivenAgent-616"><span class="linenos"> 616</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-617"><a href="#EventDrivenAgent-617"><span class="linenos"> 617</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Event-Driven Agent started&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-618"><a href="#EventDrivenAgent-618"><span class="linenos"> 618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">approve_all</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EventDrivenAgent-619"><a href="#EventDrivenAgent-619"><span class="linenos"> 619</span></a>        
</span><span id="EventDrivenAgent-620"><a href="#EventDrivenAgent-620"><span class="linenos"> 620</span></a>        <span class="c1"># Subscribe each agent individually</span>
</span><span id="EventDrivenAgent-621"><a href="#EventDrivenAgent-621"><span class="linenos"> 621</span></a>        <span class="n">all_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_warehouses</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="EventDrivenAgent-622"><a href="#EventDrivenAgent-622"><span class="linenos"> 622</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="EventDrivenAgent-623"><a href="#EventDrivenAgent-623"><span class="linenos"> 623</span></a>            <span class="n">all_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent-624"><a href="#EventDrivenAgent-624"><span class="linenos"> 624</span></a>        
</span><span id="EventDrivenAgent-625"><a href="#EventDrivenAgent-625"><span class="linenos"> 625</span></a>        <span class="k">for</span> <span class="n">agent_jid</span> <span class="ow">in</span> <span class="n">all_agents</span><span class="p">:</span>
</span><span id="EventDrivenAgent-626"><a href="#EventDrivenAgent-626"><span class="linenos"> 626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">agent_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent-627"><a href="#EventDrivenAgent-627"><span class="linenos"> 627</span></a>        
</span><span id="EventDrivenAgent-628"><a href="#EventDrivenAgent-628"><span class="linenos"> 628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">set_presence</span><span class="p">(</span><span class="n">PresenceType</span><span class="o">.</span><span class="n">AVAILABLE</span><span class="p">,</span> <span class="n">PresenceShow</span><span class="o">.</span><span class="n">CHAT</span><span class="p">)</span>
</span><span id="EventDrivenAgent-629"><a href="#EventDrivenAgent-629"><span class="linenos"> 629</span></a>        
</span><span id="EventDrivenAgent-630"><a href="#EventDrivenAgent-630"><span class="linenos"> 630</span></a>        <span class="c1"># Behaviour to continuously receive events (must be active from the start)</span>
</span><span id="EventDrivenAgent-631"><a href="#EventDrivenAgent-631"><span class="linenos"> 631</span></a>        <span class="n">receive_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveEventsBehaviour</span><span class="p">()</span>
</span><span id="EventDrivenAgent-632"><a href="#EventDrivenAgent-632"><span class="linenos"> 632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">receive_behaviour</span><span class="p">)</span>
</span><span id="EventDrivenAgent-633"><a href="#EventDrivenAgent-633"><span class="linenos"> 633</span></a>        
</span><span id="EventDrivenAgent-634"><a href="#EventDrivenAgent-634"><span class="linenos"> 634</span></a>        <span class="c1"># Behaviour to send initial signal periodically (until first arrival received)</span>
</span><span id="EventDrivenAgent-635"><a href="#EventDrivenAgent-635"><span class="linenos"> 635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendInitialSignalBehaviour</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Send every 10s</span>
</span><span id="EventDrivenAgent-636"><a href="#EventDrivenAgent-636"><span class="linenos"> 636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span><span class="p">)</span>
</span><span id="EventDrivenAgent-637"><a href="#EventDrivenAgent-637"><span class="linenos"> 637</span></a>        
</span><span id="EventDrivenAgent-638"><a href="#EventDrivenAgent-638"><span class="linenos"> 638</span></a>        <span class="c1"># Behaviour to register transit (request initial traffic simulation)</span>
</span><span id="EventDrivenAgent-639"><a href="#EventDrivenAgent-639"><span class="linenos"> 639</span></a>        <span class="n">transit_registration_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RegisterTransitBehaviour</span><span class="p">()</span>
</span><span id="EventDrivenAgent-640"><a href="#EventDrivenAgent-640"><span class="linenos"> 640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">transit_registration_behaviour</span><span class="p">)</span>
</span><span id="EventDrivenAgent-641"><a href="#EventDrivenAgent-641"><span class="linenos"> 641</span></a>        
</span><span id="EventDrivenAgent-642"><a href="#EventDrivenAgent-642"><span class="linenos"> 642</span></a>        <span class="c1"># Periodic behaviour to process events (every X seconds)</span>
</span><span id="EventDrivenAgent-643"><a href="#EventDrivenAgent-643"><span class="linenos"> 643</span></a>        <span class="c1"># Will start only after receiving first arrival</span>
</span><span id="EventDrivenAgent-644"><a href="#EventDrivenAgent-644"><span class="linenos"> 644</span></a>        <span class="n">process_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessEventsBehaviour</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span><span class="p">)</span>
</span><span id="EventDrivenAgent-645"><a href="#EventDrivenAgent-645"><span class="linenos"> 645</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">process_behaviour</span><span class="p">)</span>
</span><span id="EventDrivenAgent-646"><a href="#EventDrivenAgent-646"><span class="linenos"> 646</span></a>    
</span><span id="EventDrivenAgent-647"><a href="#EventDrivenAgent-647"><span class="linenos"> 647</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">RegisterTransitBehaviour</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="EventDrivenAgent-648"><a href="#EventDrivenAgent-648"><span class="linenos"> 648</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;One-shot behaviour requesting initial traffic simulation.</span>
</span><span id="EventDrivenAgent-649"><a href="#EventDrivenAgent-649"><span class="linenos"> 649</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-650"><a href="#EventDrivenAgent-650"><span class="linenos"> 650</span></a><span class="sd">        This behaviour executes only once during EventDrivenAgent initialization,</span>
</span><span id="EventDrivenAgent-651"><a href="#EventDrivenAgent-651"><span class="linenos"> 651</span></a><span class="sd">        sending a request to the world agent to simulate traffic conditions for a</span>
</span><span id="EventDrivenAgent-652"><a href="#EventDrivenAgent-652"><span class="linenos"> 652</span></a><span class="sd">        specified period. The initial simulation is crucial for having transit data</span>
</span><span id="EventDrivenAgent-653"><a href="#EventDrivenAgent-653"><span class="linenos"> 653</span></a><span class="sd">        available before event processing begins.</span>
</span><span id="EventDrivenAgent-654"><a href="#EventDrivenAgent-654"><span class="linenos"> 654</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-655"><a href="#EventDrivenAgent-655"><span class="linenos"> 655</span></a><span class="sd">        The behaviour follows FIPA Request interaction protocol, where this agent</span>
</span><span id="EventDrivenAgent-656"><a href="#EventDrivenAgent-656"><span class="linenos"> 656</span></a><span class="sd">        acts as the initiator sending a REQUEST performative to the world agent</span>
</span><span id="EventDrivenAgent-657"><a href="#EventDrivenAgent-657"><span class="linenos"> 657</span></a><span class="sd">        (participant), which will respond with traffic event data.</span>
</span><span id="EventDrivenAgent-658"><a href="#EventDrivenAgent-658"><span class="linenos"> 658</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-659"><a href="#EventDrivenAgent-659"><span class="linenos"> 659</span></a><span class="sd">        Workflow:</span>
</span><span id="EventDrivenAgent-660"><a href="#EventDrivenAgent-660"><span class="linenos"> 660</span></a><span class="sd">            1. Wait for agent to be fully initialized</span>
</span><span id="EventDrivenAgent-661"><a href="#EventDrivenAgent-661"><span class="linenos"> 661</span></a><span class="sd">            2. Create request message with performative &quot;request&quot;</span>
</span><span id="EventDrivenAgent-662"><a href="#EventDrivenAgent-662"><span class="linenos"> 662</span></a><span class="sd">            3. Set action as &quot;simulate_traffic&quot;</span>
</span><span id="EventDrivenAgent-663"><a href="#EventDrivenAgent-663"><span class="linenos"> 663</span></a><span class="sd">            4. Send simulation time and requester JID</span>
</span><span id="EventDrivenAgent-664"><a href="#EventDrivenAgent-664"><span class="linenos"> 664</span></a><span class="sd">            5. World agent responds with transit events</span>
</span><span id="EventDrivenAgent-665"><a href="#EventDrivenAgent-665"><span class="linenos"> 665</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-666"><a href="#EventDrivenAgent-666"><span class="linenos"> 666</span></a><span class="sd">        Attributes:</span>
</span><span id="EventDrivenAgent-667"><a href="#EventDrivenAgent-667"><span class="linenos"> 667</span></a><span class="sd">            Inherits attributes from OneShotBehaviour (no own attributes).</span>
</span><span id="EventDrivenAgent-668"><a href="#EventDrivenAgent-668"><span class="linenos"> 668</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-669"><a href="#EventDrivenAgent-669"><span class="linenos"> 669</span></a><span class="sd">        Message Format (FIPA ACL compliant):</span>
</span><span id="EventDrivenAgent-670"><a href="#EventDrivenAgent-670"><span class="linenos"> 670</span></a><span class="sd">            Metadata:</span>
</span><span id="EventDrivenAgent-671"><a href="#EventDrivenAgent-671"><span class="linenos"> 671</span></a><span class="sd">                performative: &quot;request&quot;</span>
</span><span id="EventDrivenAgent-672"><a href="#EventDrivenAgent-672"><span class="linenos"> 672</span></a><span class="sd">                action: &quot;simulate_traffic&quot;</span>
</span><span id="EventDrivenAgent-673"><a href="#EventDrivenAgent-673"><span class="linenos"> 673</span></a><span class="sd">            Body (JSON):</span>
</span><span id="EventDrivenAgent-674"><a href="#EventDrivenAgent-674"><span class="linenos"> 674</span></a><span class="sd">                {</span>
</span><span id="EventDrivenAgent-675"><a href="#EventDrivenAgent-675"><span class="linenos"> 675</span></a><span class="sd">                    &quot;simulation_time&quot;: float,  # Simulation duration in seconds</span>
</span><span id="EventDrivenAgent-676"><a href="#EventDrivenAgent-676"><span class="linenos"> 676</span></a><span class="sd">                    &quot;requester&quot;: str           # Event agent JID</span>
</span><span id="EventDrivenAgent-677"><a href="#EventDrivenAgent-677"><span class="linenos"> 677</span></a><span class="sd">                }</span>
</span><span id="EventDrivenAgent-678"><a href="#EventDrivenAgent-678"><span class="linenos"> 678</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-679"><a href="#EventDrivenAgent-679"><span class="linenos"> 679</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent-680"><a href="#EventDrivenAgent-680"><span class="linenos"> 680</span></a><span class="sd">            Implements FIPA Request Interaction Protocol:</span>
</span><span id="EventDrivenAgent-681"><a href="#EventDrivenAgent-681"><span class="linenos"> 681</span></a><span class="sd">            - Initiator: EventDrivenAgent (this behaviour)</span>
</span><span id="EventDrivenAgent-682"><a href="#EventDrivenAgent-682"><span class="linenos"> 682</span></a><span class="sd">            - Participant: WorldAgent</span>
</span><span id="EventDrivenAgent-683"><a href="#EventDrivenAgent-683"><span class="linenos"> 683</span></a><span class="sd">            - Performative: REQUEST</span>
</span><span id="EventDrivenAgent-684"><a href="#EventDrivenAgent-684"><span class="linenos"> 684</span></a><span class="sd">            - Expected response: INFORM with traffic events</span>
</span><span id="EventDrivenAgent-685"><a href="#EventDrivenAgent-685"><span class="linenos"> 685</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-686"><a href="#EventDrivenAgent-686"><span class="linenos"> 686</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent-687"><a href="#EventDrivenAgent-687"><span class="linenos"> 687</span></a><span class="sd">            The world agent response is processed by ReceiveEventsBehaviour,</span>
</span><span id="EventDrivenAgent-688"><a href="#EventDrivenAgent-688"><span class="linenos"> 688</span></a><span class="sd">            which adds transit events to the transit_events list.</span>
</span><span id="EventDrivenAgent-689"><a href="#EventDrivenAgent-689"><span class="linenos"> 689</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-690"><a href="#EventDrivenAgent-690"><span class="linenos"> 690</span></a>        
</span><span id="EventDrivenAgent-691"><a href="#EventDrivenAgent-691"><span class="linenos"> 691</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent-692"><a href="#EventDrivenAgent-692"><span class="linenos"> 692</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute traffic simulation request to world agent.</span>
</span><span id="EventDrivenAgent-693"><a href="#EventDrivenAgent-693"><span class="linenos"> 693</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-694"><a href="#EventDrivenAgent-694"><span class="linenos"> 694</span></a><span class="sd">            Sends an XMPP message to the world agent requesting traffic condition</span>
</span><span id="EventDrivenAgent-695"><a href="#EventDrivenAgent-695"><span class="linenos"> 695</span></a><span class="sd">            simulation. The world agent will process the request and respond with</span>
</span><span id="EventDrivenAgent-696"><a href="#EventDrivenAgent-696"><span class="linenos"> 696</span></a><span class="sd">            a list of transit events that will be received by ReceiveEventsBehaviour.</span>
</span><span id="EventDrivenAgent-697"><a href="#EventDrivenAgent-697"><span class="linenos"> 697</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-698"><a href="#EventDrivenAgent-698"><span class="linenos"> 698</span></a><span class="sd">            This method implements the REQUEST performative of FIPA ACL, initiating</span>
</span><span id="EventDrivenAgent-699"><a href="#EventDrivenAgent-699"><span class="linenos"> 699</span></a><span class="sd">            a request-response interaction pattern.</span>
</span><span id="EventDrivenAgent-700"><a href="#EventDrivenAgent-700"><span class="linenos"> 700</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-701"><a href="#EventDrivenAgent-701"><span class="linenos"> 701</span></a><span class="sd">            Raises:</span>
</span><span id="EventDrivenAgent-702"><a href="#EventDrivenAgent-702"><span class="linenos"> 702</span></a><span class="sd">                SPADEException: If message sending fails.</span>
</span><span id="EventDrivenAgent-703"><a href="#EventDrivenAgent-703"><span class="linenos"> 703</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-704"><a href="#EventDrivenAgent-704"><span class="linenos"> 704</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent-705"><a href="#EventDrivenAgent-705"><span class="linenos"> 705</span></a><span class="sd">                This method executes only once. Subsequent simulation requests</span>
</span><span id="EventDrivenAgent-706"><a href="#EventDrivenAgent-706"><span class="linenos"> 706</span></a><span class="sd">                are managed by &quot;updatesimulation&quot; type events in the heap.</span>
</span><span id="EventDrivenAgent-707"><a href="#EventDrivenAgent-707"><span class="linenos"> 707</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-708"><a href="#EventDrivenAgent-708"><span class="linenos"> 708</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent-709"><a href="#EventDrivenAgent-709"><span class="linenos"> 709</span></a><span class="sd">                Sends REQUEST performative with structured content following</span>
</span><span id="EventDrivenAgent-710"><a href="#EventDrivenAgent-710"><span class="linenos"> 710</span></a><span class="sd">                FIPA ACL semantics for service requests.</span>
</span><span id="EventDrivenAgent-711"><a href="#EventDrivenAgent-711"><span class="linenos"> 711</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-712"><a href="#EventDrivenAgent-712"><span class="linenos"> 712</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-713"><a href="#EventDrivenAgent-713"><span class="linenos"> 713</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-714"><a href="#EventDrivenAgent-714"><span class="linenos"> 714</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  REQUESTING TRAFFIC SIMULATION FROM WORLD AGENT&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-715"><a href="#EventDrivenAgent-715"><span class="linenos"> 715</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recipient: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-716"><a href="#EventDrivenAgent-716"><span class="linenos"> 716</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-717"><a href="#EventDrivenAgent-717"><span class="linenos"> 717</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-718"><a href="#EventDrivenAgent-718"><span class="linenos"> 718</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-719"><a href="#EventDrivenAgent-719"><span class="linenos"> 719</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  REQUESTING TRAFFIC SIMULATION FROM WORLD AGENT&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-720"><a href="#EventDrivenAgent-720"><span class="linenos"> 720</span></a>            <span class="c1"># Create simulation request message</span>
</span><span id="EventDrivenAgent-721"><a href="#EventDrivenAgent-721"><span class="linenos"> 721</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent-722"><a href="#EventDrivenAgent-722"><span class="linenos"> 722</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-723"><a href="#EventDrivenAgent-723"><span class="linenos"> 723</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-724"><a href="#EventDrivenAgent-724"><span class="linenos"> 724</span></a>            
</span><span id="EventDrivenAgent-725"><a href="#EventDrivenAgent-725"><span class="linenos"> 725</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent-726"><a href="#EventDrivenAgent-726"><span class="linenos"> 726</span></a>                <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent-727"><a href="#EventDrivenAgent-727"><span class="linenos"> 727</span></a>                <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent-728"><a href="#EventDrivenAgent-728"><span class="linenos"> 728</span></a>            <span class="p">}</span>
</span><span id="EventDrivenAgent-729"><a href="#EventDrivenAgent-729"><span class="linenos"> 729</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent-730"><a href="#EventDrivenAgent-730"><span class="linenos"> 730</span></a>            
</span><span id="EventDrivenAgent-731"><a href="#EventDrivenAgent-731"><span class="linenos"> 731</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent-732"><a href="#EventDrivenAgent-732"><span class="linenos"> 732</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-733"><a href="#EventDrivenAgent-733"><span class="linenos"> 733</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Traffic simulation request sent to world agent&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-734"><a href="#EventDrivenAgent-734"><span class="linenos"> 734</span></a>        
</span><span id="EventDrivenAgent-735"><a href="#EventDrivenAgent-735"><span class="linenos"> 735</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">SendInitialSignalBehaviour</span><span class="p">(</span><span class="n">PeriodicBehaviour</span><span class="p">):</span>
</span><span id="EventDrivenAgent-736"><a href="#EventDrivenAgent-736"><span class="linenos"> 736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Periodic behaviour for vehicle activation through initial signaling.</span>
</span><span id="EventDrivenAgent-737"><a href="#EventDrivenAgent-737"><span class="linenos"> 737</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-738"><a href="#EventDrivenAgent-738"><span class="linenos"> 738</span></a><span class="sd">        This behaviour executes periodically (every 10 seconds) during initialization,</span>
</span><span id="EventDrivenAgent-739"><a href="#EventDrivenAgent-739"><span class="linenos"> 739</span></a><span class="sd">        sending fictitious &quot;arrival&quot; messages to all registered vehicles until the</span>
</span><span id="EventDrivenAgent-740"><a href="#EventDrivenAgent-740"><span class="linenos"> 740</span></a><span class="sd">        first real arrival event is received. The goal is to ensure vehicles are</span>
</span><span id="EventDrivenAgent-741"><a href="#EventDrivenAgent-741"><span class="linenos"> 741</span></a><span class="sd">        active and ready to respond to actual events.</span>
</span><span id="EventDrivenAgent-742"><a href="#EventDrivenAgent-742"><span class="linenos"> 742</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-743"><a href="#EventDrivenAgent-743"><span class="linenos"> 743</span></a><span class="sd">        This pattern implements a &quot;heartbeat&quot; or &quot;keep-alive&quot; mechanism to bootstrap</span>
</span><span id="EventDrivenAgent-744"><a href="#EventDrivenAgent-744"><span class="linenos"> 744</span></a><span class="sd">        the simulation, following distributed systems principles for node activation.</span>
</span><span id="EventDrivenAgent-745"><a href="#EventDrivenAgent-745"><span class="linenos"> 745</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-746"><a href="#EventDrivenAgent-746"><span class="linenos"> 746</span></a><span class="sd">        Initialization Strategy:</span>
</span><span id="EventDrivenAgent-747"><a href="#EventDrivenAgent-747"><span class="linenos"> 747</span></a><span class="sd">            - Uses fictitious vehicle name (&quot;vehicle_init_signal_999&quot;)</span>
</span><span id="EventDrivenAgent-748"><a href="#EventDrivenAgent-748"><span class="linenos"> 748</span></a><span class="sd">            - Event time is 0.1 (near-zero, initial moment)</span>
</span><span id="EventDrivenAgent-749"><a href="#EventDrivenAgent-749"><span class="linenos"> 749</span></a><span class="sd">            - Sends periodically until first real arrival received</span>
</span><span id="EventDrivenAgent-750"><a href="#EventDrivenAgent-750"><span class="linenos"> 750</span></a><span class="sd">            - Terminates automatically when first_arrival_received = True</span>
</span><span id="EventDrivenAgent-751"><a href="#EventDrivenAgent-751"><span class="linenos"> 751</span></a><span class="sd">            - Vehicles ignore the fictitious event but notify event agent</span>
</span><span id="EventDrivenAgent-752"><a href="#EventDrivenAgent-752"><span class="linenos"> 752</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-753"><a href="#EventDrivenAgent-753"><span class="linenos"> 753</span></a><span class="sd">        Attributes:</span>
</span><span id="EventDrivenAgent-754"><a href="#EventDrivenAgent-754"><span class="linenos"> 754</span></a><span class="sd">            Inherits attributes from PeriodicBehaviour (period set to 10 seconds).</span>
</span><span id="EventDrivenAgent-755"><a href="#EventDrivenAgent-755"><span class="linenos"> 755</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-756"><a href="#EventDrivenAgent-756"><span class="linenos"> 756</span></a><span class="sd">        Message Format (FIPA ACL INFORM):</span>
</span><span id="EventDrivenAgent-757"><a href="#EventDrivenAgent-757"><span class="linenos"> 757</span></a><span class="sd">            Metadata:</span>
</span><span id="EventDrivenAgent-758"><a href="#EventDrivenAgent-758"><span class="linenos"> 758</span></a><span class="sd">                performative: \&quot;inform\&quot;</span>
</span><span id="EventDrivenAgent-759"><a href="#EventDrivenAgent-759"><span class="linenos"> 759</span></a><span class="sd">            Body (JSON):</span>
</span><span id="EventDrivenAgent-760"><a href="#EventDrivenAgent-760"><span class="linenos"> 760</span></a><span class="sd">                {</span>
</span><span id="EventDrivenAgent-761"><a href="#EventDrivenAgent-761"><span class="linenos"> 761</span></a><span class="sd">                    \&quot;type\&quot;: \&quot;arrival\&quot;,</span>
</span><span id="EventDrivenAgent-762"><a href="#EventDrivenAgent-762"><span class="linenos"> 762</span></a><span class="sd">                    \&quot;vehicle\&quot;: \&quot;vehicle_init_signal_999\&quot;,  # Fictitious name</span>
</span><span id="EventDrivenAgent-763"><a href="#EventDrivenAgent-763"><span class="linenos"> 763</span></a><span class="sd">                    \&quot;time\&quot;: 0.1</span>
</span><span id="EventDrivenAgent-764"><a href="#EventDrivenAgent-764"><span class="linenos"> 764</span></a><span class="sd">                }</span>
</span><span id="EventDrivenAgent-765"><a href="#EventDrivenAgent-765"><span class="linenos"> 765</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-766"><a href="#EventDrivenAgent-766"><span class="linenos"> 766</span></a><span class="sd">        Examples:</span>
</span><span id="EventDrivenAgent-767"><a href="#EventDrivenAgent-767"><span class="linenos"> 767</span></a><span class="sd">            &gt;&gt;&gt; # Automatically added in setup() with 10s period</span>
</span><span id="EventDrivenAgent-768"><a href="#EventDrivenAgent-768"><span class="linenos"> 768</span></a><span class="sd">            &gt;&gt;&gt; initial_signal = self.SendInitialSignalBehaviour(period=10.0)</span>
</span><span id="EventDrivenAgent-769"><a href="#EventDrivenAgent-769"><span class="linenos"> 769</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(initial_signal)</span>
</span><span id="EventDrivenAgent-770"><a href="#EventDrivenAgent-770"><span class="linenos"> 770</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-771"><a href="#EventDrivenAgent-771"><span class="linenos"> 771</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent-772"><a href="#EventDrivenAgent-772"><span class="linenos"> 772</span></a><span class="sd">            This mechanism ensures all vehicles are ready to receive events</span>
</span><span id="EventDrivenAgent-773"><a href="#EventDrivenAgent-773"><span class="linenos"> 773</span></a><span class="sd">            before the simulation effectively begins. The behaviour stops</span>
</span><span id="EventDrivenAgent-774"><a href="#EventDrivenAgent-774"><span class="linenos"> 774</span></a><span class="sd">            automatically when the first real arrival is received.</span>
</span><span id="EventDrivenAgent-775"><a href="#EventDrivenAgent-775"><span class="linenos"> 775</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-776"><a href="#EventDrivenAgent-776"><span class="linenos"> 776</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent-777"><a href="#EventDrivenAgent-777"><span class="linenos"> 777</span></a><span class="sd">            Uses INFORM performative to notify vehicles of (fictitious) events,</span>
</span><span id="EventDrivenAgent-778"><a href="#EventDrivenAgent-778"><span class="linenos"> 778</span></a><span class="sd">            implementing a broadcast notification pattern.</span>
</span><span id="EventDrivenAgent-779"><a href="#EventDrivenAgent-779"><span class="linenos"> 779</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-780"><a href="#EventDrivenAgent-780"><span class="linenos"> 780</span></a><span class="sd">        Warning:</span>
</span><span id="EventDrivenAgent-781"><a href="#EventDrivenAgent-781"><span class="linenos"> 781</span></a><span class="sd">            If registered_vehicles is empty, behaviour terminates without action</span>
</span><span id="EventDrivenAgent-782"><a href="#EventDrivenAgent-782"><span class="linenos"> 782</span></a><span class="sd">            and emits a warning in the log.</span>
</span><span id="EventDrivenAgent-783"><a href="#EventDrivenAgent-783"><span class="linenos"> 783</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-784"><a href="#EventDrivenAgent-784"><span class="linenos"> 784</span></a>        
</span><span id="EventDrivenAgent-785"><a href="#EventDrivenAgent-785"><span class="linenos"> 785</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent-786"><a href="#EventDrivenAgent-786"><span class="linenos"> 786</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Send initialization signal to all registered vehicles periodically.</span>
</span><span id="EventDrivenAgent-787"><a href="#EventDrivenAgent-787"><span class="linenos"> 787</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-788"><a href="#EventDrivenAgent-788"><span class="linenos"> 788</span></a><span class="sd">            Iterates over the list of registered vehicles and sends each one a</span>
</span><span id="EventDrivenAgent-789"><a href="#EventDrivenAgent-789"><span class="linenos"> 789</span></a><span class="sd">            fictitious arrival message. Continues sending until the first real</span>
</span><span id="EventDrivenAgent-790"><a href="#EventDrivenAgent-790"><span class="linenos"> 790</span></a><span class="sd">            arrival is received.</span>
</span><span id="EventDrivenAgent-791"><a href="#EventDrivenAgent-791"><span class="linenos"> 791</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-792"><a href="#EventDrivenAgent-792"><span class="linenos"> 792</span></a><span class="sd">            The method implements a broadcast INFORM pattern, notifying all vehicles</span>
</span><span id="EventDrivenAgent-793"><a href="#EventDrivenAgent-793"><span class="linenos"> 793</span></a><span class="sd">            to activate their event reception behaviours.</span>
</span><span id="EventDrivenAgent-794"><a href="#EventDrivenAgent-794"><span class="linenos"> 794</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-795"><a href="#EventDrivenAgent-795"><span class="linenos"> 795</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent-796"><a href="#EventDrivenAgent-796"><span class="linenos"> 796</span></a><span class="sd">                None: Executes side effects (message sending).</span>
</span><span id="EventDrivenAgent-797"><a href="#EventDrivenAgent-797"><span class="linenos"> 797</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-798"><a href="#EventDrivenAgent-798"><span class="linenos"> 798</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent-799"><a href="#EventDrivenAgent-799"><span class="linenos"> 799</span></a><span class="sd">                The behaviour checks the first_arrival_received flag and terminates</span>
</span><span id="EventDrivenAgent-800"><a href="#EventDrivenAgent-800"><span class="linenos"> 800</span></a><span class="sd">                when it is True. The fictitious name &quot;vehicle_init_signal_999&quot;</span>
</span><span id="EventDrivenAgent-801"><a href="#EventDrivenAgent-801"><span class="linenos"> 801</span></a><span class="sd">                is intentional and should not correspond to any real vehicle.</span>
</span><span id="EventDrivenAgent-802"><a href="#EventDrivenAgent-802"><span class="linenos"> 802</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-803"><a href="#EventDrivenAgent-803"><span class="linenos"> 803</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent-804"><a href="#EventDrivenAgent-804"><span class="linenos"> 804</span></a><span class="sd">                Sends INFORM performatives to all vehicles in a broadcast pattern.</span>
</span><span id="EventDrivenAgent-805"><a href="#EventDrivenAgent-805"><span class="linenos"> 805</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-806"><a href="#EventDrivenAgent-806"><span class="linenos"> 806</span></a>            <span class="c1"># Check if first arrival already received</span>
</span><span id="EventDrivenAgent-807"><a href="#EventDrivenAgent-807"><span class="linenos"> 807</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent-808"><a href="#EventDrivenAgent-808"><span class="linenos"> 808</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-809"><a href="#EventDrivenAgent-809"><span class="linenos"> 809</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  First arrival received. Stopping initial signal sending.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-810"><a href="#EventDrivenAgent-810"><span class="linenos"> 810</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-811"><a href="#EventDrivenAgent-811"><span class="linenos"> 811</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  First arrival received.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-812"><a href="#EventDrivenAgent-812"><span class="linenos"> 812</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Stop this behaviour</span>
</span><span id="EventDrivenAgent-813"><a href="#EventDrivenAgent-813"><span class="linenos"> 813</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent-814"><a href="#EventDrivenAgent-814"><span class="linenos"> 814</span></a>            
</span><span id="EventDrivenAgent-815"><a href="#EventDrivenAgent-815"><span class="linenos"> 815</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">:</span>
</span><span id="EventDrivenAgent-816"><a href="#EventDrivenAgent-816"><span class="linenos"> 816</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  No registered vehicles to send initial signal&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-817"><a href="#EventDrivenAgent-817"><span class="linenos"> 817</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</span><span id="EventDrivenAgent-818"><a href="#EventDrivenAgent-818"><span class="linenos"> 818</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent-819"><a href="#EventDrivenAgent-819"><span class="linenos"> 819</span></a>            
</span><span id="EventDrivenAgent-820"><a href="#EventDrivenAgent-820"><span class="linenos"> 820</span></a>            <span class="c1"># Use fictitious name that doesn&#39;t correspond to any real vehicle</span>
</span><span id="EventDrivenAgent-821"><a href="#EventDrivenAgent-821"><span class="linenos"> 821</span></a>            <span class="n">fictitious_vehicle_name</span> <span class="o">=</span> <span class="s2">&quot;vehicle_init_signal_999&quot;</span>
</span><span id="EventDrivenAgent-822"><a href="#EventDrivenAgent-822"><span class="linenos"> 822</span></a>            
</span><span id="EventDrivenAgent-823"><a href="#EventDrivenAgent-823"><span class="linenos"> 823</span></a>            <span class="c1"># Send message to ALL registered vehicles</span>
</span><span id="EventDrivenAgent-824"><a href="#EventDrivenAgent-824"><span class="linenos"> 824</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-825"><a href="#EventDrivenAgent-825"><span class="linenos"> 825</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-826"><a href="#EventDrivenAgent-826"><span class="linenos"> 826</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SENDING INITIAL SIGNAL (periodic)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-827"><a href="#EventDrivenAgent-827"><span class="linenos"> 827</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recipients: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> vehicles&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-828"><a href="#EventDrivenAgent-828"><span class="linenos"> 828</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Vehicle (fictitious): </span><span class="si">{</span><span class="n">fictitious_vehicle_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-829"><a href="#EventDrivenAgent-829"><span class="linenos"> 829</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type: arrival&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-830"><a href="#EventDrivenAgent-830"><span class="linenos"> 830</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time: 0.1&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-831"><a href="#EventDrivenAgent-831"><span class="linenos"> 831</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-832"><a href="#EventDrivenAgent-832"><span class="linenos"> 832</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-833"><a href="#EventDrivenAgent-833"><span class="linenos"> 833</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SENDING INITIAL SIGNAL (waiting for real arrival...)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-834"><a href="#EventDrivenAgent-834"><span class="linenos"> 834</span></a>            
</span><span id="EventDrivenAgent-835"><a href="#EventDrivenAgent-835"><span class="linenos"> 835</span></a>            <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">:</span>
</span><span id="EventDrivenAgent-836"><a href="#EventDrivenAgent-836"><span class="linenos"> 836</span></a>                <span class="c1"># Create initial arrival message with near-zero time</span>
</span><span id="EventDrivenAgent-837"><a href="#EventDrivenAgent-837"><span class="linenos"> 837</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent-838"><a href="#EventDrivenAgent-838"><span class="linenos"> 838</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-839"><a href="#EventDrivenAgent-839"><span class="linenos"> 839</span></a>                
</span><span id="EventDrivenAgent-840"><a href="#EventDrivenAgent-840"><span class="linenos"> 840</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent-841"><a href="#EventDrivenAgent-841"><span class="linenos"> 841</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent-842"><a href="#EventDrivenAgent-842"><span class="linenos"> 842</span></a>                    <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="n">fictitious_vehicle_name</span><span class="p">,</span>  <span class="c1"># Fictitious name</span>
</span><span id="EventDrivenAgent-843"><a href="#EventDrivenAgent-843"><span class="linenos"> 843</span></a>                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span id="EventDrivenAgent-844"><a href="#EventDrivenAgent-844"><span class="linenos"> 844</span></a>                <span class="p">}</span>
</span><span id="EventDrivenAgent-845"><a href="#EventDrivenAgent-845"><span class="linenos"> 845</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent-846"><a href="#EventDrivenAgent-846"><span class="linenos"> 846</span></a>                
</span><span id="EventDrivenAgent-847"><a href="#EventDrivenAgent-847"><span class="linenos"> 847</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent-848"><a href="#EventDrivenAgent-848"><span class="linenos"> 848</span></a>                
</span><span id="EventDrivenAgent-849"><a href="#EventDrivenAgent-849"><span class="linenos"> 849</span></a>                <span class="n">vehicle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent-850"><a href="#EventDrivenAgent-850"><span class="linenos"> 850</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-851"><a href="#EventDrivenAgent-851"><span class="linenos"> 851</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sent to: </span><span class="si">{</span><span class="n">vehicle_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-852"><a href="#EventDrivenAgent-852"><span class="linenos"> 852</span></a>            
</span><span id="EventDrivenAgent-853"><a href="#EventDrivenAgent-853"><span class="linenos"> 853</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-854"><a href="#EventDrivenAgent-854"><span class="linenos"> 854</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-855"><a href="#EventDrivenAgent-855"><span class="linenos"> 855</span></a>    
</span><span id="EventDrivenAgent-856"><a href="#EventDrivenAgent-856"><span class="linenos"> 856</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveEventsBehaviour</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="EventDrivenAgent-857"><a href="#EventDrivenAgent-857"><span class="linenos"> 857</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cyclic behaviour for continuous event reception from multiple sources.</span>
</span><span id="EventDrivenAgent-858"><a href="#EventDrivenAgent-858"><span class="linenos"> 858</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-859"><a href="#EventDrivenAgent-859"><span class="linenos"> 859</span></a><span class="sd">        This behaviour remains permanently active, receiving XMPP messages from</span>
</span><span id="EventDrivenAgent-860"><a href="#EventDrivenAgent-860"><span class="linenos"> 860</span></a><span class="sd">        all registered agents (vehicles, warehouses, stores, suppliers, world agent)</span>
</span><span id="EventDrivenAgent-861"><a href="#EventDrivenAgent-861"><span class="linenos"> 861</span></a><span class="sd">        and classifying them into different event categories. Reception is</span>
</span><span id="EventDrivenAgent-862"><a href="#EventDrivenAgent-862"><span class="linenos"> 862</span></a><span class="sd">        non-blocking with 1-second timeout to allow interruptions.</span>
</span><span id="EventDrivenAgent-863"><a href="#EventDrivenAgent-863"><span class="linenos"> 863</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-864"><a href="#EventDrivenAgent-864"><span class="linenos"> 864</span></a><span class="sd">        The behaviour implements a message router pattern, directing different</span>
</span><span id="EventDrivenAgent-865"><a href="#EventDrivenAgent-865"><span class="linenos"> 865</span></a><span class="sd">        event types to appropriate data structures for later processing.</span>
</span><span id="EventDrivenAgent-866"><a href="#EventDrivenAgent-866"><span class="linenos"> 866</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-867"><a href="#EventDrivenAgent-867"><span class="linenos"> 867</span></a><span class="sd">        Event Types Processed:</span>
</span><span id="EventDrivenAgent-868"><a href="#EventDrivenAgent-868"><span class="linenos"> 868</span></a><span class="sd">            - **Traffic Events**: Transit events from world agent (complete list)</span>
</span><span id="EventDrivenAgent-869"><a href="#EventDrivenAgent-869"><span class="linenos"> 869</span></a><span class="sd">            - **Transit**: Manual traffic condition change events</span>
</span><span id="EventDrivenAgent-870"><a href="#EventDrivenAgent-870"><span class="linenos"> 870</span></a><span class="sd">            - **Arrival**: Vehicle arrival events at nodes</span>
</span><span id="EventDrivenAgent-871"><a href="#EventDrivenAgent-871"><span class="linenos"> 871</span></a><span class="sd">            - **UpdateSimulation**: Traffic resimulation requests</span>
</span><span id="EventDrivenAgent-872"><a href="#EventDrivenAgent-872"><span class="linenos"> 872</span></a><span class="sd">            - **Other**: Generic events added to main heap</span>
</span><span id="EventDrivenAgent-873"><a href="#EventDrivenAgent-873"><span class="linenos"> 873</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-874"><a href="#EventDrivenAgent-874"><span class="linenos"> 874</span></a><span class="sd">        Storage Strategy:</span>
</span><span id="EventDrivenAgent-875"><a href="#EventDrivenAgent-875"><span class="linenos"> 875</span></a><span class="sd">            - Transit events  transit_events (separate list)</span>
</span><span id="EventDrivenAgent-876"><a href="#EventDrivenAgent-876"><span class="linenos"> 876</span></a><span class="sd">            - Arrival events (time &gt; 0)  arrival_events (temporary buffer)</span>
</span><span id="EventDrivenAgent-877"><a href="#EventDrivenAgent-877"><span class="linenos"> 877</span></a><span class="sd">            - Arrival events (time = 0)  discarded (initial signal)</span>
</span><span id="EventDrivenAgent-878"><a href="#EventDrivenAgent-878"><span class="linenos"> 878</span></a><span class="sd">            - Other events  event_heap (min heap)</span>
</span><span id="EventDrivenAgent-879"><a href="#EventDrivenAgent-879"><span class="linenos"> 879</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-880"><a href="#EventDrivenAgent-880"><span class="linenos"> 880</span></a><span class="sd">        Attributes:</span>
</span><span id="EventDrivenAgent-881"><a href="#EventDrivenAgent-881"><span class="linenos"> 881</span></a><span class="sd">            Inherits attributes from CyclicBehaviour.</span>
</span><span id="EventDrivenAgent-882"><a href="#EventDrivenAgent-882"><span class="linenos"> 882</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-883"><a href="#EventDrivenAgent-883"><span class="linenos"> 883</span></a><span class="sd">        Message Formats:</span>
</span><span id="EventDrivenAgent-884"><a href="#EventDrivenAgent-884"><span class="linenos"> 884</span></a><span class="sd">            Traffic Events (from world agent):</span>
</span><span id="EventDrivenAgent-885"><a href="#EventDrivenAgent-885"><span class="linenos"> 885</span></a><span class="sd">                Metadata:</span>
</span><span id="EventDrivenAgent-886"><a href="#EventDrivenAgent-886"><span class="linenos"> 886</span></a><span class="sd">                    performative: \&quot;inform\&quot;</span>
</span><span id="EventDrivenAgent-887"><a href="#EventDrivenAgent-887"><span class="linenos"> 887</span></a><span class="sd">                    action: \&quot;traffic_events\&quot;</span>
</span><span id="EventDrivenAgent-888"><a href="#EventDrivenAgent-888"><span class="linenos"> 888</span></a><span class="sd">                Body (JSON):</span>
</span><span id="EventDrivenAgent-889"><a href="#EventDrivenAgent-889"><span class="linenos"> 889</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent-890"><a href="#EventDrivenAgent-890"><span class="linenos"> 890</span></a><span class="sd">                        \&quot;events\&quot;: [</span>
</span><span id="EventDrivenAgent-891"><a href="#EventDrivenAgent-891"><span class="linenos"> 891</span></a><span class="sd">                            {</span>
</span><span id="EventDrivenAgent-892"><a href="#EventDrivenAgent-892"><span class="linenos"> 892</span></a><span class="sd">                                \&quot;instant\&quot;: float,</span>
</span><span id="EventDrivenAgent-893"><a href="#EventDrivenAgent-893"><span class="linenos"> 893</span></a><span class="sd">                                \&quot;node1_id\&quot;: int,</span>
</span><span id="EventDrivenAgent-894"><a href="#EventDrivenAgent-894"><span class="linenos"> 894</span></a><span class="sd">                                \&quot;node2_id\&quot;: int,</span>
</span><span id="EventDrivenAgent-895"><a href="#EventDrivenAgent-895"><span class="linenos"> 895</span></a><span class="sd">                                \&quot;new_time\&quot;: float,</span>
</span><span id="EventDrivenAgent-896"><a href="#EventDrivenAgent-896"><span class="linenos"> 896</span></a><span class="sd">                                \&quot;new_fuel_consumption\&quot;: float,</span>
</span><span id="EventDrivenAgent-897"><a href="#EventDrivenAgent-897"><span class="linenos"> 897</span></a><span class="sd">                            },</span>
</span><span id="EventDrivenAgent-898"><a href="#EventDrivenAgent-898"><span class="linenos"> 898</span></a><span class="sd">                            ...</span>
</span><span id="EventDrivenAgent-899"><a href="#EventDrivenAgent-899"><span class="linenos"> 899</span></a><span class="sd">                        ]</span>
</span><span id="EventDrivenAgent-900"><a href="#EventDrivenAgent-900"><span class="linenos"> 900</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent-901"><a href="#EventDrivenAgent-901"><span class="linenos"> 901</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-902"><a href="#EventDrivenAgent-902"><span class="linenos"> 902</span></a><span class="sd">            Generic Events:</span>
</span><span id="EventDrivenAgent-903"><a href="#EventDrivenAgent-903"><span class="linenos"> 903</span></a><span class="sd">                Metadata:</span>
</span><span id="EventDrivenAgent-904"><a href="#EventDrivenAgent-904"><span class="linenos"> 904</span></a><span class="sd">                    performative: \&quot;inform\&quot;</span>
</span><span id="EventDrivenAgent-905"><a href="#EventDrivenAgent-905"><span class="linenos"> 905</span></a><span class="sd">                Body (JSON):</span>
</span><span id="EventDrivenAgent-906"><a href="#EventDrivenAgent-906"><span class="linenos"> 906</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent-907"><a href="#EventDrivenAgent-907"><span class="linenos"> 907</span></a><span class="sd">                        \&quot;type\&quot;: str,</span>
</span><span id="EventDrivenAgent-908"><a href="#EventDrivenAgent-908"><span class="linenos"> 908</span></a><span class="sd">                        \&quot;time\&quot;: float,</span>
</span><span id="EventDrivenAgent-909"><a href="#EventDrivenAgent-909"><span class="linenos"> 909</span></a><span class="sd">                        \&quot;data\&quot;: Dict[str, Any],</span>
</span><span id="EventDrivenAgent-910"><a href="#EventDrivenAgent-910"><span class="linenos"> 910</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent-911"><a href="#EventDrivenAgent-911"><span class="linenos"> 911</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-912"><a href="#EventDrivenAgent-912"><span class="linenos"> 912</span></a><span class="sd">        Examples:</span>
</span><span id="EventDrivenAgent-913"><a href="#EventDrivenAgent-913"><span class="linenos"> 913</span></a><span class="sd">            &gt;&gt;&gt; # Behaviour executes continuously after addition</span>
</span><span id="EventDrivenAgent-914"><a href="#EventDrivenAgent-914"><span class="linenos"> 914</span></a><span class="sd">            &gt;&gt;&gt; receive_behaviour = self.ReceiveEventsBehaviour()</span>
</span><span id="EventDrivenAgent-915"><a href="#EventDrivenAgent-915"><span class="linenos"> 915</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(receive_behaviour)</span>
</span><span id="EventDrivenAgent-916"><a href="#EventDrivenAgent-916"><span class="linenos"> 916</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-917"><a href="#EventDrivenAgent-917"><span class="linenos"> 917</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent-918"><a href="#EventDrivenAgent-918"><span class="linenos"> 918</span></a><span class="sd">            The 1-second timeout allows the behaviour to periodically check</span>
</span><span id="EventDrivenAgent-919"><a href="#EventDrivenAgent-919"><span class="linenos"> 919</span></a><span class="sd">            if it should terminate (e.g., when agent is stopped). Received</span>
</span><span id="EventDrivenAgent-920"><a href="#EventDrivenAgent-920"><span class="linenos"> 920</span></a><span class="sd">            messages are immediately processed and classified.</span>
</span><span id="EventDrivenAgent-921"><a href="#EventDrivenAgent-921"><span class="linenos"> 921</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-922"><a href="#EventDrivenAgent-922"><span class="linenos"> 922</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent-923"><a href="#EventDrivenAgent-923"><span class="linenos"> 923</span></a><span class="sd">            Processes FIPA ACL messages with INFORM performative, acting as</span>
</span><span id="EventDrivenAgent-924"><a href="#EventDrivenAgent-924"><span class="linenos"> 924</span></a><span class="sd">            a receiver in multiple interaction protocols initiated by other agents.</span>
</span><span id="EventDrivenAgent-925"><a href="#EventDrivenAgent-925"><span class="linenos"> 925</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-926"><a href="#EventDrivenAgent-926"><span class="linenos"> 926</span></a><span class="sd">        Warning:</span>
</span><span id="EventDrivenAgent-927"><a href="#EventDrivenAgent-927"><span class="linenos"> 927</span></a><span class="sd">            JSON parsing errors are caught and logged, but do not interrupt</span>
</span><span id="EventDrivenAgent-928"><a href="#EventDrivenAgent-928"><span class="linenos"> 928</span></a><span class="sd">            the behaviour. Malformed events are discarded.</span>
</span><span id="EventDrivenAgent-929"><a href="#EventDrivenAgent-929"><span class="linenos"> 929</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-930"><a href="#EventDrivenAgent-930"><span class="linenos"> 930</span></a><span class="sd">        See Also:</span>
</span><span id="EventDrivenAgent-931"><a href="#EventDrivenAgent-931"><span class="linenos"> 931</span></a><span class="sd">            ProcessEventsBehaviour: Processes stored events.</span>
</span><span id="EventDrivenAgent-932"><a href="#EventDrivenAgent-932"><span class="linenos"> 932</span></a><span class="sd">            Event: Data structure for representing events.</span>
</span><span id="EventDrivenAgent-933"><a href="#EventDrivenAgent-933"><span class="linenos"> 933</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-934"><a href="#EventDrivenAgent-934"><span class="linenos"> 934</span></a>        
</span><span id="EventDrivenAgent-935"><a href="#EventDrivenAgent-935"><span class="linenos"> 935</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent-936"><a href="#EventDrivenAgent-936"><span class="linenos"> 936</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Cycle of event message reception and classification.</span>
</span><span id="EventDrivenAgent-937"><a href="#EventDrivenAgent-937"><span class="linenos"> 937</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-938"><a href="#EventDrivenAgent-938"><span class="linenos"> 938</span></a><span class="sd">            This method executes continuously, awaiting messages with 1-second</span>
</span><span id="EventDrivenAgent-939"><a href="#EventDrivenAgent-939"><span class="linenos"> 939</span></a><span class="sd">            timeout. When a message is received, it identifies the event type</span>
</span><span id="EventDrivenAgent-940"><a href="#EventDrivenAgent-940"><span class="linenos"> 940</span></a><span class="sd">            and stores it in the appropriate data structure.</span>
</span><span id="EventDrivenAgent-941"><a href="#EventDrivenAgent-941"><span class="linenos"> 941</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-942"><a href="#EventDrivenAgent-942"><span class="linenos"> 942</span></a><span class="sd">            Processing Flow:</span>
</span><span id="EventDrivenAgent-943"><a href="#EventDrivenAgent-943"><span class="linenos"> 943</span></a><span class="sd">                1. Await message with 1s timeout</span>
</span><span id="EventDrivenAgent-944"><a href="#EventDrivenAgent-944"><span class="linenos"> 944</span></a><span class="sd">                2. Check if it&#39;s traffic events response from world agent</span>
</span><span id="EventDrivenAgent-945"><a href="#EventDrivenAgent-945"><span class="linenos"> 945</span></a><span class="sd">                3. If yes, process complete list of transit events</span>
</span><span id="EventDrivenAgent-946"><a href="#EventDrivenAgent-946"><span class="linenos"> 946</span></a><span class="sd">                4. If no, identify individual event type</span>
</span><span id="EventDrivenAgent-947"><a href="#EventDrivenAgent-947"><span class="linenos"> 947</span></a><span class="sd">                5. Store in transit_events, arrival_events, or event_heap</span>
</span><span id="EventDrivenAgent-948"><a href="#EventDrivenAgent-948"><span class="linenos"> 948</span></a><span class="sd">                6. Increment received events counter</span>
</span><span id="EventDrivenAgent-949"><a href="#EventDrivenAgent-949"><span class="linenos"> 949</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-950"><a href="#EventDrivenAgent-950"><span class="linenos"> 950</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent-951"><a href="#EventDrivenAgent-951"><span class="linenos"> 951</span></a><span class="sd">                None: Executes continuously until behaviour is removed.</span>
</span><span id="EventDrivenAgent-952"><a href="#EventDrivenAgent-952"><span class="linenos"> 952</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-953"><a href="#EventDrivenAgent-953"><span class="linenos"> 953</span></a><span class="sd">            Raises:</span>
</span><span id="EventDrivenAgent-954"><a href="#EventDrivenAgent-954"><span class="linenos"> 954</span></a><span class="sd">                Exception: Catches and logs parsing errors without interrupting.</span>
</span><span id="EventDrivenAgent-955"><a href="#EventDrivenAgent-955"><span class="linenos"> 955</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-956"><a href="#EventDrivenAgent-956"><span class="linenos"> 956</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent-957"><a href="#EventDrivenAgent-957"><span class="linenos"> 957</span></a><span class="sd">                For transit events from world agent, also creates an automatic</span>
</span><span id="EventDrivenAgent-958"><a href="#EventDrivenAgent-958"><span class="linenos"> 958</span></a><span class="sd">                resimulation event after world_simulation_time.</span>
</span><span id="EventDrivenAgent-959"><a href="#EventDrivenAgent-959"><span class="linenos"> 959</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-960"><a href="#EventDrivenAgent-960"><span class="linenos"> 960</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent-961"><a href="#EventDrivenAgent-961"><span class="linenos"> 961</span></a><span class="sd">                Receives and processes INFORM performatives from multiple agents,</span>
</span><span id="EventDrivenAgent-962"><a href="#EventDrivenAgent-962"><span class="linenos"> 962</span></a><span class="sd">                implementing receiver role in FIPA interaction protocols.</span>
</span><span id="EventDrivenAgent-963"><a href="#EventDrivenAgent-963"><span class="linenos"> 963</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-964"><a href="#EventDrivenAgent-964"><span class="linenos"> 964</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EventDrivenAgent-965"><a href="#EventDrivenAgent-965"><span class="linenos"> 965</span></a>            
</span><span id="EventDrivenAgent-966"><a href="#EventDrivenAgent-966"><span class="linenos"> 966</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="EventDrivenAgent-967"><a href="#EventDrivenAgent-967"><span class="linenos"> 967</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="EventDrivenAgent-968"><a href="#EventDrivenAgent-968"><span class="linenos"> 968</span></a>                    <span class="c1"># Verificar se  resposta do world agent com eventos de trnsito</span>
</span><span id="EventDrivenAgent-969"><a href="#EventDrivenAgent-969"><span class="linenos"> 969</span></a>                    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;inform&quot;</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;traffic_events&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent-970"><a href="#EventDrivenAgent-970"><span class="linenos"> 970</span></a>                        <span class="c1"># Mensagem do world agent com eventos de trnsito</span>
</span><span id="EventDrivenAgent-971"><a href="#EventDrivenAgent-971"><span class="linenos"> 971</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="EventDrivenAgent-972"><a href="#EventDrivenAgent-972"><span class="linenos"> 972</span></a>                        <span class="n">events</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="EventDrivenAgent-973"><a href="#EventDrivenAgent-973"><span class="linenos"> 973</span></a>                        
</span><span id="EventDrivenAgent-974"><a href="#EventDrivenAgent-974"><span class="linenos"> 974</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-975"><a href="#EventDrivenAgent-975"><span class="linenos"> 975</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-976"><a href="#EventDrivenAgent-976"><span class="linenos"> 976</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  EVENTOS DE TRNSITO DO WORLD AGENT RECEBIDOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-977"><a href="#EventDrivenAgent-977"><span class="linenos"> 977</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total de eventos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-978"><a href="#EventDrivenAgent-978"><span class="linenos"> 978</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-979"><a href="#EventDrivenAgent-979"><span class="linenos"> 979</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-980"><a href="#EventDrivenAgent-980"><span class="linenos"> 980</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  EVENTOS DE TRNSITO DO WORLD AGENT RECEBIDOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-981"><a href="#EventDrivenAgent-981"><span class="linenos"> 981</span></a>                        
</span><span id="EventDrivenAgent-982"><a href="#EventDrivenAgent-982"><span class="linenos"> 982</span></a>                        <span class="c1"># Processar cada evento de trnsito</span>
</span><span id="EventDrivenAgent-983"><a href="#EventDrivenAgent-983"><span class="linenos"> 983</span></a>                        <span class="k">for</span> <span class="n">event_data</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="EventDrivenAgent-984"><a href="#EventDrivenAgent-984"><span class="linenos"> 984</span></a>                            <span class="c1"># Criar evento de trnsito</span>
</span><span id="EventDrivenAgent-985"><a href="#EventDrivenAgent-985"><span class="linenos"> 985</span></a>                            <span class="n">transit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent-986"><a href="#EventDrivenAgent-986"><span class="linenos"> 986</span></a>                                <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent-987"><a href="#EventDrivenAgent-987"><span class="linenos"> 987</span></a>                                <span class="n">time</span><span class="o">=</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instant&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
</span><span id="EventDrivenAgent-988"><a href="#EventDrivenAgent-988"><span class="linenos"> 988</span></a>                                <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span><span id="EventDrivenAgent-989"><a href="#EventDrivenAgent-989"><span class="linenos"> 989</span></a>                                    <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[{</span>
</span><span id="EventDrivenAgent-990"><a href="#EventDrivenAgent-990"><span class="linenos"> 990</span></a>                                        <span class="s2">&quot;node1&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node1_id&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent-991"><a href="#EventDrivenAgent-991"><span class="linenos"> 991</span></a>                                        <span class="s2">&quot;node2&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node2_id&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent-992"><a href="#EventDrivenAgent-992"><span class="linenos"> 992</span></a>                                        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_time&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent-993"><a href="#EventDrivenAgent-993"><span class="linenos"> 993</span></a>                                        <span class="s2">&quot;fuel_consumption&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_fuel_consumption&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-994"><a href="#EventDrivenAgent-994"><span class="linenos"> 994</span></a>                                    <span class="p">}]</span>
</span><span id="EventDrivenAgent-995"><a href="#EventDrivenAgent-995"><span class="linenos"> 995</span></a>                                <span class="p">},</span>
</span><span id="EventDrivenAgent-996"><a href="#EventDrivenAgent-996"><span class="linenos"> 996</span></a>                                <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">),</span>
</span><span id="EventDrivenAgent-997"><a href="#EventDrivenAgent-997"><span class="linenos"> 997</span></a>                            <span class="p">)</span>
</span><span id="EventDrivenAgent-998"><a href="#EventDrivenAgent-998"><span class="linenos"> 998</span></a>                            
</span><span id="EventDrivenAgent-999"><a href="#EventDrivenAgent-999"><span class="linenos"> 999</span></a>                            <span class="c1"># Adicionar  lista de eventos de trnsito</span>
</span><span id="EventDrivenAgent-1000"><a href="#EventDrivenAgent-1000"><span class="linenos">1000</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1001"><a href="#EventDrivenAgent-1001"><span class="linenos">1001</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1002"><a href="#EventDrivenAgent-1002"><span class="linenos">1002</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Transit event added: Edge (</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node1_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node2_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">), time=</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_time&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, instant=</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instant&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1003"><a href="#EventDrivenAgent-1003"><span class="linenos">1003</span></a>                        
</span><span id="EventDrivenAgent-1004"><a href="#EventDrivenAgent-1004"><span class="linenos">1004</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1005"><a href="#EventDrivenAgent-1005"><span class="linenos">1005</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Total transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1006"><a href="#EventDrivenAgent-1006"><span class="linenos">1006</span></a>                        
</span><span id="EventDrivenAgent-1007"><a href="#EventDrivenAgent-1007"><span class="linenos">1007</span></a>                        <span class="c1"># Criar evento para solicitar nova simulao aps world_simulation_time</span>
</span><span id="EventDrivenAgent-1008"><a href="#EventDrivenAgent-1008"><span class="linenos">1008</span></a>                        <span class="n">resimulation_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent-1009"><a href="#EventDrivenAgent-1009"><span class="linenos">1009</span></a>                            <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;updatesimulation&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1010"><a href="#EventDrivenAgent-1010"><span class="linenos">1010</span></a>                            <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1011"><a href="#EventDrivenAgent-1011"><span class="linenos">1011</span></a>                            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;request_new_simulation&quot;</span><span class="p">},</span>
</span><span id="EventDrivenAgent-1012"><a href="#EventDrivenAgent-1012"><span class="linenos">1012</span></a>                            <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">),</span>
</span><span id="EventDrivenAgent-1013"><a href="#EventDrivenAgent-1013"><span class="linenos">1013</span></a>                        <span class="p">)</span>
</span><span id="EventDrivenAgent-1014"><a href="#EventDrivenAgent-1014"><span class="linenos">1014</span></a>                        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">resimulation_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1015"><a href="#EventDrivenAgent-1015"><span class="linenos">1015</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1016"><a href="#EventDrivenAgent-1016"><span class="linenos">1016</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Resimulation event added to heap: </span><span class="si">{</span><span class="n">resimulation_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1017"><a href="#EventDrivenAgent-1017"><span class="linenos">1017</span></a>                        
</span><span id="EventDrivenAgent-1018"><a href="#EventDrivenAgent-1018"><span class="linenos">1018</span></a>                        <span class="k">return</span>
</span><span id="EventDrivenAgent-1019"><a href="#EventDrivenAgent-1019"><span class="linenos">1019</span></a>                    
</span><span id="EventDrivenAgent-1020"><a href="#EventDrivenAgent-1020"><span class="linenos">1020</span></a>                    <span class="c1"># Processar outros eventos normalmente</span>
</span><span id="EventDrivenAgent-1021"><a href="#EventDrivenAgent-1021"><span class="linenos">1021</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1022"><a href="#EventDrivenAgent-1022"><span class="linenos">1022</span></a>                    <span class="n">event_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1023"><a href="#EventDrivenAgent-1023"><span class="linenos">1023</span></a>                    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1024"><a href="#EventDrivenAgent-1024"><span class="linenos">1024</span></a>                    <span class="n">event_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="EventDrivenAgent-1025"><a href="#EventDrivenAgent-1025"><span class="linenos">1025</span></a>                    
</span><span id="EventDrivenAgent-1026"><a href="#EventDrivenAgent-1026"><span class="linenos">1026</span></a>                    <span class="c1"># Debug: mostrar dados recebidos</span>
</span><span id="EventDrivenAgent-1027"><a href="#EventDrivenAgent-1027"><span class="linenos">1027</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1028"><a href="#EventDrivenAgent-1028"><span class="linenos">1028</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Mensagem recebida:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1029"><a href="#EventDrivenAgent-1029"><span class="linenos">1029</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sender: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1030"><a href="#EventDrivenAgent-1030"><span class="linenos">1030</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Type: </span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1031"><a href="#EventDrivenAgent-1031"><span class="linenos">1031</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Time: </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1032"><a href="#EventDrivenAgent-1032"><span class="linenos">1032</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Data: </span><span class="si">{</span><span class="n">event_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1033"><a href="#EventDrivenAgent-1033"><span class="linenos">1033</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1034"><a href="#EventDrivenAgent-1034"><span class="linenos">1034</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Mensagem recebida de </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1035"><a href="#EventDrivenAgent-1035"><span class="linenos">1035</span></a>                    
</span><span id="EventDrivenAgent-1036"><a href="#EventDrivenAgent-1036"><span class="linenos">1036</span></a>                    <span class="c1"># Criar evento</span>
</span><span id="EventDrivenAgent-1037"><a href="#EventDrivenAgent-1037"><span class="linenos">1037</span></a>                    <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent-1038"><a href="#EventDrivenAgent-1038"><span class="linenos">1038</span></a>                        <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1039"><a href="#EventDrivenAgent-1039"><span class="linenos">1039</span></a>                        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1040"><a href="#EventDrivenAgent-1040"><span class="linenos">1040</span></a>                        <span class="n">data</span><span class="o">=</span><span class="n">event_data</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1041"><a href="#EventDrivenAgent-1041"><span class="linenos">1041</span></a>                        <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">),</span>
</span><span id="EventDrivenAgent-1042"><a href="#EventDrivenAgent-1042"><span class="linenos">1042</span></a>                    <span class="p">)</span>
</span><span id="EventDrivenAgent-1043"><a href="#EventDrivenAgent-1043"><span class="linenos">1043</span></a>                    
</span><span id="EventDrivenAgent-1044"><a href="#EventDrivenAgent-1044"><span class="linenos">1044</span></a>                    <span class="c1"># Verificar se  evento de trnsito manual (no do world agent)</span>
</span><span id="EventDrivenAgent-1045"><a href="#EventDrivenAgent-1045"><span class="linenos">1045</span></a>                    <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1046"><a href="#EventDrivenAgent-1046"><span class="linenos">1046</span></a>                        <span class="c1"># Adicionar  lista de trnsito</span>
</span><span id="EventDrivenAgent-1047"><a href="#EventDrivenAgent-1047"><span class="linenos">1047</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1048"><a href="#EventDrivenAgent-1048"><span class="linenos">1048</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1049"><a href="#EventDrivenAgent-1049"><span class="linenos">1049</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Manual transit event received: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1050"><a href="#EventDrivenAgent-1050"><span class="linenos">1050</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1051"><a href="#EventDrivenAgent-1051"><span class="linenos">1051</span></a>                    <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1052"><a href="#EventDrivenAgent-1052"><span class="linenos">1052</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1053"><a href="#EventDrivenAgent-1053"><span class="linenos">1053</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EventDrivenAgent-1054"><a href="#EventDrivenAgent-1054"><span class="linenos">1054</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1055"><a href="#EventDrivenAgent-1055"><span class="linenos">1055</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PRIMEIRO ARRIVAL RECEBIDO! Iniciando processamento da heap.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1056"><a href="#EventDrivenAgent-1056"><span class="linenos">1056</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1057"><a href="#EventDrivenAgent-1057"><span class="linenos">1057</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PRIMEIRO ARRIVAL RECEBIDO!&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1058"><a href="#EventDrivenAgent-1058"><span class="linenos">1058</span></a>                            
</span><span id="EventDrivenAgent-1059"><a href="#EventDrivenAgent-1059"><span class="linenos">1059</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1060"><a href="#EventDrivenAgent-1060"><span class="linenos">1060</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1061"><a href="#EventDrivenAgent-1061"><span class="linenos">1061</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento ARRIVAL adicionado  lista: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1062"><a href="#EventDrivenAgent-1062"><span class="linenos">1062</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos de arrival: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1063"><a href="#EventDrivenAgent-1063"><span class="linenos">1063</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1064"><a href="#EventDrivenAgent-1064"><span class="linenos">1064</span></a>                        <span class="c1"># Adicionar  heap outros tipos de eventos</span>
</span><span id="EventDrivenAgent-1065"><a href="#EventDrivenAgent-1065"><span class="linenos">1065</span></a>                        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1066"><a href="#EventDrivenAgent-1066"><span class="linenos">1066</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1067"><a href="#EventDrivenAgent-1067"><span class="linenos">1067</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento recebido: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1068"><a href="#EventDrivenAgent-1068"><span class="linenos">1068</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1069"><a href="#EventDrivenAgent-1069"><span class="linenos">1069</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1070"><a href="#EventDrivenAgent-1070"><span class="linenos">1070</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento recebido: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    
</span><span id="EventDrivenAgent-1071"><a href="#EventDrivenAgent-1071"><span class="linenos">1071</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="EventDrivenAgent-1072"><a href="#EventDrivenAgent-1072"><span class="linenos">1072</span></a>                
</span><span id="EventDrivenAgent-1073"><a href="#EventDrivenAgent-1073"><span class="linenos">1073</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1074"><a href="#EventDrivenAgent-1074"><span class="linenos">1074</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Erro ao processar mensagem: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1075"><a href="#EventDrivenAgent-1075"><span class="linenos">1075</span></a>    
</span><span id="EventDrivenAgent-1076"><a href="#EventDrivenAgent-1076"><span class="linenos">1076</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ProcessEventsBehaviour</span><span class="p">(</span><span class="n">PeriodicBehaviour</span><span class="p">):</span>
</span><span id="EventDrivenAgent-1077"><a href="#EventDrivenAgent-1077"><span class="linenos">1077</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Periodic behaviour responsible for temporal event processing.</span>
</span><span id="EventDrivenAgent-1078"><a href="#EventDrivenAgent-1078"><span class="linenos">1078</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1079"><a href="#EventDrivenAgent-1079"><span class="linenos">1079</span></a><span class="sd">        This behaviour is the core of the temporal simulation system, executing at</span>
</span><span id="EventDrivenAgent-1080"><a href="#EventDrivenAgent-1080"><span class="linenos">1080</span></a><span class="sd">        regular intervals (defined by simulation_interval) to process events that</span>
</span><span id="EventDrivenAgent-1081"><a href="#EventDrivenAgent-1081"><span class="linenos">1081</span></a><span class="sd">        occur at the same temporal instant. It implements a sophisticated time</span>
</span><span id="EventDrivenAgent-1082"><a href="#EventDrivenAgent-1082"><span class="linenos">1082</span></a><span class="sd">        management strategy, ensuring correct synchronization between all events</span>
</span><span id="EventDrivenAgent-1083"><a href="#EventDrivenAgent-1083"><span class="linenos">1083</span></a><span class="sd">        and agents.</span>
</span><span id="EventDrivenAgent-1084"><a href="#EventDrivenAgent-1084"><span class="linenos">1084</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1085"><a href="#EventDrivenAgent-1085"><span class="linenos">1085</span></a><span class="sd">        The behaviour implements a discrete event simulation (DES) approach, where</span>
</span><span id="EventDrivenAgent-1086"><a href="#EventDrivenAgent-1086"><span class="linenos">1086</span></a><span class="sd">        time advances in discrete steps and all events at each time step are</span>
</span><span id="EventDrivenAgent-1087"><a href="#EventDrivenAgent-1087"><span class="linenos">1087</span></a><span class="sd">        processed simultaneously.</span>
</span><span id="EventDrivenAgent-1088"><a href="#EventDrivenAgent-1088"><span class="linenos">1088</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1089"><a href="#EventDrivenAgent-1089"><span class="linenos">1089</span></a><span class="sd">        Processing Strategy:</span>
</span><span id="EventDrivenAgent-1090"><a href="#EventDrivenAgent-1090"><span class="linenos">1090</span></a><span class="sd">            1. **Arrival Transfer**: Move arrival events from buffer to heap</span>
</span><span id="EventDrivenAgent-1091"><a href="#EventDrivenAgent-1091"><span class="linenos">1091</span></a><span class="sd">            2. **Transit Integration**: Reinsert transit events into heap</span>
</span><span id="EventDrivenAgent-1092"><a href="#EventDrivenAgent-1092"><span class="linenos">1092</span></a><span class="sd">            3. **Time Selection**: Extract first event (smallest time)</span>
</span><span id="EventDrivenAgent-1093"><a href="#EventDrivenAgent-1093"><span class="linenos">1093</span></a><span class="sd">            4. **Grouping**: Collect all events with same time</span>
</span><span id="EventDrivenAgent-1094"><a href="#EventDrivenAgent-1094"><span class="linenos">1094</span></a><span class="sd">            5. **Processing**: Notify relevant agents about events</span>
</span><span id="EventDrivenAgent-1095"><a href="#EventDrivenAgent-1095"><span class="linenos">1095</span></a><span class="sd">            6. **Transit Update**: Decrement time of remaining transit events</span>
</span><span id="EventDrivenAgent-1096"><a href="#EventDrivenAgent-1096"><span class="linenos">1096</span></a><span class="sd">            7. **Cleanup**: Empty heap (discard future events until next cycle)</span>
</span><span id="EventDrivenAgent-1097"><a href="#EventDrivenAgent-1097"><span class="linenos">1097</span></a><span class="sd">            8. **Resimulation**: Request new simulation if needed</span>
</span><span id="EventDrivenAgent-1098"><a href="#EventDrivenAgent-1098"><span class="linenos">1098</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1099"><a href="#EventDrivenAgent-1099"><span class="linenos">1099</span></a><span class="sd">        Time Management:</span>
</span><span id="EventDrivenAgent-1100"><a href="#EventDrivenAgent-1100"><span class="linenos">1100</span></a><span class="sd">            - Only events with time equal to first event are processed</span>
</span><span id="EventDrivenAgent-1101"><a href="#EventDrivenAgent-1101"><span class="linenos">1101</span></a><span class="sd">            - Transit events have time decremented continuously</span>
</span><span id="EventDrivenAgent-1102"><a href="#EventDrivenAgent-1102"><span class="linenos">1102</span></a><span class="sd">            - First event of each type has real time, subsequent ones time 0</span>
</span><span id="EventDrivenAgent-1103"><a href="#EventDrivenAgent-1103"><span class="linenos">1103</span></a><span class="sd">            - Avoids duplicate simulation of same temporal interval</span>
</span><span id="EventDrivenAgent-1104"><a href="#EventDrivenAgent-1104"><span class="linenos">1104</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1105"><a href="#EventDrivenAgent-1105"><span class="linenos">1105</span></a><span class="sd">        Attributes:</span>
</span><span id="EventDrivenAgent-1106"><a href="#EventDrivenAgent-1106"><span class="linenos">1106</span></a><span class="sd">            period (float): Interval in seconds between executions (inherited from PeriodicBehaviour).</span>
</span><span id="EventDrivenAgent-1107"><a href="#EventDrivenAgent-1107"><span class="linenos">1107</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1108"><a href="#EventDrivenAgent-1108"><span class="linenos">1108</span></a><span class="sd">        Notification Flow:</span>
</span><span id="EventDrivenAgent-1109"><a href="#EventDrivenAgent-1109"><span class="linenos">1109</span></a><span class="sd">            - Arrival events  All vehicles (grouped message)</span>
</span><span id="EventDrivenAgent-1110"><a href="#EventDrivenAgent-1110"><span class="linenos">1110</span></a><span class="sd">            - Transit events  Vehicles + Warehouses + Stores</span>
</span><span id="EventDrivenAgent-1111"><a href="#EventDrivenAgent-1111"><span class="linenos">1111</span></a><span class="sd">            - UpdateSimulation events  World agent</span>
</span><span id="EventDrivenAgent-1112"><a href="#EventDrivenAgent-1112"><span class="linenos">1112</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1113"><a href="#EventDrivenAgent-1113"><span class="linenos">1113</span></a><span class="sd">        Examples:</span>
</span><span id="EventDrivenAgent-1114"><a href="#EventDrivenAgent-1114"><span class="linenos">1114</span></a><span class="sd">            &gt;&gt;&gt; # Automatically created in setup() with configurable period</span>
</span><span id="EventDrivenAgent-1115"><a href="#EventDrivenAgent-1115"><span class="linenos">1115</span></a><span class="sd">            &gt;&gt;&gt; process_behaviour = self.ProcessEventsBehaviour(period=5.0)</span>
</span><span id="EventDrivenAgent-1116"><a href="#EventDrivenAgent-1116"><span class="linenos">1116</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(process_behaviour)</span>
</span><span id="EventDrivenAgent-1117"><a href="#EventDrivenAgent-1117"><span class="linenos">1117</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1118"><a href="#EventDrivenAgent-1118"><span class="linenos">1118</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent-1119"><a href="#EventDrivenAgent-1119"><span class="linenos">1119</span></a><span class="sd">            Emptying the heap after processing is intentional. It ensures only</span>
</span><span id="EventDrivenAgent-1120"><a href="#EventDrivenAgent-1120"><span class="linenos">1120</span></a><span class="sd">            events from the next temporal instant are considered in the next cycle,</span>
</span><span id="EventDrivenAgent-1121"><a href="#EventDrivenAgent-1121"><span class="linenos">1121</span></a><span class="sd">            avoiding temporal inconsistencies.</span>
</span><span id="EventDrivenAgent-1122"><a href="#EventDrivenAgent-1122"><span class="linenos">1122</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1123"><a href="#EventDrivenAgent-1123"><span class="linenos">1123</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent-1124"><a href="#EventDrivenAgent-1124"><span class="linenos">1124</span></a><span class="sd">            Implements FIPA Inform protocol when notifying agents of processed</span>
</span><span id="EventDrivenAgent-1125"><a href="#EventDrivenAgent-1125"><span class="linenos">1125</span></a><span class="sd">            events, acting as initiator in broadcast notification patterns.</span>
</span><span id="EventDrivenAgent-1126"><a href="#EventDrivenAgent-1126"><span class="linenos">1126</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1127"><a href="#EventDrivenAgent-1127"><span class="linenos">1127</span></a><span class="sd">        Warning:</span>
</span><span id="EventDrivenAgent-1128"><a href="#EventDrivenAgent-1128"><span class="linenos">1128</span></a><span class="sd">            If the heap is empty, the cycle is skipped. This is normal when there</span>
</span><span id="EventDrivenAgent-1129"><a href="#EventDrivenAgent-1129"><span class="linenos">1129</span></a><span class="sd">            are no pending events.</span>
</span><span id="EventDrivenAgent-1130"><a href="#EventDrivenAgent-1130"><span class="linenos">1130</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent-1131"><a href="#EventDrivenAgent-1131"><span class="linenos">1131</span></a><span class="sd">        See Also:</span>
</span><span id="EventDrivenAgent-1132"><a href="#EventDrivenAgent-1132"><span class="linenos">1132</span></a><span class="sd">            notify_events: Internal method to distribute processed events.</span>
</span><span id="EventDrivenAgent-1133"><a href="#EventDrivenAgent-1133"><span class="linenos">1133</span></a><span class="sd">            Event: Event data structure.</span>
</span><span id="EventDrivenAgent-1134"><a href="#EventDrivenAgent-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-1135"><a href="#EventDrivenAgent-1135"><span class="linenos">1135</span></a>        
</span><span id="EventDrivenAgent-1136"><a href="#EventDrivenAgent-1136"><span class="linenos">1136</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent-1137"><a href="#EventDrivenAgent-1137"><span class="linenos">1137</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute one cycle of event processing.</span>
</span><span id="EventDrivenAgent-1138"><a href="#EventDrivenAgent-1138"><span class="linenos">1138</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1139"><a href="#EventDrivenAgent-1139"><span class="linenos">1139</span></a><span class="sd">            This method is called periodically by SPADE framework at the interval</span>
</span><span id="EventDrivenAgent-1140"><a href="#EventDrivenAgent-1140"><span class="linenos">1140</span></a><span class="sd">            defined by simulation_interval. It coordinates all processing steps,</span>
</span><span id="EventDrivenAgent-1141"><a href="#EventDrivenAgent-1141"><span class="linenos">1141</span></a><span class="sd">            from heap preparation to agent notification.</span>
</span><span id="EventDrivenAgent-1142"><a href="#EventDrivenAgent-1142"><span class="linenos">1142</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1143"><a href="#EventDrivenAgent-1143"><span class="linenos">1143</span></a><span class="sd">            Detailed Steps:</span>
</span><span id="EventDrivenAgent-1144"><a href="#EventDrivenAgent-1144"><span class="linenos">1144</span></a><span class="sd">                1. **Heap Preparation**:</span>
</span><span id="EventDrivenAgent-1145"><a href="#EventDrivenAgent-1145"><span class="linenos">1145</span></a><span class="sd">                   - Transfer arrival_events to event_heap</span>
</span><span id="EventDrivenAgent-1146"><a href="#EventDrivenAgent-1146"><span class="linenos">1146</span></a><span class="sd">                   - Reinsert transit_events into heap</span>
</span><span id="EventDrivenAgent-1147"><a href="#EventDrivenAgent-1147"><span class="linenos">1147</span></a><span class="sd">                   - Empty temporary buffers</span>
</span><span id="EventDrivenAgent-1148"><a href="#EventDrivenAgent-1148"><span class="linenos">1148</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1149"><a href="#EventDrivenAgent-1149"><span class="linenos">1149</span></a><span class="sd">                2. **Event Verification**:</span>
</span><span id="EventDrivenAgent-1150"><a href="#EventDrivenAgent-1150"><span class="linenos">1150</span></a><span class="sd">                   - If heap empty, terminate cycle</span>
</span><span id="EventDrivenAgent-1151"><a href="#EventDrivenAgent-1151"><span class="linenos">1151</span></a><span class="sd">                   - Log state for monitoring</span>
</span><span id="EventDrivenAgent-1152"><a href="#EventDrivenAgent-1152"><span class="linenos">1152</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1153"><a href="#EventDrivenAgent-1153"><span class="linenos">1153</span></a><span class="sd">                3. **Event Extraction**:</span>
</span><span id="EventDrivenAgent-1154"><a href="#EventDrivenAgent-1154"><span class="linenos">1154</span></a><span class="sd">                   - Remove first event (smallest time)</span>
</span><span id="EventDrivenAgent-1155"><a href="#EventDrivenAgent-1155"><span class="linenos">1155</span></a><span class="sd">                   - Collect subsequent events with same time</span>
</span><span id="EventDrivenAgent-1156"><a href="#EventDrivenAgent-1156"><span class="linenos">1156</span></a><span class="sd">                   - Create list of events to process</span>
</span><span id="EventDrivenAgent-1157"><a href="#EventDrivenAgent-1157"><span class="linenos">1157</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1158"><a href="#EventDrivenAgent-1158"><span class="linenos">1158</span></a><span class="sd">                4. **Transit Management**:</span>
</span><span id="EventDrivenAgent-1159"><a href="#EventDrivenAgent-1159"><span class="linenos">1159</span></a><span class="sd">                   - Remove transit events from separate list</span>
</span><span id="EventDrivenAgent-1160"><a href="#EventDrivenAgent-1160"><span class="linenos">1160</span></a><span class="sd">                   - Detect if last transit event was processed</span>
</span><span id="EventDrivenAgent-1161"><a href="#EventDrivenAgent-1161"><span class="linenos">1161</span></a><span class="sd">                   - Update time of remaining events</span>
</span><span id="EventDrivenAgent-1162"><a href="#EventDrivenAgent-1162"><span class="linenos">1162</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1163"><a href="#EventDrivenAgent-1163"><span class="linenos">1163</span></a><span class="sd">                5. **Notification**:</span>
</span><span id="EventDrivenAgent-1164"><a href="#EventDrivenAgent-1164"><span class="linenos">1164</span></a><span class="sd">                   - Call notify_events() to distribute to agents</span>
</span><span id="EventDrivenAgent-1165"><a href="#EventDrivenAgent-1165"><span class="linenos">1165</span></a><span class="sd">                   - Await send confirmations</span>
</span><span id="EventDrivenAgent-1166"><a href="#EventDrivenAgent-1166"><span class="linenos">1166</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1167"><a href="#EventDrivenAgent-1167"><span class="linenos">1167</span></a><span class="sd">                6. **Resimulation**:</span>
</span><span id="EventDrivenAgent-1168"><a href="#EventDrivenAgent-1168"><span class="linenos">1168</span></a><span class="sd">                   - If last transit event processed</span>
</span><span id="EventDrivenAgent-1169"><a href="#EventDrivenAgent-1169"><span class="linenos">1169</span></a><span class="sd">                   - Send new simulation request to world agent</span>
</span><span id="EventDrivenAgent-1170"><a href="#EventDrivenAgent-1170"><span class="linenos">1170</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1171"><a href="#EventDrivenAgent-1171"><span class="linenos">1171</span></a><span class="sd">                7. **Statistics**:</span>
</span><span id="EventDrivenAgent-1172"><a href="#EventDrivenAgent-1172"><span class="linenos">1172</span></a><span class="sd">                   - Update counters</span>
</span><span id="EventDrivenAgent-1173"><a href="#EventDrivenAgent-1173"><span class="linenos">1173</span></a><span class="sd">                   - Generate detailed logs if verbose=True</span>
</span><span id="EventDrivenAgent-1174"><a href="#EventDrivenAgent-1174"><span class="linenos">1174</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1175"><a href="#EventDrivenAgent-1175"><span class="linenos">1175</span></a><span class="sd">                8. **Cleanup**:</span>
</span><span id="EventDrivenAgent-1176"><a href="#EventDrivenAgent-1176"><span class="linenos">1176</span></a><span class="sd">                   - Empty event_heap</span>
</span><span id="EventDrivenAgent-1177"><a href="#EventDrivenAgent-1177"><span class="linenos">1177</span></a><span class="sd">                   - Prepare for next cycle</span>
</span><span id="EventDrivenAgent-1178"><a href="#EventDrivenAgent-1178"><span class="linenos">1178</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1179"><a href="#EventDrivenAgent-1179"><span class="linenos">1179</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent-1180"><a href="#EventDrivenAgent-1180"><span class="linenos">1180</span></a><span class="sd">                None: Executes side effects (notifications and state updates).</span>
</span><span id="EventDrivenAgent-1181"><a href="#EventDrivenAgent-1181"><span class="linenos">1181</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1182"><a href="#EventDrivenAgent-1182"><span class="linenos">1182</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent-1183"><a href="#EventDrivenAgent-1183"><span class="linenos">1183</span></a><span class="sd">                Decrementing transit event time ensures remaining time always</span>
</span><span id="EventDrivenAgent-1184"><a href="#EventDrivenAgent-1184"><span class="linenos">1184</span></a><span class="sd">                reflects interval until next processing. Processing only begins</span>
</span><span id="EventDrivenAgent-1185"><a href="#EventDrivenAgent-1185"><span class="linenos">1185</span></a><span class="sd">                after receiving first real arrival.</span>
</span><span id="EventDrivenAgent-1186"><a href="#EventDrivenAgent-1186"><span class="linenos">1186</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1187"><a href="#EventDrivenAgent-1187"><span class="linenos">1187</span></a><span class="sd">            Examples:</span>
</span><span id="EventDrivenAgent-1188"><a href="#EventDrivenAgent-1188"><span class="linenos">1188</span></a><span class="sd">                &gt;&gt;&gt; # Example verbose log during execution</span>
</span><span id="EventDrivenAgent-1189"><a href="#EventDrivenAgent-1189"><span class="linenos">1189</span></a><span class="sd">                [event_agent]  PROCESSING EVENTS</span>
</span><span id="EventDrivenAgent-1190"><a href="#EventDrivenAgent-1190"><span class="linenos">1190</span></a><span class="sd">                [event_agent] Simulation time: 5.0s</span>
</span><span id="EventDrivenAgent-1191"><a href="#EventDrivenAgent-1191"><span class="linenos">1191</span></a><span class="sd">                [event_agent] Events in heap: 3</span>
</span><span id="EventDrivenAgent-1192"><a href="#EventDrivenAgent-1192"><span class="linenos">1192</span></a><span class="sd">                [event_agent] Transit events: 5</span>
</span><span id="EventDrivenAgent-1193"><a href="#EventDrivenAgent-1193"><span class="linenos">1193</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1194"><a href="#EventDrivenAgent-1194"><span class="linenos">1194</span></a><span class="sd">                [event_agent]  Next event: Event(type=arrival, time=10.50, sender=vehicle1@localhost)</span>
</span><span id="EventDrivenAgent-1195"><a href="#EventDrivenAgent-1195"><span class="linenos">1195</span></a><span class="sd">                [event_agent]  Total events with time 10.50s: 2</span>
</span><span id="EventDrivenAgent-1196"><a href="#EventDrivenAgent-1196"><span class="linenos">1196</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1197"><a href="#EventDrivenAgent-1197"><span class="linenos">1197</span></a><span class="sd">                [event_agent]  Notifying grouped ARRIVAL event to 3 vehicles</span>
</span><span id="EventDrivenAgent-1198"><a href="#EventDrivenAgent-1198"><span class="linenos">1198</span></a><span class="sd">                   Arrived vehicles: [&#39;vehicle1&#39;, &#39;vehicle2&#39;]</span>
</span><span id="EventDrivenAgent-1199"><a href="#EventDrivenAgent-1199"><span class="linenos">1199</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1200"><a href="#EventDrivenAgent-1200"><span class="linenos">1200</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent-1201"><a href="#EventDrivenAgent-1201"><span class="linenos">1201</span></a><span class="sd">                Sends INFORM performatives to notify agents of processed events,</span>
</span><span id="EventDrivenAgent-1202"><a href="#EventDrivenAgent-1202"><span class="linenos">1202</span></a><span class="sd">                implementing broadcast notification pattern.</span>
</span><span id="EventDrivenAgent-1203"><a href="#EventDrivenAgent-1203"><span class="linenos">1203</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-1204"><a href="#EventDrivenAgent-1204"><span class="linenos">1204</span></a>            <span class="c1"># Check if first arrival received before processing</span>
</span><span id="EventDrivenAgent-1205"><a href="#EventDrivenAgent-1205"><span class="linenos">1205</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1206"><a href="#EventDrivenAgent-1206"><span class="linenos">1206</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1207"><a href="#EventDrivenAgent-1207"><span class="linenos">1207</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Waiting for first arrival before processing heap...&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1208"><a href="#EventDrivenAgent-1208"><span class="linenos">1208</span></a>                <span class="k">return</span>  <span class="c1"># Don&#39;t process until first arrival received</span>
</span><span id="EventDrivenAgent-1209"><a href="#EventDrivenAgent-1209"><span class="linenos">1209</span></a>            
</span><span id="EventDrivenAgent-1210"><a href="#EventDrivenAgent-1210"><span class="linenos">1210</span></a>            <span class="c1"># Adicionar eventos de arrival  heap e esvaziar a lista</span>
</span><span id="EventDrivenAgent-1211"><a href="#EventDrivenAgent-1211"><span class="linenos">1211</span></a>            <span class="k">for</span> <span class="n">arrival_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1212"><a href="#EventDrivenAgent-1212"><span class="linenos">1212</span></a>                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">arrival_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1213"><a href="#EventDrivenAgent-1213"><span class="linenos">1213</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1214"><a href="#EventDrivenAgent-1214"><span class="linenos">1214</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1215"><a href="#EventDrivenAgent-1215"><span class="linenos">1215</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Adicionados </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span><span class="si">}</span><span class="s2"> eventos de arrival  heap&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1216"><a href="#EventDrivenAgent-1216"><span class="linenos">1216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Esvaziar a lista</span>
</span><span id="EventDrivenAgent-1217"><a href="#EventDrivenAgent-1217"><span class="linenos">1217</span></a>            
</span><span id="EventDrivenAgent-1218"><a href="#EventDrivenAgent-1218"><span class="linenos">1218</span></a>            <span class="c1"># Recolocar eventos de trnsito na heap no incio</span>
</span><span id="EventDrivenAgent-1219"><a href="#EventDrivenAgent-1219"><span class="linenos">1219</span></a>            <span class="k">for</span> <span class="n">transit_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1220"><a href="#EventDrivenAgent-1220"><span class="linenos">1220</span></a>                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1221"><a href="#EventDrivenAgent-1221"><span class="linenos">1221</span></a>            
</span><span id="EventDrivenAgent-1222"><a href="#EventDrivenAgent-1222"><span class="linenos">1222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1223"><a href="#EventDrivenAgent-1223"><span class="linenos">1223</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1224"><a href="#EventDrivenAgent-1224"><span class="linenos">1224</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PROCESSANDO EVENTOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1225"><a href="#EventDrivenAgent-1225"><span class="linenos">1225</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">simulation_interval</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1226"><a href="#EventDrivenAgent-1226"><span class="linenos">1226</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Eventos na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1227"><a href="#EventDrivenAgent-1227"><span class="linenos">1227</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1228"><a href="#EventDrivenAgent-1228"><span class="linenos">1228</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1229"><a href="#EventDrivenAgent-1229"><span class="linenos">1229</span></a>            
</span><span id="EventDrivenAgent-1230"><a href="#EventDrivenAgent-1230"><span class="linenos">1230</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1231"><a href="#EventDrivenAgent-1231"><span class="linenos">1231</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1232"><a href="#EventDrivenAgent-1232"><span class="linenos">1232</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Nenhum evento para processar</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1233"><a href="#EventDrivenAgent-1233"><span class="linenos">1233</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent-1234"><a href="#EventDrivenAgent-1234"><span class="linenos">1234</span></a>            
</span><span id="EventDrivenAgent-1235"><a href="#EventDrivenAgent-1235"><span class="linenos">1235</span></a>            <span class="c1"># Tirar o primeiro evento da heap (menor tempo)</span>
</span><span id="EventDrivenAgent-1236"><a href="#EventDrivenAgent-1236"><span class="linenos">1236</span></a>            <span class="n">first_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1237"><a href="#EventDrivenAgent-1237"><span class="linenos">1237</span></a>            <span class="n">event_time</span> <span class="o">=</span> <span class="n">first_event</span><span class="o">.</span><span class="n">time</span>
</span><span id="EventDrivenAgent-1238"><a href="#EventDrivenAgent-1238"><span class="linenos">1238</span></a>            <span class="n">events_to_process</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_event</span><span class="p">]</span>
</span><span id="EventDrivenAgent-1239"><a href="#EventDrivenAgent-1239"><span class="linenos">1239</span></a>            
</span><span id="EventDrivenAgent-1240"><a href="#EventDrivenAgent-1240"><span class="linenos">1240</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Next event: </span><span class="si">{</span><span class="n">first_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1241"><a href="#EventDrivenAgent-1241"><span class="linenos">1241</span></a>            
</span><span id="EventDrivenAgent-1242"><a href="#EventDrivenAgent-1242"><span class="linenos">1242</span></a>            <span class="c1"># Continuar a dar pop enquanto houver eventos com o mesmo tempo</span>
</span><span id="EventDrivenAgent-1243"><a href="#EventDrivenAgent-1243"><span class="linenos">1243</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">event_time</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1244"><a href="#EventDrivenAgent-1244"><span class="linenos">1244</span></a>                <span class="n">next_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1245"><a href="#EventDrivenAgent-1245"><span class="linenos">1245</span></a>                <span class="n">events_to_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1246"><a href="#EventDrivenAgent-1246"><span class="linenos">1246</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1247"><a href="#EventDrivenAgent-1247"><span class="linenos">1247</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento adicional (mesmo tempo): </span><span class="si">{</span><span class="n">next_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1248"><a href="#EventDrivenAgent-1248"><span class="linenos">1248</span></a>            
</span><span id="EventDrivenAgent-1249"><a href="#EventDrivenAgent-1249"><span class="linenos">1249</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1250"><a href="#EventDrivenAgent-1250"><span class="linenos">1250</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Total de eventos com tempo </span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1251"><a href="#EventDrivenAgent-1251"><span class="linenos">1251</span></a>            
</span><span id="EventDrivenAgent-1252"><a href="#EventDrivenAgent-1252"><span class="linenos">1252</span></a>            <span class="c1"># Processar remoo de eventos de trnsito da lista</span>
</span><span id="EventDrivenAgent-1253"><a href="#EventDrivenAgent-1253"><span class="linenos">1253</span></a>            <span class="n">was_last_transit_event</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EventDrivenAgent-1254"><a href="#EventDrivenAgent-1254"><span class="linenos">1254</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events_to_process</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1255"><a href="#EventDrivenAgent-1255"><span class="linenos">1255</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1256"><a href="#EventDrivenAgent-1256"><span class="linenos">1256</span></a>                    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1257"><a href="#EventDrivenAgent-1257"><span class="linenos">1257</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1258"><a href="#EventDrivenAgent-1258"><span class="linenos">1258</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1259"><a href="#EventDrivenAgent-1259"><span class="linenos">1259</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Transit event removed from list: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1260"><a href="#EventDrivenAgent-1260"><span class="linenos">1260</span></a>            
</span><span id="EventDrivenAgent-1261"><a href="#EventDrivenAgent-1261"><span class="linenos">1261</span></a>            <span class="c1"># Verificar se era o ltimo evento de trnsito</span>
</span><span id="EventDrivenAgent-1262"><a href="#EventDrivenAgent-1262"><span class="linenos">1262</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1263"><a href="#EventDrivenAgent-1263"><span class="linenos">1263</span></a>                <span class="c1"># Verificar se algum dos eventos processados era de trnsito</span>
</span><span id="EventDrivenAgent-1264"><a href="#EventDrivenAgent-1264"><span class="linenos">1264</span></a>                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events_to_process</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1265"><a href="#EventDrivenAgent-1265"><span class="linenos">1265</span></a>                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1266"><a href="#EventDrivenAgent-1266"><span class="linenos">1266</span></a>                        <span class="n">was_last_transit_event</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EventDrivenAgent-1267"><a href="#EventDrivenAgent-1267"><span class="linenos">1267</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1268"><a href="#EventDrivenAgent-1268"><span class="linenos">1268</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   LTIMO EVENTO DE TRNSITO REMOVIDO!&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1269"><a href="#EventDrivenAgent-1269"><span class="linenos">1269</span></a>                        <span class="k">break</span>
</span><span id="EventDrivenAgent-1270"><a href="#EventDrivenAgent-1270"><span class="linenos">1270</span></a>            
</span><span id="EventDrivenAgent-1271"><a href="#EventDrivenAgent-1271"><span class="linenos">1271</span></a>            <span class="c1"># Atualizar tempo de todos os eventos de trnsito restantes</span>
</span><span id="EventDrivenAgent-1272"><a href="#EventDrivenAgent-1272"><span class="linenos">1272</span></a>            <span class="n">updated_transit_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent-1273"><a href="#EventDrivenAgent-1273"><span class="linenos">1273</span></a>            <span class="k">for</span> <span class="n">transit_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1274"><a href="#EventDrivenAgent-1274"><span class="linenos">1274</span></a>                <span class="n">transit_event</span><span class="o">.</span><span class="n">time</span> <span class="o">-=</span> <span class="n">event_time</span>
</span><span id="EventDrivenAgent-1275"><a href="#EventDrivenAgent-1275"><span class="linenos">1275</span></a>                <span class="n">updated_transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1276"><a href="#EventDrivenAgent-1276"><span class="linenos">1276</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1277"><a href="#EventDrivenAgent-1277"><span class="linenos">1277</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Trnsito atualizado: </span><span class="si">{</span><span class="n">transit_event</span><span class="si">}</span><span class="s2"> (tempo restante: </span><span class="si">{</span><span class="n">transit_event</span><span class="o">.</span><span class="n">time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1278"><a href="#EventDrivenAgent-1278"><span class="linenos">1278</span></a>            
</span><span id="EventDrivenAgent-1279"><a href="#EventDrivenAgent-1279"><span class="linenos">1279</span></a>            <span class="c1"># Atualizar lista de eventos de trnsito</span>
</span><span id="EventDrivenAgent-1280"><a href="#EventDrivenAgent-1280"><span class="linenos">1280</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span> <span class="o">=</span> <span class="n">updated_transit_events</span>
</span><span id="EventDrivenAgent-1281"><a href="#EventDrivenAgent-1281"><span class="linenos">1281</span></a>            
</span><span id="EventDrivenAgent-1282"><a href="#EventDrivenAgent-1282"><span class="linenos">1282</span></a>            <span class="c1"># Notificar todos os veculos sobre os eventos processados (sequencialmente)</span>
</span><span id="EventDrivenAgent-1283"><a href="#EventDrivenAgent-1283"><span class="linenos">1283</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_events</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1284"><a href="#EventDrivenAgent-1284"><span class="linenos">1284</span></a>            
</span><span id="EventDrivenAgent-1285"><a href="#EventDrivenAgent-1285"><span class="linenos">1285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1286"><a href="#EventDrivenAgent-1286"><span class="linenos">1286</span></a>            
</span><span id="EventDrivenAgent-1287"><a href="#EventDrivenAgent-1287"><span class="linenos">1287</span></a>            <span class="c1"># Se foi o ltimo evento de trnsito, solicitar nova simulao</span>
</span><span id="EventDrivenAgent-1288"><a href="#EventDrivenAgent-1288"><span class="linenos">1288</span></a>            <span class="k">if</span> <span class="n">was_last_transit_event</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1289"><a href="#EventDrivenAgent-1289"><span class="linenos">1289</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1290"><a href="#EventDrivenAgent-1290"><span class="linenos">1290</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1291"><a href="#EventDrivenAgent-1291"><span class="linenos">1291</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SOLICITANDO NOVA SIMULAO DE TRNSITO&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1292"><a href="#EventDrivenAgent-1292"><span class="linenos">1292</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Motivo: ltimo evento de trnsito processado&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1293"><a href="#EventDrivenAgent-1293"><span class="linenos">1293</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Destinatrio: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1294"><a href="#EventDrivenAgent-1294"><span class="linenos">1294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1295"><a href="#EventDrivenAgent-1295"><span class="linenos">1295</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1296"><a href="#EventDrivenAgent-1296"><span class="linenos">1296</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SOLICITANDO NOVA SIMULAO DE TRNSITO&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1297"><a href="#EventDrivenAgent-1297"><span class="linenos">1297</span></a>                
</span><span id="EventDrivenAgent-1298"><a href="#EventDrivenAgent-1298"><span class="linenos">1298</span></a>                <span class="c1"># Enviar pedido de nova simulao</span>
</span><span id="EventDrivenAgent-1299"><a href="#EventDrivenAgent-1299"><span class="linenos">1299</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1300"><a href="#EventDrivenAgent-1300"><span class="linenos">1300</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1301"><a href="#EventDrivenAgent-1301"><span class="linenos">1301</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1302"><a href="#EventDrivenAgent-1302"><span class="linenos">1302</span></a>                
</span><span id="EventDrivenAgent-1303"><a href="#EventDrivenAgent-1303"><span class="linenos">1303</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent-1304"><a href="#EventDrivenAgent-1304"><span class="linenos">1304</span></a>                    <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1305"><a href="#EventDrivenAgent-1305"><span class="linenos">1305</span></a>                    <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1306"><a href="#EventDrivenAgent-1306"><span class="linenos">1306</span></a>                <span class="p">}</span>
</span><span id="EventDrivenAgent-1307"><a href="#EventDrivenAgent-1307"><span class="linenos">1307</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1308"><a href="#EventDrivenAgent-1308"><span class="linenos">1308</span></a>                
</span><span id="EventDrivenAgent-1309"><a href="#EventDrivenAgent-1309"><span class="linenos">1309</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1310"><a href="#EventDrivenAgent-1310"><span class="linenos">1310</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Pedido de nova simulao enviado</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1311"><a href="#EventDrivenAgent-1311"><span class="linenos">1311</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1312"><a href="#EventDrivenAgent-1312"><span class="linenos">1312</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Estatsticas:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1313"><a href="#EventDrivenAgent-1313"><span class="linenos">1313</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos processados: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1314"><a href="#EventDrivenAgent-1314"><span class="linenos">1314</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tipos: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">event_type</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">events_to_process</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1315"><a href="#EventDrivenAgent-1315"><span class="linenos">1315</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tempo dos eventos: </span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1316"><a href="#EventDrivenAgent-1316"><span class="linenos">1316</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Trnsitos ativos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1317"><a href="#EventDrivenAgent-1317"><span class="linenos">1317</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total recebido: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1318"><a href="#EventDrivenAgent-1318"><span class="linenos">1318</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total processado: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">processed_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1319"><a href="#EventDrivenAgent-1319"><span class="linenos">1319</span></a>                    
</span><span id="EventDrivenAgent-1320"><a href="#EventDrivenAgent-1320"><span class="linenos">1320</span></a>                <span class="c1"># Imprimir estado completo da heap restante</span>
</span><span id="EventDrivenAgent-1321"><a href="#EventDrivenAgent-1321"><span class="linenos">1321</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  ESTADO DA HEAP RESTANTE:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1322"><a href="#EventDrivenAgent-1322"><span class="linenos">1322</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1323"><a href="#EventDrivenAgent-1323"><span class="linenos">1323</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Heap vazia (sem eventos)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1324"><a href="#EventDrivenAgent-1324"><span class="linenos">1324</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1325"><a href="#EventDrivenAgent-1325"><span class="linenos">1325</span></a>                    <span class="c1"># Mostrar eventos normais na heap</span>
</span><span id="EventDrivenAgent-1326"><a href="#EventDrivenAgent-1326"><span class="linenos">1326</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1327"><a href="#EventDrivenAgent-1327"><span class="linenos">1327</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos normais na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1328"><a href="#EventDrivenAgent-1328"><span class="linenos">1328</span></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="EventDrivenAgent-1329"><a href="#EventDrivenAgent-1329"><span class="linenos">1329</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1330"><a href="#EventDrivenAgent-1330"><span class="linenos">1330</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1331"><a href="#EventDrivenAgent-1331"><span class="linenos">1331</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos normais na heap: 0&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1332"><a href="#EventDrivenAgent-1332"><span class="linenos">1332</span></a>                    
</span><span id="EventDrivenAgent-1333"><a href="#EventDrivenAgent-1333"><span class="linenos">1333</span></a>                    <span class="c1"># Mostrar eventos de trnsito</span>
</span><span id="EventDrivenAgent-1334"><a href="#EventDrivenAgent-1334"><span class="linenos">1334</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1335"><a href="#EventDrivenAgent-1335"><span class="linenos">1335</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos de trnsito: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1336"><a href="#EventDrivenAgent-1336"><span class="linenos">1336</span></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="EventDrivenAgent-1337"><a href="#EventDrivenAgent-1337"><span class="linenos">1337</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1338"><a href="#EventDrivenAgent-1338"><span class="linenos">1338</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1339"><a href="#EventDrivenAgent-1339"><span class="linenos">1339</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos de trnsito: 0&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1340"><a href="#EventDrivenAgent-1340"><span class="linenos">1340</span></a>                
</span><span id="EventDrivenAgent-1341"><a href="#EventDrivenAgent-1341"><span class="linenos">1341</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1342"><a href="#EventDrivenAgent-1342"><span class="linenos">1342</span></a>
</span><span id="EventDrivenAgent-1343"><a href="#EventDrivenAgent-1343"><span class="linenos">1343</span></a>            <span class="c1"># Esvaziar a heap (descartar outros eventos)</span>
</span><span id="EventDrivenAgent-1344"><a href="#EventDrivenAgent-1344"><span class="linenos">1344</span></a>            <span class="n">discarded_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1345"><a href="#EventDrivenAgent-1345"><span class="linenos">1345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent-1346"><a href="#EventDrivenAgent-1346"><span class="linenos">1346</span></a>            
</span><span id="EventDrivenAgent-1347"><a href="#EventDrivenAgent-1347"><span class="linenos">1347</span></a>            <span class="k">if</span> <span class="n">discarded_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1348"><a href="#EventDrivenAgent-1348"><span class="linenos">1348</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1349"><a href="#EventDrivenAgent-1349"><span class="linenos">1349</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Heap esvaziada: </span><span class="si">{</span><span class="n">discarded_count</span><span class="si">}</span><span class="s2"> eventos descartados&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1350"><a href="#EventDrivenAgent-1350"><span class="linenos">1350</span></a>        
</span><span id="EventDrivenAgent-1351"><a href="#EventDrivenAgent-1351"><span class="linenos">1351</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">notify_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]):</span>
</span><span id="EventDrivenAgent-1352"><a href="#EventDrivenAgent-1352"><span class="linenos">1352</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-1353"><a href="#EventDrivenAgent-1353"><span class="linenos">1353</span></a><span class="sd">            Notifica agentes apropriados sobre eventos processados com agrupamento inteligente.</span>
</span><span id="EventDrivenAgent-1354"><a href="#EventDrivenAgent-1354"><span class="linenos">1354</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1355"><a href="#EventDrivenAgent-1355"><span class="linenos">1355</span></a><span class="sd">            Este mtodo distribui eventos aos agentes relevantes, implementando estratgias</span>
</span><span id="EventDrivenAgent-1356"><a href="#EventDrivenAgent-1356"><span class="linenos">1356</span></a><span class="sd">            de optimizao diferentes para cada tipo de evento. O agrupamento de arrivals</span>
</span><span id="EventDrivenAgent-1357"><a href="#EventDrivenAgent-1357"><span class="linenos">1357</span></a><span class="sd">            e o ajuste temporal de trnsito garantem eficincia e consistncia temporal.</span>
</span><span id="EventDrivenAgent-1358"><a href="#EventDrivenAgent-1358"><span class="linenos">1358</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1359"><a href="#EventDrivenAgent-1359"><span class="linenos">1359</span></a><span class="sd">            Estratgias por Tipo:</span>
</span><span id="EventDrivenAgent-1360"><a href="#EventDrivenAgent-1360"><span class="linenos">1360</span></a><span class="sd">                1. **Arrival Events**:</span>
</span><span id="EventDrivenAgent-1361"><a href="#EventDrivenAgent-1361"><span class="linenos">1361</span></a><span class="sd">                   - Agrupados numa nica mensagem por veculo</span>
</span><span id="EventDrivenAgent-1362"><a href="#EventDrivenAgent-1362"><span class="linenos">1362</span></a><span class="sd">                   - Lista de todos os veculos que chegaram includa</span>
</span><span id="EventDrivenAgent-1363"><a href="#EventDrivenAgent-1363"><span class="linenos">1363</span></a><span class="sd">                   - Enviada a TODOS os veculos registados</span>
</span><span id="EventDrivenAgent-1364"><a href="#EventDrivenAgent-1364"><span class="linenos">1364</span></a><span class="sd">                   - Apenas o tempo do primeiro arrival  usado</span>
</span><span id="EventDrivenAgent-1365"><a href="#EventDrivenAgent-1365"><span class="linenos">1365</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1366"><a href="#EventDrivenAgent-1366"><span class="linenos">1366</span></a><span class="sd">                2. **Transit Events**:</span>
</span><span id="EventDrivenAgent-1367"><a href="#EventDrivenAgent-1367"><span class="linenos">1367</span></a><span class="sd">                   - Enviados individualmente mas sequencialmente</span>
</span><span id="EventDrivenAgent-1368"><a href="#EventDrivenAgent-1368"><span class="linenos">1368</span></a><span class="sd">                   - Primeiro evento tem tempo real</span>
</span><span id="EventDrivenAgent-1369"><a href="#EventDrivenAgent-1369"><span class="linenos">1369</span></a><span class="sd">                   - Eventos subsequentes tm tempo 0 (evita resimulao)</span>
</span><span id="EventDrivenAgent-1370"><a href="#EventDrivenAgent-1370"><span class="linenos">1370</span></a><span class="sd">                   - Enviados a veculos, armazns e lojas</span>
</span><span id="EventDrivenAgent-1371"><a href="#EventDrivenAgent-1371"><span class="linenos">1371</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1372"><a href="#EventDrivenAgent-1372"><span class="linenos">1372</span></a><span class="sd">                3. **UpdateSimulation Events**:</span>
</span><span id="EventDrivenAgent-1373"><a href="#EventDrivenAgent-1373"><span class="linenos">1373</span></a><span class="sd">                   - Enviados apenas ao world agent</span>
</span><span id="EventDrivenAgent-1374"><a href="#EventDrivenAgent-1374"><span class="linenos">1374</span></a><span class="sd">                   - Solicita nova simulao de trfego</span>
</span><span id="EventDrivenAgent-1375"><a href="#EventDrivenAgent-1375"><span class="linenos">1375</span></a><span class="sd">                   - Usa tempo configurado em world_simulation_time</span>
</span><span id="EventDrivenAgent-1376"><a href="#EventDrivenAgent-1376"><span class="linenos">1376</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1377"><a href="#EventDrivenAgent-1377"><span class="linenos">1377</span></a><span class="sd">            Args:</span>
</span><span id="EventDrivenAgent-1378"><a href="#EventDrivenAgent-1378"><span class="linenos">1378</span></a><span class="sd">                events (List[Event]): Lista de eventos a notificar. Podem ser de tipos</span>
</span><span id="EventDrivenAgent-1379"><a href="#EventDrivenAgent-1379"><span class="linenos">1379</span></a><span class="sd">                    mistos. O mtodo classifica e processa cada tipo adequadamente.</span>
</span><span id="EventDrivenAgent-1380"><a href="#EventDrivenAgent-1380"><span class="linenos">1380</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1381"><a href="#EventDrivenAgent-1381"><span class="linenos">1381</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent-1382"><a href="#EventDrivenAgent-1382"><span class="linenos">1382</span></a><span class="sd">                None: Executa efeitos colaterais (envio de mensagens XMPP).</span>
</span><span id="EventDrivenAgent-1383"><a href="#EventDrivenAgent-1383"><span class="linenos">1383</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1384"><a href="#EventDrivenAgent-1384"><span class="linenos">1384</span></a><span class="sd">            Message Formats:</span>
</span><span id="EventDrivenAgent-1385"><a href="#EventDrivenAgent-1385"><span class="linenos">1385</span></a><span class="sd">                Arrival (agrupado):</span>
</span><span id="EventDrivenAgent-1386"><a href="#EventDrivenAgent-1386"><span class="linenos">1386</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent-1387"><a href="#EventDrivenAgent-1387"><span class="linenos">1387</span></a><span class="sd">                        &quot;type&quot;: &quot;arrival&quot;,</span>
</span><span id="EventDrivenAgent-1388"><a href="#EventDrivenAgent-1388"><span class="linenos">1388</span></a><span class="sd">                        &quot;time&quot;: float,              # Tempo do primeiro arrival</span>
</span><span id="EventDrivenAgent-1389"><a href="#EventDrivenAgent-1389"><span class="linenos">1389</span></a><span class="sd">                        &quot;vehicles&quot;: List[str]       # Lista de nomes de veculos</span>
</span><span id="EventDrivenAgent-1390"><a href="#EventDrivenAgent-1390"><span class="linenos">1390</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent-1391"><a href="#EventDrivenAgent-1391"><span class="linenos">1391</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1392"><a href="#EventDrivenAgent-1392"><span class="linenos">1392</span></a><span class="sd">                Transit (individual):</span>
</span><span id="EventDrivenAgent-1393"><a href="#EventDrivenAgent-1393"><span class="linenos">1393</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent-1394"><a href="#EventDrivenAgent-1394"><span class="linenos">1394</span></a><span class="sd">                        &quot;type&quot;: &quot;Transit&quot;,</span>
</span><span id="EventDrivenAgent-1395"><a href="#EventDrivenAgent-1395"><span class="linenos">1395</span></a><span class="sd">                        &quot;time&quot;: float,              # Real para primeiro, 0 para restantes</span>
</span><span id="EventDrivenAgent-1396"><a href="#EventDrivenAgent-1396"><span class="linenos">1396</span></a><span class="sd">                        &quot;data&quot;: {</span>
</span><span id="EventDrivenAgent-1397"><a href="#EventDrivenAgent-1397"><span class="linenos">1397</span></a><span class="sd">                            &quot;edges&quot;: [</span>
</span><span id="EventDrivenAgent-1398"><a href="#EventDrivenAgent-1398"><span class="linenos">1398</span></a><span class="sd">                                {</span>
</span><span id="EventDrivenAgent-1399"><a href="#EventDrivenAgent-1399"><span class="linenos">1399</span></a><span class="sd">                                    &quot;node1&quot;: int,</span>
</span><span id="EventDrivenAgent-1400"><a href="#EventDrivenAgent-1400"><span class="linenos">1400</span></a><span class="sd">                                    &quot;node2&quot;: int,</span>
</span><span id="EventDrivenAgent-1401"><a href="#EventDrivenAgent-1401"><span class="linenos">1401</span></a><span class="sd">                                    &quot;weight&quot;: float,</span>
</span><span id="EventDrivenAgent-1402"><a href="#EventDrivenAgent-1402"><span class="linenos">1402</span></a><span class="sd">                                    &quot;fuel_consumption&quot;: float</span>
</span><span id="EventDrivenAgent-1403"><a href="#EventDrivenAgent-1403"><span class="linenos">1403</span></a><span class="sd">                                }</span>
</span><span id="EventDrivenAgent-1404"><a href="#EventDrivenAgent-1404"><span class="linenos">1404</span></a><span class="sd">                            ]</span>
</span><span id="EventDrivenAgent-1405"><a href="#EventDrivenAgent-1405"><span class="linenos">1405</span></a><span class="sd">                        }</span>
</span><span id="EventDrivenAgent-1406"><a href="#EventDrivenAgent-1406"><span class="linenos">1406</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent-1407"><a href="#EventDrivenAgent-1407"><span class="linenos">1407</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1408"><a href="#EventDrivenAgent-1408"><span class="linenos">1408</span></a><span class="sd">                UpdateSimulation:</span>
</span><span id="EventDrivenAgent-1409"><a href="#EventDrivenAgent-1409"><span class="linenos">1409</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent-1410"><a href="#EventDrivenAgent-1410"><span class="linenos">1410</span></a><span class="sd">                        &quot;simulation_time&quot;: float,</span>
</span><span id="EventDrivenAgent-1411"><a href="#EventDrivenAgent-1411"><span class="linenos">1411</span></a><span class="sd">                        &quot;requester&quot;: str            # JID do event agent</span>
</span><span id="EventDrivenAgent-1412"><a href="#EventDrivenAgent-1412"><span class="linenos">1412</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent-1413"><a href="#EventDrivenAgent-1413"><span class="linenos">1413</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1414"><a href="#EventDrivenAgent-1414"><span class="linenos">1414</span></a><span class="sd">            Examples:</span>
</span><span id="EventDrivenAgent-1415"><a href="#EventDrivenAgent-1415"><span class="linenos">1415</span></a><span class="sd">                &gt;&gt;&gt; # Processar lista mista de eventos</span>
</span><span id="EventDrivenAgent-1416"><a href="#EventDrivenAgent-1416"><span class="linenos">1416</span></a><span class="sd">                &gt;&gt;&gt; events = [</span>
</span><span id="EventDrivenAgent-1417"><a href="#EventDrivenAgent-1417"><span class="linenos">1417</span></a><span class="sd">                ...     Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle1@localhost&quot;),</span>
</span><span id="EventDrivenAgent-1418"><a href="#EventDrivenAgent-1418"><span class="linenos">1418</span></a><span class="sd">                ...     Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle2@localhost&quot;),</span>
</span><span id="EventDrivenAgent-1419"><a href="#EventDrivenAgent-1419"><span class="linenos">1419</span></a><span class="sd">                ...     Event(&quot;transit&quot;, 10.5, {&quot;edges&quot;: [...]})</span>
</span><span id="EventDrivenAgent-1420"><a href="#EventDrivenAgent-1420"><span class="linenos">1420</span></a><span class="sd">                ... ]</span>
</span><span id="EventDrivenAgent-1421"><a href="#EventDrivenAgent-1421"><span class="linenos">1421</span></a><span class="sd">                &gt;&gt;&gt; await self.notify_events(events)</span>
</span><span id="EventDrivenAgent-1422"><a href="#EventDrivenAgent-1422"><span class="linenos">1422</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent-1423"><a href="#EventDrivenAgent-1423"><span class="linenos">1423</span></a><span class="sd">                # Resultado:</span>
</span><span id="EventDrivenAgent-1424"><a href="#EventDrivenAgent-1424"><span class="linenos">1424</span></a><span class="sd">                # - 1 mensagem de arrival para cada veculo registado (lista agrupada)</span>
</span><span id="EventDrivenAgent-1425"><a href="#EventDrivenAgent-1425"><span class="linenos">1425</span></a><span class="sd">                # - 1 mensagem de transit para veculos + armazns + lojas</span>
</span><span id="EventDrivenAgent-1426"><a href="#EventDrivenAgent-1426"><span class="linenos">1426</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1427"><a href="#EventDrivenAgent-1427"><span class="linenos">1427</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent-1428"><a href="#EventDrivenAgent-1428"><span class="linenos">1428</span></a><span class="sd">                O ajuste de tempo para 0 em eventos subsequentes  crucial para evitar</span>
</span><span id="EventDrivenAgent-1429"><a href="#EventDrivenAgent-1429"><span class="linenos">1429</span></a><span class="sd">                que mltiplos eventos causem simulaes repetidas do mesmo intervalo</span>
</span><span id="EventDrivenAgent-1430"><a href="#EventDrivenAgent-1430"><span class="linenos">1430</span></a><span class="sd">                temporal nos agentes receptores.</span>
</span><span id="EventDrivenAgent-1431"><a href="#EventDrivenAgent-1431"><span class="linenos">1431</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1432"><a href="#EventDrivenAgent-1432"><span class="linenos">1432</span></a><span class="sd">            Warning:</span>
</span><span id="EventDrivenAgent-1433"><a href="#EventDrivenAgent-1433"><span class="linenos">1433</span></a><span class="sd">                Se world_agent no estiver configurado, eventos de updatesimulation</span>
</span><span id="EventDrivenAgent-1434"><a href="#EventDrivenAgent-1434"><span class="linenos">1434</span></a><span class="sd">                so ignorados silenciosamente com log de aviso.</span>
</span><span id="EventDrivenAgent-1435"><a href="#EventDrivenAgent-1435"><span class="linenos">1435</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent-1436"><a href="#EventDrivenAgent-1436"><span class="linenos">1436</span></a><span class="sd">            See Also:</span>
</span><span id="EventDrivenAgent-1437"><a href="#EventDrivenAgent-1437"><span class="linenos">1437</span></a><span class="sd">                Event.to_dict(): Serializao de eventos para mensagens.</span>
</span><span id="EventDrivenAgent-1438"><a href="#EventDrivenAgent-1438"><span class="linenos">1438</span></a><span class="sd">                ProcessEventsBehaviour.run(): Mtodo que invoca notify_events.</span>
</span><span id="EventDrivenAgent-1439"><a href="#EventDrivenAgent-1439"><span class="linenos">1439</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent-1440"><a href="#EventDrivenAgent-1440"><span class="linenos">1440</span></a>            <span class="c1"># Agrupar eventos por tipo</span>
</span><span id="EventDrivenAgent-1441"><a href="#EventDrivenAgent-1441"><span class="linenos">1441</span></a>            <span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent-1442"><a href="#EventDrivenAgent-1442"><span class="linenos">1442</span></a>            <span class="n">transit_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent-1443"><a href="#EventDrivenAgent-1443"><span class="linenos">1443</span></a>            <span class="n">other_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent-1444"><a href="#EventDrivenAgent-1444"><span class="linenos">1444</span></a>            
</span><span id="EventDrivenAgent-1445"><a href="#EventDrivenAgent-1445"><span class="linenos">1445</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1446"><a href="#EventDrivenAgent-1446"><span class="linenos">1446</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1447"><a href="#EventDrivenAgent-1447"><span class="linenos">1447</span></a>                    <span class="n">arrival_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1448"><a href="#EventDrivenAgent-1448"><span class="linenos">1448</span></a>                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1449"><a href="#EventDrivenAgent-1449"><span class="linenos">1449</span></a>                    <span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1450"><a href="#EventDrivenAgent-1450"><span class="linenos">1450</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1451"><a href="#EventDrivenAgent-1451"><span class="linenos">1451</span></a>                    <span class="n">other_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1452"><a href="#EventDrivenAgent-1452"><span class="linenos">1452</span></a>            
</span><span id="EventDrivenAgent-1453"><a href="#EventDrivenAgent-1453"><span class="linenos">1453</span></a>            <span class="c1"># Processar eventos de arrival agrupados</span>
</span><span id="EventDrivenAgent-1454"><a href="#EventDrivenAgent-1454"><span class="linenos">1454</span></a>            <span class="k">if</span> <span class="n">arrival_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1455"><a href="#EventDrivenAgent-1455"><span class="linenos">1455</span></a>                <span class="c1"># Coletar todos os nomes de veculos</span>
</span><span id="EventDrivenAgent-1456"><a href="#EventDrivenAgent-1456"><span class="linenos">1456</span></a>                <span class="n">vehicle_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">arrival_events</span><span class="p">]</span>
</span><span id="EventDrivenAgent-1457"><a href="#EventDrivenAgent-1457"><span class="linenos">1457</span></a>                <span class="c1"># Tempo  do primeiro evento</span>
</span><span id="EventDrivenAgent-1458"><a href="#EventDrivenAgent-1458"><span class="linenos">1458</span></a>                <span class="n">event_time</span> <span class="o">=</span> <span class="n">arrival_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
</span><span id="EventDrivenAgent-1459"><a href="#EventDrivenAgent-1459"><span class="linenos">1459</span></a>                
</span><span id="EventDrivenAgent-1460"><a href="#EventDrivenAgent-1460"><span class="linenos">1460</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1461"><a href="#EventDrivenAgent-1461"><span class="linenos">1461</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento ARRIVAL agrupado para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> veculos&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1462"><a href="#EventDrivenAgent-1462"><span class="linenos">1462</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Veculos que chegaram: </span><span class="si">{</span><span class="n">vehicle_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1463"><a href="#EventDrivenAgent-1463"><span class="linenos">1463</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1464"><a href="#EventDrivenAgent-1464"><span class="linenos">1464</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento ARRIVAL agrupado para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> veculos&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1465"><a href="#EventDrivenAgent-1465"><span class="linenos">1465</span></a>
</span><span id="EventDrivenAgent-1466"><a href="#EventDrivenAgent-1466"><span class="linenos">1466</span></a>                <span class="c1"># Enviar uma nica mensagem para todos os veculos registrados</span>
</span><span id="EventDrivenAgent-1467"><a href="#EventDrivenAgent-1467"><span class="linenos">1467</span></a>                <span class="n">recipients</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> 
</span><span id="EventDrivenAgent-1468"><a href="#EventDrivenAgent-1468"><span class="linenos">1468</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="EventDrivenAgent-1469"><a href="#EventDrivenAgent-1469"><span class="linenos">1469</span></a>                            <span class="p">)</span> <span class="c1"># TODO + self.agent.registered_warehouses + self.agent.registered_suppliers</span>
</span><span id="EventDrivenAgent-1470"><a href="#EventDrivenAgent-1470"><span class="linenos">1470</span></a>                <span class="k">for</span> <span class="n">recipient_jid</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1471"><a href="#EventDrivenAgent-1471"><span class="linenos">1471</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">recipient_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1472"><a href="#EventDrivenAgent-1472"><span class="linenos">1472</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1473"><a href="#EventDrivenAgent-1473"><span class="linenos">1473</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arrival&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1474"><a href="#EventDrivenAgent-1474"><span class="linenos">1474</span></a>                    
</span><span id="EventDrivenAgent-1475"><a href="#EventDrivenAgent-1475"><span class="linenos">1475</span></a>                    <span class="c1"># Criar mensagem com lista de veculos</span>
</span><span id="EventDrivenAgent-1476"><a href="#EventDrivenAgent-1476"><span class="linenos">1476</span></a>                    <span class="n">event_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent-1477"><a href="#EventDrivenAgent-1477"><span class="linenos">1477</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1478"><a href="#EventDrivenAgent-1478"><span class="linenos">1478</span></a>                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">event_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1479"><a href="#EventDrivenAgent-1479"><span class="linenos">1479</span></a>                        <span class="s2">&quot;vehicles&quot;</span><span class="p">:</span> <span class="n">vehicle_names</span>  <span class="c1"># Lista de veculos</span>
</span><span id="EventDrivenAgent-1480"><a href="#EventDrivenAgent-1480"><span class="linenos">1480</span></a>                    <span class="p">}</span>
</span><span id="EventDrivenAgent-1481"><a href="#EventDrivenAgent-1481"><span class="linenos">1481</span></a>                    
</span><span id="EventDrivenAgent-1482"><a href="#EventDrivenAgent-1482"><span class="linenos">1482</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1483"><a href="#EventDrivenAgent-1483"><span class="linenos">1483</span></a>                    
</span><span id="EventDrivenAgent-1484"><a href="#EventDrivenAgent-1484"><span class="linenos">1484</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1485"><a href="#EventDrivenAgent-1485"><span class="linenos">1485</span></a>                    <span class="n">recipient_name</span> <span class="o">=</span> <span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent-1486"><a href="#EventDrivenAgent-1486"><span class="linenos">1486</span></a>                    
</span><span id="EventDrivenAgent-1487"><a href="#EventDrivenAgent-1487"><span class="linenos">1487</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1488"><a href="#EventDrivenAgent-1488"><span class="linenos">1488</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    </span><span class="si">{</span><span class="n">recipient_name</span><span class="si">}</span><span class="s2">: arrival (vehicles=</span><span class="si">{</span><span class="n">vehicle_names</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1489"><a href="#EventDrivenAgent-1489"><span class="linenos">1489</span></a>            
</span><span id="EventDrivenAgent-1490"><a href="#EventDrivenAgent-1490"><span class="linenos">1490</span></a>            <span class="c1"># Processar eventos de trnsito</span>
</span><span id="EventDrivenAgent-1491"><a href="#EventDrivenAgent-1491"><span class="linenos">1491</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transit_events</span><span class="p">):</span>
</span><span id="EventDrivenAgent-1492"><a href="#EventDrivenAgent-1492"><span class="linenos">1492</span></a>                <span class="n">recipients</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> 
</span><span id="EventDrivenAgent-1493"><a href="#EventDrivenAgent-1493"><span class="linenos">1493</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="EventDrivenAgent-1494"><a href="#EventDrivenAgent-1494"><span class="linenos">1494</span></a>                            <span class="p">)</span> <span class="c1"># TODO + self.agent.registered_warehouses + self.agent.registered_suppliers</span>
</span><span id="EventDrivenAgent-1495"><a href="#EventDrivenAgent-1495"><span class="linenos">1495</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1496"><a href="#EventDrivenAgent-1496"><span class="linenos">1496</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento TRANSIT para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">recipients</span><span class="p">)</span><span class="si">}</span><span class="s2"> agentes&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1497"><a href="#EventDrivenAgent-1497"><span class="linenos">1497</span></a>                
</span><span id="EventDrivenAgent-1498"><a href="#EventDrivenAgent-1498"><span class="linenos">1498</span></a>                <span class="k">for</span> <span class="n">recipient_jid</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1499"><a href="#EventDrivenAgent-1499"><span class="linenos">1499</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">recipient_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1500"><a href="#EventDrivenAgent-1500"><span class="linenos">1500</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1501"><a href="#EventDrivenAgent-1501"><span class="linenos">1501</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1502"><a href="#EventDrivenAgent-1502"><span class="linenos">1502</span></a>                    
</span><span id="EventDrivenAgent-1503"><a href="#EventDrivenAgent-1503"><span class="linenos">1503</span></a>                    <span class="n">event_dict</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="EventDrivenAgent-1504"><a href="#EventDrivenAgent-1504"><span class="linenos">1504</span></a>                    
</span><span id="EventDrivenAgent-1505"><a href="#EventDrivenAgent-1505"><span class="linenos">1505</span></a>                    <span class="c1"># Apenas o primeiro evento tem o tempo real</span>
</span><span id="EventDrivenAgent-1506"><a href="#EventDrivenAgent-1506"><span class="linenos">1506</span></a>                    <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1507"><a href="#EventDrivenAgent-1507"><span class="linenos">1507</span></a>                        <span class="n">original_time</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="EventDrivenAgent-1508"><a href="#EventDrivenAgent-1508"><span class="linenos">1508</span></a>                        <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="EventDrivenAgent-1509"><a href="#EventDrivenAgent-1509"><span class="linenos">1509</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1510"><a href="#EventDrivenAgent-1510"><span class="linenos">1510</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Ajustando tempo do evento Transit para 0 (original=</span><span class="si">{</span><span class="n">original_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s) para </span><span class="si">{</span><span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1511"><a href="#EventDrivenAgent-1511"><span class="linenos">1511</span></a>                    
</span><span id="EventDrivenAgent-1512"><a href="#EventDrivenAgent-1512"><span class="linenos">1512</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1513"><a href="#EventDrivenAgent-1513"><span class="linenos">1513</span></a>                    
</span><span id="EventDrivenAgent-1514"><a href="#EventDrivenAgent-1514"><span class="linenos">1514</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1515"><a href="#EventDrivenAgent-1515"><span class="linenos">1515</span></a>                    <span class="n">recipient_name</span> <span class="o">=</span> <span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent-1516"><a href="#EventDrivenAgent-1516"><span class="linenos">1516</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1517"><a href="#EventDrivenAgent-1517"><span class="linenos">1517</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    </span><span class="si">{</span><span class="n">recipient_name</span><span class="si">}</span><span class="s2">: Transit (time=</span><span class="si">{</span><span class="n">event_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1518"><a href="#EventDrivenAgent-1518"><span class="linenos">1518</span></a>            
</span><span id="EventDrivenAgent-1519"><a href="#EventDrivenAgent-1519"><span class="linenos">1519</span></a>            <span class="c1"># Processar outros eventos (updatesimulation, etc)</span>
</span><span id="EventDrivenAgent-1520"><a href="#EventDrivenAgent-1520"><span class="linenos">1520</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">other_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1521"><a href="#EventDrivenAgent-1521"><span class="linenos">1521</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;updatesimulation&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1522"><a href="#EventDrivenAgent-1522"><span class="linenos">1522</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1523"><a href="#EventDrivenAgent-1523"><span class="linenos">1523</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1524"><a href="#EventDrivenAgent-1524"><span class="linenos">1524</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Processando evento UPDATESIMULATION - Solicitando nova simulao&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1525"><a href="#EventDrivenAgent-1525"><span class="linenos">1525</span></a>                        
</span><span id="EventDrivenAgent-1526"><a href="#EventDrivenAgent-1526"><span class="linenos">1526</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1527"><a href="#EventDrivenAgent-1527"><span class="linenos">1527</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1528"><a href="#EventDrivenAgent-1528"><span class="linenos">1528</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1529"><a href="#EventDrivenAgent-1529"><span class="linenos">1529</span></a>                        
</span><span id="EventDrivenAgent-1530"><a href="#EventDrivenAgent-1530"><span class="linenos">1530</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent-1531"><a href="#EventDrivenAgent-1531"><span class="linenos">1531</span></a>                            <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent-1532"><a href="#EventDrivenAgent-1532"><span class="linenos">1532</span></a>                            <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1533"><a href="#EventDrivenAgent-1533"><span class="linenos">1533</span></a>                        <span class="p">}</span>
</span><span id="EventDrivenAgent-1534"><a href="#EventDrivenAgent-1534"><span class="linenos">1534</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1535"><a href="#EventDrivenAgent-1535"><span class="linenos">1535</span></a>                        
</span><span id="EventDrivenAgent-1536"><a href="#EventDrivenAgent-1536"><span class="linenos">1536</span></a>                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1537"><a href="#EventDrivenAgent-1537"><span class="linenos">1537</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    Pedido de re-simulao enviado ao world agent&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent-1538"><a href="#EventDrivenAgent-1538"><span class="linenos">1538</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent-1539"><a href="#EventDrivenAgent-1539"><span class="linenos">1539</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Agente do mundo no registrado, evento ignorado&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Event-driven agent managing temporal simulation with heap-based priority queue.</p>

<p>This agent serves as the core of the event management system for supply chain simulation.
It uses a min heap data structure to maintain events ordered by time and processes them
periodically at configurable intervals. The agent coordinates communications between
vehicles, warehouses, stores, suppliers, and the world agent, ensuring all participants
receive relevant event notifications.</p>

<p>The agent implements FIPA (Foundation for Intelligent Physical Agents) standards for
multi-agent communication, using XMPP as transport protocol and ACL performatives
for semantic message exchange.</p>

<h6 id="architecture">Architecture:</h6>

<blockquote>
  <ul>
  <li><strong>Min Heap</strong>: Stores general events ordered by time (O(log n) operations)</li>
  <li><strong>Transit Events List</strong>: Separate list for traffic change events with temporal decay</li>
  <li><strong>Arrival Events Buffer</strong>: Temporary buffer for vehicle arrival grouping</li>
  <li><strong>Behaviours</strong>: Set of asynchronous behaviours executing different functionalities:
  <ul>
  <li>ReceiveEventsBehaviour: Continuous message reception (CyclicBehaviour)</li>
  <li>ProcessEventsBehaviour: Periodic event processing (PeriodicBehaviour)</li>
  <li>SendInitialSignalBehaviour: Initial system activation (PeriodicBehaviour)</li>
  <li>RegisterTransitBehaviour: Initial traffic simulation request (OneShotBehaviour)</li>
  </ul></li>
  </ul>
</blockquote>

<h6 id="workflow">Workflow:</h6>

<blockquote>
  <ol>
  <li><strong>Initialization</strong>: Subscribe all registered agents and send initial signal</li>
  <li><strong>Continuous Reception</strong>: Cyclic behaviour receives events from all agents</li>
  <li><strong>Periodic Processing</strong>: At each interval, process events from heap</li>
  <li><strong>Notification</strong>: Distribute processed events to appropriate agents</li>
  <li><strong>Resimulation</strong>: Request new traffic simulation when needed</li>
  </ol>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>event_heap (List[Event]):</strong>  Min heap of general events ordered by time.</li>
<li><strong>transit_events (List[Event]):</strong>  Separate list for active traffic events with time decay.</li>
<li><strong>arrival_events (List[Event]):</strong>  Temporary buffer for vehicle arrival events.</li>
<li><strong>simulation_interval (float):</strong>  Interval in seconds between processing cycles.</li>
<li><strong>registered_vehicles (List[str]):</strong>  JIDs of vehicles registered in the system.</li>
<li><strong>registered_warehouses (List[str]):</strong>  JIDs of registered warehouses.</li>
<li><strong>registered_stores (List[str]):</strong>  JIDs of registered stores.</li>
<li><strong>registered_suppliers (List[str]):</strong>  JIDs of registered suppliers.</li>
<li><strong>world_agent (str):</strong>  JID of the world agent for traffic simulation.</li>
<li><strong>world_simulation_time (float):</strong>  Duration in seconds of each traffic simulation.</li>
<li><strong>event_count (int):</strong>  Total counter of events received.</li>
<li><strong>processed_count (int):</strong>  Total counter of events processed.</li>
<li><strong>last_simulation_time (float):</strong>  Timestamp of last processed simulation.</li>
<li><strong>time_simulated (float):</strong>  Total accumulated simulation time.</li>
<li><strong>verbose (bool):</strong>  Flag to enable detailed logging.</li>
<li><strong>first_arrival_received (bool):</strong>  Flag indicating if first arrival has been received.</li>
<li><strong>initial_signal_behaviour (PeriodicBehaviour):</strong>  Reference to initial signal behaviour.</li>
</ul>

<h6 id="behaviours">Behaviours:</h6>

<blockquote>
  <p>SendInitialSignalBehaviour: Sends initial signal to vehicles (PeriodicBehaviour).
  RegisterTransitBehaviour: Requests initial traffic simulation (OneShotBehaviour).
  ReceiveEventsBehaviour: Receives events continuously (CyclicBehaviour).
  ProcessEventsBehaviour: Processes events periodically (PeriodicBehaviour).</p>
</blockquote>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create event agent with basic configuration</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">event_agent</span> <span class="o">=</span> <span class="n">EventDrivenAgent</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;event_agent@localhost&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password123&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">simulation_interval</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">registered_vehicles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;vehicle1@localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;vehicle2@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_warehouses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;warehouse1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_stores</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;store1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_suppliers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;supplier1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">world_agent</span><span class="o">=</span><span class="s2">&quot;world@localhost&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">world_simulation_time</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Start the agent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">await</span> <span class="n">event_agent</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The agent will:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 1. Subscribe all registered agents</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 2. Send initial signal to vehicles</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 3. Request traffic simulation from world agent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># 4. Receive and process events continuously</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The agent uses a hybrid processing strategy:</p>
  
  <ul>
  <li>Transit events are kept separate with time decremented each cycle</li>
  <li>Arrival events are grouped before processing for efficiency</li>
  <li>General events are processed in strict temporal order</li>
  </ul>
  
  <p>Only events with the same time as the first event in heap are processed
  in each cycle, ensuring correct temporal synchronization.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <ul>
  <li>Uses FIPA ACL performatives in message metadata ("inform", "request")</li>
  <li>Follows FIPA interaction protocols for agent coordination</li>
  <li>Implements presence-based subscription for agent discovery (XMPP)</li>
  <li>Content is encoded as JSON for interoperability</li>
  <li>Sender and receiver identification through JIDs (Jabber IDs)</li>
  </ul>
</blockquote>

<h6 id="warning">Warning:</h6>

<blockquote>
  <p>The agent requires a running XMPP server before initialization.
  All registered JIDs must exist and be accessible for communication.</p>
</blockquote>
</div>


                            <div id="EventDrivenAgent.__init__" class="classattr">
                                        <input id="EventDrivenAgent.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EventDrivenAgent</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">jid</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">password</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">simulation_interval</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">registered_vehicles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">registered_warehouses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">registered_stores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">registered_suppliers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">world_agent</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">world_simulation_time</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span></span>)</span>

                <label class="view-source-button" for="EventDrivenAgent.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.__init__-495"><a href="#EventDrivenAgent.__init__-495"><span class="linenos">495</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">simulation_interval</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">registered_vehicles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="EventDrivenAgent.__init__-496"><a href="#EventDrivenAgent.__init__-496"><span class="linenos">496</span></a>                 <span class="n">registered_warehouses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">registered_stores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="p">,</span><span class="n">registered_suppliers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="EventDrivenAgent.__init__-497"><a href="#EventDrivenAgent.__init__-497"><span class="linenos">497</span></a>                 <span class="n">world_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">world_simulation_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="EventDrivenAgent.__init__-498"><a href="#EventDrivenAgent.__init__-498"><span class="linenos">498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize EventDrivenAgent with simulation settings and registered agents.</span>
</span><span id="EventDrivenAgent.__init__-499"><a href="#EventDrivenAgent.__init__-499"><span class="linenos">499</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.__init__-500"><a href="#EventDrivenAgent.__init__-500"><span class="linenos">500</span></a><span class="sd">        Creates an event-driven agent instance configured for supply chain simulation</span>
</span><span id="EventDrivenAgent.__init__-501"><a href="#EventDrivenAgent.__init__-501"><span class="linenos">501</span></a><span class="sd">        with specified processing interval and registered agent participants. This</span>
</span><span id="EventDrivenAgent.__init__-502"><a href="#EventDrivenAgent.__init__-502"><span class="linenos">502</span></a><span class="sd">        constructor initializes all data structures but does not start behaviours or</span>
</span><span id="EventDrivenAgent.__init__-503"><a href="#EventDrivenAgent.__init__-503"><span class="linenos">503</span></a><span class="sd">        subscribe agents - those actions occur in the setup() method.</span>
</span><span id="EventDrivenAgent.__init__-504"><a href="#EventDrivenAgent.__init__-504"><span class="linenos">504</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.__init__-505"><a href="#EventDrivenAgent.__init__-505"><span class="linenos">505</span></a><span class="sd">        Args:</span>
</span><span id="EventDrivenAgent.__init__-506"><a href="#EventDrivenAgent.__init__-506"><span class="linenos">506</span></a><span class="sd">            jid (str): Complete Jabber ID of the agent (format: &quot;name@server&quot;).</span>
</span><span id="EventDrivenAgent.__init__-507"><a href="#EventDrivenAgent.__init__-507"><span class="linenos">507</span></a><span class="sd">                Must be registered on the XMPP server before use.</span>
</span><span id="EventDrivenAgent.__init__-508"><a href="#EventDrivenAgent.__init__-508"><span class="linenos">508</span></a><span class="sd">            password (str): Password for XMPP server authentication.</span>
</span><span id="EventDrivenAgent.__init__-509"><a href="#EventDrivenAgent.__init__-509"><span class="linenos">509</span></a><span class="sd">            simulation_interval (float): Interval in seconds between event processing</span>
</span><span id="EventDrivenAgent.__init__-510"><a href="#EventDrivenAgent.__init__-510"><span class="linenos">510</span></a><span class="sd">                cycles. Typical values: 1.0 to 10.0 seconds. Determines temporal</span>
</span><span id="EventDrivenAgent.__init__-511"><a href="#EventDrivenAgent.__init__-511"><span class="linenos">511</span></a><span class="sd">                granularity of the simulation.</span>
</span><span id="EventDrivenAgent.__init__-512"><a href="#EventDrivenAgent.__init__-512"><span class="linenos">512</span></a><span class="sd">            registered_vehicles (List[str]): List of vehicle JIDs participating in</span>
</span><span id="EventDrivenAgent.__init__-513"><a href="#EventDrivenAgent.__init__-513"><span class="linenos">513</span></a><span class="sd">                simulation. These agents will receive event notifications and</span>
</span><span id="EventDrivenAgent.__init__-514"><a href="#EventDrivenAgent.__init__-514"><span class="linenos">514</span></a><span class="sd">                traffic updates.</span>
</span><span id="EventDrivenAgent.__init__-515"><a href="#EventDrivenAgent.__init__-515"><span class="linenos">515</span></a><span class="sd">            registered_warehouses (List[str]): List of registered warehouse JIDs.</span>
</span><span id="EventDrivenAgent.__init__-516"><a href="#EventDrivenAgent.__init__-516"><span class="linenos">516</span></a><span class="sd">                Warehouses receive transit events for route optimization.</span>
</span><span id="EventDrivenAgent.__init__-517"><a href="#EventDrivenAgent.__init__-517"><span class="linenos">517</span></a><span class="sd">            registered_stores (List[str]): List of registered store JIDs.</span>
</span><span id="EventDrivenAgent.__init__-518"><a href="#EventDrivenAgent.__init__-518"><span class="linenos">518</span></a><span class="sd">                Stores receive traffic updates for delivery planning.</span>
</span><span id="EventDrivenAgent.__init__-519"><a href="#EventDrivenAgent.__init__-519"><span class="linenos">519</span></a><span class="sd">            registered_suppliers (List[str]): List of registered supplier JIDs.</span>
</span><span id="EventDrivenAgent.__init__-520"><a href="#EventDrivenAgent.__init__-520"><span class="linenos">520</span></a><span class="sd">                Suppliers receive event notifications for supply coordination.</span>
</span><span id="EventDrivenAgent.__init__-521"><a href="#EventDrivenAgent.__init__-521"><span class="linenos">521</span></a><span class="sd">            world_agent (str): JID of the world agent responsible for traffic simulation.</span>
</span><span id="EventDrivenAgent.__init__-522"><a href="#EventDrivenAgent.__init__-522"><span class="linenos">522</span></a><span class="sd">                If None, traffic simulation features are disabled.</span>
</span><span id="EventDrivenAgent.__init__-523"><a href="#EventDrivenAgent.__init__-523"><span class="linenos">523</span></a><span class="sd">            world_simulation_time (float): Duration in seconds of each traffic simulation</span>
</span><span id="EventDrivenAgent.__init__-524"><a href="#EventDrivenAgent.__init__-524"><span class="linenos">524</span></a><span class="sd">                requested from world agent. Determines temporal forecasting horizon.</span>
</span><span id="EventDrivenAgent.__init__-525"><a href="#EventDrivenAgent.__init__-525"><span class="linenos">525</span></a><span class="sd">            verbose (bool): If True, enable detailed logs for debugging and monitoring.</span>
</span><span id="EventDrivenAgent.__init__-526"><a href="#EventDrivenAgent.__init__-526"><span class="linenos">526</span></a><span class="sd">                If False, only essential messages are displayed.</span>
</span><span id="EventDrivenAgent.__init__-527"><a href="#EventDrivenAgent.__init__-527"><span class="linenos">527</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.__init__-528"><a href="#EventDrivenAgent.__init__-528"><span class="linenos">528</span></a><span class="sd">        Examples:</span>
</span><span id="EventDrivenAgent.__init__-529"><a href="#EventDrivenAgent.__init__-529"><span class="linenos">529</span></a><span class="sd">            &gt;&gt;&gt; # Small simulation configuration with 2 vehicles</span>
</span><span id="EventDrivenAgent.__init__-530"><a href="#EventDrivenAgent.__init__-530"><span class="linenos">530</span></a><span class="sd">            &gt;&gt;&gt; agent = EventDrivenAgent(</span>
</span><span id="EventDrivenAgent.__init__-531"><a href="#EventDrivenAgent.__init__-531"><span class="linenos">531</span></a><span class="sd">            ...     jid=&quot;events@localhost&quot;,</span>
</span><span id="EventDrivenAgent.__init__-532"><a href="#EventDrivenAgent.__init__-532"><span class="linenos">532</span></a><span class="sd">            ...     password=&quot;pass123&quot;,</span>
</span><span id="EventDrivenAgent.__init__-533"><a href="#EventDrivenAgent.__init__-533"><span class="linenos">533</span></a><span class="sd">            ...     simulation_interval=5.0,</span>
</span><span id="EventDrivenAgent.__init__-534"><a href="#EventDrivenAgent.__init__-534"><span class="linenos">534</span></a><span class="sd">            ...     registered_vehicles=[&quot;v1@localhost&quot;, &quot;v2@localhost&quot;],</span>
</span><span id="EventDrivenAgent.__init__-535"><a href="#EventDrivenAgent.__init__-535"><span class="linenos">535</span></a><span class="sd">            ...     registered_warehouses=[&quot;w1@localhost&quot;],</span>
</span><span id="EventDrivenAgent.__init__-536"><a href="#EventDrivenAgent.__init__-536"><span class="linenos">536</span></a><span class="sd">            ...     registered_stores=[&quot;s1@localhost&quot;, &quot;s2@localhost&quot;],</span>
</span><span id="EventDrivenAgent.__init__-537"><a href="#EventDrivenAgent.__init__-537"><span class="linenos">537</span></a><span class="sd">            ...     registered_suppliers=[&quot;sup1@localhost&quot;],</span>
</span><span id="EventDrivenAgent.__init__-538"><a href="#EventDrivenAgent.__init__-538"><span class="linenos">538</span></a><span class="sd">            ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="EventDrivenAgent.__init__-539"><a href="#EventDrivenAgent.__init__-539"><span class="linenos">539</span></a><span class="sd">            ...     world_simulation_time=15.0,</span>
</span><span id="EventDrivenAgent.__init__-540"><a href="#EventDrivenAgent.__init__-540"><span class="linenos">540</span></a><span class="sd">            ...     verbose=False</span>
</span><span id="EventDrivenAgent.__init__-541"><a href="#EventDrivenAgent.__init__-541"><span class="linenos">541</span></a><span class="sd">            ... )</span>
</span><span id="EventDrivenAgent.__init__-542"><a href="#EventDrivenAgent.__init__-542"><span class="linenos">542</span></a><span class="sd">            &gt;&gt;&gt; </span>
</span><span id="EventDrivenAgent.__init__-543"><a href="#EventDrivenAgent.__init__-543"><span class="linenos">543</span></a><span class="sd">            &gt;&gt;&gt; # Large simulation configuration with detailed logging</span>
</span><span id="EventDrivenAgent.__init__-544"><a href="#EventDrivenAgent.__init__-544"><span class="linenos">544</span></a><span class="sd">            &gt;&gt;&gt; agent_verbose = EventDrivenAgent(</span>
</span><span id="EventDrivenAgent.__init__-545"><a href="#EventDrivenAgent.__init__-545"><span class="linenos">545</span></a><span class="sd">            ...     jid=&quot;events@localhost&quot;,</span>
</span><span id="EventDrivenAgent.__init__-546"><a href="#EventDrivenAgent.__init__-546"><span class="linenos">546</span></a><span class="sd">            ...     password=&quot;pass123&quot;,</span>
</span><span id="EventDrivenAgent.__init__-547"><a href="#EventDrivenAgent.__init__-547"><span class="linenos">547</span></a><span class="sd">            ...     simulation_interval=2.0,</span>
</span><span id="EventDrivenAgent.__init__-548"><a href="#EventDrivenAgent.__init__-548"><span class="linenos">548</span></a><span class="sd">            ...     registered_vehicles=[f&quot;vehicle{i}@localhost&quot; for i in range(10)],</span>
</span><span id="EventDrivenAgent.__init__-549"><a href="#EventDrivenAgent.__init__-549"><span class="linenos">549</span></a><span class="sd">            ...     registered_warehouses=[f&quot;warehouse{i}@localhost&quot; for i in range(5)],</span>
</span><span id="EventDrivenAgent.__init__-550"><a href="#EventDrivenAgent.__init__-550"><span class="linenos">550</span></a><span class="sd">            ...     registered_stores=[f&quot;store{i}@localhost&quot; for i in range(20)],</span>
</span><span id="EventDrivenAgent.__init__-551"><a href="#EventDrivenAgent.__init__-551"><span class="linenos">551</span></a><span class="sd">            ...     registered_suppliers=[f&quot;supplier{i}@localhost&quot; for i in range(3)],</span>
</span><span id="EventDrivenAgent.__init__-552"><a href="#EventDrivenAgent.__init__-552"><span class="linenos">552</span></a><span class="sd">            ...     world_agent=&quot;world@localhost&quot;,</span>
</span><span id="EventDrivenAgent.__init__-553"><a href="#EventDrivenAgent.__init__-553"><span class="linenos">553</span></a><span class="sd">            ...     world_simulation_time=30.0,</span>
</span><span id="EventDrivenAgent.__init__-554"><a href="#EventDrivenAgent.__init__-554"><span class="linenos">554</span></a><span class="sd">            ...     verbose=True</span>
</span><span id="EventDrivenAgent.__init__-555"><a href="#EventDrivenAgent.__init__-555"><span class="linenos">555</span></a><span class="sd">            ... )</span>
</span><span id="EventDrivenAgent.__init__-556"><a href="#EventDrivenAgent.__init__-556"><span class="linenos">556</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.__init__-557"><a href="#EventDrivenAgent.__init__-557"><span class="linenos">557</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent.__init__-558"><a href="#EventDrivenAgent.__init__-558"><span class="linenos">558</span></a><span class="sd">            The constructor only initializes data structures. Agent subscription</span>
</span><span id="EventDrivenAgent.__init__-559"><a href="#EventDrivenAgent.__init__-559"><span class="linenos">559</span></a><span class="sd">            and behaviour initialization occur in the setup() method, which is</span>
</span><span id="EventDrivenAgent.__init__-560"><a href="#EventDrivenAgent.__init__-560"><span class="linenos">560</span></a><span class="sd">            called automatically by SPADE framework when start() is invoked.</span>
</span><span id="EventDrivenAgent.__init__-561"><a href="#EventDrivenAgent.__init__-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.__init__-562"><a href="#EventDrivenAgent.__init__-562"><span class="linenos">562</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">jid</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span><span id="EventDrivenAgent.__init__-563"><a href="#EventDrivenAgent.__init__-563"><span class="linenos">563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_heap</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Min heap of events (non-transit)</span>
</span><span id="EventDrivenAgent.__init__-564"><a href="#EventDrivenAgent.__init__-564"><span class="linenos">564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transit_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Separate list for transit events</span>
</span><span id="EventDrivenAgent.__init__-565"><a href="#EventDrivenAgent.__init__-565"><span class="linenos">565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Separate list for arrival events</span>
</span><span id="EventDrivenAgent.__init__-566"><a href="#EventDrivenAgent.__init__-566"><span class="linenos">566</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span> <span class="o">=</span> <span class="n">simulation_interval</span>  <span class="c1"># Simulation interval (e.g., 5s)</span>
</span><span id="EventDrivenAgent.__init__-567"><a href="#EventDrivenAgent.__init__-567"><span class="linenos">567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">=</span> <span class="n">registered_vehicles</span>  <span class="c1"># Registered vehicles</span>
</span><span id="EventDrivenAgent.__init__-568"><a href="#EventDrivenAgent.__init__-568"><span class="linenos">568</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_warehouses</span> <span class="o">=</span> <span class="n">registered_warehouses</span>  <span class="c1"># Registered warehouses</span>
</span><span id="EventDrivenAgent.__init__-569"><a href="#EventDrivenAgent.__init__-569"><span class="linenos">569</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_stores</span> <span class="o">=</span> <span class="n">registered_stores</span>  <span class="c1"># Registered stores</span>
</span><span id="EventDrivenAgent.__init__-570"><a href="#EventDrivenAgent.__init__-570"><span class="linenos">570</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">registered_suppliers</span> <span class="o">=</span> <span class="n">registered_suppliers</span>  <span class="c1"># Registered suppliers</span>
</span><span id="EventDrivenAgent.__init__-571"><a href="#EventDrivenAgent.__init__-571"><span class="linenos">571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span> <span class="o">=</span> <span class="n">world_agent</span>  <span class="c1"># World agent JID</span>
</span><span id="EventDrivenAgent.__init__-572"><a href="#EventDrivenAgent.__init__-572"><span class="linenos">572</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">world_simulation_time</span> <span class="o">=</span> <span class="n">world_simulation_time</span>  <span class="c1"># World simulation duration</span>
</span><span id="EventDrivenAgent.__init__-573"><a href="#EventDrivenAgent.__init__-573"><span class="linenos">573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">event_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Counter of events received</span>
</span><span id="EventDrivenAgent.__init__-574"><a href="#EventDrivenAgent.__init__-574"><span class="linenos">574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Counter of events processed</span>
</span><span id="EventDrivenAgent.__init__-575"><a href="#EventDrivenAgent.__init__-575"><span class="linenos">575</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">last_simulation_time</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Last simulation timestamp</span>
</span><span id="EventDrivenAgent.__init__-576"><a href="#EventDrivenAgent.__init__-576"><span class="linenos">576</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">time_simulated</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Total simulated time</span>
</span><span id="EventDrivenAgent.__init__-577"><a href="#EventDrivenAgent.__init__-577"><span class="linenos">577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>  <span class="c1"># Verbose mode flag</span>
</span><span id="EventDrivenAgent.__init__-578"><a href="#EventDrivenAgent.__init__-578"><span class="linenos">578</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">first_arrival_received</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag for first arrival received</span>
</span><span id="EventDrivenAgent.__init__-579"><a href="#EventDrivenAgent.__init__-579"><span class="linenos">579</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Reference to initial signal behaviour</span>
</span></pre></div>


            <div class="docstring"><p>Initialize EventDrivenAgent with simulation settings and registered agents.</p>

<p>Creates an event-driven agent instance configured for supply chain simulation
with specified processing interval and registered agent participants. This
constructor initializes all data structures but does not start behaviours or
subscribe agents - those actions occur in the setup() method.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>jid (str):</strong>  Complete Jabber ID of the agent (format: "name@server").
Must be registered on the XMPP server before use.</li>
<li><strong>password (str):</strong>  Password for XMPP server authentication.</li>
<li><strong>simulation_interval (float):</strong>  Interval in seconds between event processing
cycles. Typical values: 1.0 to 10.0 seconds. Determines temporal
granularity of the simulation.</li>
<li><strong>registered_vehicles (List[str]):</strong>  List of vehicle JIDs participating in
simulation. These agents will receive event notifications and
traffic updates.</li>
<li><strong>registered_warehouses (List[str]):</strong>  List of registered warehouse JIDs.
Warehouses receive transit events for route optimization.</li>
<li><strong>registered_stores (List[str]):</strong>  List of registered store JIDs.
Stores receive traffic updates for delivery planning.</li>
<li><strong>registered_suppliers (List[str]):</strong>  List of registered supplier JIDs.
Suppliers receive event notifications for supply coordination.</li>
<li><strong>world_agent (str):</strong>  JID of the world agent responsible for traffic simulation.
If None, traffic simulation features are disabled.</li>
<li><strong>world_simulation_time (float):</strong>  Duration in seconds of each traffic simulation
requested from world agent. Determines temporal forecasting horizon.</li>
<li><strong>verbose (bool):</strong>  If True, enable detailed logs for debugging and monitoring.
If False, only essential messages are displayed.</li>
</ul>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Small simulation configuration with 2 vehicles</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">EventDrivenAgent</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;events@localhost&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;pass123&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">simulation_interval</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">registered_vehicles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;v1@localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;v2@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_warehouses</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;w1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_stores</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;s1@localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;s2@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">registered_suppliers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sup1@localhost&quot;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">world_agent</span><span class="o">=</span><span class="s2">&quot;world@localhost&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">world_simulation_time</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Large simulation configuration with detailed logging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent_verbose</span> <span class="o">=</span> <span class="n">EventDrivenAgent</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">jid</span><span class="o">=</span><span class="s2">&quot;events@localhost&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">password</span><span class="o">=</span><span class="s2">&quot;pass123&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">simulation_interval</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">registered_vehicles</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;vehicle</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">@localhost&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">registered_warehouses</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;warehouse</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">@localhost&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">registered_stores</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;store</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">@localhost&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">registered_suppliers</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;supplier</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">@localhost&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">world_agent</span><span class="o">=</span><span class="s2">&quot;world@localhost&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">world_simulation_time</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The constructor only initializes data structures. Agent subscription
  and behaviour initialization occur in the setup() method, which is
  called automatically by SPADE framework when start() is invoked.</p>
</blockquote>
</div>


                            </div>
                            <div id="EventDrivenAgent.event_heap" class="classattr">
                                <div class="attr variable">
            <span class="name">event_heap</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.event_heap"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.transit_events" class="classattr">
                                <div class="attr variable">
            <span class="name">transit_events</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.transit_events"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.arrival_events" class="classattr">
                                <div class="attr variable">
            <span class="name">arrival_events</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.arrival_events"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.simulation_interval" class="classattr">
                                <div class="attr variable">
            <span class="name">simulation_interval</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.simulation_interval"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.registered_vehicles" class="classattr">
                                <div class="attr variable">
            <span class="name">registered_vehicles</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.registered_vehicles"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.registered_warehouses" class="classattr">
                                <div class="attr variable">
            <span class="name">registered_warehouses</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.registered_warehouses"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.registered_stores" class="classattr">
                                <div class="attr variable">
            <span class="name">registered_stores</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.registered_stores"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.registered_suppliers" class="classattr">
                                <div class="attr variable">
            <span class="name">registered_suppliers</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.registered_suppliers"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.world_agent" class="classattr">
                                <div class="attr variable">
            <span class="name">world_agent</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.world_agent"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.world_simulation_time" class="classattr">
                                <div class="attr variable">
            <span class="name">world_simulation_time</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.world_simulation_time"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.event_count" class="classattr">
                                <div class="attr variable">
            <span class="name">event_count</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.event_count"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.processed_count" class="classattr">
                                <div class="attr variable">
            <span class="name">processed_count</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.processed_count"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.last_simulation_time" class="classattr">
                                <div class="attr variable">
            <span class="name">last_simulation_time</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.last_simulation_time"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.time_simulated" class="classattr">
                                <div class="attr variable">
            <span class="name">time_simulated</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.time_simulated"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.verbose" class="classattr">
                                <div class="attr variable">
            <span class="name">verbose</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.verbose"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.first_arrival_received" class="classattr">
                                <div class="attr variable">
            <span class="name">first_arrival_received</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.first_arrival_received"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.initial_signal_behaviour" class="classattr">
                                <div class="attr variable">
            <span class="name">initial_signal_behaviour</span>

        
    </div>
    <a class="headerlink" href="#EventDrivenAgent.initial_signal_behaviour"></a>
    
    

                            </div>
                            <div id="EventDrivenAgent.setup" class="classattr">
                                        <input id="EventDrivenAgent.setup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">setup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EventDrivenAgent.setup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.setup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.setup-580"><a href="#EventDrivenAgent.setup-580"><span class="linenos">580</span></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.setup-581"><a href="#EventDrivenAgent.setup-581"><span class="linenos">581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure and initialize all behaviours and agent subscriptions.</span>
</span><span id="EventDrivenAgent.setup-582"><a href="#EventDrivenAgent.setup-582"><span class="linenos">582</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.setup-583"><a href="#EventDrivenAgent.setup-583"><span class="linenos">583</span></a><span class="sd">        This method is called automatically by the SPADE framework when the agent</span>
</span><span id="EventDrivenAgent.setup-584"><a href="#EventDrivenAgent.setup-584"><span class="linenos">584</span></a><span class="sd">        is started. It configures XMPP presence, subscribes all registered agents,</span>
</span><span id="EventDrivenAgent.setup-585"><a href="#EventDrivenAgent.setup-585"><span class="linenos">585</span></a><span class="sd">        and adds the necessary behaviours for system operation.</span>
</span><span id="EventDrivenAgent.setup-586"><a href="#EventDrivenAgent.setup-586"><span class="linenos">586</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.setup-587"><a href="#EventDrivenAgent.setup-587"><span class="linenos">587</span></a><span class="sd">        Initialization Sequence:</span>
</span><span id="EventDrivenAgent.setup-588"><a href="#EventDrivenAgent.setup-588"><span class="linenos">588</span></a><span class="sd">            1. Set presence as available (AVAILABLE/CHAT) following XMPP protocol</span>
</span><span id="EventDrivenAgent.setup-589"><a href="#EventDrivenAgent.setup-589"><span class="linenos">589</span></a><span class="sd">            2. Automatically approve all subscription requests (trust model)</span>
</span><span id="EventDrivenAgent.setup-590"><a href="#EventDrivenAgent.setup-590"><span class="linenos">590</span></a><span class="sd">            3. Subscribe vehicles, warehouses, stores, suppliers, and world agent</span>
</span><span id="EventDrivenAgent.setup-591"><a href="#EventDrivenAgent.setup-591"><span class="linenos">591</span></a><span class="sd">            4. Add ReceiveEventsBehaviour for continuous message reception</span>
</span><span id="EventDrivenAgent.setup-592"><a href="#EventDrivenAgent.setup-592"><span class="linenos">592</span></a><span class="sd">            5. Add SendInitialSignalBehaviour (periodic until first arrival)</span>
</span><span id="EventDrivenAgent.setup-593"><a href="#EventDrivenAgent.setup-593"><span class="linenos">593</span></a><span class="sd">            6. Add RegisterTransitBehaviour to request initial traffic simulation</span>
</span><span id="EventDrivenAgent.setup-594"><a href="#EventDrivenAgent.setup-594"><span class="linenos">594</span></a><span class="sd">            7. Add ProcessEventsBehaviour for periodic event processing</span>
</span><span id="EventDrivenAgent.setup-595"><a href="#EventDrivenAgent.setup-595"><span class="linenos">595</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.setup-596"><a href="#EventDrivenAgent.setup-596"><span class="linenos">596</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent.setup-597"><a href="#EventDrivenAgent.setup-597"><span class="linenos">597</span></a><span class="sd">            Uses XMPP presence mechanism for agent discovery and availability,</span>
</span><span id="EventDrivenAgent.setup-598"><a href="#EventDrivenAgent.setup-598"><span class="linenos">598</span></a><span class="sd">            which aligns with FIPA&#39;s agent management specifications.</span>
</span><span id="EventDrivenAgent.setup-599"><a href="#EventDrivenAgent.setup-599"><span class="linenos">599</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.setup-600"><a href="#EventDrivenAgent.setup-600"><span class="linenos">600</span></a><span class="sd">        Raises:</span>
</span><span id="EventDrivenAgent.setup-601"><a href="#EventDrivenAgent.setup-601"><span class="linenos">601</span></a><span class="sd">            SPADEException: If there are problems with XMPP connection or subscription.</span>
</span><span id="EventDrivenAgent.setup-602"><a href="#EventDrivenAgent.setup-602"><span class="linenos">602</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.setup-603"><a href="#EventDrivenAgent.setup-603"><span class="linenos">603</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent.setup-604"><a href="#EventDrivenAgent.setup-604"><span class="linenos">604</span></a><span class="sd">            The order of behaviour addition is important. The initial signal and</span>
</span><span id="EventDrivenAgent.setup-605"><a href="#EventDrivenAgent.setup-605"><span class="linenos">605</span></a><span class="sd">            traffic simulation request should execute before processing begins.</span>
</span><span id="EventDrivenAgent.setup-606"><a href="#EventDrivenAgent.setup-606"><span class="linenos">606</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.setup-607"><a href="#EventDrivenAgent.setup-607"><span class="linenos">607</span></a><span class="sd">            The agent sets presence.approve_all = True to automatically accept</span>
</span><span id="EventDrivenAgent.setup-608"><a href="#EventDrivenAgent.setup-608"><span class="linenos">608</span></a><span class="sd">            all subscription requests, implementing a trust-based agent society.</span>
</span><span id="EventDrivenAgent.setup-609"><a href="#EventDrivenAgent.setup-609"><span class="linenos">609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.setup-610"><a href="#EventDrivenAgent.setup-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.setup-611"><a href="#EventDrivenAgent.setup-611"><span class="linenos">611</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-612"><a href="#EventDrivenAgent.setup-612"><span class="linenos">612</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Event-Driven Agent started&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-613"><a href="#EventDrivenAgent.setup-613"><span class="linenos">613</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Simulation interval: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-614"><a href="#EventDrivenAgent.setup-614"><span class="linenos">614</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] World simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-615"><a href="#EventDrivenAgent.setup-615"><span class="linenos">615</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-616"><a href="#EventDrivenAgent.setup-616"><span class="linenos">616</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.setup-617"><a href="#EventDrivenAgent.setup-617"><span class="linenos">617</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Event-Driven Agent started&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-618"><a href="#EventDrivenAgent.setup-618"><span class="linenos">618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">approve_all</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EventDrivenAgent.setup-619"><a href="#EventDrivenAgent.setup-619"><span class="linenos">619</span></a>        
</span><span id="EventDrivenAgent.setup-620"><a href="#EventDrivenAgent.setup-620"><span class="linenos">620</span></a>        <span class="c1"># Subscribe each agent individually</span>
</span><span id="EventDrivenAgent.setup-621"><a href="#EventDrivenAgent.setup-621"><span class="linenos">621</span></a>        <span class="n">all_agents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_warehouses</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="EventDrivenAgent.setup-622"><a href="#EventDrivenAgent.setup-622"><span class="linenos">622</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="EventDrivenAgent.setup-623"><a href="#EventDrivenAgent.setup-623"><span class="linenos">623</span></a>            <span class="n">all_agents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-624"><a href="#EventDrivenAgent.setup-624"><span class="linenos">624</span></a>        
</span><span id="EventDrivenAgent.setup-625"><a href="#EventDrivenAgent.setup-625"><span class="linenos">625</span></a>        <span class="k">for</span> <span class="n">agent_jid</span> <span class="ow">in</span> <span class="n">all_agents</span><span class="p">:</span>
</span><span id="EventDrivenAgent.setup-626"><a href="#EventDrivenAgent.setup-626"><span class="linenos">626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">agent_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-627"><a href="#EventDrivenAgent.setup-627"><span class="linenos">627</span></a>        
</span><span id="EventDrivenAgent.setup-628"><a href="#EventDrivenAgent.setup-628"><span class="linenos">628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">presence</span><span class="o">.</span><span class="n">set_presence</span><span class="p">(</span><span class="n">PresenceType</span><span class="o">.</span><span class="n">AVAILABLE</span><span class="p">,</span> <span class="n">PresenceShow</span><span class="o">.</span><span class="n">CHAT</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-629"><a href="#EventDrivenAgent.setup-629"><span class="linenos">629</span></a>        
</span><span id="EventDrivenAgent.setup-630"><a href="#EventDrivenAgent.setup-630"><span class="linenos">630</span></a>        <span class="c1"># Behaviour to continuously receive events (must be active from the start)</span>
</span><span id="EventDrivenAgent.setup-631"><a href="#EventDrivenAgent.setup-631"><span class="linenos">631</span></a>        <span class="n">receive_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveEventsBehaviour</span><span class="p">()</span>
</span><span id="EventDrivenAgent.setup-632"><a href="#EventDrivenAgent.setup-632"><span class="linenos">632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">receive_behaviour</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-633"><a href="#EventDrivenAgent.setup-633"><span class="linenos">633</span></a>        
</span><span id="EventDrivenAgent.setup-634"><a href="#EventDrivenAgent.setup-634"><span class="linenos">634</span></a>        <span class="c1"># Behaviour to send initial signal periodically (until first arrival received)</span>
</span><span id="EventDrivenAgent.setup-635"><a href="#EventDrivenAgent.setup-635"><span class="linenos">635</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendInitialSignalBehaviour</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># Send every 10s</span>
</span><span id="EventDrivenAgent.setup-636"><a href="#EventDrivenAgent.setup-636"><span class="linenos">636</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_signal_behaviour</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-637"><a href="#EventDrivenAgent.setup-637"><span class="linenos">637</span></a>        
</span><span id="EventDrivenAgent.setup-638"><a href="#EventDrivenAgent.setup-638"><span class="linenos">638</span></a>        <span class="c1"># Behaviour to register transit (request initial traffic simulation)</span>
</span><span id="EventDrivenAgent.setup-639"><a href="#EventDrivenAgent.setup-639"><span class="linenos">639</span></a>        <span class="n">transit_registration_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RegisterTransitBehaviour</span><span class="p">()</span>
</span><span id="EventDrivenAgent.setup-640"><a href="#EventDrivenAgent.setup-640"><span class="linenos">640</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">transit_registration_behaviour</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-641"><a href="#EventDrivenAgent.setup-641"><span class="linenos">641</span></a>        
</span><span id="EventDrivenAgent.setup-642"><a href="#EventDrivenAgent.setup-642"><span class="linenos">642</span></a>        <span class="c1"># Periodic behaviour to process events (every X seconds)</span>
</span><span id="EventDrivenAgent.setup-643"><a href="#EventDrivenAgent.setup-643"><span class="linenos">643</span></a>        <span class="c1"># Will start only after receiving first arrival</span>
</span><span id="EventDrivenAgent.setup-644"><a href="#EventDrivenAgent.setup-644"><span class="linenos">644</span></a>        <span class="n">process_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessEventsBehaviour</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">simulation_interval</span><span class="p">)</span>
</span><span id="EventDrivenAgent.setup-645"><a href="#EventDrivenAgent.setup-645"><span class="linenos">645</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">process_behaviour</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Configure and initialize all behaviours and agent subscriptions.</p>

<p>This method is called automatically by the SPADE framework when the agent
is started. It configures XMPP presence, subscribes all registered agents,
and adds the necessary behaviours for system operation.</p>

<h6 id="initialization-sequence">Initialization Sequence:</h6>

<blockquote>
  <ol>
  <li>Set presence as available (AVAILABLE/CHAT) following XMPP protocol</li>
  <li>Automatically approve all subscription requests (trust model)</li>
  <li>Subscribe vehicles, warehouses, stores, suppliers, and world agent</li>
  <li>Add ReceiveEventsBehaviour for continuous message reception</li>
  <li>Add SendInitialSignalBehaviour (periodic until first arrival)</li>
  <li>Add RegisterTransitBehaviour to request initial traffic simulation</li>
  <li>Add ProcessEventsBehaviour for periodic event processing</li>
  </ol>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Uses XMPP presence mechanism for agent discovery and availability,
  which aligns with FIPA's agent management specifications.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>SPADEException:</strong>  If there are problems with XMPP connection or subscription.</li>
</ul>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The order of behaviour addition is important. The initial signal and
  traffic simulation request should execute before processing begins.</p>
  
  <p>The agent sets presence.approve_all = True to automatically accept
  all subscription requests, implementing a trust-based agent society.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="EventDrivenAgent.RegisterTransitBehaviour">
                            <input id="EventDrivenAgent.RegisterTransitBehaviour-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EventDrivenAgent.RegisterTransitBehaviour</span><wbr>(<span class="base">spade.behaviour.OneShotBehaviour</span>):

                <label class="view-source-button" for="EventDrivenAgent.RegisterTransitBehaviour-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.RegisterTransitBehaviour"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.RegisterTransitBehaviour-647"><a href="#EventDrivenAgent.RegisterTransitBehaviour-647"><span class="linenos">647</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">RegisterTransitBehaviour</span><span class="p">(</span><span class="n">OneShotBehaviour</span><span class="p">):</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-648"><a href="#EventDrivenAgent.RegisterTransitBehaviour-648"><span class="linenos">648</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;One-shot behaviour requesting initial traffic simulation.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-649"><a href="#EventDrivenAgent.RegisterTransitBehaviour-649"><span class="linenos">649</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-650"><a href="#EventDrivenAgent.RegisterTransitBehaviour-650"><span class="linenos">650</span></a><span class="sd">        This behaviour executes only once during EventDrivenAgent initialization,</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-651"><a href="#EventDrivenAgent.RegisterTransitBehaviour-651"><span class="linenos">651</span></a><span class="sd">        sending a request to the world agent to simulate traffic conditions for a</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-652"><a href="#EventDrivenAgent.RegisterTransitBehaviour-652"><span class="linenos">652</span></a><span class="sd">        specified period. The initial simulation is crucial for having transit data</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-653"><a href="#EventDrivenAgent.RegisterTransitBehaviour-653"><span class="linenos">653</span></a><span class="sd">        available before event processing begins.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-654"><a href="#EventDrivenAgent.RegisterTransitBehaviour-654"><span class="linenos">654</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-655"><a href="#EventDrivenAgent.RegisterTransitBehaviour-655"><span class="linenos">655</span></a><span class="sd">        The behaviour follows FIPA Request interaction protocol, where this agent</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-656"><a href="#EventDrivenAgent.RegisterTransitBehaviour-656"><span class="linenos">656</span></a><span class="sd">        acts as the initiator sending a REQUEST performative to the world agent</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-657"><a href="#EventDrivenAgent.RegisterTransitBehaviour-657"><span class="linenos">657</span></a><span class="sd">        (participant), which will respond with traffic event data.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-658"><a href="#EventDrivenAgent.RegisterTransitBehaviour-658"><span class="linenos">658</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-659"><a href="#EventDrivenAgent.RegisterTransitBehaviour-659"><span class="linenos">659</span></a><span class="sd">        Workflow:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-660"><a href="#EventDrivenAgent.RegisterTransitBehaviour-660"><span class="linenos">660</span></a><span class="sd">            1. Wait for agent to be fully initialized</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-661"><a href="#EventDrivenAgent.RegisterTransitBehaviour-661"><span class="linenos">661</span></a><span class="sd">            2. Create request message with performative &quot;request&quot;</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-662"><a href="#EventDrivenAgent.RegisterTransitBehaviour-662"><span class="linenos">662</span></a><span class="sd">            3. Set action as &quot;simulate_traffic&quot;</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-663"><a href="#EventDrivenAgent.RegisterTransitBehaviour-663"><span class="linenos">663</span></a><span class="sd">            4. Send simulation time and requester JID</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-664"><a href="#EventDrivenAgent.RegisterTransitBehaviour-664"><span class="linenos">664</span></a><span class="sd">            5. World agent responds with transit events</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-665"><a href="#EventDrivenAgent.RegisterTransitBehaviour-665"><span class="linenos">665</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-666"><a href="#EventDrivenAgent.RegisterTransitBehaviour-666"><span class="linenos">666</span></a><span class="sd">        Attributes:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-667"><a href="#EventDrivenAgent.RegisterTransitBehaviour-667"><span class="linenos">667</span></a><span class="sd">            Inherits attributes from OneShotBehaviour (no own attributes).</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-668"><a href="#EventDrivenAgent.RegisterTransitBehaviour-668"><span class="linenos">668</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-669"><a href="#EventDrivenAgent.RegisterTransitBehaviour-669"><span class="linenos">669</span></a><span class="sd">        Message Format (FIPA ACL compliant):</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-670"><a href="#EventDrivenAgent.RegisterTransitBehaviour-670"><span class="linenos">670</span></a><span class="sd">            Metadata:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-671"><a href="#EventDrivenAgent.RegisterTransitBehaviour-671"><span class="linenos">671</span></a><span class="sd">                performative: &quot;request&quot;</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-672"><a href="#EventDrivenAgent.RegisterTransitBehaviour-672"><span class="linenos">672</span></a><span class="sd">                action: &quot;simulate_traffic&quot;</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-673"><a href="#EventDrivenAgent.RegisterTransitBehaviour-673"><span class="linenos">673</span></a><span class="sd">            Body (JSON):</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-674"><a href="#EventDrivenAgent.RegisterTransitBehaviour-674"><span class="linenos">674</span></a><span class="sd">                {</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-675"><a href="#EventDrivenAgent.RegisterTransitBehaviour-675"><span class="linenos">675</span></a><span class="sd">                    &quot;simulation_time&quot;: float,  # Simulation duration in seconds</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-676"><a href="#EventDrivenAgent.RegisterTransitBehaviour-676"><span class="linenos">676</span></a><span class="sd">                    &quot;requester&quot;: str           # Event agent JID</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-677"><a href="#EventDrivenAgent.RegisterTransitBehaviour-677"><span class="linenos">677</span></a><span class="sd">                }</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-678"><a href="#EventDrivenAgent.RegisterTransitBehaviour-678"><span class="linenos">678</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-679"><a href="#EventDrivenAgent.RegisterTransitBehaviour-679"><span class="linenos">679</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-680"><a href="#EventDrivenAgent.RegisterTransitBehaviour-680"><span class="linenos">680</span></a><span class="sd">            Implements FIPA Request Interaction Protocol:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-681"><a href="#EventDrivenAgent.RegisterTransitBehaviour-681"><span class="linenos">681</span></a><span class="sd">            - Initiator: EventDrivenAgent (this behaviour)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-682"><a href="#EventDrivenAgent.RegisterTransitBehaviour-682"><span class="linenos">682</span></a><span class="sd">            - Participant: WorldAgent</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-683"><a href="#EventDrivenAgent.RegisterTransitBehaviour-683"><span class="linenos">683</span></a><span class="sd">            - Performative: REQUEST</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-684"><a href="#EventDrivenAgent.RegisterTransitBehaviour-684"><span class="linenos">684</span></a><span class="sd">            - Expected response: INFORM with traffic events</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-685"><a href="#EventDrivenAgent.RegisterTransitBehaviour-685"><span class="linenos">685</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-686"><a href="#EventDrivenAgent.RegisterTransitBehaviour-686"><span class="linenos">686</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-687"><a href="#EventDrivenAgent.RegisterTransitBehaviour-687"><span class="linenos">687</span></a><span class="sd">            The world agent response is processed by ReceiveEventsBehaviour,</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-688"><a href="#EventDrivenAgent.RegisterTransitBehaviour-688"><span class="linenos">688</span></a><span class="sd">            which adds transit events to the transit_events list.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-689"><a href="#EventDrivenAgent.RegisterTransitBehaviour-689"><span class="linenos">689</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-690"><a href="#EventDrivenAgent.RegisterTransitBehaviour-690"><span class="linenos">690</span></a>        
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-691"><a href="#EventDrivenAgent.RegisterTransitBehaviour-691"><span class="linenos">691</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-692"><a href="#EventDrivenAgent.RegisterTransitBehaviour-692"><span class="linenos">692</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute traffic simulation request to world agent.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-693"><a href="#EventDrivenAgent.RegisterTransitBehaviour-693"><span class="linenos">693</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-694"><a href="#EventDrivenAgent.RegisterTransitBehaviour-694"><span class="linenos">694</span></a><span class="sd">            Sends an XMPP message to the world agent requesting traffic condition</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-695"><a href="#EventDrivenAgent.RegisterTransitBehaviour-695"><span class="linenos">695</span></a><span class="sd">            simulation. The world agent will process the request and respond with</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-696"><a href="#EventDrivenAgent.RegisterTransitBehaviour-696"><span class="linenos">696</span></a><span class="sd">            a list of transit events that will be received by ReceiveEventsBehaviour.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-697"><a href="#EventDrivenAgent.RegisterTransitBehaviour-697"><span class="linenos">697</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-698"><a href="#EventDrivenAgent.RegisterTransitBehaviour-698"><span class="linenos">698</span></a><span class="sd">            This method implements the REQUEST performative of FIPA ACL, initiating</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-699"><a href="#EventDrivenAgent.RegisterTransitBehaviour-699"><span class="linenos">699</span></a><span class="sd">            a request-response interaction pattern.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-700"><a href="#EventDrivenAgent.RegisterTransitBehaviour-700"><span class="linenos">700</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-701"><a href="#EventDrivenAgent.RegisterTransitBehaviour-701"><span class="linenos">701</span></a><span class="sd">            Raises:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-702"><a href="#EventDrivenAgent.RegisterTransitBehaviour-702"><span class="linenos">702</span></a><span class="sd">                SPADEException: If message sending fails.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-703"><a href="#EventDrivenAgent.RegisterTransitBehaviour-703"><span class="linenos">703</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-704"><a href="#EventDrivenAgent.RegisterTransitBehaviour-704"><span class="linenos">704</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-705"><a href="#EventDrivenAgent.RegisterTransitBehaviour-705"><span class="linenos">705</span></a><span class="sd">                This method executes only once. Subsequent simulation requests</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-706"><a href="#EventDrivenAgent.RegisterTransitBehaviour-706"><span class="linenos">706</span></a><span class="sd">                are managed by &quot;updatesimulation&quot; type events in the heap.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-707"><a href="#EventDrivenAgent.RegisterTransitBehaviour-707"><span class="linenos">707</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-708"><a href="#EventDrivenAgent.RegisterTransitBehaviour-708"><span class="linenos">708</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-709"><a href="#EventDrivenAgent.RegisterTransitBehaviour-709"><span class="linenos">709</span></a><span class="sd">                Sends REQUEST performative with structured content following</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-710"><a href="#EventDrivenAgent.RegisterTransitBehaviour-710"><span class="linenos">710</span></a><span class="sd">                FIPA ACL semantics for service requests.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-711"><a href="#EventDrivenAgent.RegisterTransitBehaviour-711"><span class="linenos">711</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-712"><a href="#EventDrivenAgent.RegisterTransitBehaviour-712"><span class="linenos">712</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-713"><a href="#EventDrivenAgent.RegisterTransitBehaviour-713"><span class="linenos">713</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-714"><a href="#EventDrivenAgent.RegisterTransitBehaviour-714"><span class="linenos">714</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  REQUESTING TRAFFIC SIMULATION FROM WORLD AGENT&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-715"><a href="#EventDrivenAgent.RegisterTransitBehaviour-715"><span class="linenos">715</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recipient: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-716"><a href="#EventDrivenAgent.RegisterTransitBehaviour-716"><span class="linenos">716</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-717"><a href="#EventDrivenAgent.RegisterTransitBehaviour-717"><span class="linenos">717</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-718"><a href="#EventDrivenAgent.RegisterTransitBehaviour-718"><span class="linenos">718</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-719"><a href="#EventDrivenAgent.RegisterTransitBehaviour-719"><span class="linenos">719</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  REQUESTING TRAFFIC SIMULATION FROM WORLD AGENT&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-720"><a href="#EventDrivenAgent.RegisterTransitBehaviour-720"><span class="linenos">720</span></a>            <span class="c1"># Create simulation request message</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-721"><a href="#EventDrivenAgent.RegisterTransitBehaviour-721"><span class="linenos">721</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-722"><a href="#EventDrivenAgent.RegisterTransitBehaviour-722"><span class="linenos">722</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-723"><a href="#EventDrivenAgent.RegisterTransitBehaviour-723"><span class="linenos">723</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-724"><a href="#EventDrivenAgent.RegisterTransitBehaviour-724"><span class="linenos">724</span></a>            
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-725"><a href="#EventDrivenAgent.RegisterTransitBehaviour-725"><span class="linenos">725</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-726"><a href="#EventDrivenAgent.RegisterTransitBehaviour-726"><span class="linenos">726</span></a>                <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-727"><a href="#EventDrivenAgent.RegisterTransitBehaviour-727"><span class="linenos">727</span></a>                <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-728"><a href="#EventDrivenAgent.RegisterTransitBehaviour-728"><span class="linenos">728</span></a>            <span class="p">}</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-729"><a href="#EventDrivenAgent.RegisterTransitBehaviour-729"><span class="linenos">729</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-730"><a href="#EventDrivenAgent.RegisterTransitBehaviour-730"><span class="linenos">730</span></a>            
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-731"><a href="#EventDrivenAgent.RegisterTransitBehaviour-731"><span class="linenos">731</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-732"><a href="#EventDrivenAgent.RegisterTransitBehaviour-732"><span class="linenos">732</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour-733"><a href="#EventDrivenAgent.RegisterTransitBehaviour-733"><span class="linenos">733</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Traffic simulation request sent to world agent&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>One-shot behaviour requesting initial traffic simulation.</p>

<p>This behaviour executes only once during EventDrivenAgent initialization,
sending a request to the world agent to simulate traffic conditions for a
specified period. The initial simulation is crucial for having transit data
available before event processing begins.</p>

<p>The behaviour follows FIPA Request interaction protocol, where this agent
acts as the initiator sending a REQUEST performative to the world agent
(participant), which will respond with traffic event data.</p>

<h6 id="workflow">Workflow:</h6>

<blockquote>
  <ol>
  <li>Wait for agent to be fully initialized</li>
  <li>Create request message with performative "request"</li>
  <li>Set action as "simulate_traffic"</li>
  <li>Send simulation time and requester JID</li>
  <li>World agent responds with transit events</li>
  </ol>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li>Inherits attributes from OneShotBehaviour (no own attributes).</li>
</ul>

<p>Message Format (FIPA ACL compliant):
    Metadata:
        performative: "request"
        action: "simulate_traffic"
    Body (JSON):
        {
            "simulation_time": float,  # Simulation duration in seconds
            "requester": str           # Event agent JID
        }</p>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Implements FIPA Request Interaction Protocol:</p>
  
  <ul>
  <li>Initiator: EventDrivenAgent (this behaviour)</li>
  <li>Participant: WorldAgent</li>
  <li>Performative: REQUEST</li>
  <li>Expected response: INFORM with traffic events</li>
  </ul>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The world agent response is processed by ReceiveEventsBehaviour,
  which adds transit events to the transit_events list.</p>
</blockquote>
</div>


                            <div id="EventDrivenAgent.RegisterTransitBehaviour.run" class="classattr">
                                        <input id="EventDrivenAgent.RegisterTransitBehaviour.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EventDrivenAgent.RegisterTransitBehaviour.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.RegisterTransitBehaviour.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-691"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-691"><span class="linenos">691</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-692"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-692"><span class="linenos">692</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute traffic simulation request to world agent.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-693"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-693"><span class="linenos">693</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-694"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-694"><span class="linenos">694</span></a><span class="sd">            Sends an XMPP message to the world agent requesting traffic condition</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-695"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-695"><span class="linenos">695</span></a><span class="sd">            simulation. The world agent will process the request and respond with</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-696"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-696"><span class="linenos">696</span></a><span class="sd">            a list of transit events that will be received by ReceiveEventsBehaviour.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-697"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-697"><span class="linenos">697</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-698"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-698"><span class="linenos">698</span></a><span class="sd">            This method implements the REQUEST performative of FIPA ACL, initiating</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-699"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-699"><span class="linenos">699</span></a><span class="sd">            a request-response interaction pattern.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-700"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-700"><span class="linenos">700</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-701"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-701"><span class="linenos">701</span></a><span class="sd">            Raises:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-702"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-702"><span class="linenos">702</span></a><span class="sd">                SPADEException: If message sending fails.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-703"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-703"><span class="linenos">703</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-704"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-704"><span class="linenos">704</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-705"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-705"><span class="linenos">705</span></a><span class="sd">                This method executes only once. Subsequent simulation requests</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-706"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-706"><span class="linenos">706</span></a><span class="sd">                are managed by &quot;updatesimulation&quot; type events in the heap.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-707"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-707"><span class="linenos">707</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-708"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-708"><span class="linenos">708</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-709"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-709"><span class="linenos">709</span></a><span class="sd">                Sends REQUEST performative with structured content following</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-710"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-710"><span class="linenos">710</span></a><span class="sd">                FIPA ACL semantics for service requests.</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-711"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-711"><span class="linenos">711</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-712"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-712"><span class="linenos">712</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-713"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-713"><span class="linenos">713</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-714"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-714"><span class="linenos">714</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  REQUESTING TRAFFIC SIMULATION FROM WORLD AGENT&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-715"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-715"><span class="linenos">715</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recipient: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-716"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-716"><span class="linenos">716</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-717"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-717"><span class="linenos">717</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-718"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-718"><span class="linenos">718</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-719"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-719"><span class="linenos">719</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  REQUESTING TRAFFIC SIMULATION FROM WORLD AGENT&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-720"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-720"><span class="linenos">720</span></a>            <span class="c1"># Create simulation request message</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-721"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-721"><span class="linenos">721</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-722"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-722"><span class="linenos">722</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-723"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-723"><span class="linenos">723</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-724"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-724"><span class="linenos">724</span></a>            
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-725"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-725"><span class="linenos">725</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-726"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-726"><span class="linenos">726</span></a>                <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-727"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-727"><span class="linenos">727</span></a>                <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-728"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-728"><span class="linenos">728</span></a>            <span class="p">}</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-729"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-729"><span class="linenos">729</span></a>            <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-730"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-730"><span class="linenos">730</span></a>            
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-731"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-731"><span class="linenos">731</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-732"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-732"><span class="linenos">732</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.RegisterTransitBehaviour.run-733"><a href="#EventDrivenAgent.RegisterTransitBehaviour.run-733"><span class="linenos">733</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Traffic simulation request sent to world agent&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Execute traffic simulation request to world agent.</p>

<p>Sends an XMPP message to the world agent requesting traffic condition
simulation. The world agent will process the request and respond with
a list of transit events that will be received by ReceiveEventsBehaviour.</p>

<p>This method implements the REQUEST performative of FIPA ACL, initiating
a request-response interaction pattern.</p>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>SPADEException:</strong>  If message sending fails.</li>
</ul>

<h6 id="note">Note:</h6>

<blockquote>
  <p>This method executes only once. Subsequent simulation requests
  are managed by "updatesimulation" type events in the heap.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Sends REQUEST performative with structured content following
  FIPA ACL semantics for service requests.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="EventDrivenAgent.SendInitialSignalBehaviour">
                            <input id="EventDrivenAgent.SendInitialSignalBehaviour-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EventDrivenAgent.SendInitialSignalBehaviour</span><wbr>(<span class="base">spade.behaviour.PeriodicBehaviour</span>):

                <label class="view-source-button" for="EventDrivenAgent.SendInitialSignalBehaviour-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.SendInitialSignalBehaviour"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.SendInitialSignalBehaviour-735"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-735"><span class="linenos">735</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">SendInitialSignalBehaviour</span><span class="p">(</span><span class="n">PeriodicBehaviour</span><span class="p">):</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-736"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-736"><span class="linenos">736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Periodic behaviour for vehicle activation through initial signaling.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-737"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-737"><span class="linenos">737</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-738"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-738"><span class="linenos">738</span></a><span class="sd">        This behaviour executes periodically (every 10 seconds) during initialization,</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-739"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-739"><span class="linenos">739</span></a><span class="sd">        sending fictitious &quot;arrival&quot; messages to all registered vehicles until the</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-740"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-740"><span class="linenos">740</span></a><span class="sd">        first real arrival event is received. The goal is to ensure vehicles are</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-741"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-741"><span class="linenos">741</span></a><span class="sd">        active and ready to respond to actual events.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-742"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-742"><span class="linenos">742</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-743"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-743"><span class="linenos">743</span></a><span class="sd">        This pattern implements a &quot;heartbeat&quot; or &quot;keep-alive&quot; mechanism to bootstrap</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-744"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-744"><span class="linenos">744</span></a><span class="sd">        the simulation, following distributed systems principles for node activation.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-745"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-745"><span class="linenos">745</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-746"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-746"><span class="linenos">746</span></a><span class="sd">        Initialization Strategy:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-747"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-747"><span class="linenos">747</span></a><span class="sd">            - Uses fictitious vehicle name (&quot;vehicle_init_signal_999&quot;)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-748"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-748"><span class="linenos">748</span></a><span class="sd">            - Event time is 0.1 (near-zero, initial moment)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-749"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-749"><span class="linenos">749</span></a><span class="sd">            - Sends periodically until first real arrival received</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-750"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-750"><span class="linenos">750</span></a><span class="sd">            - Terminates automatically when first_arrival_received = True</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-751"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-751"><span class="linenos">751</span></a><span class="sd">            - Vehicles ignore the fictitious event but notify event agent</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-752"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-752"><span class="linenos">752</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-753"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-753"><span class="linenos">753</span></a><span class="sd">        Attributes:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-754"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-754"><span class="linenos">754</span></a><span class="sd">            Inherits attributes from PeriodicBehaviour (period set to 10 seconds).</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-755"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-755"><span class="linenos">755</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-756"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-756"><span class="linenos">756</span></a><span class="sd">        Message Format (FIPA ACL INFORM):</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-757"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-757"><span class="linenos">757</span></a><span class="sd">            Metadata:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-758"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-758"><span class="linenos">758</span></a><span class="sd">                performative: \&quot;inform\&quot;</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-759"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-759"><span class="linenos">759</span></a><span class="sd">            Body (JSON):</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-760"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-760"><span class="linenos">760</span></a><span class="sd">                {</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-761"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-761"><span class="linenos">761</span></a><span class="sd">                    \&quot;type\&quot;: \&quot;arrival\&quot;,</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-762"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-762"><span class="linenos">762</span></a><span class="sd">                    \&quot;vehicle\&quot;: \&quot;vehicle_init_signal_999\&quot;,  # Fictitious name</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-763"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-763"><span class="linenos">763</span></a><span class="sd">                    \&quot;time\&quot;: 0.1</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-764"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-764"><span class="linenos">764</span></a><span class="sd">                }</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-765"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-765"><span class="linenos">765</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-766"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-766"><span class="linenos">766</span></a><span class="sd">        Examples:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-767"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-767"><span class="linenos">767</span></a><span class="sd">            &gt;&gt;&gt; # Automatically added in setup() with 10s period</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-768"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-768"><span class="linenos">768</span></a><span class="sd">            &gt;&gt;&gt; initial_signal = self.SendInitialSignalBehaviour(period=10.0)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-769"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-769"><span class="linenos">769</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(initial_signal)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-770"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-770"><span class="linenos">770</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-771"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-771"><span class="linenos">771</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-772"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-772"><span class="linenos">772</span></a><span class="sd">            This mechanism ensures all vehicles are ready to receive events</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-773"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-773"><span class="linenos">773</span></a><span class="sd">            before the simulation effectively begins. The behaviour stops</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-774"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-774"><span class="linenos">774</span></a><span class="sd">            automatically when the first real arrival is received.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-775"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-775"><span class="linenos">775</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-776"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-776"><span class="linenos">776</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-777"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-777"><span class="linenos">777</span></a><span class="sd">            Uses INFORM performative to notify vehicles of (fictitious) events,</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-778"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-778"><span class="linenos">778</span></a><span class="sd">            implementing a broadcast notification pattern.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-779"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-779"><span class="linenos">779</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-780"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-780"><span class="linenos">780</span></a><span class="sd">        Warning:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-781"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-781"><span class="linenos">781</span></a><span class="sd">            If registered_vehicles is empty, behaviour terminates without action</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-782"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-782"><span class="linenos">782</span></a><span class="sd">            and emits a warning in the log.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-783"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-783"><span class="linenos">783</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-784"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-784"><span class="linenos">784</span></a>        
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-785"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-785"><span class="linenos">785</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-786"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-786"><span class="linenos">786</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Send initialization signal to all registered vehicles periodically.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-787"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-787"><span class="linenos">787</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-788"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-788"><span class="linenos">788</span></a><span class="sd">            Iterates over the list of registered vehicles and sends each one a</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-789"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-789"><span class="linenos">789</span></a><span class="sd">            fictitious arrival message. Continues sending until the first real</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-790"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-790"><span class="linenos">790</span></a><span class="sd">            arrival is received.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-791"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-791"><span class="linenos">791</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-792"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-792"><span class="linenos">792</span></a><span class="sd">            The method implements a broadcast INFORM pattern, notifying all vehicles</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-793"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-793"><span class="linenos">793</span></a><span class="sd">            to activate their event reception behaviours.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-794"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-794"><span class="linenos">794</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-795"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-795"><span class="linenos">795</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-796"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-796"><span class="linenos">796</span></a><span class="sd">                None: Executes side effects (message sending).</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-797"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-797"><span class="linenos">797</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-798"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-798"><span class="linenos">798</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-799"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-799"><span class="linenos">799</span></a><span class="sd">                The behaviour checks the first_arrival_received flag and terminates</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-800"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-800"><span class="linenos">800</span></a><span class="sd">                when it is True. The fictitious name &quot;vehicle_init_signal_999&quot;</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-801"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-801"><span class="linenos">801</span></a><span class="sd">                is intentional and should not correspond to any real vehicle.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-802"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-802"><span class="linenos">802</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-803"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-803"><span class="linenos">803</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-804"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-804"><span class="linenos">804</span></a><span class="sd">                Sends INFORM performatives to all vehicles in a broadcast pattern.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-805"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-805"><span class="linenos">805</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-806"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-806"><span class="linenos">806</span></a>            <span class="c1"># Check if first arrival already received</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-807"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-807"><span class="linenos">807</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-808"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-808"><span class="linenos">808</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-809"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-809"><span class="linenos">809</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  First arrival received. Stopping initial signal sending.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-810"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-810"><span class="linenos">810</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-811"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-811"><span class="linenos">811</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  First arrival received.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-812"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-812"><span class="linenos">812</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Stop this behaviour</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-813"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-813"><span class="linenos">813</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-814"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-814"><span class="linenos">814</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-815"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-815"><span class="linenos">815</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-816"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-816"><span class="linenos">816</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  No registered vehicles to send initial signal&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-817"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-817"><span class="linenos">817</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-818"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-818"><span class="linenos">818</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-819"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-819"><span class="linenos">819</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-820"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-820"><span class="linenos">820</span></a>            <span class="c1"># Use fictitious name that doesn&#39;t correspond to any real vehicle</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-821"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-821"><span class="linenos">821</span></a>            <span class="n">fictitious_vehicle_name</span> <span class="o">=</span> <span class="s2">&quot;vehicle_init_signal_999&quot;</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-822"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-822"><span class="linenos">822</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-823"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-823"><span class="linenos">823</span></a>            <span class="c1"># Send message to ALL registered vehicles</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-824"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-824"><span class="linenos">824</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-825"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-825"><span class="linenos">825</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-826"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-826"><span class="linenos">826</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SENDING INITIAL SIGNAL (periodic)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-827"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-827"><span class="linenos">827</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recipients: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> vehicles&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-828"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-828"><span class="linenos">828</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Vehicle (fictitious): </span><span class="si">{</span><span class="n">fictitious_vehicle_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-829"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-829"><span class="linenos">829</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type: arrival&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-830"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-830"><span class="linenos">830</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time: 0.1&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-831"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-831"><span class="linenos">831</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-832"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-832"><span class="linenos">832</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-833"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-833"><span class="linenos">833</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SENDING INITIAL SIGNAL (waiting for real arrival...)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-834"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-834"><span class="linenos">834</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-835"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-835"><span class="linenos">835</span></a>            <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-836"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-836"><span class="linenos">836</span></a>                <span class="c1"># Create initial arrival message with near-zero time</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-837"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-837"><span class="linenos">837</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-838"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-838"><span class="linenos">838</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-839"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-839"><span class="linenos">839</span></a>                
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-840"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-840"><span class="linenos">840</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-841"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-841"><span class="linenos">841</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-842"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-842"><span class="linenos">842</span></a>                    <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="n">fictitious_vehicle_name</span><span class="p">,</span>  <span class="c1"># Fictitious name</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-843"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-843"><span class="linenos">843</span></a>                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-844"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-844"><span class="linenos">844</span></a>                <span class="p">}</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-845"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-845"><span class="linenos">845</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-846"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-846"><span class="linenos">846</span></a>                
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-847"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-847"><span class="linenos">847</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-848"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-848"><span class="linenos">848</span></a>                
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-849"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-849"><span class="linenos">849</span></a>                <span class="n">vehicle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-850"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-850"><span class="linenos">850</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-851"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-851"><span class="linenos">851</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sent to: </span><span class="si">{</span><span class="n">vehicle_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-852"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-852"><span class="linenos">852</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-853"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-853"><span class="linenos">853</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour-854"><a href="#EventDrivenAgent.SendInitialSignalBehaviour-854"><span class="linenos">854</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Periodic behaviour for vehicle activation through initial signaling.</p>

<p>This behaviour executes periodically (every 10 seconds) during initialization,
sending fictitious "arrival" messages to all registered vehicles until the
first real arrival event is received. The goal is to ensure vehicles are
active and ready to respond to actual events.</p>

<p>This pattern implements a "heartbeat" or "keep-alive" mechanism to bootstrap
the simulation, following distributed systems principles for node activation.</p>

<h6 id="initialization-strategy">Initialization Strategy:</h6>

<blockquote>
  <ul>
  <li>Uses fictitious vehicle name ("vehicle_init_signal_999")</li>
  <li>Event time is 0.1 (near-zero, initial moment)</li>
  <li>Sends periodically until first real arrival received</li>
  <li>Terminates automatically when first_arrival_received = True</li>
  <li>Vehicles ignore the fictitious event but notify event agent</li>
  </ul>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li>Inherits attributes from PeriodicBehaviour (period set to 10 seconds).</li>
</ul>

<p>Message Format (FIPA ACL INFORM):
    Metadata:
        performative: "inform"
    Body (JSON):
        {
            "type": "arrival",
            "vehicle": "vehicle_init_signal_999",  # Fictitious name
            "time": 0.1
        }</p>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Automatically added in setup() with 10s period</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">initial_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendInitialSignalBehaviour</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">initial_signal</span><span class="p">)</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>This mechanism ensures all vehicles are ready to receive events
  before the simulation effectively begins. The behaviour stops
  automatically when the first real arrival is received.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Uses INFORM performative to notify vehicles of (fictitious) events,
  implementing a broadcast notification pattern.</p>
</blockquote>

<h6 id="warning">Warning:</h6>

<blockquote>
  <p>If registered_vehicles is empty, behaviour terminates without action
  and emits a warning in the log.</p>
</blockquote>
</div>


                            <div id="EventDrivenAgent.SendInitialSignalBehaviour.run" class="classattr">
                                        <input id="EventDrivenAgent.SendInitialSignalBehaviour.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EventDrivenAgent.SendInitialSignalBehaviour.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.SendInitialSignalBehaviour.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-785"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-785"><span class="linenos">785</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-786"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-786"><span class="linenos">786</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Send initialization signal to all registered vehicles periodically.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-787"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-787"><span class="linenos">787</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-788"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-788"><span class="linenos">788</span></a><span class="sd">            Iterates over the list of registered vehicles and sends each one a</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-789"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-789"><span class="linenos">789</span></a><span class="sd">            fictitious arrival message. Continues sending until the first real</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-790"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-790"><span class="linenos">790</span></a><span class="sd">            arrival is received.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-791"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-791"><span class="linenos">791</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-792"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-792"><span class="linenos">792</span></a><span class="sd">            The method implements a broadcast INFORM pattern, notifying all vehicles</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-793"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-793"><span class="linenos">793</span></a><span class="sd">            to activate their event reception behaviours.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-794"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-794"><span class="linenos">794</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-795"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-795"><span class="linenos">795</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-796"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-796"><span class="linenos">796</span></a><span class="sd">                None: Executes side effects (message sending).</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-797"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-797"><span class="linenos">797</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-798"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-798"><span class="linenos">798</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-799"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-799"><span class="linenos">799</span></a><span class="sd">                The behaviour checks the first_arrival_received flag and terminates</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-800"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-800"><span class="linenos">800</span></a><span class="sd">                when it is True. The fictitious name &quot;vehicle_init_signal_999&quot;</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-801"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-801"><span class="linenos">801</span></a><span class="sd">                is intentional and should not correspond to any real vehicle.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-802"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-802"><span class="linenos">802</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-803"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-803"><span class="linenos">803</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-804"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-804"><span class="linenos">804</span></a><span class="sd">                Sends INFORM performatives to all vehicles in a broadcast pattern.</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-805"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-805"><span class="linenos">805</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-806"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-806"><span class="linenos">806</span></a>            <span class="c1"># Check if first arrival already received</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-807"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-807"><span class="linenos">807</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-808"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-808"><span class="linenos">808</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-809"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-809"><span class="linenos">809</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  First arrival received. Stopping initial signal sending.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-810"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-810"><span class="linenos">810</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-811"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-811"><span class="linenos">811</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  First arrival received.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-812"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-812"><span class="linenos">812</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Stop this behaviour</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-813"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-813"><span class="linenos">813</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-814"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-814"><span class="linenos">814</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-815"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-815"><span class="linenos">815</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-816"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-816"><span class="linenos">816</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  No registered vehicles to send initial signal&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-817"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-817"><span class="linenos">817</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-818"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-818"><span class="linenos">818</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-819"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-819"><span class="linenos">819</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-820"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-820"><span class="linenos">820</span></a>            <span class="c1"># Use fictitious name that doesn&#39;t correspond to any real vehicle</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-821"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-821"><span class="linenos">821</span></a>            <span class="n">fictitious_vehicle_name</span> <span class="o">=</span> <span class="s2">&quot;vehicle_init_signal_999&quot;</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-822"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-822"><span class="linenos">822</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-823"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-823"><span class="linenos">823</span></a>            <span class="c1"># Send message to ALL registered vehicles</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-824"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-824"><span class="linenos">824</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-825"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-825"><span class="linenos">825</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-826"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-826"><span class="linenos">826</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SENDING INITIAL SIGNAL (periodic)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-827"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-827"><span class="linenos">827</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Recipients: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> vehicles&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-828"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-828"><span class="linenos">828</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Vehicle (fictitious): </span><span class="si">{</span><span class="n">fictitious_vehicle_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-829"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-829"><span class="linenos">829</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Type: arrival&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-830"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-830"><span class="linenos">830</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time: 0.1&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-831"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-831"><span class="linenos">831</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-832"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-832"><span class="linenos">832</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-833"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-833"><span class="linenos">833</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SENDING INITIAL SIGNAL (waiting for real arrival...)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-834"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-834"><span class="linenos">834</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-835"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-835"><span class="linenos">835</span></a>            <span class="k">for</span> <span class="n">vehicle_jid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-836"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-836"><span class="linenos">836</span></a>                <span class="c1"># Create initial arrival message with near-zero time</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-837"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-837"><span class="linenos">837</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">vehicle_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-838"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-838"><span class="linenos">838</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-839"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-839"><span class="linenos">839</span></a>                
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-840"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-840"><span class="linenos">840</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-841"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-841"><span class="linenos">841</span></a>                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-842"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-842"><span class="linenos">842</span></a>                    <span class="s2">&quot;vehicle&quot;</span><span class="p">:</span> <span class="n">fictitious_vehicle_name</span><span class="p">,</span>  <span class="c1"># Fictitious name</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-843"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-843"><span class="linenos">843</span></a>                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mf">0.1</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-844"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-844"><span class="linenos">844</span></a>                <span class="p">}</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-845"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-845"><span class="linenos">845</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-846"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-846"><span class="linenos">846</span></a>                
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-847"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-847"><span class="linenos">847</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-848"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-848"><span class="linenos">848</span></a>                
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-849"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-849"><span class="linenos">849</span></a>                <span class="n">vehicle_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">vehicle_jid</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-850"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-850"><span class="linenos">850</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-851"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-851"><span class="linenos">851</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sent to: </span><span class="si">{</span><span class="n">vehicle_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-852"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-852"><span class="linenos">852</span></a>            
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-853"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-853"><span class="linenos">853</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.SendInitialSignalBehaviour.run-854"><a href="#EventDrivenAgent.SendInitialSignalBehaviour.run-854"><span class="linenos">854</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Send initialization signal to all registered vehicles periodically.</p>

<p>Iterates over the list of registered vehicles and sends each one a
fictitious arrival message. Continues sending until the first real
arrival is received.</p>

<p>The method implements a broadcast INFORM pattern, notifying all vehicles
to activate their event reception behaviours.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None: Executes side effects (message sending).</p>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The behaviour checks the first_arrival_received flag and terminates
  when it is True. The fictitious name "vehicle_init_signal_999"
  is intentional and should not correspond to any real vehicle.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Sends INFORM performatives to all vehicles in a broadcast pattern.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="EventDrivenAgent.ReceiveEventsBehaviour">
                            <input id="EventDrivenAgent.ReceiveEventsBehaviour-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EventDrivenAgent.ReceiveEventsBehaviour</span><wbr>(<span class="base">spade.behaviour.CyclicBehaviour</span>):

                <label class="view-source-button" for="EventDrivenAgent.ReceiveEventsBehaviour-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.ReceiveEventsBehaviour"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.ReceiveEventsBehaviour-856"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-856"><span class="linenos"> 856</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ReceiveEventsBehaviour</span><span class="p">(</span><span class="n">CyclicBehaviour</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-857"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-857"><span class="linenos"> 857</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cyclic behaviour for continuous event reception from multiple sources.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-858"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-858"><span class="linenos"> 858</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-859"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-859"><span class="linenos"> 859</span></a><span class="sd">        This behaviour remains permanently active, receiving XMPP messages from</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-860"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-860"><span class="linenos"> 860</span></a><span class="sd">        all registered agents (vehicles, warehouses, stores, suppliers, world agent)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-861"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-861"><span class="linenos"> 861</span></a><span class="sd">        and classifying them into different event categories. Reception is</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-862"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-862"><span class="linenos"> 862</span></a><span class="sd">        non-blocking with 1-second timeout to allow interruptions.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-863"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-863"><span class="linenos"> 863</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-864"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-864"><span class="linenos"> 864</span></a><span class="sd">        The behaviour implements a message router pattern, directing different</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-865"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-865"><span class="linenos"> 865</span></a><span class="sd">        event types to appropriate data structures for later processing.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-866"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-866"><span class="linenos"> 866</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-867"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-867"><span class="linenos"> 867</span></a><span class="sd">        Event Types Processed:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-868"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-868"><span class="linenos"> 868</span></a><span class="sd">            - **Traffic Events**: Transit events from world agent (complete list)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-869"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-869"><span class="linenos"> 869</span></a><span class="sd">            - **Transit**: Manual traffic condition change events</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-870"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-870"><span class="linenos"> 870</span></a><span class="sd">            - **Arrival**: Vehicle arrival events at nodes</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-871"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-871"><span class="linenos"> 871</span></a><span class="sd">            - **UpdateSimulation**: Traffic resimulation requests</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-872"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-872"><span class="linenos"> 872</span></a><span class="sd">            - **Other**: Generic events added to main heap</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-873"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-873"><span class="linenos"> 873</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-874"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-874"><span class="linenos"> 874</span></a><span class="sd">        Storage Strategy:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-875"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-875"><span class="linenos"> 875</span></a><span class="sd">            - Transit events  transit_events (separate list)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-876"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-876"><span class="linenos"> 876</span></a><span class="sd">            - Arrival events (time &gt; 0)  arrival_events (temporary buffer)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-877"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-877"><span class="linenos"> 877</span></a><span class="sd">            - Arrival events (time = 0)  discarded (initial signal)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-878"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-878"><span class="linenos"> 878</span></a><span class="sd">            - Other events  event_heap (min heap)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-879"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-879"><span class="linenos"> 879</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-880"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-880"><span class="linenos"> 880</span></a><span class="sd">        Attributes:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-881"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-881"><span class="linenos"> 881</span></a><span class="sd">            Inherits attributes from CyclicBehaviour.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-882"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-882"><span class="linenos"> 882</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-883"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-883"><span class="linenos"> 883</span></a><span class="sd">        Message Formats:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-884"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-884"><span class="linenos"> 884</span></a><span class="sd">            Traffic Events (from world agent):</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-885"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-885"><span class="linenos"> 885</span></a><span class="sd">                Metadata:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-886"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-886"><span class="linenos"> 886</span></a><span class="sd">                    performative: \&quot;inform\&quot;</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-887"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-887"><span class="linenos"> 887</span></a><span class="sd">                    action: \&quot;traffic_events\&quot;</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-888"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-888"><span class="linenos"> 888</span></a><span class="sd">                Body (JSON):</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-889"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-889"><span class="linenos"> 889</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-890"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-890"><span class="linenos"> 890</span></a><span class="sd">                        \&quot;events\&quot;: [</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-891"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-891"><span class="linenos"> 891</span></a><span class="sd">                            {</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-892"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-892"><span class="linenos"> 892</span></a><span class="sd">                                \&quot;instant\&quot;: float,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-893"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-893"><span class="linenos"> 893</span></a><span class="sd">                                \&quot;node1_id\&quot;: int,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-894"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-894"><span class="linenos"> 894</span></a><span class="sd">                                \&quot;node2_id\&quot;: int,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-895"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-895"><span class="linenos"> 895</span></a><span class="sd">                                \&quot;new_time\&quot;: float,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-896"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-896"><span class="linenos"> 896</span></a><span class="sd">                                \&quot;new_fuel_consumption\&quot;: float,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-897"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-897"><span class="linenos"> 897</span></a><span class="sd">                            },</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-898"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-898"><span class="linenos"> 898</span></a><span class="sd">                            ...</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-899"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-899"><span class="linenos"> 899</span></a><span class="sd">                        ]</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-900"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-900"><span class="linenos"> 900</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-901"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-901"><span class="linenos"> 901</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-902"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-902"><span class="linenos"> 902</span></a><span class="sd">            Generic Events:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-903"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-903"><span class="linenos"> 903</span></a><span class="sd">                Metadata:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-904"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-904"><span class="linenos"> 904</span></a><span class="sd">                    performative: \&quot;inform\&quot;</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-905"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-905"><span class="linenos"> 905</span></a><span class="sd">                Body (JSON):</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-906"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-906"><span class="linenos"> 906</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-907"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-907"><span class="linenos"> 907</span></a><span class="sd">                        \&quot;type\&quot;: str,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-908"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-908"><span class="linenos"> 908</span></a><span class="sd">                        \&quot;time\&quot;: float,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-909"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-909"><span class="linenos"> 909</span></a><span class="sd">                        \&quot;data\&quot;: Dict[str, Any],</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-910"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-910"><span class="linenos"> 910</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-911"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-911"><span class="linenos"> 911</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-912"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-912"><span class="linenos"> 912</span></a><span class="sd">        Examples:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-913"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-913"><span class="linenos"> 913</span></a><span class="sd">            &gt;&gt;&gt; # Behaviour executes continuously after addition</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-914"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-914"><span class="linenos"> 914</span></a><span class="sd">            &gt;&gt;&gt; receive_behaviour = self.ReceiveEventsBehaviour()</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-915"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-915"><span class="linenos"> 915</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(receive_behaviour)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-916"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-916"><span class="linenos"> 916</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-917"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-917"><span class="linenos"> 917</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-918"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-918"><span class="linenos"> 918</span></a><span class="sd">            The 1-second timeout allows the behaviour to periodically check</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-919"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-919"><span class="linenos"> 919</span></a><span class="sd">            if it should terminate (e.g., when agent is stopped). Received</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-920"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-920"><span class="linenos"> 920</span></a><span class="sd">            messages are immediately processed and classified.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-921"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-921"><span class="linenos"> 921</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-922"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-922"><span class="linenos"> 922</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-923"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-923"><span class="linenos"> 923</span></a><span class="sd">            Processes FIPA ACL messages with INFORM performative, acting as</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-924"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-924"><span class="linenos"> 924</span></a><span class="sd">            a receiver in multiple interaction protocols initiated by other agents.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-925"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-925"><span class="linenos"> 925</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-926"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-926"><span class="linenos"> 926</span></a><span class="sd">        Warning:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-927"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-927"><span class="linenos"> 927</span></a><span class="sd">            JSON parsing errors are caught and logged, but do not interrupt</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-928"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-928"><span class="linenos"> 928</span></a><span class="sd">            the behaviour. Malformed events are discarded.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-929"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-929"><span class="linenos"> 929</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-930"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-930"><span class="linenos"> 930</span></a><span class="sd">        See Also:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-931"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-931"><span class="linenos"> 931</span></a><span class="sd">            ProcessEventsBehaviour: Processes stored events.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-932"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-932"><span class="linenos"> 932</span></a><span class="sd">            Event: Data structure for representing events.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-933"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-933"><span class="linenos"> 933</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-934"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-934"><span class="linenos"> 934</span></a>        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-935"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-935"><span class="linenos"> 935</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-936"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-936"><span class="linenos"> 936</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Cycle of event message reception and classification.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-937"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-937"><span class="linenos"> 937</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-938"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-938"><span class="linenos"> 938</span></a><span class="sd">            This method executes continuously, awaiting messages with 1-second</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-939"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-939"><span class="linenos"> 939</span></a><span class="sd">            timeout. When a message is received, it identifies the event type</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-940"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-940"><span class="linenos"> 940</span></a><span class="sd">            and stores it in the appropriate data structure.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-941"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-941"><span class="linenos"> 941</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-942"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-942"><span class="linenos"> 942</span></a><span class="sd">            Processing Flow:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-943"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-943"><span class="linenos"> 943</span></a><span class="sd">                1. Await message with 1s timeout</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-944"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-944"><span class="linenos"> 944</span></a><span class="sd">                2. Check if it&#39;s traffic events response from world agent</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-945"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-945"><span class="linenos"> 945</span></a><span class="sd">                3. If yes, process complete list of transit events</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-946"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-946"><span class="linenos"> 946</span></a><span class="sd">                4. If no, identify individual event type</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-947"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-947"><span class="linenos"> 947</span></a><span class="sd">                5. Store in transit_events, arrival_events, or event_heap</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-948"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-948"><span class="linenos"> 948</span></a><span class="sd">                6. Increment received events counter</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-949"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-949"><span class="linenos"> 949</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-950"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-950"><span class="linenos"> 950</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-951"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-951"><span class="linenos"> 951</span></a><span class="sd">                None: Executes continuously until behaviour is removed.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-952"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-952"><span class="linenos"> 952</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-953"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-953"><span class="linenos"> 953</span></a><span class="sd">            Raises:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-954"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-954"><span class="linenos"> 954</span></a><span class="sd">                Exception: Catches and logs parsing errors without interrupting.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-955"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-955"><span class="linenos"> 955</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-956"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-956"><span class="linenos"> 956</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-957"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-957"><span class="linenos"> 957</span></a><span class="sd">                For transit events from world agent, also creates an automatic</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-958"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-958"><span class="linenos"> 958</span></a><span class="sd">                resimulation event after world_simulation_time.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-959"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-959"><span class="linenos"> 959</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-960"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-960"><span class="linenos"> 960</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-961"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-961"><span class="linenos"> 961</span></a><span class="sd">                Receives and processes INFORM performatives from multiple agents,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-962"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-962"><span class="linenos"> 962</span></a><span class="sd">                implementing receiver role in FIPA interaction protocols.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-963"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-963"><span class="linenos"> 963</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-964"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-964"><span class="linenos"> 964</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-965"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-965"><span class="linenos"> 965</span></a>            
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-966"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-966"><span class="linenos"> 966</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-967"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-967"><span class="linenos"> 967</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-968"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-968"><span class="linenos"> 968</span></a>                    <span class="c1"># Verificar se  resposta do world agent com eventos de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-969"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-969"><span class="linenos"> 969</span></a>                    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;inform&quot;</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;traffic_events&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-970"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-970"><span class="linenos"> 970</span></a>                        <span class="c1"># Mensagem do world agent com eventos de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-971"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-971"><span class="linenos"> 971</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-972"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-972"><span class="linenos"> 972</span></a>                        <span class="n">events</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-973"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-973"><span class="linenos"> 973</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-974"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-974"><span class="linenos"> 974</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-975"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-975"><span class="linenos"> 975</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-976"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-976"><span class="linenos"> 976</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  EVENTOS DE TRNSITO DO WORLD AGENT RECEBIDOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-977"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-977"><span class="linenos"> 977</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total de eventos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-978"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-978"><span class="linenos"> 978</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-979"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-979"><span class="linenos"> 979</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-980"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-980"><span class="linenos"> 980</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  EVENTOS DE TRNSITO DO WORLD AGENT RECEBIDOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-981"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-981"><span class="linenos"> 981</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-982"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-982"><span class="linenos"> 982</span></a>                        <span class="c1"># Processar cada evento de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-983"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-983"><span class="linenos"> 983</span></a>                        <span class="k">for</span> <span class="n">event_data</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-984"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-984"><span class="linenos"> 984</span></a>                            <span class="c1"># Criar evento de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-985"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-985"><span class="linenos"> 985</span></a>                            <span class="n">transit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-986"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-986"><span class="linenos"> 986</span></a>                                <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-987"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-987"><span class="linenos"> 987</span></a>                                <span class="n">time</span><span class="o">=</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instant&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-988"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-988"><span class="linenos"> 988</span></a>                                <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-989"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-989"><span class="linenos"> 989</span></a>                                    <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[{</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-990"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-990"><span class="linenos"> 990</span></a>                                        <span class="s2">&quot;node1&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node1_id&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-991"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-991"><span class="linenos"> 991</span></a>                                        <span class="s2">&quot;node2&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node2_id&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-992"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-992"><span class="linenos"> 992</span></a>                                        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_time&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-993"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-993"><span class="linenos"> 993</span></a>                                        <span class="s2">&quot;fuel_consumption&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_fuel_consumption&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-994"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-994"><span class="linenos"> 994</span></a>                                    <span class="p">}]</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-995"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-995"><span class="linenos"> 995</span></a>                                <span class="p">},</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-996"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-996"><span class="linenos"> 996</span></a>                                <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-997"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-997"><span class="linenos"> 997</span></a>                            <span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-998"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-998"><span class="linenos"> 998</span></a>                            
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-999"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-999"><span class="linenos"> 999</span></a>                            <span class="c1"># Adicionar  lista de eventos de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1000"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1000"><span class="linenos">1000</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1001"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1001"><span class="linenos">1001</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1002"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1002"><span class="linenos">1002</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Transit event added: Edge (</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node1_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node2_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">), time=</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_time&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, instant=</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instant&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1003"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1003"><span class="linenos">1003</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1004"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1004"><span class="linenos">1004</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1005"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1005"><span class="linenos">1005</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Total transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1006"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1006"><span class="linenos">1006</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1007"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1007"><span class="linenos">1007</span></a>                        <span class="c1"># Criar evento para solicitar nova simulao aps world_simulation_time</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1008"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1008"><span class="linenos">1008</span></a>                        <span class="n">resimulation_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1009"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1009"><span class="linenos">1009</span></a>                            <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;updatesimulation&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1010"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1010"><span class="linenos">1010</span></a>                            <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1011"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1011"><span class="linenos">1011</span></a>                            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;request_new_simulation&quot;</span><span class="p">},</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1012"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1012"><span class="linenos">1012</span></a>                            <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1013"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1013"><span class="linenos">1013</span></a>                        <span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1014"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1014"><span class="linenos">1014</span></a>                        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">resimulation_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1015"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1015"><span class="linenos">1015</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1016"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1016"><span class="linenos">1016</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Resimulation event added to heap: </span><span class="si">{</span><span class="n">resimulation_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1017"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1017"><span class="linenos">1017</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1018"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1018"><span class="linenos">1018</span></a>                        <span class="k">return</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1019"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1019"><span class="linenos">1019</span></a>                    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1020"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1020"><span class="linenos">1020</span></a>                    <span class="c1"># Processar outros eventos normalmente</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1021"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1021"><span class="linenos">1021</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1022"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1022"><span class="linenos">1022</span></a>                    <span class="n">event_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1023"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1023"><span class="linenos">1023</span></a>                    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1024"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1024"><span class="linenos">1024</span></a>                    <span class="n">event_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1025"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1025"><span class="linenos">1025</span></a>                    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1026"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1026"><span class="linenos">1026</span></a>                    <span class="c1"># Debug: mostrar dados recebidos</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1027"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1027"><span class="linenos">1027</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1028"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1028"><span class="linenos">1028</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Mensagem recebida:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1029"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1029"><span class="linenos">1029</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sender: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1030"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1030"><span class="linenos">1030</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Type: </span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1031"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1031"><span class="linenos">1031</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Time: </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1032"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1032"><span class="linenos">1032</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Data: </span><span class="si">{</span><span class="n">event_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1033"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1033"><span class="linenos">1033</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1034"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1034"><span class="linenos">1034</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Mensagem recebida de </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1035"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1035"><span class="linenos">1035</span></a>                    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1036"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1036"><span class="linenos">1036</span></a>                    <span class="c1"># Criar evento</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1037"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1037"><span class="linenos">1037</span></a>                    <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1038"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1038"><span class="linenos">1038</span></a>                        <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1039"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1039"><span class="linenos">1039</span></a>                        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1040"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1040"><span class="linenos">1040</span></a>                        <span class="n">data</span><span class="o">=</span><span class="n">event_data</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1041"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1041"><span class="linenos">1041</span></a>                        <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1042"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1042"><span class="linenos">1042</span></a>                    <span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1043"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1043"><span class="linenos">1043</span></a>                    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1044"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1044"><span class="linenos">1044</span></a>                    <span class="c1"># Verificar se  evento de trnsito manual (no do world agent)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1045"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1045"><span class="linenos">1045</span></a>                    <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1046"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1046"><span class="linenos">1046</span></a>                        <span class="c1"># Adicionar  lista de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1047"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1047"><span class="linenos">1047</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1048"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1048"><span class="linenos">1048</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1049"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1049"><span class="linenos">1049</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Manual transit event received: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1050"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1050"><span class="linenos">1050</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1051"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1051"><span class="linenos">1051</span></a>                    <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1052"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1052"><span class="linenos">1052</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1053"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1053"><span class="linenos">1053</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1054"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1054"><span class="linenos">1054</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1055"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1055"><span class="linenos">1055</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PRIMEIRO ARRIVAL RECEBIDO! Iniciando processamento da heap.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1056"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1056"><span class="linenos">1056</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1057"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1057"><span class="linenos">1057</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PRIMEIRO ARRIVAL RECEBIDO!&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1058"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1058"><span class="linenos">1058</span></a>                            
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1059"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1059"><span class="linenos">1059</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1060"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1060"><span class="linenos">1060</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1061"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1061"><span class="linenos">1061</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento ARRIVAL adicionado  lista: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1062"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1062"><span class="linenos">1062</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos de arrival: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1063"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1063"><span class="linenos">1063</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1064"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1064"><span class="linenos">1064</span></a>                        <span class="c1"># Adicionar  heap outros tipos de eventos</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1065"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1065"><span class="linenos">1065</span></a>                        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1066"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1066"><span class="linenos">1066</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1067"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1067"><span class="linenos">1067</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento recebido: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1068"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1068"><span class="linenos">1068</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1069"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1069"><span class="linenos">1069</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1070"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1070"><span class="linenos">1070</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento recebido: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1071"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1071"><span class="linenos">1071</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1072"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1072"><span class="linenos">1072</span></a>                
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1073"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1073"><span class="linenos">1073</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour-1074"><a href="#EventDrivenAgent.ReceiveEventsBehaviour-1074"><span class="linenos">1074</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Erro ao processar mensagem: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cyclic behaviour for continuous event reception from multiple sources.</p>

<p>This behaviour remains permanently active, receiving XMPP messages from
all registered agents (vehicles, warehouses, stores, suppliers, world agent)
and classifying them into different event categories. Reception is
non-blocking with 1-second timeout to allow interruptions.</p>

<p>The behaviour implements a message router pattern, directing different
event types to appropriate data structures for later processing.</p>

<h6 id="event-types-processed">Event Types Processed:</h6>

<blockquote>
  <ul>
  <li><strong>Traffic Events</strong>: Transit events from world agent (complete list)</li>
  <li><strong>Transit</strong>: Manual traffic condition change events</li>
  <li><strong>Arrival</strong>: Vehicle arrival events at nodes</li>
  <li><strong>UpdateSimulation</strong>: Traffic resimulation requests</li>
  <li><strong>Other</strong>: Generic events added to main heap</li>
  </ul>
</blockquote>

<h6 id="storage-strategy">Storage Strategy:</h6>

<blockquote>
  <ul>
  <li>Transit events  transit_events (separate list)</li>
  <li>Arrival events (time &gt; 0)  arrival_events (temporary buffer)</li>
  <li>Arrival events (time = 0)  discarded (initial signal)</li>
  <li>Other events  event_heap (min heap)</li>
  </ul>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li>Inherits attributes from CyclicBehaviour.</li>
</ul>

<h6 id="message-formats">Message Formats:</h6>

<blockquote>
  <p>Traffic Events (from world agent):
      Metadata:
          performative: "inform"
          action: "traffic_events"
      Body (JSON):
          {
              "events": [
                  {
                      "instant": float,
                      "node1_id": int,
                      "node2_id": int,
                      "new_time": float,
                      "new_fuel_consumption": float,
                  },
                  ...
              ]
          }</p>
  
  <p>Generic Events:
      Metadata:
          performative: "inform"
      Body (JSON):
          {
              "type": str,
              "time": float,
              "data": Dict[str, Any],
          }</p>
</blockquote>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Behaviour executes continuously after addition</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">receive_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReceiveEventsBehaviour</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">receive_behaviour</span><span class="p">)</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>The 1-second timeout allows the behaviour to periodically check
  if it should terminate (e.g., when agent is stopped). Received
  messages are immediately processed and classified.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Processes FIPA ACL messages with INFORM performative, acting as
  a receiver in multiple interaction protocols initiated by other agents.</p>
</blockquote>

<h6 id="warning">Warning:</h6>

<blockquote>
  <p>JSON parsing errors are caught and logged, but do not interrupt
  the behaviour. Malformed events are discarded.</p>
</blockquote>

<h6 id="see-also">See Also:</h6>

<blockquote>
  <p>ProcessEventsBehaviour: Processes stored events.
  Event: Data structure for representing events.</p>
</blockquote>
</div>


                            <div id="EventDrivenAgent.ReceiveEventsBehaviour.run" class="classattr">
                                        <input id="EventDrivenAgent.ReceiveEventsBehaviour.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EventDrivenAgent.ReceiveEventsBehaviour.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.ReceiveEventsBehaviour.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-935"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-935"><span class="linenos"> 935</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-936"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-936"><span class="linenos"> 936</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Cycle of event message reception and classification.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-937"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-937"><span class="linenos"> 937</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-938"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-938"><span class="linenos"> 938</span></a><span class="sd">            This method executes continuously, awaiting messages with 1-second</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-939"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-939"><span class="linenos"> 939</span></a><span class="sd">            timeout. When a message is received, it identifies the event type</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-940"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-940"><span class="linenos"> 940</span></a><span class="sd">            and stores it in the appropriate data structure.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-941"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-941"><span class="linenos"> 941</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-942"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-942"><span class="linenos"> 942</span></a><span class="sd">            Processing Flow:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-943"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-943"><span class="linenos"> 943</span></a><span class="sd">                1. Await message with 1s timeout</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-944"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-944"><span class="linenos"> 944</span></a><span class="sd">                2. Check if it&#39;s traffic events response from world agent</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-945"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-945"><span class="linenos"> 945</span></a><span class="sd">                3. If yes, process complete list of transit events</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-946"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-946"><span class="linenos"> 946</span></a><span class="sd">                4. If no, identify individual event type</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-947"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-947"><span class="linenos"> 947</span></a><span class="sd">                5. Store in transit_events, arrival_events, or event_heap</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-948"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-948"><span class="linenos"> 948</span></a><span class="sd">                6. Increment received events counter</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-949"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-949"><span class="linenos"> 949</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-950"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-950"><span class="linenos"> 950</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-951"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-951"><span class="linenos"> 951</span></a><span class="sd">                None: Executes continuously until behaviour is removed.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-952"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-952"><span class="linenos"> 952</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-953"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-953"><span class="linenos"> 953</span></a><span class="sd">            Raises:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-954"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-954"><span class="linenos"> 954</span></a><span class="sd">                Exception: Catches and logs parsing errors without interrupting.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-955"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-955"><span class="linenos"> 955</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-956"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-956"><span class="linenos"> 956</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-957"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-957"><span class="linenos"> 957</span></a><span class="sd">                For transit events from world agent, also creates an automatic</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-958"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-958"><span class="linenos"> 958</span></a><span class="sd">                resimulation event after world_simulation_time.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-959"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-959"><span class="linenos"> 959</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-960"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-960"><span class="linenos"> 960</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-961"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-961"><span class="linenos"> 961</span></a><span class="sd">                Receives and processes INFORM performatives from multiple agents,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-962"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-962"><span class="linenos"> 962</span></a><span class="sd">                implementing receiver role in FIPA interaction protocols.</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-963"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-963"><span class="linenos"> 963</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-964"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-964"><span class="linenos"> 964</span></a>            <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-965"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-965"><span class="linenos"> 965</span></a>            
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-966"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-966"><span class="linenos"> 966</span></a>            <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-967"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-967"><span class="linenos"> 967</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-968"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-968"><span class="linenos"> 968</span></a>                    <span class="c1"># Verificar se  resposta do world agent com eventos de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-969"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-969"><span class="linenos"> 969</span></a>                    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;inform&quot;</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;traffic_events&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-970"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-970"><span class="linenos"> 970</span></a>                        <span class="c1"># Mensagem do world agent com eventos de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-971"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-971"><span class="linenos"> 971</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-972"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-972"><span class="linenos"> 972</span></a>                        <span class="n">events</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-973"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-973"><span class="linenos"> 973</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-974"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-974"><span class="linenos"> 974</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-975"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-975"><span class="linenos"> 975</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-976"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-976"><span class="linenos"> 976</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  EVENTOS DE TRNSITO DO WORLD AGENT RECEBIDOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-977"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-977"><span class="linenos"> 977</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total de eventos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-978"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-978"><span class="linenos"> 978</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-979"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-979"><span class="linenos"> 979</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-980"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-980"><span class="linenos"> 980</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  EVENTOS DE TRNSITO DO WORLD AGENT RECEBIDOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-981"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-981"><span class="linenos"> 981</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-982"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-982"><span class="linenos"> 982</span></a>                        <span class="c1"># Processar cada evento de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-983"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-983"><span class="linenos"> 983</span></a>                        <span class="k">for</span> <span class="n">event_data</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-984"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-984"><span class="linenos"> 984</span></a>                            <span class="c1"># Criar evento de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-985"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-985"><span class="linenos"> 985</span></a>                            <span class="n">transit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-986"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-986"><span class="linenos"> 986</span></a>                                <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;Transit&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-987"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-987"><span class="linenos"> 987</span></a>                                <span class="n">time</span><span class="o">=</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instant&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-988"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-988"><span class="linenos"> 988</span></a>                                <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-989"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-989"><span class="linenos"> 989</span></a>                                    <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[{</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-990"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-990"><span class="linenos"> 990</span></a>                                        <span class="s2">&quot;node1&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node1_id&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-991"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-991"><span class="linenos"> 991</span></a>                                        <span class="s2">&quot;node2&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;node2_id&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-992"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-992"><span class="linenos"> 992</span></a>                                        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_time&quot;</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-993"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-993"><span class="linenos"> 993</span></a>                                        <span class="s2">&quot;fuel_consumption&quot;</span><span class="p">:</span> <span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;new_fuel_consumption&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-994"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-994"><span class="linenos"> 994</span></a>                                    <span class="p">}]</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-995"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-995"><span class="linenos"> 995</span></a>                                <span class="p">},</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-996"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-996"><span class="linenos"> 996</span></a>                                <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-997"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-997"><span class="linenos"> 997</span></a>                            <span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-998"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-998"><span class="linenos"> 998</span></a>                            
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-999"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-999"><span class="linenos"> 999</span></a>                            <span class="c1"># Adicionar  lista de eventos de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1000"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1000"><span class="linenos">1000</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1001"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1001"><span class="linenos">1001</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1002"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1002"><span class="linenos">1002</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Transit event added: Edge (</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node1_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node2_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">), time=</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_time&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, instant=</span><span class="si">{</span><span class="n">event_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;instant&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1003"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1003"><span class="linenos">1003</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1004"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1004"><span class="linenos">1004</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1005"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1005"><span class="linenos">1005</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Total transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1006"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1006"><span class="linenos">1006</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1007"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1007"><span class="linenos">1007</span></a>                        <span class="c1"># Criar evento para solicitar nova simulao aps world_simulation_time</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1008"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1008"><span class="linenos">1008</span></a>                        <span class="n">resimulation_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1009"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1009"><span class="linenos">1009</span></a>                            <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;updatesimulation&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1010"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1010"><span class="linenos">1010</span></a>                            <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1011"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1011"><span class="linenos">1011</span></a>                            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;request_new_simulation&quot;</span><span class="p">},</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1012"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1012"><span class="linenos">1012</span></a>                            <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1013"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1013"><span class="linenos">1013</span></a>                        <span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1014"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1014"><span class="linenos">1014</span></a>                        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">resimulation_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1015"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1015"><span class="linenos">1015</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1016"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1016"><span class="linenos">1016</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Resimulation event added to heap: </span><span class="si">{</span><span class="n">resimulation_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1017"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1017"><span class="linenos">1017</span></a>                        
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1018"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1018"><span class="linenos">1018</span></a>                        <span class="k">return</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1019"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1019"><span class="linenos">1019</span></a>                    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1020"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1020"><span class="linenos">1020</span></a>                    <span class="c1"># Processar outros eventos normalmente</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1021"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1021"><span class="linenos">1021</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1022"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1022"><span class="linenos">1022</span></a>                    <span class="n">event_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1023"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1023"><span class="linenos">1023</span></a>                    <span class="n">time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1024"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1024"><span class="linenos">1024</span></a>                    <span class="n">event_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1025"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1025"><span class="linenos">1025</span></a>                    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1026"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1026"><span class="linenos">1026</span></a>                    <span class="c1"># Debug: mostrar dados recebidos</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1027"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1027"><span class="linenos">1027</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1028"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1028"><span class="linenos">1028</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Mensagem recebida:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1029"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1029"><span class="linenos">1029</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Sender: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1030"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1030"><span class="linenos">1030</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Type: </span><span class="si">{</span><span class="n">event_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1031"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1031"><span class="linenos">1031</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Time: </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1032"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1032"><span class="linenos">1032</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Data: </span><span class="si">{</span><span class="n">event_data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1033"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1033"><span class="linenos">1033</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1034"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1034"><span class="linenos">1034</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Mensagem recebida de </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1035"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1035"><span class="linenos">1035</span></a>                    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1036"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1036"><span class="linenos">1036</span></a>                    <span class="c1"># Criar evento</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1037"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1037"><span class="linenos">1037</span></a>                    <span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1038"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1038"><span class="linenos">1038</span></a>                        <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1039"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1039"><span class="linenos">1039</span></a>                        <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1040"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1040"><span class="linenos">1040</span></a>                        <span class="n">data</span><span class="o">=</span><span class="n">event_data</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1041"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1041"><span class="linenos">1041</span></a>                        <span class="n">sender</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">),</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1042"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1042"><span class="linenos">1042</span></a>                    <span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1043"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1043"><span class="linenos">1043</span></a>                    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1044"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1044"><span class="linenos">1044</span></a>                    <span class="c1"># Verificar se  evento de trnsito manual (no do world agent)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1045"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1045"><span class="linenos">1045</span></a>                    <span class="k">if</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1046"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1046"><span class="linenos">1046</span></a>                        <span class="c1"># Adicionar  lista de trnsito</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1047"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1047"><span class="linenos">1047</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1048"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1048"><span class="linenos">1048</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1049"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1049"><span class="linenos">1049</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Manual transit event received: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1050"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1050"><span class="linenos">1050</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1051"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1051"><span class="linenos">1051</span></a>                    <span class="k">elif</span> <span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1052"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1052"><span class="linenos">1052</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1053"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1053"><span class="linenos">1053</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1054"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1054"><span class="linenos">1054</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1055"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1055"><span class="linenos">1055</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PRIMEIRO ARRIVAL RECEBIDO! Iniciando processamento da heap.&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1056"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1056"><span class="linenos">1056</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1057"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1057"><span class="linenos">1057</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PRIMEIRO ARRIVAL RECEBIDO!&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1058"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1058"><span class="linenos">1058</span></a>                            
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1059"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1059"><span class="linenos">1059</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1060"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1060"><span class="linenos">1060</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1061"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1061"><span class="linenos">1061</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento ARRIVAL adicionado  lista: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1062"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1062"><span class="linenos">1062</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos de arrival: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1063"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1063"><span class="linenos">1063</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1064"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1064"><span class="linenos">1064</span></a>                        <span class="c1"># Adicionar  heap outros tipos de eventos</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1065"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1065"><span class="linenos">1065</span></a>                        <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1066"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1066"><span class="linenos">1066</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1067"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1067"><span class="linenos">1067</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento recebido: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1068"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1068"><span class="linenos">1068</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1069"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1069"><span class="linenos">1069</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1070"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1070"><span class="linenos">1070</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento recebido: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1071"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1071"><span class="linenos">1071</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1072"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1072"><span class="linenos">1072</span></a>                
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1073"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1073"><span class="linenos">1073</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ReceiveEventsBehaviour.run-1074"><a href="#EventDrivenAgent.ReceiveEventsBehaviour.run-1074"><span class="linenos">1074</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Erro ao processar mensagem: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cycle of event message reception and classification.</p>

<p>This method executes continuously, awaiting messages with 1-second
timeout. When a message is received, it identifies the event type
and stores it in the appropriate data structure.</p>

<h6 id="processing-flow">Processing Flow:</h6>

<blockquote>
  <ol>
  <li>Await message with 1s timeout</li>
  <li>Check if it's traffic events response from world agent</li>
  <li>If yes, process complete list of transit events</li>
  <li>If no, identify individual event type</li>
  <li>Store in transit_events, arrival_events, or event_heap</li>
  <li>Increment received events counter</li>
  </ol>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None: Executes continuously until behaviour is removed.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>Exception:</strong>  Catches and logs parsing errors without interrupting.</li>
</ul>

<h6 id="note">Note:</h6>

<blockquote>
  <p>For transit events from world agent, also creates an automatic
  resimulation event after world_simulation_time.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Receives and processes INFORM performatives from multiple agents,
  implementing receiver role in FIPA interaction protocols.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="EventDrivenAgent.ProcessEventsBehaviour">
                            <input id="EventDrivenAgent.ProcessEventsBehaviour-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EventDrivenAgent.ProcessEventsBehaviour</span><wbr>(<span class="base">spade.behaviour.PeriodicBehaviour</span>):

                <label class="view-source-button" for="EventDrivenAgent.ProcessEventsBehaviour-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.ProcessEventsBehaviour"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.ProcessEventsBehaviour-1076"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1076"><span class="linenos">1076</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">ProcessEventsBehaviour</span><span class="p">(</span><span class="n">PeriodicBehaviour</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1077"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1077"><span class="linenos">1077</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Periodic behaviour responsible for temporal event processing.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1078"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1078"><span class="linenos">1078</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1079"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1079"><span class="linenos">1079</span></a><span class="sd">        This behaviour is the core of the temporal simulation system, executing at</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1080"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1080"><span class="linenos">1080</span></a><span class="sd">        regular intervals (defined by simulation_interval) to process events that</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1081"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1081"><span class="linenos">1081</span></a><span class="sd">        occur at the same temporal instant. It implements a sophisticated time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1082"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1082"><span class="linenos">1082</span></a><span class="sd">        management strategy, ensuring correct synchronization between all events</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1083"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1083"><span class="linenos">1083</span></a><span class="sd">        and agents.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1084"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1084"><span class="linenos">1084</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1085"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1085"><span class="linenos">1085</span></a><span class="sd">        The behaviour implements a discrete event simulation (DES) approach, where</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1086"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1086"><span class="linenos">1086</span></a><span class="sd">        time advances in discrete steps and all events at each time step are</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1087"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1087"><span class="linenos">1087</span></a><span class="sd">        processed simultaneously.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1088"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1088"><span class="linenos">1088</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1089"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1089"><span class="linenos">1089</span></a><span class="sd">        Processing Strategy:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1090"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1090"><span class="linenos">1090</span></a><span class="sd">            1. **Arrival Transfer**: Move arrival events from buffer to heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1091"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1091"><span class="linenos">1091</span></a><span class="sd">            2. **Transit Integration**: Reinsert transit events into heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1092"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1092"><span class="linenos">1092</span></a><span class="sd">            3. **Time Selection**: Extract first event (smallest time)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1093"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1093"><span class="linenos">1093</span></a><span class="sd">            4. **Grouping**: Collect all events with same time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1094"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1094"><span class="linenos">1094</span></a><span class="sd">            5. **Processing**: Notify relevant agents about events</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1095"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1095"><span class="linenos">1095</span></a><span class="sd">            6. **Transit Update**: Decrement time of remaining transit events</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1096"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1096"><span class="linenos">1096</span></a><span class="sd">            7. **Cleanup**: Empty heap (discard future events until next cycle)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1097"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1097"><span class="linenos">1097</span></a><span class="sd">            8. **Resimulation**: Request new simulation if needed</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1098"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1098"><span class="linenos">1098</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1099"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1099"><span class="linenos">1099</span></a><span class="sd">        Time Management:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1100"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1100"><span class="linenos">1100</span></a><span class="sd">            - Only events with time equal to first event are processed</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1101"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1101"><span class="linenos">1101</span></a><span class="sd">            - Transit events have time decremented continuously</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1102"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1102"><span class="linenos">1102</span></a><span class="sd">            - First event of each type has real time, subsequent ones time 0</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1103"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1103"><span class="linenos">1103</span></a><span class="sd">            - Avoids duplicate simulation of same temporal interval</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1104"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1104"><span class="linenos">1104</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1105"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1105"><span class="linenos">1105</span></a><span class="sd">        Attributes:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1106"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1106"><span class="linenos">1106</span></a><span class="sd">            period (float): Interval in seconds between executions (inherited from PeriodicBehaviour).</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1107"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1107"><span class="linenos">1107</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1108"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1108"><span class="linenos">1108</span></a><span class="sd">        Notification Flow:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1109"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1109"><span class="linenos">1109</span></a><span class="sd">            - Arrival events  All vehicles (grouped message)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1110"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1110"><span class="linenos">1110</span></a><span class="sd">            - Transit events  Vehicles + Warehouses + Stores</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1111"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1111"><span class="linenos">1111</span></a><span class="sd">            - UpdateSimulation events  World agent</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1112"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1112"><span class="linenos">1112</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1113"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1113"><span class="linenos">1113</span></a><span class="sd">        Examples:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1114"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1114"><span class="linenos">1114</span></a><span class="sd">            &gt;&gt;&gt; # Automatically created in setup() with configurable period</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1115"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1115"><span class="linenos">1115</span></a><span class="sd">            &gt;&gt;&gt; process_behaviour = self.ProcessEventsBehaviour(period=5.0)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1116"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1116"><span class="linenos">1116</span></a><span class="sd">            &gt;&gt;&gt; self.add_behaviour(process_behaviour)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1117"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1117"><span class="linenos">1117</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1118"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1118"><span class="linenos">1118</span></a><span class="sd">        Note:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1119"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1119"><span class="linenos">1119</span></a><span class="sd">            Emptying the heap after processing is intentional. It ensures only</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1120"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1120"><span class="linenos">1120</span></a><span class="sd">            events from the next temporal instant are considered in the next cycle,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1121"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1121"><span class="linenos">1121</span></a><span class="sd">            avoiding temporal inconsistencies.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1122"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1122"><span class="linenos">1122</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1123"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1123"><span class="linenos">1123</span></a><span class="sd">        FIPA Compliance:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1124"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1124"><span class="linenos">1124</span></a><span class="sd">            Implements FIPA Inform protocol when notifying agents of processed</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1125"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1125"><span class="linenos">1125</span></a><span class="sd">            events, acting as initiator in broadcast notification patterns.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1126"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1126"><span class="linenos">1126</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1127"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1127"><span class="linenos">1127</span></a><span class="sd">        Warning:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1128"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1128"><span class="linenos">1128</span></a><span class="sd">            If the heap is empty, the cycle is skipped. This is normal when there</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1129"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1129"><span class="linenos">1129</span></a><span class="sd">            are no pending events.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1130"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1130"><span class="linenos">1130</span></a><span class="sd">        </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1131"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1131"><span class="linenos">1131</span></a><span class="sd">        See Also:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1132"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1132"><span class="linenos">1132</span></a><span class="sd">            notify_events: Internal method to distribute processed events.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1133"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1133"><span class="linenos">1133</span></a><span class="sd">            Event: Event data structure.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1134"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1135"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1135"><span class="linenos">1135</span></a>        
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1136"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1136"><span class="linenos">1136</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1137"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1137"><span class="linenos">1137</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute one cycle of event processing.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1138"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1138"><span class="linenos">1138</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1139"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1139"><span class="linenos">1139</span></a><span class="sd">            This method is called periodically by SPADE framework at the interval</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1140"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1140"><span class="linenos">1140</span></a><span class="sd">            defined by simulation_interval. It coordinates all processing steps,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1141"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1141"><span class="linenos">1141</span></a><span class="sd">            from heap preparation to agent notification.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1142"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1142"><span class="linenos">1142</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1143"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1143"><span class="linenos">1143</span></a><span class="sd">            Detailed Steps:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1144"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1144"><span class="linenos">1144</span></a><span class="sd">                1. **Heap Preparation**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1145"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1145"><span class="linenos">1145</span></a><span class="sd">                   - Transfer arrival_events to event_heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1146"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1146"><span class="linenos">1146</span></a><span class="sd">                   - Reinsert transit_events into heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1147"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1147"><span class="linenos">1147</span></a><span class="sd">                   - Empty temporary buffers</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1148"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1148"><span class="linenos">1148</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1149"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1149"><span class="linenos">1149</span></a><span class="sd">                2. **Event Verification**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1150"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1150"><span class="linenos">1150</span></a><span class="sd">                   - If heap empty, terminate cycle</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1151"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1151"><span class="linenos">1151</span></a><span class="sd">                   - Log state for monitoring</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1152"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1152"><span class="linenos">1152</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1153"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1153"><span class="linenos">1153</span></a><span class="sd">                3. **Event Extraction**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1154"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1154"><span class="linenos">1154</span></a><span class="sd">                   - Remove first event (smallest time)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1155"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1155"><span class="linenos">1155</span></a><span class="sd">                   - Collect subsequent events with same time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1156"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1156"><span class="linenos">1156</span></a><span class="sd">                   - Create list of events to process</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1157"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1157"><span class="linenos">1157</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1158"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1158"><span class="linenos">1158</span></a><span class="sd">                4. **Transit Management**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1159"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1159"><span class="linenos">1159</span></a><span class="sd">                   - Remove transit events from separate list</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1160"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1160"><span class="linenos">1160</span></a><span class="sd">                   - Detect if last transit event was processed</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1161"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1161"><span class="linenos">1161</span></a><span class="sd">                   - Update time of remaining events</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1162"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1162"><span class="linenos">1162</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1163"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1163"><span class="linenos">1163</span></a><span class="sd">                5. **Notification**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1164"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1164"><span class="linenos">1164</span></a><span class="sd">                   - Call notify_events() to distribute to agents</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1165"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1165"><span class="linenos">1165</span></a><span class="sd">                   - Await send confirmations</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1166"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1166"><span class="linenos">1166</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1167"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1167"><span class="linenos">1167</span></a><span class="sd">                6. **Resimulation**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1168"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1168"><span class="linenos">1168</span></a><span class="sd">                   - If last transit event processed</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1169"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1169"><span class="linenos">1169</span></a><span class="sd">                   - Send new simulation request to world agent</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1170"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1170"><span class="linenos">1170</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1171"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1171"><span class="linenos">1171</span></a><span class="sd">                7. **Statistics**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1172"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1172"><span class="linenos">1172</span></a><span class="sd">                   - Update counters</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1173"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1173"><span class="linenos">1173</span></a><span class="sd">                   - Generate detailed logs if verbose=True</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1174"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1174"><span class="linenos">1174</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1175"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1175"><span class="linenos">1175</span></a><span class="sd">                8. **Cleanup**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1176"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1176"><span class="linenos">1176</span></a><span class="sd">                   - Empty event_heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1177"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1177"><span class="linenos">1177</span></a><span class="sd">                   - Prepare for next cycle</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1178"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1178"><span class="linenos">1178</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1179"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1179"><span class="linenos">1179</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1180"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1180"><span class="linenos">1180</span></a><span class="sd">                None: Executes side effects (notifications and state updates).</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1181"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1181"><span class="linenos">1181</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1182"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1182"><span class="linenos">1182</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1183"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1183"><span class="linenos">1183</span></a><span class="sd">                Decrementing transit event time ensures remaining time always</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1184"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1184"><span class="linenos">1184</span></a><span class="sd">                reflects interval until next processing. Processing only begins</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1185"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1185"><span class="linenos">1185</span></a><span class="sd">                after receiving first real arrival.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1186"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1186"><span class="linenos">1186</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1187"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1187"><span class="linenos">1187</span></a><span class="sd">            Examples:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1188"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1188"><span class="linenos">1188</span></a><span class="sd">                &gt;&gt;&gt; # Example verbose log during execution</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1189"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1189"><span class="linenos">1189</span></a><span class="sd">                [event_agent]  PROCESSING EVENTS</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1190"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1190"><span class="linenos">1190</span></a><span class="sd">                [event_agent] Simulation time: 5.0s</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1191"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1191"><span class="linenos">1191</span></a><span class="sd">                [event_agent] Events in heap: 3</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1192"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1192"><span class="linenos">1192</span></a><span class="sd">                [event_agent] Transit events: 5</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1193"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1193"><span class="linenos">1193</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1194"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1194"><span class="linenos">1194</span></a><span class="sd">                [event_agent]  Next event: Event(type=arrival, time=10.50, sender=vehicle1@localhost)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1195"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1195"><span class="linenos">1195</span></a><span class="sd">                [event_agent]  Total events with time 10.50s: 2</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1196"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1196"><span class="linenos">1196</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1197"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1197"><span class="linenos">1197</span></a><span class="sd">                [event_agent]  Notifying grouped ARRIVAL event to 3 vehicles</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1198"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1198"><span class="linenos">1198</span></a><span class="sd">                   Arrived vehicles: [&#39;vehicle1&#39;, &#39;vehicle2&#39;]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1199"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1199"><span class="linenos">1199</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1200"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1200"><span class="linenos">1200</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1201"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1201"><span class="linenos">1201</span></a><span class="sd">                Sends INFORM performatives to notify agents of processed events,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1202"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1202"><span class="linenos">1202</span></a><span class="sd">                implementing broadcast notification pattern.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1203"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1203"><span class="linenos">1203</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1204"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1204"><span class="linenos">1204</span></a>            <span class="c1"># Check if first arrival received before processing</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1205"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1205"><span class="linenos">1205</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1206"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1206"><span class="linenos">1206</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1207"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1207"><span class="linenos">1207</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Waiting for first arrival before processing heap...&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1208"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1208"><span class="linenos">1208</span></a>                <span class="k">return</span>  <span class="c1"># Don&#39;t process until first arrival received</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1209"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1209"><span class="linenos">1209</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1210"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1210"><span class="linenos">1210</span></a>            <span class="c1"># Adicionar eventos de arrival  heap e esvaziar a lista</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1211"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1211"><span class="linenos">1211</span></a>            <span class="k">for</span> <span class="n">arrival_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1212"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1212"><span class="linenos">1212</span></a>                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">arrival_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1213"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1213"><span class="linenos">1213</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1214"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1214"><span class="linenos">1214</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1215"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1215"><span class="linenos">1215</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Adicionados </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span><span class="si">}</span><span class="s2"> eventos de arrival  heap&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1216"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1216"><span class="linenos">1216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Esvaziar a lista</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1217"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1217"><span class="linenos">1217</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1218"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1218"><span class="linenos">1218</span></a>            <span class="c1"># Recolocar eventos de trnsito na heap no incio</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1219"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1219"><span class="linenos">1219</span></a>            <span class="k">for</span> <span class="n">transit_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1220"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1220"><span class="linenos">1220</span></a>                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1221"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1221"><span class="linenos">1221</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1222"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1222"><span class="linenos">1222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1223"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1223"><span class="linenos">1223</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1224"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1224"><span class="linenos">1224</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PROCESSANDO EVENTOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1225"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1225"><span class="linenos">1225</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">simulation_interval</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1226"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1226"><span class="linenos">1226</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Eventos na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1227"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1227"><span class="linenos">1227</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1228"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1228"><span class="linenos">1228</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1229"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1229"><span class="linenos">1229</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1230"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1230"><span class="linenos">1230</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1231"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1231"><span class="linenos">1231</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1232"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1232"><span class="linenos">1232</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Nenhum evento para processar</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1233"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1233"><span class="linenos">1233</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1234"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1234"><span class="linenos">1234</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1235"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1235"><span class="linenos">1235</span></a>            <span class="c1"># Tirar o primeiro evento da heap (menor tempo)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1236"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1236"><span class="linenos">1236</span></a>            <span class="n">first_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1237"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1237"><span class="linenos">1237</span></a>            <span class="n">event_time</span> <span class="o">=</span> <span class="n">first_event</span><span class="o">.</span><span class="n">time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1238"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1238"><span class="linenos">1238</span></a>            <span class="n">events_to_process</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_event</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1239"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1239"><span class="linenos">1239</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1240"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1240"><span class="linenos">1240</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Next event: </span><span class="si">{</span><span class="n">first_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1241"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1241"><span class="linenos">1241</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1242"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1242"><span class="linenos">1242</span></a>            <span class="c1"># Continuar a dar pop enquanto houver eventos com o mesmo tempo</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1243"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1243"><span class="linenos">1243</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">event_time</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1244"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1244"><span class="linenos">1244</span></a>                <span class="n">next_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1245"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1245"><span class="linenos">1245</span></a>                <span class="n">events_to_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1246"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1246"><span class="linenos">1246</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1247"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1247"><span class="linenos">1247</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento adicional (mesmo tempo): </span><span class="si">{</span><span class="n">next_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1248"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1248"><span class="linenos">1248</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1249"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1249"><span class="linenos">1249</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1250"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1250"><span class="linenos">1250</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Total de eventos com tempo </span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1251"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1251"><span class="linenos">1251</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1252"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1252"><span class="linenos">1252</span></a>            <span class="c1"># Processar remoo de eventos de trnsito da lista</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1253"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1253"><span class="linenos">1253</span></a>            <span class="n">was_last_transit_event</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1254"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1254"><span class="linenos">1254</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events_to_process</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1255"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1255"><span class="linenos">1255</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1256"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1256"><span class="linenos">1256</span></a>                    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1257"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1257"><span class="linenos">1257</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1258"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1258"><span class="linenos">1258</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1259"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1259"><span class="linenos">1259</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Transit event removed from list: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1260"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1260"><span class="linenos">1260</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1261"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1261"><span class="linenos">1261</span></a>            <span class="c1"># Verificar se era o ltimo evento de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1262"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1262"><span class="linenos">1262</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1263"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1263"><span class="linenos">1263</span></a>                <span class="c1"># Verificar se algum dos eventos processados era de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1264"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1264"><span class="linenos">1264</span></a>                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events_to_process</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1265"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1265"><span class="linenos">1265</span></a>                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1266"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1266"><span class="linenos">1266</span></a>                        <span class="n">was_last_transit_event</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1267"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1267"><span class="linenos">1267</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1268"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1268"><span class="linenos">1268</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   LTIMO EVENTO DE TRNSITO REMOVIDO!&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1269"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1269"><span class="linenos">1269</span></a>                        <span class="k">break</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1270"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1270"><span class="linenos">1270</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1271"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1271"><span class="linenos">1271</span></a>            <span class="c1"># Atualizar tempo de todos os eventos de trnsito restantes</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1272"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1272"><span class="linenos">1272</span></a>            <span class="n">updated_transit_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1273"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1273"><span class="linenos">1273</span></a>            <span class="k">for</span> <span class="n">transit_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1274"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1274"><span class="linenos">1274</span></a>                <span class="n">transit_event</span><span class="o">.</span><span class="n">time</span> <span class="o">-=</span> <span class="n">event_time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1275"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1275"><span class="linenos">1275</span></a>                <span class="n">updated_transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1276"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1276"><span class="linenos">1276</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1277"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1277"><span class="linenos">1277</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Trnsito atualizado: </span><span class="si">{</span><span class="n">transit_event</span><span class="si">}</span><span class="s2"> (tempo restante: </span><span class="si">{</span><span class="n">transit_event</span><span class="o">.</span><span class="n">time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1278"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1278"><span class="linenos">1278</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1279"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1279"><span class="linenos">1279</span></a>            <span class="c1"># Atualizar lista de eventos de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1280"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1280"><span class="linenos">1280</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span> <span class="o">=</span> <span class="n">updated_transit_events</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1281"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1281"><span class="linenos">1281</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1282"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1282"><span class="linenos">1282</span></a>            <span class="c1"># Notificar todos os veculos sobre os eventos processados (sequencialmente)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1283"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1283"><span class="linenos">1283</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_events</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1284"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1284"><span class="linenos">1284</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1285"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1285"><span class="linenos">1285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1286"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1286"><span class="linenos">1286</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1287"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1287"><span class="linenos">1287</span></a>            <span class="c1"># Se foi o ltimo evento de trnsito, solicitar nova simulao</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1288"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1288"><span class="linenos">1288</span></a>            <span class="k">if</span> <span class="n">was_last_transit_event</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1289"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1289"><span class="linenos">1289</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1290"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1290"><span class="linenos">1290</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1291"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1291"><span class="linenos">1291</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SOLICITANDO NOVA SIMULAO DE TRNSITO&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1292"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1292"><span class="linenos">1292</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Motivo: ltimo evento de trnsito processado&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1293"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1293"><span class="linenos">1293</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Destinatrio: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1294"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1294"><span class="linenos">1294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1295"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1295"><span class="linenos">1295</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1296"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1296"><span class="linenos">1296</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SOLICITANDO NOVA SIMULAO DE TRNSITO&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1297"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1297"><span class="linenos">1297</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1298"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1298"><span class="linenos">1298</span></a>                <span class="c1"># Enviar pedido de nova simulao</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1299"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1299"><span class="linenos">1299</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1300"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1300"><span class="linenos">1300</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1301"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1301"><span class="linenos">1301</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1302"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1302"><span class="linenos">1302</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1303"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1303"><span class="linenos">1303</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1304"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1304"><span class="linenos">1304</span></a>                    <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1305"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1305"><span class="linenos">1305</span></a>                    <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1306"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1306"><span class="linenos">1306</span></a>                <span class="p">}</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1307"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1307"><span class="linenos">1307</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1308"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1308"><span class="linenos">1308</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1309"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1309"><span class="linenos">1309</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1310"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1310"><span class="linenos">1310</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Pedido de nova simulao enviado</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1311"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1311"><span class="linenos">1311</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1312"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1312"><span class="linenos">1312</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Estatsticas:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1313"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1313"><span class="linenos">1313</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos processados: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1314"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1314"><span class="linenos">1314</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tipos: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">event_type</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">events_to_process</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1315"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1315"><span class="linenos">1315</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tempo dos eventos: </span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1316"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1316"><span class="linenos">1316</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Trnsitos ativos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1317"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1317"><span class="linenos">1317</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total recebido: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1318"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1318"><span class="linenos">1318</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total processado: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">processed_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1319"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1319"><span class="linenos">1319</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1320"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1320"><span class="linenos">1320</span></a>                <span class="c1"># Imprimir estado completo da heap restante</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1321"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1321"><span class="linenos">1321</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  ESTADO DA HEAP RESTANTE:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1322"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1322"><span class="linenos">1322</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1323"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1323"><span class="linenos">1323</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Heap vazia (sem eventos)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1324"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1324"><span class="linenos">1324</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1325"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1325"><span class="linenos">1325</span></a>                    <span class="c1"># Mostrar eventos normais na heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1326"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1326"><span class="linenos">1326</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1327"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1327"><span class="linenos">1327</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos normais na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1328"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1328"><span class="linenos">1328</span></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1329"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1329"><span class="linenos">1329</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1330"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1330"><span class="linenos">1330</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1331"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1331"><span class="linenos">1331</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos normais na heap: 0&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1332"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1332"><span class="linenos">1332</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1333"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1333"><span class="linenos">1333</span></a>                    <span class="c1"># Mostrar eventos de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1334"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1334"><span class="linenos">1334</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1335"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1335"><span class="linenos">1335</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos de trnsito: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1336"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1336"><span class="linenos">1336</span></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1337"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1337"><span class="linenos">1337</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1338"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1338"><span class="linenos">1338</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1339"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1339"><span class="linenos">1339</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos de trnsito: 0&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1340"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1340"><span class="linenos">1340</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1341"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1341"><span class="linenos">1341</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1342"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1342"><span class="linenos">1342</span></a>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1343"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1343"><span class="linenos">1343</span></a>            <span class="c1"># Esvaziar a heap (descartar outros eventos)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1344"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1344"><span class="linenos">1344</span></a>            <span class="n">discarded_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1345"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1345"><span class="linenos">1345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1346"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1346"><span class="linenos">1346</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1347"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1347"><span class="linenos">1347</span></a>            <span class="k">if</span> <span class="n">discarded_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1348"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1348"><span class="linenos">1348</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1349"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1349"><span class="linenos">1349</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Heap esvaziada: </span><span class="si">{</span><span class="n">discarded_count</span><span class="si">}</span><span class="s2"> eventos descartados&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1350"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1350"><span class="linenos">1350</span></a>        
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1351"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1351"><span class="linenos">1351</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">notify_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1352"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1352"><span class="linenos">1352</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1353"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1353"><span class="linenos">1353</span></a><span class="sd">            Notifica agentes apropriados sobre eventos processados com agrupamento inteligente.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1354"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1354"><span class="linenos">1354</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1355"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1355"><span class="linenos">1355</span></a><span class="sd">            Este mtodo distribui eventos aos agentes relevantes, implementando estratgias</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1356"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1356"><span class="linenos">1356</span></a><span class="sd">            de optimizao diferentes para cada tipo de evento. O agrupamento de arrivals</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1357"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1357"><span class="linenos">1357</span></a><span class="sd">            e o ajuste temporal de trnsito garantem eficincia e consistncia temporal.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1358"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1358"><span class="linenos">1358</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1359"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1359"><span class="linenos">1359</span></a><span class="sd">            Estratgias por Tipo:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1360"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1360"><span class="linenos">1360</span></a><span class="sd">                1. **Arrival Events**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1361"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1361"><span class="linenos">1361</span></a><span class="sd">                   - Agrupados numa nica mensagem por veculo</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1362"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1362"><span class="linenos">1362</span></a><span class="sd">                   - Lista de todos os veculos que chegaram includa</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1363"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1363"><span class="linenos">1363</span></a><span class="sd">                   - Enviada a TODOS os veculos registados</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1364"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1364"><span class="linenos">1364</span></a><span class="sd">                   - Apenas o tempo do primeiro arrival  usado</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1365"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1365"><span class="linenos">1365</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1366"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1366"><span class="linenos">1366</span></a><span class="sd">                2. **Transit Events**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1367"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1367"><span class="linenos">1367</span></a><span class="sd">                   - Enviados individualmente mas sequencialmente</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1368"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1368"><span class="linenos">1368</span></a><span class="sd">                   - Primeiro evento tem tempo real</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1369"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1369"><span class="linenos">1369</span></a><span class="sd">                   - Eventos subsequentes tm tempo 0 (evita resimulao)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1370"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1370"><span class="linenos">1370</span></a><span class="sd">                   - Enviados a veculos, armazns e lojas</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1371"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1371"><span class="linenos">1371</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1372"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1372"><span class="linenos">1372</span></a><span class="sd">                3. **UpdateSimulation Events**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1373"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1373"><span class="linenos">1373</span></a><span class="sd">                   - Enviados apenas ao world agent</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1374"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1374"><span class="linenos">1374</span></a><span class="sd">                   - Solicita nova simulao de trfego</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1375"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1375"><span class="linenos">1375</span></a><span class="sd">                   - Usa tempo configurado em world_simulation_time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1376"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1376"><span class="linenos">1376</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1377"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1377"><span class="linenos">1377</span></a><span class="sd">            Args:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1378"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1378"><span class="linenos">1378</span></a><span class="sd">                events (List[Event]): Lista de eventos a notificar. Podem ser de tipos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1379"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1379"><span class="linenos">1379</span></a><span class="sd">                    mistos. O mtodo classifica e processa cada tipo adequadamente.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1380"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1380"><span class="linenos">1380</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1381"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1381"><span class="linenos">1381</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1382"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1382"><span class="linenos">1382</span></a><span class="sd">                None: Executa efeitos colaterais (envio de mensagens XMPP).</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1383"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1383"><span class="linenos">1383</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1384"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1384"><span class="linenos">1384</span></a><span class="sd">            Message Formats:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1385"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1385"><span class="linenos">1385</span></a><span class="sd">                Arrival (agrupado):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1386"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1386"><span class="linenos">1386</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1387"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1387"><span class="linenos">1387</span></a><span class="sd">                        &quot;type&quot;: &quot;arrival&quot;,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1388"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1388"><span class="linenos">1388</span></a><span class="sd">                        &quot;time&quot;: float,              # Tempo do primeiro arrival</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1389"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1389"><span class="linenos">1389</span></a><span class="sd">                        &quot;vehicles&quot;: List[str]       # Lista de nomes de veculos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1390"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1390"><span class="linenos">1390</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1391"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1391"><span class="linenos">1391</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1392"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1392"><span class="linenos">1392</span></a><span class="sd">                Transit (individual):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1393"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1393"><span class="linenos">1393</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1394"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1394"><span class="linenos">1394</span></a><span class="sd">                        &quot;type&quot;: &quot;Transit&quot;,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1395"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1395"><span class="linenos">1395</span></a><span class="sd">                        &quot;time&quot;: float,              # Real para primeiro, 0 para restantes</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1396"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1396"><span class="linenos">1396</span></a><span class="sd">                        &quot;data&quot;: {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1397"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1397"><span class="linenos">1397</span></a><span class="sd">                            &quot;edges&quot;: [</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1398"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1398"><span class="linenos">1398</span></a><span class="sd">                                {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1399"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1399"><span class="linenos">1399</span></a><span class="sd">                                    &quot;node1&quot;: int,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1400"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1400"><span class="linenos">1400</span></a><span class="sd">                                    &quot;node2&quot;: int,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1401"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1401"><span class="linenos">1401</span></a><span class="sd">                                    &quot;weight&quot;: float,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1402"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1402"><span class="linenos">1402</span></a><span class="sd">                                    &quot;fuel_consumption&quot;: float</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1403"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1403"><span class="linenos">1403</span></a><span class="sd">                                }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1404"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1404"><span class="linenos">1404</span></a><span class="sd">                            ]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1405"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1405"><span class="linenos">1405</span></a><span class="sd">                        }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1406"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1406"><span class="linenos">1406</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1407"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1407"><span class="linenos">1407</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1408"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1408"><span class="linenos">1408</span></a><span class="sd">                UpdateSimulation:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1409"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1409"><span class="linenos">1409</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1410"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1410"><span class="linenos">1410</span></a><span class="sd">                        &quot;simulation_time&quot;: float,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1411"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1411"><span class="linenos">1411</span></a><span class="sd">                        &quot;requester&quot;: str            # JID do event agent</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1412"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1412"><span class="linenos">1412</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1413"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1413"><span class="linenos">1413</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1414"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1414"><span class="linenos">1414</span></a><span class="sd">            Examples:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1415"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1415"><span class="linenos">1415</span></a><span class="sd">                &gt;&gt;&gt; # Processar lista mista de eventos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1416"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1416"><span class="linenos">1416</span></a><span class="sd">                &gt;&gt;&gt; events = [</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1417"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1417"><span class="linenos">1417</span></a><span class="sd">                ...     Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle1@localhost&quot;),</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1418"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1418"><span class="linenos">1418</span></a><span class="sd">                ...     Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle2@localhost&quot;),</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1419"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1419"><span class="linenos">1419</span></a><span class="sd">                ...     Event(&quot;transit&quot;, 10.5, {&quot;edges&quot;: [...]})</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1420"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1420"><span class="linenos">1420</span></a><span class="sd">                ... ]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1421"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1421"><span class="linenos">1421</span></a><span class="sd">                &gt;&gt;&gt; await self.notify_events(events)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1422"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1422"><span class="linenos">1422</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1423"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1423"><span class="linenos">1423</span></a><span class="sd">                # Resultado:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1424"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1424"><span class="linenos">1424</span></a><span class="sd">                # - 1 mensagem de arrival para cada veculo registado (lista agrupada)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1425"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1425"><span class="linenos">1425</span></a><span class="sd">                # - 1 mensagem de transit para veculos + armazns + lojas</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1426"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1426"><span class="linenos">1426</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1427"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1427"><span class="linenos">1427</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1428"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1428"><span class="linenos">1428</span></a><span class="sd">                O ajuste de tempo para 0 em eventos subsequentes  crucial para evitar</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1429"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1429"><span class="linenos">1429</span></a><span class="sd">                que mltiplos eventos causem simulaes repetidas do mesmo intervalo</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1430"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1430"><span class="linenos">1430</span></a><span class="sd">                temporal nos agentes receptores.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1431"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1431"><span class="linenos">1431</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1432"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1432"><span class="linenos">1432</span></a><span class="sd">            Warning:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1433"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1433"><span class="linenos">1433</span></a><span class="sd">                Se world_agent no estiver configurado, eventos de updatesimulation</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1434"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1434"><span class="linenos">1434</span></a><span class="sd">                so ignorados silenciosamente com log de aviso.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1435"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1435"><span class="linenos">1435</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1436"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1436"><span class="linenos">1436</span></a><span class="sd">            See Also:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1437"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1437"><span class="linenos">1437</span></a><span class="sd">                Event.to_dict(): Serializao de eventos para mensagens.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1438"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1438"><span class="linenos">1438</span></a><span class="sd">                ProcessEventsBehaviour.run(): Mtodo que invoca notify_events.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1439"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1439"><span class="linenos">1439</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1440"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1440"><span class="linenos">1440</span></a>            <span class="c1"># Agrupar eventos por tipo</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1441"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1441"><span class="linenos">1441</span></a>            <span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1442"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1442"><span class="linenos">1442</span></a>            <span class="n">transit_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1443"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1443"><span class="linenos">1443</span></a>            <span class="n">other_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1444"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1444"><span class="linenos">1444</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1445"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1445"><span class="linenos">1445</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1446"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1446"><span class="linenos">1446</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1447"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1447"><span class="linenos">1447</span></a>                    <span class="n">arrival_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1448"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1448"><span class="linenos">1448</span></a>                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1449"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1449"><span class="linenos">1449</span></a>                    <span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1450"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1450"><span class="linenos">1450</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1451"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1451"><span class="linenos">1451</span></a>                    <span class="n">other_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1452"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1452"><span class="linenos">1452</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1453"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1453"><span class="linenos">1453</span></a>            <span class="c1"># Processar eventos de arrival agrupados</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1454"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1454"><span class="linenos">1454</span></a>            <span class="k">if</span> <span class="n">arrival_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1455"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1455"><span class="linenos">1455</span></a>                <span class="c1"># Coletar todos os nomes de veculos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1456"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1456"><span class="linenos">1456</span></a>                <span class="n">vehicle_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">arrival_events</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1457"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1457"><span class="linenos">1457</span></a>                <span class="c1"># Tempo  do primeiro evento</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1458"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1458"><span class="linenos">1458</span></a>                <span class="n">event_time</span> <span class="o">=</span> <span class="n">arrival_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1459"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1459"><span class="linenos">1459</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1460"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1460"><span class="linenos">1460</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1461"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1461"><span class="linenos">1461</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento ARRIVAL agrupado para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> veculos&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1462"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1462"><span class="linenos">1462</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Veculos que chegaram: </span><span class="si">{</span><span class="n">vehicle_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1463"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1463"><span class="linenos">1463</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1464"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1464"><span class="linenos">1464</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento ARRIVAL agrupado para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> veculos&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1465"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1465"><span class="linenos">1465</span></a>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1466"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1466"><span class="linenos">1466</span></a>                <span class="c1"># Enviar uma nica mensagem para todos os veculos registrados</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1467"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1467"><span class="linenos">1467</span></a>                <span class="n">recipients</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> 
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1468"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1468"><span class="linenos">1468</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1469"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1469"><span class="linenos">1469</span></a>                            <span class="p">)</span> <span class="c1"># TODO + self.agent.registered_warehouses + self.agent.registered_suppliers</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1470"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1470"><span class="linenos">1470</span></a>                <span class="k">for</span> <span class="n">recipient_jid</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1471"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1471"><span class="linenos">1471</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">recipient_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1472"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1472"><span class="linenos">1472</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1473"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1473"><span class="linenos">1473</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arrival&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1474"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1474"><span class="linenos">1474</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1475"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1475"><span class="linenos">1475</span></a>                    <span class="c1"># Criar mensagem com lista de veculos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1476"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1476"><span class="linenos">1476</span></a>                    <span class="n">event_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1477"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1477"><span class="linenos">1477</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1478"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1478"><span class="linenos">1478</span></a>                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">event_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1479"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1479"><span class="linenos">1479</span></a>                        <span class="s2">&quot;vehicles&quot;</span><span class="p">:</span> <span class="n">vehicle_names</span>  <span class="c1"># Lista de veculos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1480"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1480"><span class="linenos">1480</span></a>                    <span class="p">}</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1481"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1481"><span class="linenos">1481</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1482"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1482"><span class="linenos">1482</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1483"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1483"><span class="linenos">1483</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1484"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1484"><span class="linenos">1484</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1485"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1485"><span class="linenos">1485</span></a>                    <span class="n">recipient_name</span> <span class="o">=</span> <span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1486"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1486"><span class="linenos">1486</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1487"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1487"><span class="linenos">1487</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1488"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1488"><span class="linenos">1488</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    </span><span class="si">{</span><span class="n">recipient_name</span><span class="si">}</span><span class="s2">: arrival (vehicles=</span><span class="si">{</span><span class="n">vehicle_names</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1489"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1489"><span class="linenos">1489</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1490"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1490"><span class="linenos">1490</span></a>            <span class="c1"># Processar eventos de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1491"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1491"><span class="linenos">1491</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transit_events</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1492"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1492"><span class="linenos">1492</span></a>                <span class="n">recipients</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> 
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1493"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1493"><span class="linenos">1493</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1494"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1494"><span class="linenos">1494</span></a>                            <span class="p">)</span> <span class="c1"># TODO + self.agent.registered_warehouses + self.agent.registered_suppliers</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1495"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1495"><span class="linenos">1495</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1496"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1496"><span class="linenos">1496</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento TRANSIT para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">recipients</span><span class="p">)</span><span class="si">}</span><span class="s2"> agentes&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1497"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1497"><span class="linenos">1497</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1498"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1498"><span class="linenos">1498</span></a>                <span class="k">for</span> <span class="n">recipient_jid</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1499"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1499"><span class="linenos">1499</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">recipient_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1500"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1500"><span class="linenos">1500</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1501"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1501"><span class="linenos">1501</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1502"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1502"><span class="linenos">1502</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1503"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1503"><span class="linenos">1503</span></a>                    <span class="n">event_dict</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1504"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1504"><span class="linenos">1504</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1505"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1505"><span class="linenos">1505</span></a>                    <span class="c1"># Apenas o primeiro evento tem o tempo real</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1506"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1506"><span class="linenos">1506</span></a>                    <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1507"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1507"><span class="linenos">1507</span></a>                        <span class="n">original_time</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1508"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1508"><span class="linenos">1508</span></a>                        <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1509"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1509"><span class="linenos">1509</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1510"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1510"><span class="linenos">1510</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Ajustando tempo do evento Transit para 0 (original=</span><span class="si">{</span><span class="n">original_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s) para </span><span class="si">{</span><span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1511"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1511"><span class="linenos">1511</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1512"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1512"><span class="linenos">1512</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1513"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1513"><span class="linenos">1513</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1514"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1514"><span class="linenos">1514</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1515"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1515"><span class="linenos">1515</span></a>                    <span class="n">recipient_name</span> <span class="o">=</span> <span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1516"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1516"><span class="linenos">1516</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1517"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1517"><span class="linenos">1517</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    </span><span class="si">{</span><span class="n">recipient_name</span><span class="si">}</span><span class="s2">: Transit (time=</span><span class="si">{</span><span class="n">event_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1518"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1518"><span class="linenos">1518</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1519"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1519"><span class="linenos">1519</span></a>            <span class="c1"># Processar outros eventos (updatesimulation, etc)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1520"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1520"><span class="linenos">1520</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">other_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1521"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1521"><span class="linenos">1521</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;updatesimulation&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1522"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1522"><span class="linenos">1522</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1523"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1523"><span class="linenos">1523</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1524"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1524"><span class="linenos">1524</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Processando evento UPDATESIMULATION - Solicitando nova simulao&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1525"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1525"><span class="linenos">1525</span></a>                        
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1526"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1526"><span class="linenos">1526</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1527"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1527"><span class="linenos">1527</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1528"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1528"><span class="linenos">1528</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1529"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1529"><span class="linenos">1529</span></a>                        
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1530"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1530"><span class="linenos">1530</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1531"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1531"><span class="linenos">1531</span></a>                            <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1532"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1532"><span class="linenos">1532</span></a>                            <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1533"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1533"><span class="linenos">1533</span></a>                        <span class="p">}</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1534"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1534"><span class="linenos">1534</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1535"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1535"><span class="linenos">1535</span></a>                        
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1536"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1536"><span class="linenos">1536</span></a>                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1537"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1537"><span class="linenos">1537</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    Pedido de re-simulao enviado ao world agent&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1538"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1538"><span class="linenos">1538</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour-1539"><a href="#EventDrivenAgent.ProcessEventsBehaviour-1539"><span class="linenos">1539</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Agente do mundo no registrado, evento ignorado&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Periodic behaviour responsible for temporal event processing.</p>

<p>This behaviour is the core of the temporal simulation system, executing at
regular intervals (defined by simulation_interval) to process events that
occur at the same temporal instant. It implements a sophisticated time
management strategy, ensuring correct synchronization between all events
and agents.</p>

<p>The behaviour implements a discrete event simulation (DES) approach, where
time advances in discrete steps and all events at each time step are
processed simultaneously.</p>

<h6 id="processing-strategy">Processing Strategy:</h6>

<blockquote>
  <ol>
  <li><strong>Arrival Transfer</strong>: Move arrival events from buffer to heap</li>
  <li><strong>Transit Integration</strong>: Reinsert transit events into heap</li>
  <li><strong>Time Selection</strong>: Extract first event (smallest time)</li>
  <li><strong>Grouping</strong>: Collect all events with same time</li>
  <li><strong>Processing</strong>: Notify relevant agents about events</li>
  <li><strong>Transit Update</strong>: Decrement time of remaining transit events</li>
  <li><strong>Cleanup</strong>: Empty heap (discard future events until next cycle)</li>
  <li><strong>Resimulation</strong>: Request new simulation if needed</li>
  </ol>
</blockquote>

<h6 id="time-management">Time Management:</h6>

<blockquote>
  <ul>
  <li>Only events with time equal to first event are processed</li>
  <li>Transit events have time decremented continuously</li>
  <li>First event of each type has real time, subsequent ones time 0</li>
  <li>Avoids duplicate simulation of same temporal interval</li>
  </ul>
</blockquote>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>period (float):</strong>  Interval in seconds between executions (inherited from PeriodicBehaviour).</li>
</ul>

<h6 id="notification-flow">Notification Flow:</h6>

<blockquote>
  <ul>
  <li>Arrival events  All vehicles (grouped message)</li>
  <li>Transit events  Vehicles + Warehouses + Stores</li>
  <li>UpdateSimulation events  World agent</li>
  </ul>
</blockquote>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Automatically created in setup() with configurable period</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">process_behaviour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ProcessEventsBehaviour</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">add_behaviour</span><span class="p">(</span><span class="n">process_behaviour</span><span class="p">)</span>
</code></pre>
  </div>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Emptying the heap after processing is intentional. It ensures only
  events from the next temporal instant are considered in the next cycle,
  avoiding temporal inconsistencies.</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Implements FIPA Inform protocol when notifying agents of processed
  events, acting as initiator in broadcast notification patterns.</p>
</blockquote>

<h6 id="warning">Warning:</h6>

<blockquote>
  <p>If the heap is empty, the cycle is skipped. This is normal when there
  are no pending events.</p>
</blockquote>

<h6 id="see-also">See Also:</h6>

<blockquote>
  <p>notify_events: Internal method to distribute processed events.
  Event: Event data structure.</p>
</blockquote>
</div>


                            <div id="EventDrivenAgent.ProcessEventsBehaviour.run" class="classattr">
                                        <input id="EventDrivenAgent.ProcessEventsBehaviour.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EventDrivenAgent.ProcessEventsBehaviour.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.ProcessEventsBehaviour.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1136"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1136"><span class="linenos">1136</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1137"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1137"><span class="linenos">1137</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Execute one cycle of event processing.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1138"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1138"><span class="linenos">1138</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1139"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1139"><span class="linenos">1139</span></a><span class="sd">            This method is called periodically by SPADE framework at the interval</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1140"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1140"><span class="linenos">1140</span></a><span class="sd">            defined by simulation_interval. It coordinates all processing steps,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1141"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1141"><span class="linenos">1141</span></a><span class="sd">            from heap preparation to agent notification.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1142"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1142"><span class="linenos">1142</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1143"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1143"><span class="linenos">1143</span></a><span class="sd">            Detailed Steps:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1144"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1144"><span class="linenos">1144</span></a><span class="sd">                1. **Heap Preparation**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1145"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1145"><span class="linenos">1145</span></a><span class="sd">                   - Transfer arrival_events to event_heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1146"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1146"><span class="linenos">1146</span></a><span class="sd">                   - Reinsert transit_events into heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1147"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1147"><span class="linenos">1147</span></a><span class="sd">                   - Empty temporary buffers</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1148"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1148"><span class="linenos">1148</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1149"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1149"><span class="linenos">1149</span></a><span class="sd">                2. **Event Verification**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1150"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1150"><span class="linenos">1150</span></a><span class="sd">                   - If heap empty, terminate cycle</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1151"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1151"><span class="linenos">1151</span></a><span class="sd">                   - Log state for monitoring</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1152"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1152"><span class="linenos">1152</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1153"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1153"><span class="linenos">1153</span></a><span class="sd">                3. **Event Extraction**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1154"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1154"><span class="linenos">1154</span></a><span class="sd">                   - Remove first event (smallest time)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1155"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1155"><span class="linenos">1155</span></a><span class="sd">                   - Collect subsequent events with same time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1156"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1156"><span class="linenos">1156</span></a><span class="sd">                   - Create list of events to process</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1157"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1157"><span class="linenos">1157</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1158"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1158"><span class="linenos">1158</span></a><span class="sd">                4. **Transit Management**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1159"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1159"><span class="linenos">1159</span></a><span class="sd">                   - Remove transit events from separate list</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1160"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1160"><span class="linenos">1160</span></a><span class="sd">                   - Detect if last transit event was processed</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1161"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1161"><span class="linenos">1161</span></a><span class="sd">                   - Update time of remaining events</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1162"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1162"><span class="linenos">1162</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1163"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1163"><span class="linenos">1163</span></a><span class="sd">                5. **Notification**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1164"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1164"><span class="linenos">1164</span></a><span class="sd">                   - Call notify_events() to distribute to agents</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1165"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1165"><span class="linenos">1165</span></a><span class="sd">                   - Await send confirmations</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1166"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1166"><span class="linenos">1166</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1167"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1167"><span class="linenos">1167</span></a><span class="sd">                6. **Resimulation**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1168"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1168"><span class="linenos">1168</span></a><span class="sd">                   - If last transit event processed</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1169"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1169"><span class="linenos">1169</span></a><span class="sd">                   - Send new simulation request to world agent</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1170"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1170"><span class="linenos">1170</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1171"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1171"><span class="linenos">1171</span></a><span class="sd">                7. **Statistics**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1172"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1172"><span class="linenos">1172</span></a><span class="sd">                   - Update counters</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1173"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1173"><span class="linenos">1173</span></a><span class="sd">                   - Generate detailed logs if verbose=True</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1174"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1174"><span class="linenos">1174</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1175"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1175"><span class="linenos">1175</span></a><span class="sd">                8. **Cleanup**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1176"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1176"><span class="linenos">1176</span></a><span class="sd">                   - Empty event_heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1177"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1177"><span class="linenos">1177</span></a><span class="sd">                   - Prepare for next cycle</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1178"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1178"><span class="linenos">1178</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1179"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1179"><span class="linenos">1179</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1180"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1180"><span class="linenos">1180</span></a><span class="sd">                None: Executes side effects (notifications and state updates).</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1181"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1181"><span class="linenos">1181</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1182"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1182"><span class="linenos">1182</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1183"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1183"><span class="linenos">1183</span></a><span class="sd">                Decrementing transit event time ensures remaining time always</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1184"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1184"><span class="linenos">1184</span></a><span class="sd">                reflects interval until next processing. Processing only begins</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1185"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1185"><span class="linenos">1185</span></a><span class="sd">                after receiving first real arrival.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1186"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1186"><span class="linenos">1186</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1187"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1187"><span class="linenos">1187</span></a><span class="sd">            Examples:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1188"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1188"><span class="linenos">1188</span></a><span class="sd">                &gt;&gt;&gt; # Example verbose log during execution</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1189"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1189"><span class="linenos">1189</span></a><span class="sd">                [event_agent]  PROCESSING EVENTS</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1190"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1190"><span class="linenos">1190</span></a><span class="sd">                [event_agent] Simulation time: 5.0s</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1191"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1191"><span class="linenos">1191</span></a><span class="sd">                [event_agent] Events in heap: 3</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1192"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1192"><span class="linenos">1192</span></a><span class="sd">                [event_agent] Transit events: 5</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1193"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1193"><span class="linenos">1193</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1194"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1194"><span class="linenos">1194</span></a><span class="sd">                [event_agent]  Next event: Event(type=arrival, time=10.50, sender=vehicle1@localhost)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1195"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1195"><span class="linenos">1195</span></a><span class="sd">                [event_agent]  Total events with time 10.50s: 2</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1196"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1196"><span class="linenos">1196</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1197"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1197"><span class="linenos">1197</span></a><span class="sd">                [event_agent]  Notifying grouped ARRIVAL event to 3 vehicles</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1198"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1198"><span class="linenos">1198</span></a><span class="sd">                   Arrived vehicles: [&#39;vehicle1&#39;, &#39;vehicle2&#39;]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1199"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1199"><span class="linenos">1199</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1200"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1200"><span class="linenos">1200</span></a><span class="sd">            FIPA Compliance:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1201"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1201"><span class="linenos">1201</span></a><span class="sd">                Sends INFORM performatives to notify agents of processed events,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1202"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1202"><span class="linenos">1202</span></a><span class="sd">                implementing broadcast notification pattern.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1203"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1203"><span class="linenos">1203</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1204"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1204"><span class="linenos">1204</span></a>            <span class="c1"># Check if first arrival received before processing</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1205"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1205"><span class="linenos">1205</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">first_arrival_received</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1206"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1206"><span class="linenos">1206</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1207"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1207"><span class="linenos">1207</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Waiting for first arrival before processing heap...&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1208"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1208"><span class="linenos">1208</span></a>                <span class="k">return</span>  <span class="c1"># Don&#39;t process until first arrival received</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1209"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1209"><span class="linenos">1209</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1210"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1210"><span class="linenos">1210</span></a>            <span class="c1"># Adicionar eventos de arrival  heap e esvaziar a lista</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1211"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1211"><span class="linenos">1211</span></a>            <span class="k">for</span> <span class="n">arrival_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1212"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1212"><span class="linenos">1212</span></a>                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">arrival_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1213"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1213"><span class="linenos">1213</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1214"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1214"><span class="linenos">1214</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1215"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1215"><span class="linenos">1215</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Adicionados </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span><span class="p">)</span><span class="si">}</span><span class="s2"> eventos de arrival  heap&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1216"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1216"><span class="linenos">1216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Esvaziar a lista</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1217"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1217"><span class="linenos">1217</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1218"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1218"><span class="linenos">1218</span></a>            <span class="c1"># Recolocar eventos de trnsito na heap no incio</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1219"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1219"><span class="linenos">1219</span></a>            <span class="k">for</span> <span class="n">transit_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1220"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1220"><span class="linenos">1220</span></a>                <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">,</span> <span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1221"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1221"><span class="linenos">1221</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1222"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1222"><span class="linenos">1222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1223"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1223"><span class="linenos">1223</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1224"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1224"><span class="linenos">1224</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  PROCESSANDO EVENTOS&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1225"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1225"><span class="linenos">1225</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Simulation time: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">simulation_interval</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1226"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1226"><span class="linenos">1226</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Eventos na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1227"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1227"><span class="linenos">1227</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">] Transit events: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1228"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1228"><span class="linenos">1228</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1229"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1229"><span class="linenos">1229</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1230"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1230"><span class="linenos">1230</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1231"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1231"><span class="linenos">1231</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1232"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1232"><span class="linenos">1232</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Nenhum evento para processar</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1233"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1233"><span class="linenos">1233</span></a>                <span class="k">return</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1234"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1234"><span class="linenos">1234</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1235"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1235"><span class="linenos">1235</span></a>            <span class="c1"># Tirar o primeiro evento da heap (menor tempo)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1236"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1236"><span class="linenos">1236</span></a>            <span class="n">first_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1237"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1237"><span class="linenos">1237</span></a>            <span class="n">event_time</span> <span class="o">=</span> <span class="n">first_event</span><span class="o">.</span><span class="n">time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1238"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1238"><span class="linenos">1238</span></a>            <span class="n">events_to_process</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_event</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1239"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1239"><span class="linenos">1239</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1240"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1240"><span class="linenos">1240</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Next event: </span><span class="si">{</span><span class="n">first_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1241"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1241"><span class="linenos">1241</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1242"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1242"><span class="linenos">1242</span></a>            <span class="c1"># Continuar a dar pop enquanto houver eventos com o mesmo tempo</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1243"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1243"><span class="linenos">1243</span></a>            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">event_time</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1244"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1244"><span class="linenos">1244</span></a>                <span class="n">next_event</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1245"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1245"><span class="linenos">1245</span></a>                <span class="n">events_to_process</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1246"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1246"><span class="linenos">1246</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1247"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1247"><span class="linenos">1247</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Evento adicional (mesmo tempo): </span><span class="si">{</span><span class="n">next_event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1248"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1248"><span class="linenos">1248</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1249"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1249"><span class="linenos">1249</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1250"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1250"><span class="linenos">1250</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Total de eventos com tempo </span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1251"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1251"><span class="linenos">1251</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1252"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1252"><span class="linenos">1252</span></a>            <span class="c1"># Processar remoo de eventos de trnsito da lista</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1253"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1253"><span class="linenos">1253</span></a>            <span class="n">was_last_transit_event</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1254"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1254"><span class="linenos">1254</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events_to_process</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1255"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1255"><span class="linenos">1255</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1256"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1256"><span class="linenos">1256</span></a>                    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1257"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1257"><span class="linenos">1257</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1258"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1258"><span class="linenos">1258</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1259"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1259"><span class="linenos">1259</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Transit event removed from list: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1260"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1260"><span class="linenos">1260</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1261"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1261"><span class="linenos">1261</span></a>            <span class="c1"># Verificar se era o ltimo evento de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1262"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1262"><span class="linenos">1262</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1263"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1263"><span class="linenos">1263</span></a>                <span class="c1"># Verificar se algum dos eventos processados era de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1264"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1264"><span class="linenos">1264</span></a>                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events_to_process</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1265"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1265"><span class="linenos">1265</span></a>                    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1266"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1266"><span class="linenos">1266</span></a>                        <span class="n">was_last_transit_event</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1267"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1267"><span class="linenos">1267</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1268"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1268"><span class="linenos">1268</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   LTIMO EVENTO DE TRNSITO REMOVIDO!&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1269"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1269"><span class="linenos">1269</span></a>                        <span class="k">break</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1270"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1270"><span class="linenos">1270</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1271"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1271"><span class="linenos">1271</span></a>            <span class="c1"># Atualizar tempo de todos os eventos de trnsito restantes</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1272"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1272"><span class="linenos">1272</span></a>            <span class="n">updated_transit_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1273"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1273"><span class="linenos">1273</span></a>            <span class="k">for</span> <span class="n">transit_event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1274"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1274"><span class="linenos">1274</span></a>                <span class="n">transit_event</span><span class="o">.</span><span class="n">time</span> <span class="o">-=</span> <span class="n">event_time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1275"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1275"><span class="linenos">1275</span></a>                <span class="n">updated_transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transit_event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1276"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1276"><span class="linenos">1276</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1277"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1277"><span class="linenos">1277</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Trnsito atualizado: </span><span class="si">{</span><span class="n">transit_event</span><span class="si">}</span><span class="s2"> (tempo restante: </span><span class="si">{</span><span class="n">transit_event</span><span class="o">.</span><span class="n">time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1278"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1278"><span class="linenos">1278</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1279"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1279"><span class="linenos">1279</span></a>            <span class="c1"># Atualizar lista de eventos de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1280"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1280"><span class="linenos">1280</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span> <span class="o">=</span> <span class="n">updated_transit_events</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1281"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1281"><span class="linenos">1281</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1282"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1282"><span class="linenos">1282</span></a>            <span class="c1"># Notificar todos os veculos sobre os eventos processados (sequencialmente)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1283"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1283"><span class="linenos">1283</span></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_events</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1284"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1284"><span class="linenos">1284</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1285"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1285"><span class="linenos">1285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">processed_count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1286"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1286"><span class="linenos">1286</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1287"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1287"><span class="linenos">1287</span></a>            <span class="c1"># Se foi o ltimo evento de trnsito, solicitar nova simulao</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1288"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1288"><span class="linenos">1288</span></a>            <span class="k">if</span> <span class="n">was_last_transit_event</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1289"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1289"><span class="linenos">1289</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1290"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1290"><span class="linenos">1290</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1291"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1291"><span class="linenos">1291</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SOLICITANDO NOVA SIMULAO DE TRNSITO&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1292"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1292"><span class="linenos">1292</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Motivo: ltimo evento de trnsito processado&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1293"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1293"><span class="linenos">1293</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Destinatrio: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1294"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1294"><span class="linenos">1294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1295"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1295"><span class="linenos">1295</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1296"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1296"><span class="linenos">1296</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  SOLICITANDO NOVA SIMULAO DE TRNSITO&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1297"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1297"><span class="linenos">1297</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1298"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1298"><span class="linenos">1298</span></a>                <span class="c1"># Enviar pedido de nova simulao</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1299"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1299"><span class="linenos">1299</span></a>                <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1300"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1300"><span class="linenos">1300</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1301"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1301"><span class="linenos">1301</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1302"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1302"><span class="linenos">1302</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1303"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1303"><span class="linenos">1303</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1304"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1304"><span class="linenos">1304</span></a>                    <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1305"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1305"><span class="linenos">1305</span></a>                    <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1306"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1306"><span class="linenos">1306</span></a>                <span class="p">}</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1307"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1307"><span class="linenos">1307</span></a>                <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1308"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1308"><span class="linenos">1308</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1309"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1309"><span class="linenos">1309</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1310"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1310"><span class="linenos">1310</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Pedido de nova simulao enviado</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1311"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1311"><span class="linenos">1311</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1312"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1312"><span class="linenos">1312</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Estatsticas:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1313"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1313"><span class="linenos">1313</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Eventos processados: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events_to_process</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1314"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1314"><span class="linenos">1314</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tipos: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">event_type</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">events_to_process</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1315"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1315"><span class="linenos">1315</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Tempo dos eventos: </span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1316"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1316"><span class="linenos">1316</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Trnsitos ativos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1317"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1317"><span class="linenos">1317</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total recebido: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1318"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1318"><span class="linenos">1318</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Total processado: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">processed_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1319"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1319"><span class="linenos">1319</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1320"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1320"><span class="linenos">1320</span></a>                <span class="c1"># Imprimir estado completo da heap restante</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1321"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1321"><span class="linenos">1321</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  ESTADO DA HEAP RESTANTE:&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1322"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1322"><span class="linenos">1322</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1323"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1323"><span class="linenos">1323</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Heap vazia (sem eventos)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1324"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1324"><span class="linenos">1324</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1325"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1325"><span class="linenos">1325</span></a>                    <span class="c1"># Mostrar eventos normais na heap</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1326"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1326"><span class="linenos">1326</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1327"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1327"><span class="linenos">1327</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos normais na heap: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1328"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1328"><span class="linenos">1328</span></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1329"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1329"><span class="linenos">1329</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1330"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1330"><span class="linenos">1330</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1331"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1331"><span class="linenos">1331</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos normais na heap: 0&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1332"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1332"><span class="linenos">1332</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1333"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1333"><span class="linenos">1333</span></a>                    <span class="c1"># Mostrar eventos de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1334"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1334"><span class="linenos">1334</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1335"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1335"><span class="linenos">1335</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos de trnsito: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1336"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1336"><span class="linenos">1336</span></a>                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">transit_events</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1337"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1337"><span class="linenos">1337</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1338"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1338"><span class="linenos">1338</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1339"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1339"><span class="linenos">1339</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Eventos de trnsito: 0&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1340"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1340"><span class="linenos">1340</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1341"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1341"><span class="linenos">1341</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">70</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1342"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1342"><span class="linenos">1342</span></a>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1343"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1343"><span class="linenos">1343</span></a>            <span class="c1"># Esvaziar a heap (descartar outros eventos)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1344"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1344"><span class="linenos">1344</span></a>            <span class="n">discarded_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1345"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1345"><span class="linenos">1345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">event_heap</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1346"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1346"><span class="linenos">1346</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1347"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1347"><span class="linenos">1347</span></a>            <span class="k">if</span> <span class="n">discarded_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1348"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1348"><span class="linenos">1348</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.run-1349"><a href="#EventDrivenAgent.ProcessEventsBehaviour.run-1349"><span class="linenos">1349</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Heap esvaziada: </span><span class="si">{</span><span class="n">discarded_count</span><span class="si">}</span><span class="s2"> eventos descartados&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Execute one cycle of event processing.</p>

<p>This method is called periodically by SPADE framework at the interval
defined by simulation_interval. It coordinates all processing steps,
from heap preparation to agent notification.</p>

<h6 id="detailed-steps">Detailed Steps:</h6>

<blockquote>
  <ol>
  <li><p><strong>Heap Preparation</strong>:</p>
  
  <ul>
  <li>Transfer arrival_events to event_heap</li>
  <li>Reinsert transit_events into heap</li>
  <li>Empty temporary buffers</li>
  </ul></li>
  <li><p><strong>Event Verification</strong>:</p>
  
  <ul>
  <li>If heap empty, terminate cycle</li>
  <li>Log state for monitoring</li>
  </ul></li>
  <li><p><strong>Event Extraction</strong>:</p>
  
  <ul>
  <li>Remove first event (smallest time)</li>
  <li>Collect subsequent events with same time</li>
  <li>Create list of events to process</li>
  </ul></li>
  <li><p><strong>Transit Management</strong>:</p>
  
  <ul>
  <li>Remove transit events from separate list</li>
  <li>Detect if last transit event was processed</li>
  <li>Update time of remaining events</li>
  </ul></li>
  <li><p><strong>Notification</strong>:</p>
  
  <ul>
  <li>Call notify_events() to distribute to agents</li>
  <li>Await send confirmations</li>
  </ul></li>
  <li><p><strong>Resimulation</strong>:</p>
  
  <ul>
  <li>If last transit event processed</li>
  <li>Send new simulation request to world agent</li>
  </ul></li>
  <li><p><strong>Statistics</strong>:</p>
  
  <ul>
  <li>Update counters</li>
  <li>Generate detailed logs if verbose=True</li>
  </ul></li>
  <li><p><strong>Cleanup</strong>:</p>
  
  <ul>
  <li>Empty event_heap</li>
  <li>Prepare for next cycle</li>
  </ul></li>
  </ol>
</blockquote>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None: Executes side effects (notifications and state updates).</p>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Decrementing transit event time ensures remaining time always
  reflects interval until next processing. Processing only begins
  after receiving first real arrival.</p>
</blockquote>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example verbose log during execution</span>
<span class="go">[event_agent]  PROCESSING EVENTS</span>
<span class="go">[event_agent] Simulation time: 5.0s</span>
<span class="go">[event_agent] Events in heap: 3</span>
<span class="go">[event_agent] Transit events: 5</span>
</code></pre>
  </div>
  
  <p>[event_agent]  Next event: Event(type=arrival, time=10.50, sender=vehicle1@localhost)
  [event_agent]  Total events with time 10.50s: 2</p>
  
  <p>[event_agent]  Notifying grouped ARRIVAL event to 3 vehicles
     Arrived vehicles: ['vehicle1', 'vehicle2']</p>
</blockquote>

<h6 id="fipa-compliance">FIPA Compliance:</h6>

<blockquote>
  <p>Sends INFORM performatives to notify agents of processed events,
  implementing broadcast notification pattern.</p>
</blockquote>
</div>


                            </div>
                            <div id="EventDrivenAgent.ProcessEventsBehaviour.notify_events" class="classattr">
                                        <input id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">notify_events</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#Event">Event</a></span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EventDrivenAgent.ProcessEventsBehaviour.notify_events-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1351"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1351"><span class="linenos">1351</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">notify_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Event</span><span class="p">]):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1352"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1352"><span class="linenos">1352</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1353"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1353"><span class="linenos">1353</span></a><span class="sd">            Notifica agentes apropriados sobre eventos processados com agrupamento inteligente.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1354"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1354"><span class="linenos">1354</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1355"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1355"><span class="linenos">1355</span></a><span class="sd">            Este mtodo distribui eventos aos agentes relevantes, implementando estratgias</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1356"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1356"><span class="linenos">1356</span></a><span class="sd">            de optimizao diferentes para cada tipo de evento. O agrupamento de arrivals</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1357"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1357"><span class="linenos">1357</span></a><span class="sd">            e o ajuste temporal de trnsito garantem eficincia e consistncia temporal.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1358"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1358"><span class="linenos">1358</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1359"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1359"><span class="linenos">1359</span></a><span class="sd">            Estratgias por Tipo:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1360"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1360"><span class="linenos">1360</span></a><span class="sd">                1. **Arrival Events**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1361"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1361"><span class="linenos">1361</span></a><span class="sd">                   - Agrupados numa nica mensagem por veculo</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1362"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1362"><span class="linenos">1362</span></a><span class="sd">                   - Lista de todos os veculos que chegaram includa</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1363"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1363"><span class="linenos">1363</span></a><span class="sd">                   - Enviada a TODOS os veculos registados</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1364"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1364"><span class="linenos">1364</span></a><span class="sd">                   - Apenas o tempo do primeiro arrival  usado</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1365"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1365"><span class="linenos">1365</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1366"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1366"><span class="linenos">1366</span></a><span class="sd">                2. **Transit Events**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1367"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1367"><span class="linenos">1367</span></a><span class="sd">                   - Enviados individualmente mas sequencialmente</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1368"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1368"><span class="linenos">1368</span></a><span class="sd">                   - Primeiro evento tem tempo real</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1369"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1369"><span class="linenos">1369</span></a><span class="sd">                   - Eventos subsequentes tm tempo 0 (evita resimulao)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1370"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1370"><span class="linenos">1370</span></a><span class="sd">                   - Enviados a veculos, armazns e lojas</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1371"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1371"><span class="linenos">1371</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1372"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1372"><span class="linenos">1372</span></a><span class="sd">                3. **UpdateSimulation Events**:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1373"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1373"><span class="linenos">1373</span></a><span class="sd">                   - Enviados apenas ao world agent</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1374"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1374"><span class="linenos">1374</span></a><span class="sd">                   - Solicita nova simulao de trfego</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1375"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1375"><span class="linenos">1375</span></a><span class="sd">                   - Usa tempo configurado em world_simulation_time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1376"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1376"><span class="linenos">1376</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1377"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1377"><span class="linenos">1377</span></a><span class="sd">            Args:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1378"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1378"><span class="linenos">1378</span></a><span class="sd">                events (List[Event]): Lista de eventos a notificar. Podem ser de tipos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1379"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1379"><span class="linenos">1379</span></a><span class="sd">                    mistos. O mtodo classifica e processa cada tipo adequadamente.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1380"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1380"><span class="linenos">1380</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1381"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1381"><span class="linenos">1381</span></a><span class="sd">            Returns:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1382"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1382"><span class="linenos">1382</span></a><span class="sd">                None: Executa efeitos colaterais (envio de mensagens XMPP).</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1383"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1383"><span class="linenos">1383</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1384"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1384"><span class="linenos">1384</span></a><span class="sd">            Message Formats:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1385"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1385"><span class="linenos">1385</span></a><span class="sd">                Arrival (agrupado):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1386"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1386"><span class="linenos">1386</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1387"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1387"><span class="linenos">1387</span></a><span class="sd">                        &quot;type&quot;: &quot;arrival&quot;,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1388"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1388"><span class="linenos">1388</span></a><span class="sd">                        &quot;time&quot;: float,              # Tempo do primeiro arrival</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1389"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1389"><span class="linenos">1389</span></a><span class="sd">                        &quot;vehicles&quot;: List[str]       # Lista de nomes de veculos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1390"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1390"><span class="linenos">1390</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1391"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1391"><span class="linenos">1391</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1392"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1392"><span class="linenos">1392</span></a><span class="sd">                Transit (individual):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1393"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1393"><span class="linenos">1393</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1394"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1394"><span class="linenos">1394</span></a><span class="sd">                        &quot;type&quot;: &quot;Transit&quot;,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1395"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1395"><span class="linenos">1395</span></a><span class="sd">                        &quot;time&quot;: float,              # Real para primeiro, 0 para restantes</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1396"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1396"><span class="linenos">1396</span></a><span class="sd">                        &quot;data&quot;: {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1397"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1397"><span class="linenos">1397</span></a><span class="sd">                            &quot;edges&quot;: [</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1398"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1398"><span class="linenos">1398</span></a><span class="sd">                                {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1399"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1399"><span class="linenos">1399</span></a><span class="sd">                                    &quot;node1&quot;: int,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1400"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1400"><span class="linenos">1400</span></a><span class="sd">                                    &quot;node2&quot;: int,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1401"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1401"><span class="linenos">1401</span></a><span class="sd">                                    &quot;weight&quot;: float,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1402"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1402"><span class="linenos">1402</span></a><span class="sd">                                    &quot;fuel_consumption&quot;: float</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1403"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1403"><span class="linenos">1403</span></a><span class="sd">                                }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1404"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1404"><span class="linenos">1404</span></a><span class="sd">                            ]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1405"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1405"><span class="linenos">1405</span></a><span class="sd">                        }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1406"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1406"><span class="linenos">1406</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1407"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1407"><span class="linenos">1407</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1408"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1408"><span class="linenos">1408</span></a><span class="sd">                UpdateSimulation:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1409"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1409"><span class="linenos">1409</span></a><span class="sd">                    {</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1410"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1410"><span class="linenos">1410</span></a><span class="sd">                        &quot;simulation_time&quot;: float,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1411"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1411"><span class="linenos">1411</span></a><span class="sd">                        &quot;requester&quot;: str            # JID do event agent</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1412"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1412"><span class="linenos">1412</span></a><span class="sd">                    }</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1413"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1413"><span class="linenos">1413</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1414"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1414"><span class="linenos">1414</span></a><span class="sd">            Examples:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1415"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1415"><span class="linenos">1415</span></a><span class="sd">                &gt;&gt;&gt; # Processar lista mista de eventos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1416"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1416"><span class="linenos">1416</span></a><span class="sd">                &gt;&gt;&gt; events = [</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1417"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1417"><span class="linenos">1417</span></a><span class="sd">                ...     Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle1@localhost&quot;),</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1418"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1418"><span class="linenos">1418</span></a><span class="sd">                ...     Event(&quot;arrival&quot;, 10.5, {}, &quot;vehicle2@localhost&quot;),</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1419"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1419"><span class="linenos">1419</span></a><span class="sd">                ...     Event(&quot;transit&quot;, 10.5, {&quot;edges&quot;: [...]})</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1420"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1420"><span class="linenos">1420</span></a><span class="sd">                ... ]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1421"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1421"><span class="linenos">1421</span></a><span class="sd">                &gt;&gt;&gt; await self.notify_events(events)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1422"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1422"><span class="linenos">1422</span></a><span class="sd">                </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1423"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1423"><span class="linenos">1423</span></a><span class="sd">                # Resultado:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1424"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1424"><span class="linenos">1424</span></a><span class="sd">                # - 1 mensagem de arrival para cada veculo registado (lista agrupada)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1425"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1425"><span class="linenos">1425</span></a><span class="sd">                # - 1 mensagem de transit para veculos + armazns + lojas</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1426"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1426"><span class="linenos">1426</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1427"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1427"><span class="linenos">1427</span></a><span class="sd">            Note:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1428"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1428"><span class="linenos">1428</span></a><span class="sd">                O ajuste de tempo para 0 em eventos subsequentes  crucial para evitar</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1429"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1429"><span class="linenos">1429</span></a><span class="sd">                que mltiplos eventos causem simulaes repetidas do mesmo intervalo</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1430"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1430"><span class="linenos">1430</span></a><span class="sd">                temporal nos agentes receptores.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1431"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1431"><span class="linenos">1431</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1432"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1432"><span class="linenos">1432</span></a><span class="sd">            Warning:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1433"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1433"><span class="linenos">1433</span></a><span class="sd">                Se world_agent no estiver configurado, eventos de updatesimulation</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1434"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1434"><span class="linenos">1434</span></a><span class="sd">                so ignorados silenciosamente com log de aviso.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1435"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1435"><span class="linenos">1435</span></a><span class="sd">            </span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1436"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1436"><span class="linenos">1436</span></a><span class="sd">            See Also:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1437"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1437"><span class="linenos">1437</span></a><span class="sd">                Event.to_dict(): Serializao de eventos para mensagens.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1438"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1438"><span class="linenos">1438</span></a><span class="sd">                ProcessEventsBehaviour.run(): Mtodo que invoca notify_events.</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1439"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1439"><span class="linenos">1439</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1440"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1440"><span class="linenos">1440</span></a>            <span class="c1"># Agrupar eventos por tipo</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1441"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1441"><span class="linenos">1441</span></a>            <span class="n">arrival_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1442"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1442"><span class="linenos">1442</span></a>            <span class="n">transit_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1443"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1443"><span class="linenos">1443</span></a>            <span class="n">other_events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1444"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1444"><span class="linenos">1444</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1445"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1445"><span class="linenos">1445</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1446"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1446"><span class="linenos">1446</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;arrival&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1447"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1447"><span class="linenos">1447</span></a>                    <span class="n">arrival_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1448"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1448"><span class="linenos">1448</span></a>                <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;Transit&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1449"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1449"><span class="linenos">1449</span></a>                    <span class="n">transit_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1450"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1450"><span class="linenos">1450</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1451"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1451"><span class="linenos">1451</span></a>                    <span class="n">other_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1452"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1452"><span class="linenos">1452</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1453"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1453"><span class="linenos">1453</span></a>            <span class="c1"># Processar eventos de arrival agrupados</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1454"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1454"><span class="linenos">1454</span></a>            <span class="k">if</span> <span class="n">arrival_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1455"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1455"><span class="linenos">1455</span></a>                <span class="c1"># Coletar todos os nomes de veculos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1456"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1456"><span class="linenos">1456</span></a>                <span class="n">vehicle_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">arrival_events</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1457"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1457"><span class="linenos">1457</span></a>                <span class="c1"># Tempo  do primeiro evento</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1458"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1458"><span class="linenos">1458</span></a>                <span class="n">event_time</span> <span class="o">=</span> <span class="n">arrival_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1459"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1459"><span class="linenos">1459</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1460"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1460"><span class="linenos">1460</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1461"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1461"><span class="linenos">1461</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento ARRIVAL agrupado para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> veculos&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1462"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1462"><span class="linenos">1462</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Veculos que chegaram: </span><span class="si">{</span><span class="n">vehicle_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1463"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1463"><span class="linenos">1463</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1464"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1464"><span class="linenos">1464</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento ARRIVAL agrupado para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span><span class="p">)</span><span class="si">}</span><span class="s2"> veculos&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1465"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1465"><span class="linenos">1465</span></a>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1466"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1466"><span class="linenos">1466</span></a>                <span class="c1"># Enviar uma nica mensagem para todos os veculos registrados</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1467"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1467"><span class="linenos">1467</span></a>                <span class="n">recipients</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> 
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1468"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1468"><span class="linenos">1468</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1469"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1469"><span class="linenos">1469</span></a>                            <span class="p">)</span> <span class="c1"># TODO + self.agent.registered_warehouses + self.agent.registered_suppliers</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1470"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1470"><span class="linenos">1470</span></a>                <span class="k">for</span> <span class="n">recipient_jid</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1471"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1471"><span class="linenos">1471</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">recipient_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1472"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1472"><span class="linenos">1472</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1473"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1473"><span class="linenos">1473</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;arrival&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1474"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1474"><span class="linenos">1474</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1475"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1475"><span class="linenos">1475</span></a>                    <span class="c1"># Criar mensagem com lista de veculos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1476"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1476"><span class="linenos">1476</span></a>                    <span class="n">event_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1477"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1477"><span class="linenos">1477</span></a>                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;arrival&quot;</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1478"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1478"><span class="linenos">1478</span></a>                        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">event_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1479"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1479"><span class="linenos">1479</span></a>                        <span class="s2">&quot;vehicles&quot;</span><span class="p">:</span> <span class="n">vehicle_names</span>  <span class="c1"># Lista de veculos</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1480"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1480"><span class="linenos">1480</span></a>                    <span class="p">}</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1481"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1481"><span class="linenos">1481</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1482"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1482"><span class="linenos">1482</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1483"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1483"><span class="linenos">1483</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1484"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1484"><span class="linenos">1484</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1485"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1485"><span class="linenos">1485</span></a>                    <span class="n">recipient_name</span> <span class="o">=</span> <span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1486"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1486"><span class="linenos">1486</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1487"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1487"><span class="linenos">1487</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1488"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1488"><span class="linenos">1488</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    </span><span class="si">{</span><span class="n">recipient_name</span><span class="si">}</span><span class="s2">: arrival (vehicles=</span><span class="si">{</span><span class="n">vehicle_names</span><span class="si">}</span><span class="s2">, time=</span><span class="si">{</span><span class="n">event_time</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1489"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1489"><span class="linenos">1489</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1490"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1490"><span class="linenos">1490</span></a>            <span class="c1"># Processar eventos de trnsito</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1491"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1491"><span class="linenos">1491</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">transit_events</span><span class="p">):</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1492"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1492"><span class="linenos">1492</span></a>                <span class="n">recipients</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_vehicles</span> <span class="o">+</span> 
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1493"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1493"><span class="linenos">1493</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">registered_stores</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1494"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1494"><span class="linenos">1494</span></a>                            <span class="p">)</span> <span class="c1"># TODO + self.agent.registered_warehouses + self.agent.registered_suppliers</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1495"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1495"><span class="linenos">1495</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1496"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1496"><span class="linenos">1496</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Notificando evento TRANSIT para </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">recipients</span><span class="p">)</span><span class="si">}</span><span class="s2"> agentes&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1497"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1497"><span class="linenos">1497</span></a>                
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1498"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1498"><span class="linenos">1498</span></a>                <span class="k">for</span> <span class="n">recipient_jid</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1499"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1499"><span class="linenos">1499</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="n">recipient_jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1500"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1500"><span class="linenos">1500</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;inform&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1501"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1501"><span class="linenos">1501</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="s2">&quot;Transit&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1502"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1502"><span class="linenos">1502</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1503"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1503"><span class="linenos">1503</span></a>                    <span class="n">event_dict</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1504"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1504"><span class="linenos">1504</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1505"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1505"><span class="linenos">1505</span></a>                    <span class="c1"># Apenas o primeiro evento tem o tempo real</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1506"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1506"><span class="linenos">1506</span></a>                    <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1507"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1507"><span class="linenos">1507</span></a>                        <span class="n">original_time</span> <span class="o">=</span> <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1508"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1508"><span class="linenos">1508</span></a>                        <span class="n">event_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1509"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1509"><span class="linenos">1509</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1510"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1510"><span class="linenos">1510</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Ajustando tempo do evento Transit para 0 (original=</span><span class="si">{</span><span class="n">original_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s) para </span><span class="si">{</span><span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1511"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1511"><span class="linenos">1511</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1512"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1512"><span class="linenos">1512</span></a>                    <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1513"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1513"><span class="linenos">1513</span></a>                    
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1514"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1514"><span class="linenos">1514</span></a>                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1515"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1515"><span class="linenos">1515</span></a>                    <span class="n">recipient_name</span> <span class="o">=</span> <span class="n">recipient_jid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1516"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1516"><span class="linenos">1516</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1517"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1517"><span class="linenos">1517</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    </span><span class="si">{</span><span class="n">recipient_name</span><span class="si">}</span><span class="s2">: Transit (time=</span><span class="si">{</span><span class="n">event_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">s)&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1518"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1518"><span class="linenos">1518</span></a>            
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1519"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1519"><span class="linenos">1519</span></a>            <span class="c1"># Processar outros eventos (updatesimulation, etc)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1520"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1520"><span class="linenos">1520</span></a>            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">other_events</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1521"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1521"><span class="linenos">1521</span></a>                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;updatesimulation&quot;</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1522"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1522"><span class="linenos">1522</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1523"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1523"><span class="linenos">1523</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1524"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1524"><span class="linenos">1524</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]  Processando evento UPDATESIMULATION - Solicitando nova simulao&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1525"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1525"><span class="linenos">1525</span></a>                        
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1526"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1526"><span class="linenos">1526</span></a>                        <span class="n">msg</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_agent</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1527"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1527"><span class="linenos">1527</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;performative&quot;</span><span class="p">,</span> <span class="s2">&quot;request&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1528"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1528"><span class="linenos">1528</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">set_metadata</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;simulate_traffic&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1529"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1529"><span class="linenos">1529</span></a>                        
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1530"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1530"><span class="linenos">1530</span></a>                        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1531"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1531"><span class="linenos">1531</span></a>                            <span class="s2">&quot;simulation_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">world_simulation_time</span><span class="p">,</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1532"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1532"><span class="linenos">1532</span></a>                            <span class="s2">&quot;requester&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">jid</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1533"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1533"><span class="linenos">1533</span></a>                        <span class="p">}</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1534"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1534"><span class="linenos">1534</span></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1535"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1535"><span class="linenos">1535</span></a>                        
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1536"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1536"><span class="linenos">1536</span></a>                        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1537"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1537"><span class="linenos">1537</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]    Pedido de re-simulao enviado ao world agent&quot;</span><span class="p">)</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1538"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1538"><span class="linenos">1538</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="EventDrivenAgent.ProcessEventsBehaviour.notify_events-1539"><a href="#EventDrivenAgent.ProcessEventsBehaviour.notify_events-1539"><span class="linenos">1539</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">]   Agente do mundo no registrado, evento ignorado&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Notifica agentes apropriados sobre eventos processados com agrupamento inteligente.</p>

<p>Este mtodo distribui eventos aos agentes relevantes, implementando estratgias
de optimizao diferentes para cada tipo de evento. O agrupamento de arrivals
e o ajuste temporal de trnsito garantem eficincia e consistncia temporal.</p>

<p>Estratgias por Tipo:
    1. <strong>Arrival Events</strong>:
       - Agrupados numa nica mensagem por veculo
       - Lista de todos os veculos que chegaram includa
       - Enviada a TODOS os veculos registados
       - Apenas o tempo do primeiro arrival  usado</p>

<pre><code>2. **Transit Events**:
   - Enviados individualmente mas sequencialmente
   - Primeiro evento tem tempo real
   - Eventos subsequentes tm tempo 0 (evita resimulao)
   - Enviados a veculos, armazns e lojas

3. **UpdateSimulation Events**:
   - Enviados apenas ao world agent
   - Solicita nova simulao de trfego
   - Usa tempo configurado em world_simulation_time
</code></pre>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>events (List[Event]):</strong>  Lista de eventos a notificar. Podem ser de tipos
mistos. O mtodo classifica e processa cada tipo adequadamente.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>None: Executa efeitos colaterais (envio de mensagens XMPP).</p>
</blockquote>

<h6 id="message-formats">Message Formats:</h6>

<blockquote>
  <p>Arrival (agrupado):
      {
          "type": "arrival",
          "time": float,              # Tempo do primeiro arrival
          "vehicles": List[str]       # Lista de nomes de veculos
      }</p>
  
  <p>Transit (individual):
      {
          "type": "Transit",
          "time": float,              # Real para primeiro, 0 para restantes
          "data": {
              "edges": [
                  {
                      "node1": int,
                      "node2": int,
                      "weight": float,
                      "fuel_consumption": float
                  }
              ]
          }
      }</p>
  
  <p>UpdateSimulation:
      {
          "simulation_time": float,
          "requester": str            # JID do event agent
      }</p>
</blockquote>

<h6 id="examples">Examples:</h6>

<blockquote>
  <div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Processar lista mista de eventos</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">events</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">... </span>    <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;arrival&quot;</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">&quot;vehicle1@localhost&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;arrival&quot;</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="p">{},</span> <span class="s2">&quot;vehicle2@localhost&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">Event</span><span class="p">(</span><span class="s2">&quot;transit&quot;</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]})</span>
<span class="gp">... </span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notify_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</code></pre>
  </div>
  
  <h1 id="resultado">Resultado:</h1>
  
  <h1 id="-1-mensagem-de-arrival-para-cada-veiculo-registado-lista-agrupada">- 1 mensagem de arrival para cada veculo registado (lista agrupada)</h1>
  
  <h1 id="-1-mensagem-de-transit-para-veiculos-armazens-lojas">- 1 mensagem de transit para veculos + armazns + lojas</h1>
</blockquote>

<h6 id="note">Note:</h6>

<blockquote>
  <p>O ajuste de tempo para 0 em eventos subsequentes  crucial para evitar
  que mltiplos eventos causem simulaes repetidas do mesmo intervalo
  temporal nos agentes receptores.</p>
</blockquote>

<h6 id="warning">Warning:</h6>

<blockquote>
  <p>Se world_agent no estiver configurado, eventos de updatesimulation
  so ignorados silenciosamente com log de aviso.</p>
</blockquote>

<h6 id="see-also">See Also:</h6>

<blockquote>
  <p><a href="#Event.to_dict">Event.to_dict()</a>: Serializao de eventos para mensagens.
  <a href="#EventDrivenAgent.ProcessEventsBehaviour.run">ProcessEventsBehaviour.run()</a>: Mtodo que invoca notify_events.</p>
</blockquote>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>